define("discourse/plugins/discourse-user-notes/discourse/adapters/user-note",["exports","discourse/adapters/rest","discourse/lib/ajax"],(function(e,s,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends s.default{destroyRecord(e,s,o){const r=this.pathFor(e,s,o.id)
return(0,t.ajax)(`${r}?user_id=${o.user_id}`,{method:"DELETE"})}}e.default=o})),define("discourse/plugins/discourse-user-notes/discourse/components/modal/user-notes",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/helper","@ember/object","@ember/service","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/components/user-link","discourse/helpers/age-with-tooltip","discourse/helpers/avatar","discourse/lib/ajax-error","discourse-i18n","@ember/template-factory"],(function(e,s,t,o,r,n,i,u,c,a,d,l,p,m,h,f){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class b extends s.default{static#e=(()=>dt7948.g(this.prototype,"dialog",[i.service]))()
#s=(()=>{dt7948.i(this,"dialog")})()
static#t=(()=>dt7948.g(this.prototype,"store",[i.service]))()
#o=(()=>{dt7948.i(this,"store")})()
static#r=(()=>dt7948.g(this.prototype,"newNote",[t.tracked]))()
#n=(()=>{dt7948.i(this,"newNote")})()
static#i=(()=>dt7948.g(this.prototype,"userId",[t.tracked],(function(){return this.args.model.userId})))()
#u=(()=>{dt7948.i(this,"userId")})()
static#c=(()=>dt7948.g(this.prototype,"saving",[t.tracked],(function(){return!1})))()
#a=(()=>{dt7948.i(this,"saving")})()
postId=this.args.model.postId
callback=this.args.model.callback
#d(){this.callback&&this.callback(this.args.model.note.length)}get attachDisabled(){return this.saving||!this.newNote||0===this.newNote.length}async attachNote(){const e=this.store.createRecord("user-note"),s=parseInt(this.userId,10)
this.saving=!0
const t={raw:this.newNote,user_id:s}
this.postId&&(t.post_id=parseInt(this.postId,10))
try{await e.save(t),this.newNote="",this.args.model.note.insertAt(0,e),this.#d()}catch(o){(0,m.popupAjaxError)(o)}finally{this.saving=!1}}static#l=(()=>dt7948.n(this.prototype,"attachNote",[n.action]))()
removeNote(e){this.dialog.deleteConfirm({message:(0,h.i18n)("user_notes.delete_confirm"),didConfirm:()=>{e.destroyRecord().then((()=>{this.args.model.note.removeObject(e),this.#d()})).catch(m.popupAjaxError)}})}static#p=(()=>dt7948.n(this.prototype,"removeNote",[n.action]))()
static#m=(()=>(0,o.setComponentTemplate)((0,f.createTemplateFactory)({id:"Ozzl46w+",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"user-notes-modal"]],[["@closeModal","@title"],[[30,1],[28,[32,1],["user_notes.title"],null]]],[["default"],[[[[1,"\\n      "],[8,[32,2],null,[["@value"],[[30,0,["newNote"]]]],null],[1,"      "],[8,[32,3],[[24,0,"btn-primary"]],[["@action","@label","@disabled"],[[30,0,["attachNote"]],"user_notes.attach",[30,0,["attachDisabled"]]]],null],[1,"\\n\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["note"]]],null]],null],null,[[[1,"        "],[10,0],[14,0,"user-note"],[12],[1,"\\n          "],[10,0],[14,0,"posted-by"],[12],[1,"\\n            "],[8,[32,4],null,[["@user"],[[30,3,["created_by"]]]],[["default"],[[[[1,"\\n              "],[1,[28,[32,5],[[30,3,["created_by"]]],[["imageSize"],["small"]]]],[1,"\\n            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[14,0,"note-contents"],[12],[1,"\\n            "],[10,0],[14,0,"note-info"],[12],[1,"\\n              "],[10,1],[14,0,"username"],[12],[1,[30,3,["created_by","username"]]],[13],[1,"\\n              "],[10,1],[14,0,"post-date"],[12],[1,[28,[32,6],[[30,3,["created_at"]]],null]],[13],[1,"\\n\\n"],[41,[30,3,["can_delete"]],[[[1,"                "],[10,1],[14,0,"controls"],[12],[1,"\\n                  "],[8,[32,3],[[24,0,"btn-small btn-danger"]],[["@action","@icon","@title"],[[28,[32,7],[[30,0,["removeNote"]],[30,3]],null],"far-trash-can","user_notes.remove"]],null],[1,"\\n                "],[13],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"cooked"],[12],[1,"\\n              "],[8,[32,8],null,[["@rawText"],[[30,3,["raw"]]]],null],[1,"\\n            "],[13],[1,"\\n\\n"],[41,[30,3,["post_id"]],[[[1,"              "],[10,3],[15,6,[30,3,["post_url"]]],[14,0,"btn btn-small"],[12],[1,"\\n                "],[1,[28,[32,1],["user_notes.show_post"],null]],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n\\n          "],[10,0],[14,0,"clearfix"],[12],[13],[1,"\\n        "],[13],[1,"\\n"]],[3]],null],[1,"    "]],[]]]]],[1,"\\n  "]],["@closeModal","@model","n"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-user-notes/discourse/components/modal/user-notes.js",scope:()=>[a.default,h.i18n,o.Textarea,c.default,d.default,p.default,l.default,r.fn,u.default],isStrictMode:!0}),this))()}e.default=b})),define("discourse/plugins/discourse-user-notes/discourse/components/show-user-notes",["exports","@glimmer/component","discourse/components/d-button","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,s,t,o,r,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{get label(){return this.args.count>0?(0,o.i18n)("user_notes.show",{count:this.args.count}):(0,o.i18n)("user_notes.title")}static#e=(()=>(0,r.setComponentTemplate)((0,n.createTemplateFactory)({id:"leXVmJX6",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"btn-default show-user-notes-btn"]],[["@action","@icon","@translatedLabel"],[[30,1],"pen-to-square",[30,0,["label"]]]],null],[1,"\\n  "]],["@show"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-user-notes/discourse/components/show-user-notes.js",scope:()=>[t.default],isStrictMode:!0}),this))()}e.default=i})),define("discourse/plugins/discourse-user-notes/discourse/connectors/admin-dashboard-moderation-bottom/recent-user-notes-report-table",["exports","@ember/component","@ember-decorators/component","admin/components/admin-report","@ember/template-factory"],(function(e,s,t,o,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=dt7948.c(class extends s.default{static#e=(()=>(0,s.setComponentTemplate)((0,r.createTemplateFactory)({id:"uHWssNAm",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","user_notes_enabled"]],[[[1,"      "],[8,[32,0],null,[["@dataSourceName","@filters"],["user_notes",[30,0,["filters"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/admin-dashboard-moderation-bottom/recent-user-notes-report-table.js",scope:()=>[o.default],isStrictMode:!0}),this))()},[(0,t.classNames)("admin-dashboard-moderation-bottom-outlet","recent-user-notes-report-table"),(0,t.tagName)("div")])
e.default=n})),define("discourse/plugins/discourse-user-notes/discourse/connectors/admin-user-controls-after/add-user-notes-button",["exports","@ember/component","@ember/object","@ember/service","@ember-decorators/component","discourse/plugins/discourse-user-notes/discourse/components/show-user-notes","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/template-factory"],(function(e,s,t,o,r,n,i,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=dt7948.c(class extends s.default{static shouldRender(e,s){const{siteSettings:t,currentUser:o}=s
return t.user_notes_enabled&&o&&o.staff}static#e=(()=>dt7948.g(this.prototype,"store",[o.service]))()
#o=(()=>{dt7948.i(this,"store")})()
init(){super.init(...arguments)
const{model:e}=this
this.set("userNotesCount",e.user_notes_count||e.get("custom_fields.user_notes_count")||0)}showUserNotes(){const e=this.model;(0,i.showUserNotes)(this.store,e.id,(e=>this.set("userNotesCount",e)))}static#t=(()=>dt7948.n(this.prototype,"showUserNotes",[t.action]))()
static#r=(()=>(0,s.setComponentTemplate)((0,u.createTemplateFactory)({id:"uK/6ZtEs",block:'[[[1,"\\n    "],[8,[32,0],null,[["@show","@count"],[[30,0,["showUserNotes"]],[30,0,["userNotesCount"]]]],null],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/admin-user-controls-after/add-user-notes-button.js",scope:()=>[n.default],isStrictMode:!0}),this))()},[(0,r.classNames)("admin-user-controls-after-outlet","add-user-notes-button"),(0,r.tagName)("")])
e.default=c})),define("discourse/plugins/discourse-user-notes/discourse/connectors/after-reviewable-post-user/show-user-notes-on-flags",["exports","@ember/component","@ember/object","@ember/service","@ember-decorators/component","discourse/components/d-button","discourse/helpers/d-icon","discourse/lib/text","discourse-i18n","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/template-factory"],(function(e,s,t,o,r,n,i,u,c,a,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=dt7948.c(class extends s.default{static shouldRender(e,s){return s.siteSettings.user_notes_enabled&&e.user}static#e=(()=>dt7948.g(this.prototype,"store",[o.service]))()
#o=(()=>{dt7948.i(this,"store")})()
init(){super.init(...arguments)
const e=t.default.create(this.user).get("custom_fields.user_notes_count")||0
this.setProperties({userNotesCount:e,emojiEnabled:this.siteSettings.enable_emoji,emojiUrl:(0,u.emojiUrlFor)("memo"),userNotesTitle:(0,c.i18n)("user_notes.show",{count:e})})}showUserNotes(){const e=this.user;(0,a.showUserNotes)(this.store,e.id,(e=>this.set("userNotesCount",e)))}static#t=(()=>dt7948.n(this.prototype,"showUserNotes",[t.action]))()
static#r=(()=>(0,s.setComponentTemplate)((0,d.createTemplateFactory)({id:"7qhlC0gG",block:'[[[1,"\\n"],[41,[30,0,["userNotesCount"]],[[[1,"      "],[8,[32,0],[[24,0,"btn btn-flat"]],[["@translatedTitle","@action"],[[30,0,["userNotesTitle"]],[30,0,["showUserNotes"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["emojiEnabled"]],[[[1,"          "],[10,"img"],[15,"src",[30,0,["emojiUrl"]]],[15,"title",[30,0,["userNotesTitle"]]],[14,"alt",""],[14,0,"emoji"],[12],[13],[1,"\\n"]],[]],[[[1,"          "],[1,[28,[32,1],["pen-to-square"],null]],[1,"\\n"]],[]]],[1,"      "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/after-reviewable-post-user/show-user-notes-on-flags.js",scope:()=>[n.default,i.default],isStrictMode:!0}),this))()},[(0,r.classNames)("after-reviewable-post-user-outlet","show-user-notes-on-flags"),(0,r.tagName)("div")])
e.default=l})),define("discourse/plugins/discourse-user-notes/discourse/connectors/user-card-post-names/show-user-notes-on-card",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/helpers/d-icon","discourse/helpers/emoji","discourse-i18n","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/component","@ember/template-factory"],(function(e,s,t,o,r,n,i,u,c,a,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends s.default{static shouldRender(e,s){const{siteSettings:t,currentUser:o}=s
return t.user_notes_enabled&&o?.staff}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[o.service]))()
#h=(()=>{dt7948.i(this,"siteSettings")})()
static#t=(()=>dt7948.g(this.prototype,"currentUser",[o.service]))()
#f=(()=>{dt7948.i(this,"currentUser")})()
static#r=(()=>dt7948.g(this.prototype,"store",[o.service]))()
#o=(()=>{dt7948.i(this,"store")})()
get userNotesCount(){return parseInt(this.args.outletArgs.user.get("user_notes_count")||this.args.outletArgs.user.get("custom_fields.user_notes_count")||0,10)}showUserNotes(){(0,c.showUserNotes)(this.store,this.args.outletArgs.user.id)}static#i=(()=>dt7948.n(this.prototype,"showUserNotes",[t.action]))()
static#c=(()=>(0,a.setComponentTemplate)((0,d.createTemplateFactory)({id:"Fq27XKLe",block:'[[[1,"\\n    "],[10,0],[14,0,"show-user-notes-on-card"],[12],[1,"\\n"],[41,[30,0,["userNotesCount"]],[[[1,"        "],[8,[32,0],[[24,0,"btn-flat"]],[["@translatedTitle","@action"],[[28,[32,1,["t"]],["user_notes.show"],[["count"],[[30,0,["userNotesCount"]]]]],[30,0,["showUserNotes"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["siteSettings","enable_emoji"]],[[[1,"            "],[1,[28,[32,2],["memo"],null]],[1,"\\n"]],[]],[[[1,"            "],[1,[28,[32,3],["pen-to-square"],null]],[1,"\\n"]],[]]],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/user-card-post-names/show-user-notes-on-card.js",scope:()=>[r.default,u.default,i.default,n.default],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-user-notes/discourse/connectors/user-profile-controls/show-notes-on-profile",["exports","@ember/component","@ember/object","@ember/service","@ember-decorators/component","discourse/plugins/discourse-user-notes/discourse/components/show-user-notes","discourse/plugins/discourse-user-notes/discourse/lib/user-notes","@ember/template-factory"],(function(e,s,t,o,r,n,i,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const c=dt7948.c(class extends s.default{static shouldRender(e,s){const{siteSettings:t,currentUser:o}=s
return t.user_notes_enabled&&o&&o.staff}static#e=(()=>dt7948.g(this.prototype,"store",[o.service]))()
#o=(()=>{dt7948.i(this,"store")})()
init(){super.init(...arguments)
const{model:e}=this
this.set("userNotesCount",e.user_notes_count||e.get("custom_fields.user_notes_count")||0)}showUserNotes(){const e=this.model;(0,i.showUserNotes)(this.store,e.id,(e=>this.set("userNotesCount",e)))}static#t=(()=>dt7948.n(this.prototype,"showUserNotes",[t.action]))()
static#r=(()=>(0,s.setComponentTemplate)((0,u.createTemplateFactory)({id:"Aq/WcyCD",block:'[[[1,"\\n    "],[8,[32,0],null,[["@show","@count"],[[30,0,["showUserNotes"]],[30,0,["userNotesCount"]]]],null],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-user-notes/discourse/connectors/user-profile-controls/show-notes-on-profile.js",scope:()=>[n.default],isStrictMode:!0}),this))()},[(0,r.classNames)("user-profile-controls-outlet","show-notes-on-profile"),(0,r.tagName)("li")])
e.default=c})),define("discourse/plugins/discourse-user-notes/discourse/initializers/enable-user-notes",["exports","discourse/lib/icon-library","discourse/lib/plugin-api","discourse/plugins/discourse-user-notes/discourse/lib/user-notes"],(function(e,s,t,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"enable-user-notes",initialize(e){const r=e.lookup("service:site-settings"),n=e.lookup("service:current-user"),i=e.lookup("service:app-events")
if(!r.user_notes_enabled||!n?.staff)return
const u=e.lookup("service:store");(0,t.withPluginApi)("0.8.15",(e=>{function t(){(0,o.showUserNotes)(this.store,this.attrs.user_id,(e=>{this.sendWidgetAction("refreshUserNotes",e)}),{postId:this.attrs.id})}e.attachWidgetAction("post","refreshUserNotes",(function(e){const s=this.model.user_custom_fields||{}
s.user_notes_count=e,this.model.set("user_custom_fields",s)}))
const r=e.container.lookup("service:site").mobileView?"before":"after"
e.decorateWidget(`poster-name:${r}`,(e=>{if(e.widget.settings.hideNotes)return
const s=e.getModel()
if(!s)return
return(s.user_custom_fields||{}).user_notes_count>0?e.attach("user-notes-icon"):void 0})),e.decorateWidget("post-avatar:after",(e=>{if(!e.widget.settings.showNotes)return
const s=e.getModel()
if(!s)return
return(s.user_custom_fields||{}).user_notes_count>0?e.attach("user-notes-icon"):void 0})),e.addPostAdminMenuButton((e=>({icon:"pen-to-square",label:"user_notes.attach",action:s=>{(0,o.showUserNotes)(u,e.user_id,(e=>{const t=s.user_custom_fields||{}
t.user_notes_count=e,s.set("user_custom_fields",t),i.trigger("post-stream:refresh",{id:s.id})}),{postId:e.id})},secondaryAction:"closeAdminMenu",className:"add-user-note"}))),e.attachWidgetAction("post","showUserNotes",t),e.createWidget("user-notes-icon",{services:["site-settings"],tagName:"span.user-notes-icon",click:t,html(){return this.siteSettings.enable_emoji?this.attach("emoji",{name:"memo"}):(0,s.iconNode)("pen-to-square")}})}))}}})),define("discourse/plugins/discourse-user-notes/discourse/lib/user-notes",["exports","discourse/lib/get-owner","discourse/plugins/discourse-user-notes/discourse/components/modal/user-notes"],(function(e,s,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.showUserNotes=function(e,o,r,n){const i=(0,s.getOwnerWithFallback)(this).lookup("service:modal")
return n=n||{},e.find("user-note",{user_id:o}).then((e=>i.show(t.default,{model:{note:e,userId:o,callback:r,postId:n.postId}})))}}))

//# sourceMappingURL=discourse-user-notes-fb1e4435.map