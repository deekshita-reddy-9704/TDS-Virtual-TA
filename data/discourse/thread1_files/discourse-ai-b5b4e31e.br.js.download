define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-plugin-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.adminPlugins.show",path:"/plugins",map(){this.route("discourse-ai-personas",{path:"ai-personas"},(function(){this.route("new"),this.route("edit",{path:"/:id/edit"})})),this.route("discourse-ai-llms",{path:"ai-llms"},(function(){this.route("new"),this.route("edit",{path:"/:id/edit"})})),this.route("discourse-ai-tools",{path:"ai-tools"},(function(){this.route("new"),this.route("edit",{path:"/:id/edit"})})),this.route("discourse-ai-spam",{path:"ai-spam"}),this.route("discourse-ai-usage",{path:"ai-usage"}),this.route("discourse-ai-embeddings",{path:"ai-embeddings"},(function(){this.route("new"),this.route("edit",{path:"/:id/edit"})})),this.route("discourse-ai-features",{path:"ai-features"},(function(){this.route("edit",{path:"/:id/edit"})}))}}})),define("discourse/plugins/discourse-ai/discourse/admin-discourse-ai-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"admin.dashboard",path:"/dashboard",map(){this.route("admin.dashboardSentiment",{path:"/dashboard/sentiment",resetNamespace:!0})}}})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-embedding",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-embedding"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-feature",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-feature"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-llm",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-llm"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-persona",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-persona"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/adapters/ai-tool",["exports","discourse/adapters/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{jsonMode=!0
basePath(){return"/admin/plugins/discourse-ai/"}pathFor(e,t,s){let i=this.basePath(e,t,s)+e.pluralize(this.apiNameFor(t))
return this.appendQueryParams(i,s)}apiNameFor(){return"ai-tool"}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-embedding",["exports","discourse/lib/ajax","discourse/models/rest"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{createProperties(){return this.getProperties("id","display_name","dimensions","provider","tokenizer_class","dimensions","url","api_key","max_sequence_length","provider_params","pg_function","embed_prompt","search_prompt","matryoshka_dimensions")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e}async testConfig(){return await(0,t.ajax)("/admin/plugins/discourse-ai/ai-embeddings/test.json",{data:{ai_embedding:this.createProperties()}})}workingCopy(){const e=this.createProperties()
return this.store.createRecord("ai-embedding",e)}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-feature",["exports","discourse/models/rest"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class s extends t.default{createProperties(){return this.getProperties("id","module","global_enabled","features")}}e.default=s})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-llm",["exports","discourse/lib/ajax","discourse/models/rest"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{createProperties(){return this.getProperties("id","display_name","name","provider","tokenizer","max_prompt_tokens","max_output_tokens","url","api_key","enabled_chat_bot","provider_params","vision_enabled","input_cost","cached_input_cost","output_cost")}updateProperties(){const e=this.createProperties()
return e.id=this.id,e.llm_quotas=this.llm_quotas,e}async testConfig(e){return await(0,t.ajax)("/admin/plugins/discourse-ai/ai-llms/test.json",{data:{ai_llm:e??this.createProperties()}})}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-persona",["exports","discourse/lib/ajax","discourse/models/rest"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=["id","name","description","tools","system_prompt","allowed_group_ids","enabled","system","priority","top_p","temperature","user_id","default_llm_id","force_default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","rag_llm_model_id","question_consolidator_llm_id","allow_chat","tool_details","forced_tool_count","allow_personal_messages","allow_topic_mentions","allow_chat_channel_mentions","allow_chat_direct_messages","response_format","examples"],o=["id","allowed_group_ids","enabled","system","priority","tools","user_id","default_llm_id","force_default_llm","user","max_context_posts","vision_enabled","vision_max_pixels","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_conversation_chunks","rag_llm_model_id","question_consolidator_llm_id","tool_details","allow_personal_messages","allow_topic_mentions","allow_chat_channel_mentions","allow_chat_direct_messages"]
class n extends s.default{async createUser(){const e=await(0,t.ajax)(`/admin/plugins/discourse-ai/ai-personas/${this.id}/create-user.json`,{type:"POST"})
return this.user=e.user,this.user_id=this.user.id,this.user}flattenedToolStructure(e){return(e.tools||[]).map((t=>[t,e.toolOptions[t]||{},e.forcedTools.includes(t)]))}populateTools(e){const t=[],s={},i=e.tools?.map((e=>{if("string"==typeof e)return e
{let[i,o,n]=e
const a={}
for(const e in o)o.hasOwnProperty(e)&&(a[e]=o[e])
return Object.keys(a).length>0&&(s[i]=a),n&&t.push(i),i}}))
e.tools=i,e.forcedTools=t,e.toolOptions=s}updateProperties(){const e=this.system?this.getProperties(o):this.getProperties(i)
return e.id=this.id,e}createProperties(){return this.getProperties(i)}fromPOJO(e){const t=JSON.parse(JSON.stringify(e)),s=n.create(t)
return s.tools=this.flattenedToolStructure(t),s}toPOJO(){const e=this.getProperties(i)
return this.populateTools(e),e.forced_tool_count=this.forced_tool_count||-1,e.response_format=e.response_format||[],e.examples=e.examples||[],e}}e.default=n})),define("discourse/plugins/discourse-ai/discourse/admin/models/ai-tool",["exports","@ember-compat/tracked-built-ins","discourse/models/rest"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const i=["id","name","tool_name","description","parameters","script","summary","rag_uploads","rag_chunk_tokens","rag_chunk_overlap_tokens","rag_llm_model_id","enabled"]
class o extends s.default{createProperties(){return this.getProperties(i)}updateProperties(){return this.getProperties(i)}trackParameters(e){return new t.TrackedArray(e?.map((e=>{const s=new t.TrackedObject(e)
return s.enum&&s.enum.length?s.enum=new t.TrackedArray(s.enum):s.enum=null,s})))}workingCopy(){const e=this.getProperties(i)
return e.parameters=this.trackParameters(e.parameters),this.store.createRecord("ai-tool",e)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/components/admin-report-emotion",["exports","@ember/component","@ember-decorators/component","discourse/lib/get-url","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,o.createTemplateFactory)({id:"6OhgoeVo",block:'[[[10,0],[14,0,"cell title"],[12],[1,"\\n"],[41,[30,0,["model","icon"]],[[[1,"    "],[1,[28,[35,2],[[30,0,["model","icon"]]],null]],[1,"\\n"]],[]],null],[1,"  "],[1,[30,0,["model","title"]]],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,0,"cell value today-count"],[12],[1,"\\n  "],[10,3],[15,6,[30,0,["todayLink"]]],[12],[1,"\\n    "],[1,[28,[35,4],[[30,0,["model","todayCount"]]],null]],[1,"\\n  "],[13],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[15,0,[29,["cell value yesterday-count ",[30,0,["model","yesterdayTrend"]]]]],[15,"title",[30,0,["model","yesterdayCountTitle"]]],[12],[1,"\\n  "],[10,3],[15,6,[30,0,["yesterdayLink"]]],[12],[1,"\\n    "],[1,[28,[35,4],[[30,0,["model","yesterdayCount"]]],null]],[1,"\\n  "],[13],[1,"\\n  "],[1,[28,[35,2],[[30,0,["model","yesterdayTrendIcon"]]],null]],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[15,0,[29,["cell value sevendays-count ",[30,0,["model","sevenDaysTrend"]]]]],[15,"title",[30,0,["model","sevenDaysCountTitle"]]],[12],[1,"\\n  "],[10,3],[15,6,[30,0,["lastSevenDaysLink"]]],[12],[1,"\\n    "],[1,[28,[35,4],[[30,0,["model","lastSevenDaysCount"]]],null]],[1,"\\n  "],[13],[1,"\\n  "],[1,[28,[35,2],[[30,0,["model","sevenDaysTrendIcon"]]],null]],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[15,0,[29,["cell value thirty-days-count ",[30,0,["model","thirtyDaysTrend"]]]]],[15,"title",[30,0,["model","thirtyDaysCountTitle"]]],[12],[1,"\\n\\n  "],[10,3],[15,6,[30,0,["lastThirtyDaysLink"]]],[12],[1,"\\n    "],[1,[28,[35,4],[[30,0,["model","lastThirtyDaysCount"]]],null]],[1,"\\n  "],[13],[1,"\\n"],[41,[30,0,["model","canDisplayTrendIcon"]],[[[1,"    "],[1,[28,[35,2],[[30,0,["model","thirtyDaysTrendIcon"]]],null]],[1,"\\n"]],[]],null],[13]],[],false,["div","if","d-icon","a","number"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/admin-report-emotion.hbs",isStrictMode:!1}),a=dt7948.c(class extends t.default{get todayLink(){let e=moment().format("YYYY-MM-DD")
return this._filterURL(e)}get yesterdayLink(){let e=moment().subtract(1,"day").format("YYYY-MM-DD")
return this._filterURL(e)}get lastSevenDaysLink(){let e=moment().subtract(1,"week").format("YYYY-MM-DD")
return this._filterURL(e)}get lastThirtyDaysLink(){let e=moment().subtract(1,"month").format("YYYY-MM-DD")
return this._filterURL(e)}_baseFilter(){return"/filter?q=activity-after%3A"}_model(){return"%20order%3A"+this.model.type}_filterURL(e){return(0,i.default)(`${this._baseFilter()}${e}${this._model()}`)}},[(0,s.attributeBindings)("model.description:title"),(0,s.classNames)("admin-report-counters")])
e.default=(0,t.setComponentTemplate)(n,a)})),define("discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","ember-modifier","truth-helpers","discourse/components/d-button","discourse/components/horizontal-overflow-nav","discourse/components/post-list","discourse/helpers/body-class","discourse/helpers/category-badge","discourse/helpers/d-icon","discourse/helpers/replace-emoji","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse/lib/later","discourse/lib/utilities","discourse/models/category","discourse/models/post","discourse-i18n","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/doughnut-chart","discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T,P,C,j,M){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class A extends t.default{static#e=(()=>dt7948.g(this.prototype,"router",[r.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#s=(()=>dt7948.g(this.prototype,"selectedChart",[s.tracked],(function(){return null})))()
#i=(()=>{dt7948.i(this,"selectedChart")})()
static#o=(()=>dt7948.g(this.prototype,"posts",[s.tracked],(function(){return[]})))()
#n=(()=>{dt7948.i(this,"posts")})()
static#a=(()=>dt7948.g(this.prototype,"hasMorePosts",[s.tracked],(function(){return!1})))()
#r=(()=>{dt7948.i(this,"hasMorePosts")})()
static#l=(()=>dt7948.g(this.prototype,"nextOffset",[s.tracked],(function(){return 0})))()
#d=(()=>{dt7948.i(this,"nextOffset")})()
static#u=(()=>dt7948.g(this.prototype,"showingSelectedChart",[s.tracked],(function(){return!1})))()
#c=(()=>{dt7948.i(this,"showingSelectedChart")})()
static#p=(()=>dt7948.g(this.prototype,"activeFilter",[s.tracked],(function(){return"all"})))()
#m=(()=>{dt7948.i(this,"activeFilter")})()
static#h=(()=>dt7948.g(this.prototype,"shareIcon",[s.tracked],(function(){return"link"})))()
#g=(()=>{dt7948.i(this,"shareIcon")})()
setActiveFilter=(()=>(0,l.modifier)((e=>{this.clearActiveFilters(e),e.querySelector(`li[data-filter-type="${this.activeFilter}"] button`).classList.add("active")})))()
clearActiveFilters(e){const t=e.querySelectorAll("li button")
for(let s of t)s.classList.remove("active")}calculateNeutralScore(e){return e.total_count-(e.positive_count+e.negative_count)}sentimentMapping(e){switch(e){case"positive":return{id:"positive",text:(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.positive"),icon:"face-smile"}
case"neutral":return{id:"neutral",text:(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.neutral"),icon:"face-meh"}
case"negative":return{id:"negative",text:(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.negative"),icon:"face-angry"}}}get groupingType(){const e="discourse_ai.sentiments.sentiment_analysis.group_types"
return this.args.model.data[0].category_name?(0,k.i18n)(`${e}.category`):(0,k.i18n)(`${e}.tag`)}get colors(){return["#2ecc71","#95a5a6","#e74c3c"]}get currentGroupFilter(){return this.args.model.available_filters.find((e=>"group_by"===e.id)).default}get currentSortFilter(){return this.args.model.available_filters.find((e=>"sort_by"===e.id)).default}get transformedData(){return this.args.model.data.map((e=>({category:S.default.findById(e.category_id),title:e.category_name||e.tag_name,scores:[e.positive_count,this.calculateNeutralScore(e),e.negative_count],score_map:{positive:e.positive_count,neutral:this.calculateNeutralScore(e),negative:e.negative_count},total_score:e.total_count,widths:{positive:e.positive_count/e.total_count*100,neutral:this.calculateNeutralScore(e)/e.total_count*100,negative:e.negative_count/e.total_count*100}})))}get filteredPosts(){return this.posts&&this.posts.length?this.posts.filter((e=>(e.topic_title=(0,_.default)(e.topic_title),e.category=S.default.findById(e.category_id),"all"===this.activeFilter||e.sentiment===this.activeFilter))):[]}get postFilters(){return[{id:"all",text:`${(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.all")} (${this.selectedChart.total_score})`,icon:"bars-staggered",action:()=>{this.activeFilter="all"}},{id:"positive",text:`${(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.positive")} (${this.selectedChart.scores[0]})`,icon:"face-smile",action:()=>{this.activeFilter="positive"}},{id:"neutral",text:`${(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.neutral")} (${this.selectedChart.scores[1]})`,icon:"face-meh",action:()=>{this.activeFilter="neutral"}},{id:"negative",text:`${(0,k.i18n)("discourse_ai.sentiments.sentiment_analysis.filter_types.negative")} (${this.selectedChart.scores[2]})`,icon:"face-angry",action:()=>{this.activeFilter="negative"}}]}async postRequest(){return await(0,f.ajax)("/discourse-ai/sentiment/posts",{data:{group_by:this.currentGroupFilter,group_value:this.selectedChart?.title,start_date:this.args.model.start_date,end_date:this.args.model.end_date,offset:this.nextOffset}})}async openToChart(){const e=this.router.currentRoute.queryParams
if(e.selectedChart){if(this.selectedChart=this.transformedData.find((t=>t.title===e.selectedChart)),!this.selectedChart)return
this.showingSelectedChart=!0
try{const e=await this.postRequest()
this.posts=e.posts.map((e=>x.default.create(e))),this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset}catch(t){(0,b.popupAjaxError)(t)}}}static#_=(()=>dt7948.n(this.prototype,"openToChart",[n.action]))()
async showDetails(e){if(this.selectedChart===e)return
const t=this.router.currentRoute.queryParams,s=t?.filters?JSON.parse(t.filters):{}
this.router.transitionTo(this.router.currentRoute.name,{queryParams:{...t,filters:s,selectedChart:e.title}}),this.selectedChart=e,this.showingSelectedChart=!0
try{const e=await this.postRequest()
this.posts=e.posts.map((e=>x.default.create(e))),this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset}catch(i){(0,b.popupAjaxError)(i)}}static#f=(()=>dt7948.n(this.prototype,"showDetails",[n.action]))()
async fetchMorePosts(){if(!this.hasMorePosts||null===this.selectedChart)return[]
try{const e=await this.postRequest()
this.hasMorePosts=e.has_more,this.nextOffset=e.next_offset
const t=e.posts.map((e=>x.default.create(e)))
return this.posts.pushObjects(t),t}catch(e){(0,b.popupAjaxError)(e)}}static#b=(()=>dt7948.n(this.prototype,"fetchMorePosts",[n.action]))()
backToAllCharts(){this.showingSelectedChart=!1,this.selectedChart=null,this.activeFilter="all",this.posts=[]
const e=this.router.currentRoute.queryParams,t=e?.filters?JSON.parse(e.filters):{}
this.router.transitionTo(this.router.currentRoute.name,{queryParams:{...e,filters:t,selectedChart:null}})}static#y=(()=>dt7948.n(this.prototype,"backToAllCharts",[n.action]))()
shareChart(){const e=this.router.currentURL
e&&((0,w.clipboardCopy)((0,y.getAbsoluteURL)(e)),this.shareIcon="check",(0,v.default)((()=>{this.shareIcon="link"}),2e3))}static#v=(()=>dt7948.n(this.prototype,"shareChart",[n.action]))()
static#w=(()=>(0,j.setComponentTemplate)((0,M.createTemplateFactory)({id:"vaenlI3f",block:'[[[1,"\\n    "],[11,1],[4,[32,0],[[30,0,["openToChart"]]],null],[12],[13],[1,"\\n\\n"],[41,[51,[30,0,["showingSelectedChart"]]],[[[1,"      "],[10,0],[14,0,"admin-report-sentiment-analysis"],[12],[1,"\\n        "],[10,"table"],[14,0,"sentiment-analysis-table md-table"],[12],[1,"\\n          "],[10,"thead"],[12],[1,"\\n            "],[10,"th"],[12],[1,[30,0,["groupingType"]]],[13],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.table.total_count"],null]],[13],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.table.sentiment"],null]],[13],[1,"\\n          "],[13],[1,"\\n\\n          "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["transformedData"]]],null]],null],null,[[[1,"              "],[11,"tr"],[24,0,"sentiment-analysis-table__row"],[24,"role","button"],[4,[32,2],["click",[28,[32,3],[[30,0,["showDetails"]],[30,1]],null]],null],[12],[1,"\\n                "],[10,"td"],[14,0,"sentiment-analysis-table__title"],[12],[1,"\\n"],[41,[30,1,["category"]],[[[1,"                    "],[1,[28,[32,4],[[30,1,["category"]]],null]],[1,"\\n"]],[]],[[[1,"                    "],[1,[30,1,["title"]]],[1,"\\n"]],[]]],[1,"                "],[13],[1,"\\n                "],[10,"td"],[14,0,"sentiment-analysis-table__total-score"],[12],[1,[30,1,["total_score"]]],[13],[1,"\\n                "],[10,"td"],[14,0,"sentiment-horizontal-bar"],[12],[1,"\\n                  "],[8,[32,5],null,[["@type","@score","@width"],["positive",[30,1,["score_map","positive"]],[30,1,["widths","positive"]]]],null],[1,"\\n                  "],[8,[32,5],null,[["@type","@score","@width"],["negative",[30,1,["score_map","negative"]],[30,1,["widths","negative"]]]],null],[1,"\\n                  "],[8,[32,5],null,[["@type","@score","@width"],["neutral",[30,1,["score_map","neutral"]],[30,1,["widths","neutral"]]]],null],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[1]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,6],[[30,0,["selectedChart"]],[30,0,["showingSelectedChart"]]],null],[[[1,"      "],[1,[28,[32,7],["showing-sentiment-analysis-chart"],null]],[1,"\\n      "],[10,0],[14,0,"admin-report-sentiment-analysis__selected-chart"],[12],[1,"\\n        "],[10,0],[14,0,"admin-report-sentiment-analysis__selected-chart-actions"],[12],[1,"\\n          "],[8,[32,8],[[24,0,"btn-flat"]],[["@label","@icon","@action"],["back_button","chevron-left",[30,0,["backToAllCharts"]]]],null],[1,"\\n\\n          "],[8,[32,9],[[24,0,"share btn-flat"],[4,[32,2],["click",[30,0,["shareChart"]]],null]],[["@icon","@content"],[[30,0,["shareIcon"]],[28,[32,1],["discourse_ai.sentiments.sentiment_analysis.share_chart"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[8,[32,10],null,[["@labels","@colors","@data","@totalScore","@doughnutTitle","@displayLegend"],[[30,2,["labels"]],[30,0,["colors"]],[30,0,["selectedChart","scores"]],[30,0,["selectedChart","total_score"]],[30,0,["selectedChart","title"]],true]],null],[1,"\\n\\n      "],[13],[1,"\\n      "],[10,0],[14,0,"admin-report-sentiment-analysis-details"],[12],[1,"\\n        "],[8,[32,11],[[24,0,"admin-report-sentiment-analysis-details__filters"],[4,[30,0,["setActiveFilter"]],null,null]],null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["postFilters"]]],null]],null],null,[[[1,"            "],[10,"li"],[15,"data-filter-type",[30,3,["id"]]],[12],[1,"\\n              "],[8,[32,8],[[24,0,"btn-transparent"]],[["@icon","@translatedLabel","@action"],[[30,3,["icon"]],[30,3,["text"]],[30,3,["action"]]]],null],[1,"\\n            "],[13],[1,"\\n"]],[3]],null],[1,"        "]],[]]]]],[1,"\\n\\n        "],[8,[32,12],[[24,0,"admin-report-sentiment-analysis-details__post-list"]],[["@posts","@urlPath","@idPath","@titlePath","@usernamePath","@fetchMorePosts"],[[30,0,["filteredPosts"]],"url","post_id","topic_title","username",[30,0,["fetchMorePosts"]]]],[["abovePostItemExcerpt"],[[[[1,"\\n"],[44,[[28,[30,0,["sentimentMapping"]],[[30,4,["sentiment"]]],null]],[[[1,"              "],[10,1],[14,0,"admin-report-sentiment-analysis-details__post-score"],[15,"data-sentiment-score",[30,5,["id"]]],[12],[1,"\\n                "],[1,[28,[32,13],[[30,5,["icon"]]],null]],[1,"\\n                "],[1,[30,5,["text"]]],[1,"\\n              "],[13],[1,"\\n"]],[5]]],[1,"          "]],[4]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["data","@model","filter","post","sentiment"],false,["unless","each","-track-array","if","let"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis.js",scope:()=>[a.default,k.i18n,o.on,i.fn,h.default,C.default,d.and,m.default,u.default,T.default,P.default,c.default,p.default,g.default],isStrictMode:!0}),this))()}e.default=A})),define("discourse/plugins/discourse-ai/discourse/components/ai-artifact",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-button","discourse/helpers/html-class","discourse/lib/get-url","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[n.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#s=(()=>dt7948.g(this.prototype,"expanded",[s.tracked],(function(){return!1})))()
#x=(()=>{dt7948.i(this,"expanded")})()
static#o=(()=>dt7948.g(this.prototype,"showingArtifact",[s.tracked],(function(){return!1})))()
#k=(()=>{dt7948.i(this,"showingArtifact")})()
constructor(){super(...arguments),this.keydownHandler=this.handleKeydown.bind(this),this.popStateHandler=this.handlePopState.bind(this),window.addEventListener("popstate",this.popStateHandler)}willDestroy(){super.willDestroy(...arguments),window.removeEventListener("keydown",this.keydownHandler),window.removeEventListener("popstate",this.popStateHandler)}handleKeydown(e){"Escape"!==e.key&&"Esc"!==e.key||history.back()}static#a=(()=>dt7948.n(this.prototype,"handleKeydown",[i.action]))()
handlePopState(e){const t=e.state
this.expanded=t?.artifactId===this.args.artifactId,this.expanded||window.removeEventListener("keydown",this.keydownHandler)}static#l=(()=>dt7948.n(this.prototype,"handlePopState",[i.action]))()
get requireClickToRun(){return!this.showingArtifact&&"strict"===this.siteSettings.ai_artifact_security}get artifactUrl(){let e=(0,l.default)(`/discourse-ai/ai-bot/artifacts/${this.args.artifactId}`)
return this.args.artifactVersion&&(e=`${e}/${this.args.artifactVersion}`),e}showArtifact(){this.showingArtifact=!0}static#u=(()=>dt7948.n(this.prototype,"showArtifact",[i.action]))()
toggleView(){this.expanded?history.back():(window.history.pushState({artifactId:this.args.artifactId},"",window.location.href+"#artifact-fullscreen"),window.addEventListener("keydown",this.keydownHandler)),this.expanded=!this.expanded}static#p=(()=>dt7948.n(this.prototype,"toggleView",[i.action]))()
get wrapperClasses(){return"ai-artifact__wrapper "+(this.expanded?"ai-artifact__expanded":"")}setDataAttributes(e){this.args.dataAttributes&&Object.entries(this.args.dataAttributes).forEach((t=>{let[s,i]=t
e.setAttribute(s,i)}))}static#h=(()=>dt7948.n(this.prototype,"setDataAttributes",[i.action]))()
static#_=(()=>(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"yW89sVPA",block:'[[[1,"\\n"],[41,[30,0,["expanded"]],[[[1,"      "],[1,[28,[32,0],["ai-artifact-expanded"],null]],[1,"\\n"]],[]],null],[1,"    "],[10,0],[15,0,[30,0,["wrapperClasses"]]],[12],[1,"\\n      "],[10,0],[14,0,"ai-artifact__panel--wrapper"],[12],[1,"\\n        "],[10,0],[14,0,"ai-artifact__panel"],[12],[1,"\\n          "],[8,[32,1],[[24,0,"btn-flat btn-icon-text"]],[["@icon","@label","@action"],["discourse-compress","discourse_ai.ai_artifact.collapse_view_label",[30,0,["toggleView"]]]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["requireClickToRun"]],[[[1,"        "],[10,0],[14,0,"ai-artifact__click-to-run"],[12],[1,"\\n          "],[8,[32,1],[[24,0,"btn btn-primary"]],[["@icon","@label","@action"],["play","discourse_ai.ai_artifact.click_to_run_label",[30,0,["showArtifact"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[11,"iframe"],[24,"title","AI Artifact"],[16,"src",[30,0,["artifactUrl"]]],[24,"width","100%"],[24,"frameborder","0"],[4,[32,2],[[30,0,["setDataAttributes"]]],null],[12],[13],[1,"\\n"]],[]]],[41,[51,[30,0,["requireClickToRun"]]],[[[1,"        "],[10,0],[14,0,"ai-artifact__footer"],[12],[1,"\\n          "],[8,[32,1],[[24,0,"btn-transparent btn-icon-text ai-artifact__expand-button"]],[["@icon","@label","@action"],["discourse-expand","discourse_ai.ai_artifact.expand_view_label",[30,0,["toggleView"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-artifact.js",scope:()=>[r.default,a.default,o.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/runloop","discourse/helpers/concat-class","discourse/lib/later","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m{static#e=(()=>dt7948.g(this.prototype,"show",[s.tracked],(function(){return!1})))()
#T=(()=>{dt7948.i(this,"show")})()
static#s=(()=>dt7948.g(this.prototype,"shown",[s.tracked],(function(){return!1})))()
#P=(()=>{dt7948.i(this,"shown")})()
static#o=(()=>dt7948.g(this.prototype,"blinking",[s.tracked],(function(){return!1})))()
#C=(()=>{dt7948.i(this,"blinking")})()
constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}
this.show=e.show??!1,this.shown=e.shown??!1}}class h extends t.default{blocks=(()=>[...Array.from({length:20},(()=>new m))])()
#j
#M
#A
setupAnimation(){this.blocks.firstObject.show=!0,this.blocks.firstObject.shown=!0}static#e=(()=>dt7948.n(this.prototype,"setupAnimation",[o.action]))()
onBlinking(e){e.blinking&&(e.show=!1,this.#j=(0,u.default)(this,(()=>{this.#O(e).blinking=!0}),250),this.#M=(0,u.default)(this,(()=>{e.blinking=!1}),500))}static#s=(()=>dt7948.n(this.prototype,"onBlinking",[o.action]))()
onShowing(e){e.show&&(this.#A=(0,u.default)(this,(()=>{this.#O(e).show=!0,this.#O(e).shown=!0,this.blocks.lastObject===e&&(this.blocks.firstObject.blinking=!0)}),250))}static#o=(()=>dt7948.n(this.prototype,"onShowing",[o.action]))()
teardownAnimation(){(0,l.cancel)(this.#A),(0,l.cancel)(this.#j),(0,l.cancel)(this.#M)}static#a=(()=>dt7948.n(this.prototype,"teardownAnimation",[o.action]))()
#O(e){return e===this.blocks.lastObject?this.blocks.firstObject:this.blocks.objectAt(this.blocks.indexOf(e)+1)}static#l=(()=>(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"cWbDH+g8",block:'[[[1,"\\n    "],[11,"ul"],[24,0,"ai-blinking-animation"],[4,[32,0],[[30,0,["setupAnimation"]]],null],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["blocks"]]],null]],null],null,[[[1,"        "],[11,"li"],[16,0,[28,[32,1],["ai-blinking-animation__list-item",[52,[30,1,["show"]],"show"],[52,[30,1,["shown"]],"is-shown"],[52,[30,1,["blinking"]],"blink"]],null]],[4,[32,2],[[28,[32,3],[[30,0,["onBlinking"]],[30,1]],null],[30,1,["blinking"]]],null],[4,[32,2],[[28,[32,3],[[30,0,["onShowing"]],[30,1]],null],[30,1,["show"]]],null],[4,[32,4],[[30,0,["teardownAnimation"]]],null],[12],[13],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n  "]],["block"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation.js",scope:()=>[n.default,d.default,a.default,i.fn,r.default],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations",["exports","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/owner","@ember/render-modifiers/modifiers/did-insert","@ember/service","@ember-compat/tracked-built-ins","jquery","discourse/components/d-button","discourse/components/plugin-outlet","discourse/helpers/body-class","discourse/lib/ajax-error","discourse/lib/autocomplete/user","discourse/lib/hashtag-autocomplete","discourse/lib/uppy/uppy-upload","discourse/lib/uppy-media-optimization-plugin","discourse/lib/user-search","discourse/lib/user-status-on-autocomplete","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class T extends s.default{static#e=(()=>dt7948.g(this.prototype,"aiBotConversationsHiddenSubmit",[l.service]))()
#E=(()=>{dt7948.i(this,"aiBotConversationsHiddenSubmit")})()
static#s=(()=>dt7948.g(this.prototype,"currentUser",[l.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#o=(()=>dt7948.g(this.prototype,"mediaOptimizationWorker",[l.service]))()
#I=(()=>{dt7948.i(this,"mediaOptimizationWorker")})()
static#a=(()=>dt7948.g(this.prototype,"site",[l.service]))()
#F=(()=>{dt7948.i(this,"site")})()
static#l=(()=>dt7948.g(this.prototype,"siteSettings",[l.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#u=(()=>dt7948.g(this.prototype,"uploads",[t.tracked],(function(){return new d.TrackedArray})))()
#D=(()=>{dt7948.i(this,"uploads")})()
textarea=null
uppyUpload=null
fileInputEl=null
_handlePaste=e=>{if(document.activeElement!==this.textarea)return
const{canUpload:t,canPasteHtml:s,types:i}=(0,w.clipboardHelpers)(e,{siteSettings:this.siteSettings,canUpload:!0})
!t||s||i.includes("text/plain")||e&&e.clipboardData&&e.clipboardData.files&&this.uppyUpload.addFiles([...e.clipboardData.files],{pasted:!0})}
init(){super.init(...arguments),this.uppyUpload=new f.default((0,a.getOwner)(this),{id:"ai-bot-file-uploader",type:"ai-bot-conversation",useMultipartUploadsIfAvailable:!0,uppyReady:()=>{this.siteSettings.composer_media_optimization_image_enabled&&this.uppyUpload.uppyWrapper.useUploadPlugin(b.default,{optimizeFn:(e,t)=>this.mediaOptimizationWorker.optimizeImage(e,t),runParallel:!this.site.isMobileDevice}),this.uppyUpload.uppyWrapper.onPreProcessProgress((e=>{const t=this.inProgressUploads?.find((t=>t.id===e.id))
t&&!t.processing&&(t.processing=!0)})),this.uppyUpload.uppyWrapper.onPreProcessComplete((e=>{const t=this.inProgressUploads?.find((t=>t.id===e.id))
t&&(t.processing=!1)})),this.textarea?.addEventListener("paste",this._handlePaste)},uploadDone:e=>{this.uploads.push(e)},onProgressUploadsChanged:()=>{this.notifyPropertyChange("inProgressUploads")}})}willDestroy(){super.willDestroy(...arguments),this.textarea?.removeEventListener("paste",this._handlePaste),this.uppyUpload?.teardown(),this.textarea.autocomplete&&this.textarea.autocomplete("destroy")}get loading(){return this.aiBotConversationsHiddenSubmit?.loading}get inProgressUploads(){return this.uppyUpload?.inProgressUploads||[]}get showUploadsContainer(){return this.uploads?.length>0||this.inProgressUploads?.length>0}setPersonaId(e){this.aiBotConversationsHiddenSubmit.personaId=e}static#p=(()=>dt7948.n(this.prototype,"setPersonaId",[n.action]))()
setTargetRecipient(e){this.aiBotConversationsHiddenSubmit.targetUsername=e}static#h=(()=>dt7948.n(this.prototype,"setTargetRecipient",[n.action]))()
updateInputValue(e){this._autoExpandTextarea(),this.aiBotConversationsHiddenSubmit.inputValue=e.target?.value||e}static#_=(()=>dt7948.n(this.prototype,"updateInputValue",[n.action]))()
handleKeyDown(e){"TEXTAREA"===e.target.tagName&&("Enter"!==e.key||e.shiftKey||this.prepareAndSubmitToBot())}static#f=(()=>dt7948.n(this.prototype,"handleKeyDown",[n.action]))()
setTextArea(e){this.textarea=e,this.setupAutocomplete(e)}static#b=(()=>dt7948.n(this.prototype,"setTextArea",[n.action]))()
setupAutocomplete(e){const t=(0,u.default)(e)
this.applyUserAutocomplete(t),this.applyHashtagAutocomplete(t)}static#y=(()=>dt7948.n(this.prototype,"setupAutocomplete",[n.action]))()
applyUserAutocomplete(e){this.siteSettings.enable_mentions&&e.autocomplete({template:g.default,dataSource:e=>((0,v.destroyUserStatuses)(),(0,y.default)({term:e,includeGroups:!0}).then((e=>((0,v.initUserStatusHtml)((0,a.getOwner)(this),e.users),e)))),onRender:e=>(0,v.renderUserStatusHtml)(e),key:"@",width:"100%",treatAsTextarea:!0,autoSelectFirstSuggestion:!0,transformComplete:e=>e.username||e.name,afterComplete:e=>{this.textarea.value=e,this.textarea.focus(),this.updateInputValue({target:{value:e}})},onClose:v.destroyUserStatuses})}static#v=(()=>dt7948.n(this.prototype,"applyUserAutocomplete",[n.action]))()
applyHashtagAutocomplete(e){const t=this.site.hashtag_configurations["topic-composer"];(0,_.setupHashtagAutocomplete)(t,e,this.siteSettings,{treatAsTextarea:!0,afterComplete:e=>{this.textarea.value=e,this.textarea.focus(),this.updateInputValue({target:{value:e}})}})}static#w=(()=>dt7948.n(this.prototype,"applyHashtagAutocomplete",[n.action]))()
registerFileInput(e){e&&(this.fileInputEl=e,this.uppyUpload&&this.uppyUpload.setup(e))}static#L=(()=>dt7948.n(this.prototype,"registerFileInput",[n.action]))()
openFileUpload(){this.fileInputEl&&this.fileInputEl.click()}static#N=(()=>dt7948.n(this.prototype,"openFileUpload",[n.action]))()
removeUpload(e){this.uploads=new d.TrackedArray(this.uploads.filter((t=>t!==e)))}static#U=(()=>dt7948.n(this.prototype,"removeUpload",[n.action]))()
cancelUpload(e){this.uppyUpload.cancelSingleUpload({fileId:e.id})}static#q=(()=>dt7948.n(this.prototype,"cancelUpload",[n.action]))()
async prepareAndSubmitToBot(){this.aiBotConversationsHiddenSubmit.uploads=this.uploads
try{await this.aiBotConversationsHiddenSubmit.submitToBot(),this.uploads=new d.TrackedArray}catch(e){(0,h.popupAjaxError)(e)}}static#B=(()=>dt7948.n(this.prototype,"prepareAndSubmitToBot",[n.action]))()
_autoExpandTextarea(){this.textarea.style.height="auto",this.textarea.style.height=this.textarea.scrollHeight+"px"
const e=parseInt(getComputedStyle(this.textarea).maxHeight,10)
this.textarea.scrollHeight>e?this.textarea.style.overflowY="auto":this.textarea.style.overflowY="hidden"}static#z=(()=>(0,s.setComponentTemplate)((0,k.createTemplateFactory)({id:"99rH64XW",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-bot-conversations"],[12],[1,"\\n      "],[1,[28,[32,0],["ai-bot-conversations-page"],null]],[1,"\\n      "],[8,[32,1],null,[["@showLabels","@setPersonaId","@setTargetRecipient"],[true,[30,0,["setPersonaId"]],[30,0,["setTargetRecipient"]]]],null],[1,"\\n\\n      "],[10,0],[14,0,"ai-bot-conversations__content-wrapper"],[12],[1,"\\n        "],[10,0],[14,0,"ai-bot-conversations__title"],[12],[1,"\\n          "],[1,[28,[32,2],["discourse_ai.ai_bot.conversations.header"],null]],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,3],null,[["@name","@outletArgs"],["ai-bot-conversations-above-input",[28,[32,4],null,[["updateInput","submit"],[[30,0,["updateInputValue"]],[30,0,["prepareAndSubmitToBot"]]]]]]],null],[1,"\\n\\n        "],[10,0],[14,0,"ai-bot-conversations__input-wrapper"],[12],[1,"\\n          "],[8,[32,5],[[24,0,"btn btn-transparent ai-bot-upload-btn"]],[["@icon","@action","@title"],["upload",[30,0,["openFileUpload"]],"discourse_ai.ai_bot.conversations.upload_files"]],null],[1,"\\n          "],[11,"textarea"],[24,1,"ai-bot-conversations-input"],[24,"autofocus","true"],[16,"placeholder",[28,[32,2],["discourse_ai.ai_bot.conversations.placeholder"],null]],[24,"minlength","10"],[16,"disabled",[30,0,["loading"]]],[24,"rows","1"],[4,[32,6],[[30,0,["setTextArea"]]],null],[4,[32,7],["input",[30,0,["updateInputValue"]]],null],[4,[32,7],["keydown",[30,0,["handleKeyDown"]]],null],[12],[13],[1,"          "],[8,[32,5],[[24,0,"ai-bot-button btn-transparent ai-conversation-submit"]],[["@action","@icon","@isLoading","@title"],[[30,0,["prepareAndSubmitToBot"]],"paper-plane",[30,0,["loading"]],"discourse_ai.ai_bot.conversations.header"]],null],[1,"\\n          "],[11,"input"],[24,1,"ai-bot-file-uploader"],[24,0,"hidden-upload-field"],[24,"multiple","multiple"],[24,4,"file"],[4,[32,6],[[30,0,["registerFileInput"]]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,2],[14,0,"ai-disclaimer"],[12],[1,"\\n          "],[1,[28,[32,2],["discourse_ai.ai_bot.conversations.disclaimer"],null]],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,0,["showUploadsContainer"]],[[[1,"          "],[10,0],[14,0,"ai-bot-conversations__uploads-container"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["uploads"]]],null]],null],null,[[[1,"              "],[10,0],[14,0,"ai-bot-upload"],[12],[1,"\\n                "],[10,1],[14,0,"ai-bot-upload__filename"],[12],[1,"\\n                  "],[1,[30,1,["original_filename"]]],[1,"\\n                "],[13],[1,"\\n                "],[8,[32,5],[[24,0,"btn-transparent ai-bot-upload__remove"]],[["@icon","@action"],["xmark",[28,[32,8],[[30,0,["removeUpload"]],[30,1]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[1]],null],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["inProgressUploads"]]],null]],null],null,[[[1,"              "],[10,0],[14,0,"ai-bot-upload ai-bot-upload--in-progress"],[12],[1,"\\n                "],[10,1],[14,0,"ai-bot-upload__filename"],[12],[1,[30,2,["fileName"]]],[13],[1,"\\n                "],[10,1],[14,0,"ai-bot-upload__progress"],[12],[1,"\\n                  "],[1,[30,2,["progress"]]],[1,"%\\n                "],[13],[1,"\\n                "],[8,[32,5],[[24,0,"btn-flat ai-bot-upload__cancel"]],[["@icon","@action"],["xmark",[28,[32,8],[[30,0,["cancelUpload"]],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n"]],[2]],null],[1,"          "],[13],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["upload","upload"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations.js",scope:()=>[m.default,x.default,S.i18n,p.default,i.hash,c.default,r.default,o.on,i.fn],isStrictMode:!0}),this))()}e.default=T})),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","discourse/components/d-button","discourse/components/plugin-outlet","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static#e=(()=>dt7948.g(this.prototype,"appEvents",[o.service]))()
#H=(()=>{dt7948.i(this,"appEvents")})()
static#s=(()=>dt7948.g(this.prototype,"composer",[o.service]))()
#$=(()=>{dt7948.i(this,"composer")})()
static#o=(()=>dt7948.g(this.prototype,"currentUser",[o.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#a=(()=>dt7948.g(this.prototype,"navigationMenu",[o.service]))()
#V=(()=>{dt7948.i(this,"navigationMenu")})()
static#l=(()=>dt7948.g(this.prototype,"router",[o.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#u=(()=>dt7948.g(this.prototype,"sidebarState",[o.service]))()
#G=(()=>{dt7948.i(this,"sidebarState")})()
static#p=(()=>dt7948.g(this.prototype,"siteSettings",[o.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
get bots(){const e=this.currentUser.ai_enabled_chat_bots.filter((e=>!e.is_persosna)).filter(Boolean)
return e?e.map((e=>e.model_name)):[]}get showHeaderButton(){return this.bots.length>0&&this.siteSettings.ai_bot_add_to_header}get icon(){return this.clickShouldRouteOutOfConversations?"shuffle":"robot"}get clickShouldRouteOutOfConversations(){return!this.navigationMenu.isHeaderDropdownMode&&this.siteSettings.ai_bot_enable_dedicated_ux&&this.sidebarState.currentPanel?.key===u.AI_CONVERSATIONS_PANEL}onClick(){return this.clickShouldRouteOutOfConversations?this.router.transitionTo(`discovery.${(0,r.defaultHomepage)()}`):this.siteSettings.ai_bot_enable_dedicated_ux?(this.appEvents.trigger("discourse-ai:bot-header-icon-clicked"),this.router.transitionTo("discourse-ai-bot-conversations")):void(0,d.composeAiBotMessage)(this.bots[0],this.composer)}static#h=(()=>dt7948.n(this.prototype,"onClick",[i.action]))()
static#_=(()=>(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"6IW0Whqj",block:'[[[1,"\\n"],[41,[30,0,["showHeaderButton"]],[[[1,"      "],[10,"li"],[12],[1,"\\n        "],[8,[32,0],null,[["@name","@outletArgs"],["ai-bot-header-icon",[28,[32,1],null,[["onClick","icon"],[[30,0,["onClick"]],[30,0,["icon"]]]]]]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[16,"title",[28,[32,3],["discourse_ai.ai_bot.shortcut_title"],null]],[24,0,"ai-bot-button icon btn-flat"]],[["@action","@icon"],[[30,0,["onClick"]],[30,0,["icon"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon.js",scope:()=>[a.default,s.hash,n.default,l.i18n],isStrictMode:!0}),this))()}e.default=m})),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state",["exports","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,s.setComponentTemplate)((0,i.createTemplateFactory)({id:"m29KA1Bv",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-bot-sidebar-empty-state"],[12],[1,"\\n    "],[1,[28,[32,0],["discourse_ai.ai_bot.sidebar_empty"],null]],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state.js",scope:()=>[t.i18n],isStrictMode:!0}),(0,o.default)(void 0,"ai-bot-sidebar-empty-state"))})),define("discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static#e=(()=>dt7948.g(this.prototype,"appEvents",[i.service]))()
#H=(()=>{dt7948.i(this,"appEvents")})()
static#s=(()=>dt7948.g(this.prototype,"router",[i.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#o=(()=>dt7948.g(this.prototype,"sidebarState",[i.service]))()
#G=(()=>{dt7948.i(this,"sidebarState")})()
get shouldRender(){return this.sidebarState.isCurrentPanel(n.AI_CONVERSATIONS_PANEL)}routeTo(){this.appEvents.trigger("discourse-ai:new-conversation-btn-clicked"),"discourse-ai-bot-conversations"!==this.router.currentRouteName&&this.router.transitionTo("/discourse-ai/ai-bot/conversations"),this.args.outletArgs?.toggleNavigationMenu?.()}static#a=(()=>dt7948.n(this.prototype,"routeTo",[s.action]))()
static#l=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"0JyS5UZF",block:'[[[1,"\\n"],[41,[30,0,["shouldRender"]],[[[1,"      "],[10,0],[14,0,"ai-new-question-button__wrapper"],[12],[1,"\\n        "],[8,[32,0],[[24,0,"ai-new-question-button btn-default"]],[["@label","@icon","@action"],["discourse_ai.ai_bot.conversations.new","plus",[30,0,["routeTo"]]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/owner","@ember/service","discourse-i18n","float-kit/components/d-toast","float-kit/lib/d-toast-instance","discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list","discourse/plugins/discourse-ai/discourse/components/modal/diff-modal","discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"modal",[n.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
static#s=(()=>dt7948.g(this.prototype,"siteSettings",[n.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#o=(()=>dt7948.g(this.prototype,"currentUser",[n.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#a=(()=>dt7948.g(this.prototype,"site",[n.service]))()
#F=(()=>{dt7948.i(this,"site")})()
static#l=(()=>dt7948.g(this.prototype,"newSelectedText",[s.tracked]))()
#W=(()=>{dt7948.i(this,"newSelectedText")})()
static#u=(()=>dt7948.g(this.prototype,"diff",[s.tracked]))()
#K=(()=>{dt7948.i(this,"diff")})()
static#p=(()=>dt7948.g(this.prototype,"customPromptValue",[s.tracked],(function(){return""})))()
#J=(()=>{dt7948.i(this,"customPromptValue")})()
static#h=(()=>dt7948.g(this.prototype,"noContentError",[s.tracked],(function(){return!1})))()
#Q=(()=>{dt7948.i(this,"noContentError")})()
prompts=[]
promptTypes={}
constructor(){super(...arguments),0===this.args.data.toolbarEvent.getText().length&&(this.noContentError=!0)}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter((e=>e.location.includes("composer"))).filter((e=>"generate_titles"!==e.name)).map((e=>{const t=this.siteSettings.default_locale,s=JSON.parse(this.siteSettings.available_locales).find((e=>e.value===t)),i=(0,a.i18n)("discourse_ai.ai_helper.context_menu.translate_prompt",{language:s.name})
return"translate"===e.name?{...e,translated_name:i}:e}))
const t=e.findIndex((e=>"custom_prompt"===e.name))
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this.currentUser?.can_use_custom_prompts||(e=e.filter((e=>"custom_prompt"!==e.name))),e.forEach((e=>{this.prompts[e.name]=e})),this.promptTypes=e.reduce(((e,t)=>(e[t.name]=t.prompt_type,e)),{}),e}get toast(){const e=(0,o.getOwner)(this),t={close:()=>this.args.close(),duration:3e3,data:{theme:"error",icon:"triangle-exclamation",message:(0,a.i18n)("discourse_ai.ai_helper.no_content_error")}}
return new class extends l.default{constructor(){super(e,t)}close(){this.options.close()}static#e=(()=>dt7948.n(this.prototype,"close",[i.action]))()}(e,t)}async suggestChanges(e){if(await this.args.close(),"illustrate_post"===e.name)return this.modal.show(c.default,{model:{mode:e.name,selectedText:this.args.data.selectedText,thumbnails:this.thumbnailSuggestions}})
const t="diff"===e.prompt_type&&"markdown_table"!==e.name
return this.modal.show(u.default,{model:{mode:e.name,selectedText:this.args.data.selectedText,revert:this.undoAiAction,toolbarEvent:this.args.data.toolbarEvent,customPromptValue:this.customPromptValue,showResultAsDiff:t}})}static#_=(()=>dt7948.n(this.prototype,"suggestChanges",[i.action]))()
closeMenu(){this.customPromptValue="",this.args.close()}static#f=(()=>dt7948.n(this.prototype,"closeMenu",[i.action]))()
static#b=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"2ahoy4kS",block:'[[[1,"\\n"],[41,[30,0,["noContentError"]],[[[1,"      "],[8,[32,0],null,[["@toast"],[[30,0,["toast"]]]],null],[1,"\\n"]],[]],[[[1,"      "],[10,0],[14,0,"ai-composer-helper-menu"],[12],[1,"\\n"],[41,[30,0,["site","mobileView"]],[[[1,"          "],[10,0],[14,0,"ai-composer-helper-menu__selected-text"],[12],[1,"\\n            "],[1,[30,1,["selectedText"]]],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[32,1],null,[["@options","@customPromptValue","@performAction","@shortcutVisible"],[[30,0,["helperOptions"]],[30,0,["customPromptValue"]],[30,0,["suggestChanges"]],true]],null],[1,"\\n      "],[13],[1,"\\n"]],[]]],[1,"  "]],["@data"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu.js",scope:()=>[r.default,d.default],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/runloop","@ember/service","truth-helpers","discourse/components/back-button","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/form","discourse/helpers/d-icon","discourse/lib/ajax-error","discourse-i18n","admin/components/admin-section-landing-item","admin/components/admin-section-landing-wrapper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class y extends t.default{static#e=(()=>dt7948.g(this.prototype,"toasts",[a.service]))()
#Z=(()=>{dt7948.i(this,"toasts")})()
static#s=(()=>dt7948.g(this.prototype,"router",[a.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#o=(()=>dt7948.g(this.prototype,"dialog",[a.service]))()
#X=(()=>{dt7948.i(this,"dialog")})()
static#a=(()=>dt7948.g(this.prototype,"store",[a.service]))()
#ee=(()=>{dt7948.i(this,"store")})()
static#l=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#te=(()=>{dt7948.i(this,"isSaving")})()
static#u=(()=>dt7948.g(this.prototype,"selectedPreset",[s.tracked],(function(){return null})))()
#se=(()=>{dt7948.i(this,"selectedPreset")})()
static#p=(()=>dt7948.g(this.prototype,"testRunning",[s.tracked],(function(){return!1})))()
#ie=(()=>{dt7948.i(this,"testRunning")})()
static#h=(()=>dt7948.g(this.prototype,"testResult",[s.tracked],(function(){return null})))()
#oe=(()=>{dt7948.i(this,"testResult")})()
static#_=(()=>dt7948.g(this.prototype,"testError",[s.tracked],(function(){return null})))()
#ne=(()=>{dt7948.i(this,"testError")})()
static#f=(()=>dt7948.g(this.prototype,"currentProvider",[s.tracked],(function(){return null})))()
#ae=(()=>{dt7948.i(this,"currentProvider")})()
constructor(){super(...arguments),this.args.model&&(this.currentProvider=this.args.model.provider)}get formData(){let e
e=this.selectedPreset?this.store.createRecord("ai-embedding",this.selectedPreset).workingCopy():this.args.model.workingCopy()
const t=JSON.parse(JSON.stringify(e))
return this._originalFormData=t,t}static#b=(()=>dt7948.n(this.prototype,"formData",[s.cached]))()
get selectedProviders(){return this.args.embeddings.resultSetMeta.providers.map((e=>{return{id:e,name:(t=e,(0,h.i18n)(`discourse_ai.embeddings.providers.${t}`))}
var t}))}get distanceFunctions(){const e=e=>(0,h.i18n)(`discourse_ai.embeddings.distance_functions.${e}`)
return this.args.embeddings.resultSetMeta.distance_functions.map((t=>({id:t,name:e(t)})))}get presets(){const e=this.args.embeddings.resultSetMeta.presets.map((e=>({name:e.display_name,id:e.preset_id,provider:e.provider})))
return e.unshiftObject({name:(0,h.i18n)("discourse_ai.embeddings.configure_manually"),id:"manual",provider:"fake"}),e}get showPresets(){return!this.selectedPreset&&this.args.model.isNew}get metaProviderParams(){const e=this.currentProvider
if(!e)return{}
return(((this.args.embeddings||{}).resultSetMeta||{}).provider_params||{})[e]||{}}get testErrorMessage(){return(0,h.i18n)("discourse_ai.llms.tests.failure",{error:this.testError})}get displayTestResult(){return this.testRunning||null!==this.testResult}get seeded(){return this.args.model.id<0}configurePreset(e){this.selectedPreset=this.args.embeddings.resultSetMeta.presets.findBy("preset_id",e.id)||{},this.selectedPreset.provider&&(this.currentProvider=this.selectedPreset.provider)}static#y=(()=>dt7948.n(this.prototype,"configurePreset",[o.action]))()
setProvider(e,t){let{set:s}=t
s("provider",e),this.currentProvider=e
const i=(this.args.embeddings?.resultSetMeta?.provider_params||{})[e]||{},o={}
if(i){Object.keys(i).forEach((e=>{o[e]=null}))}s("provider_params",o)}static#v=(()=>dt7948.n(this.prototype,"setProvider",[o.action]))()
get providerParams(){return Object.entries(this.metaProviderParams).reduce(((e,t)=>{let[s,i]=t
return e[s]=(e=>e?"string"==typeof e?{type:e}:{type:e.type||"text",values:(e.values||[]).map((e=>({id:e,name:e}))),default:e.default}:{type:"text"})(i),e}),{})}resetForm(){this.selectedPreset=null,this.currentProvider=null}static#w=(()=>dt7948.n(this.prototype,"resetForm",[o.action]))()
async save(e){this.isSaving=!0
const t=this.args.model.isNew
try{const s={...e}
if(this.selectedPreset){const e=this.store.createRecord("ai-embedding",{...this.selectedPreset,...s})
await e.save(),this.args.embeddings.addObject(e)}else await this.args.model.save(s)
if(t)this.router.transitionTo("adminPlugins.show.discourse-ai-embeddings.index")
else{const e=this.currentProvider
this._originalFormData=JSON.parse(JSON.stringify(s)),this.currentProvider=e,this.toasts.success({data:{message:(0,h.i18n)("discourse_ai.embeddings.saved")},duration:2e3})}}catch(s){(0,m.popupAjaxError)(s)}finally{(0,n.later)((()=>{this.isSaving=!1}),1e3)}}static#L=(()=>dt7948.n(this.prototype,"save",[o.action]))()
async test(e){this.testRunning=!0
try{let t
t=this.args.model.isNew||this.selectedPreset?this.store.createRecord("ai-embedding",{...this.selectedPreset,...e}):this.args.model
const s=await t.testConfig(e)
this.testResult=s.success,this.testResult?this.testError=null:this.testError=s.error}catch(t){(0,m.popupAjaxError)(t)}finally{(0,n.later)((()=>{this.testRunning=!1}),1e3)}}static#N=(()=>dt7948.n(this.prototype,"test",[o.action]))()
delete(){return this.dialog.confirm({message:(0,h.i18n)("discourse_ai.embeddings.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then((()=>{this.args.embeddings.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-embeddings.index")})).catch(m.popupAjaxError)})}static#U=(()=>dt7948.n(this.prototype,"delete",[o.action]))()
providerKeys(e){return e?Object.keys(e):[]}static#q=(()=>dt7948.n(this.prototype,"providerKeys",[o.action]))()
static#B=(()=>(0,f.setComponentTemplate)((0,b.createTemplateFactory)({id:"kJ5LIVvb",block:'[[[1,"\\n"],[41,[30,0,["showPresets"]],[[[1,"      "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-embeddings","discourse_ai.embeddings.back"]],null],[1,"\\n      "],[10,0],[14,0,"control-group"],[12],[1,"\\n        "],[10,"h2"],[12],[1,[28,[32,1],["discourse_ai.embeddings.presets"],null]],[13],[1,"\\n        "],[8,[32,2],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["presets"]]],null]],null],null,[[[1,"            "],[8,[32,3],[[16,"data-preset-id",[30,1,["id"]]],[24,0,"ai-llms-list-editor__templates-list-item"]],[["@titleLabelTranslated","@taglineLabel"],[[30,1,["name"]],[28,[32,4],["discourse_ai.embeddings.providers.",[30,1,["provider"]]],null]]],[["buttons"],[[[[1,"\\n                "],[8,[30,2,["Default"]],null,[["@action","@icon","@label"],[[28,[32,5],[[30,0,["configurePreset"]],[30,1]],null],"gear","discourse_ai.llms.preconfigured.button"]],null],[1,"\\n              "]],[2]]]]],[1,"\\n"]],[1]],null],[1,"        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n"]],[]],[[[1,"      "],[8,[32,6],[[16,0,[29,["form-horizontal ai-embedding-editor ",[52,[30,0,["seeded"]],"seeded"]]]]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[41,[30,5,["isNew"]],[[[1,"          "],[8,[32,7],[[24,0,"btn-flat back-button"]],[["@action","@label","@icon"],[[30,0,["resetForm"]],"back_button","chevron-left"]],null],[1,"\\n"]],[]],[[[1,"          "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-embeddings","discourse_ai.embeddings.back"]],null],[1,"\\n"]],[]]],[1,"\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__display-name"]],[["@name","@title","@validation","@format"],["display_name",[28,[32,1],["discourse_ai.embeddings.display_name"],null],"required|length:1,100","large"]],[["default"],[[[[1,"\\n          "],[8,[30,6,["Input"]],null,null,null],[1,"\\n        "]],[6]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__provider"]],[["@name","@title","@validation","@format","@onSet"],["provider",[28,[32,1],["discourse_ai.embeddings.provider"],null],"required","large",[30,0,["setProvider"]]]],[["default"],[[[[1,"\\n          "],[8,[30,7,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["selectedProviders"]]],null]],null],null,[[[1,"              "],[8,[30,8,["Option"]],null,[["@value"],[[30,9,["id"]]]],[["default"],[[[[1,[30,9,["name"]]]],[]]]]],[1,"\\n"]],[9]],null],[1,"          "]],[8]]]]],[1,"\\n        "]],[7]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__url"]],[["@name","@title","@validation","@format"],["url",[28,[32,1],["discourse_ai.embeddings.url"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,10,["Input"]],null,null,null],[1,"\\n        "]],[10]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__api-key"]],[["@name","@title","@validation","@format"],["api_key",[28,[32,1],["discourse_ai.embeddings.api_key"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,11,["Password"]],null,null,null],[1,"\\n        "]],[11]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__tokenizer"]],[["@name","@title","@validation","@format"],["tokenizer_class",[28,[32,1],["discourse_ai.embeddings.tokenizer"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,12,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,14,["resultSetMeta","tokenizers"]]],null]],null],null,[[[1,"              "],[8,[30,13,["Option"]],null,[["@value"],[[30,15,["id"]]]],[["default"],[[[[1,[30,15,["name"]]]],[]]]]],[1,"\\n"]],[15]],null],[1,"          "]],[13]]]]],[1,"\\n        "]],[12]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__dimensions"]],[["@name","@title","@validation","@format","@tooltip"],["dimensions",[28,[32,1],["discourse_ai.embeddings.dimensions"],null],"required","large",[52,[30,5,["isNew"]],[28,[32,1],["discourse_ai.embeddings.hints.dimensions_warning"],null]]]],[["default"],[[[[1,"\\n          "],[8,[30,16,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"],[16,"disabled",[28,[32,8],[[30,5,["isNew"]]],null]]],[["@type"],["number"]],null],[1,"\\n        "]],[16]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__matryoshka_dimensions"]],[["@name","@title","@tooltip","@format"],["matryoshka_dimensions",[28,[32,1],["discourse_ai.embeddings.matryoshka_dimensions"],null],[28,[32,1],["discourse_ai.embeddings.hints.matryoshka_dimensions"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,17,["Checkbox"]],null,null,null],[1,"\\n        "]],[17]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__embed_prompt"]],[["@name","@title","@tooltip","@format"],["embed_prompt",[28,[32,1],["discourse_ai.embeddings.embed_prompt"],null],[28,[32,1],["discourse_ai.embeddings.hints.embed_prompt"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,18,["Textarea"]],null,null,null],[1,"\\n        "]],[18]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__search_prompt"]],[["@name","@title","@tooltip","@format"],["search_prompt",[28,[32,1],["discourse_ai.embeddings.search_prompt"],null],[28,[32,1],["discourse_ai.embeddings.hints.search_prompt"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,19,["Textarea"]],null,null,null],[1,"\\n        "]],[19]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__max_sequence_length"]],[["@name","@title","@tooltip","@validation","@format"],["max_sequence_length",[28,[32,1],["discourse_ai.embeddings.max_sequence_length"],null],[28,[32,1],["discourse_ai.embeddings.hints.sequence_length"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,20,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[20]]]]],[1,"\\n\\n        "],[8,[30,3,["Field"]],[[24,0,"ai-embedding-editor__distance_functions"]],[["@name","@title","@tooltip","@format","@validation"],["pg_function",[28,[32,1],["discourse_ai.embeddings.distance_function"],null],[28,[32,1],["discourse_ai.embeddings.hints.distance_function"],null],"large","required"]],[["default"],[[[[1,"\\n          "],[8,[30,21,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["distanceFunctions"]]],null]],null],null,[[[1,"              "],[8,[30,22,["Option"]],null,[["@value"],[[30,23,["id"]]]],[["default"],[[[[1,[30,23,["name"]]]],[]]]]],[1,"\\n"]],[23]],null],[1,"          "]],[22]]]]],[1,"\\n        "]],[21]]]]],[1,"\\n\\n"],[41,[30,0,["currentProvider"]],[[[1,"          "],[8,[30,3,["Object"]],null,[["@name"],["provider_params"]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["providerKeys"]],[[30,25]],null]],null]],null],null,[[[44,[[28,[32,9],[[30,0,["providerParams"]],[30,26]],null]],[[[41,[30,27],[[[1,"                  "],[8,[30,24,["Field"]],[[16,0,[29,["ai-embedding-editor-provider-param__",[30,27,["type"]]]]]],[["@name","@title","@format","@validation"],[[30,26],[28,[32,1],[[28,[32,4],["discourse_ai.embeddings.provider_fields.",[30,26]],null]],null],"large","required"]],[["default"],[[[[1,"\\n"],[41,[28,[32,10],[[30,27,["type"]],"enum"],null],[[[1,"                      "],[8,[30,28,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,27,["values"]]],null]],null],null,[[[1,"                          "],[8,[30,29,["Option"]],null,[["@value"],[[30,30,["id"]]]],[["default"],[[[[1,[30,30,["name"]]]],[]]]]],[1,"\\n"]],[30]],null],[1,"                      "]],[29]]]]],[1,"\\n"]],[]],[[[41,[28,[32,10],[[30,27,["type"]],"checkbox"],null],[[[1,"                      "],[8,[30,28,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[1,"                      "],[8,[30,28,["Input"]],null,[["@type"],[[30,27,["type"]]]],null],[1,"\\n                    "]],[]]]],[]]],[1,"                  "]],[28]]]]],[1,"\\n"]],[]],null]],[27]]]],[26]],null],[1,"          "]],[24,25]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,3,["Actions"]],[[24,0,"ai-embedding-editor__action_panel"]],null,[["default"],[[[[1,"\\n          "],[8,[30,3,["Button"]],[[24,0,"ai-embedding-editor__test"]],[["@action","@disabled","@label"],[[28,[32,5],[[30,0,["test"]],[30,4]],null],[30,0,["testRunning"]],"discourse_ai.embeddings.tests.title"]],null],[1,"\\n\\n          "],[8,[30,3,["Submit"]],[[24,0,"btn-primary ai-embedding-editor__save"]],[["@label"],["discourse_ai.embeddings.save"]],null],[1,"\\n\\n"],[41,[51,[30,4,["isNew"]]],[[[1,"            "],[8,[30,3,["Button"]],[[24,0,"btn-danger ai-embedding-editor__delete"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.embeddings.delete"]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["displayTestResult"]],[[[1,"          "],[8,[30,3,["Container"]],[[24,0,"ai-embedding-editor-tests"]],[["@format"],["full"]],[["default"],[[[[1,"\\n            "],[8,[32,11],null,[["@size","@condition"],["small",[30,0,["testRunning"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"                "],[10,0],[14,0,"ai-embedding-editor-tests__success"],[12],[1,"\\n                  "],[1,[28,[32,12],["check"],null]],[1,"\\n                  "],[1,[28,[32,1],["discourse_ai.embeddings.tests.success"],null]],[1,"\\n                "],[13],[1,"\\n"]],[]],[[[1,"                "],[10,0],[14,0,"ai-embedding-editor-tests__failure"],[12],[1,"\\n                  "],[1,[28,[32,12],["xmark"],null]],[1,"\\n                  "],[1,[30,0,["testErrorMessage"]]],[1,"\\n                "],[13],[1,"\\n"]],[]]],[1,"            "]],[]]]]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"      "]],[3,4]]]]],[1,"\\n"]],[]]],[1,"  "]],["preset","buttons","form","data","@model","field","field","select","provider","field","field","field","select","@embeddings","tokenizer","field","field","field","field","field","field","select","df","object","providerData","name","params","field","select","option"],false,["if","each","-track-array","let","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor.js",scope:()=>[l.default,h.i18n,_.default,g.default,i.concat,i.fn,c.default,u.default,r.not,i.get,r.eq,d.default,p.default],isStrictMode:!0}),this))()}e.default=y})),define("discourse/plugins/discourse-ai/discourse/components/ai-embeddings-list-editor",["exports","@glimmer/component","@ember/helper","@ember/service","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse-i18n","admin/components/admin-config-area-empty-list","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-embedding-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static#e=(()=>dt7948.g(this.prototype,"adminPluginNavManager",[i.service]))()
#re=(()=>{dt7948.i(this,"adminPluginNavManager")})()
get hasEmbeddingElements(){return 0!==this.args.embeddings.length}static#s=(()=>(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"MiS/W6iF",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-embeddings"]],[28,[32,1],["discourse_ai.embeddings.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-embeddings-list-editor admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,2],null,[["@model","@embeddings"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.embeddings.short_title"],null],[28,[32,1],["discourse_ai.embeddings.description"],null],"https://meta.discourse.org/t/discourse-ai-embeddings/259603"]],[["actions"],[[[[1,"\\n            "],[8,[30,3,["Primary"]],[[24,0,"ai-embeddings-list-editor__new-button"]],[["@label","@route","@icon"],["discourse_ai.embeddings.new","adminPlugins.show.discourse-ai-embeddings.new","plus"]],null],[1,"\\n          "]],[3]]]]],[1,"\\n\\n"],[41,[30,0,["hasEmbeddingElements"]],[[[1,"          "],[10,"table"],[14,0,"d-admin-table"],[12],[1,"\\n            "],[10,"thead"],[12],[1,"\\n              "],[10,"tr"],[12],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.embeddings.display_name"],null]],[13],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.embeddings.provider"],null]],[13],[1,"\\n                "],[10,"th"],[12],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"                "],[10,"tr"],[14,0,"ai-embeddings-list__row d-admin-row__content"],[12],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-embeddings-list__name"],[12],[1,"\\n                      "],[10,"strong"],[12],[1,"\\n                        "],[1,[30,4,["display_name"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                    "],[10,0],[14,0,"d-admin-row__mobile-label"],[12],[1,"\\n                      "],[1,[28,[32,1],["discourse_ai.embeddings.provider"],null]],[1,"\\n                    "],[13],[1,"\\n                    "],[1,[28,[32,1],[[28,[32,4],["discourse_ai.embeddings.providers.",[30,4,["provider"]]],null]],null]],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n"],[41,[30,4,["seeded"]],[[[1,"                      "],[8,[32,5],[[24,0,"ai-embeddings-list__edit-disabled-tooltip"]],null,[["trigger","content"],[[[[1,"\\n                          "],[8,[32,6],[[24,0,"btn btn-default btn-small disabled"]],[["@label"],["discourse_ai.embeddings.edit"]],null],[1,"\\n                        "]],[]],[[[1,"\\n                          "],[1,[28,[32,1],["discourse_ai.embeddings.seeded_warning"],null]],[1,"\\n                        "]],[]]]]],[1,"\\n"]],[]],[[[1,"                      "],[8,[32,6],[[24,0,"btn btn-default btn-small ai-embeddings-list__edit-button"]],[["@label","@route","@routeModels"],["discourse_ai.embeddings.edit","adminPlugins.show.discourse-ai-embeddings.edit",[30,4,["id"]]]],null],[1,"\\n"]],[]]],[1,"                  "],[13],[1,"\\n                "],[13],[1,"\\n"]],[4]],null],[1,"            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[8,[32,7],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.embeddings.new","adminPlugins.show.discourse-ai-embeddings.new","ai-embeddings-list-editor__empty-new-button","discourse_ai.embeddings.empty"]],null],[1,"\\n"]],[]]]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentEmbedding","@embeddings","actions","embedding"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-embeddings-list-editor.js",scope:()=>[o.default,r.i18n,u.default,a.default,s.concat,d.default,n.default,l.default],isStrictMode:!0}),this))()}e.default=m})),define("discourse/plugins/discourse-ai/discourse/components/ai-features-list",["exports","@ember/helper","truth-helpers","discourse/components/d-button","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const l=(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"g2phI/sb",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-features-list"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1]],null]],null],null,[[[1,"      "],[10,0],[14,0,"ai-module"],[15,"data-module-name",[30,2,["module_name"]]],[12],[1,"\\n        "],[10,0],[14,0,"ai-module__header"],[12],[1,"\\n          "],[10,0],[14,0,"ai-module__module-title"],[12],[1,"\\n            "],[10,"h3"],[12],[1,[28,[32,0],[[28,[32,1],["discourse_ai.features.",[30,2,["module_name"]],".name"],null]],null]],[13],[1,"\\n            "],[8,[32,2],[[24,0,"edit"]],[["@label","@route","@routeModels"],["discourse_ai.features.edit","adminPlugins.show.discourse-ai-features.edit",[30,2,["id"]]]],null],[1,"\\n          "],[13],[1,"\\n          "],[10,0],[12],[1,[28,[32,0],[[28,[32,1],["discourse_ai.features.",[30,2,["module_name"]],".description"],null]],null]],[13],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"admin-section-landing-wrapper ai-feature-cards"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["features"]]],null]],null],null,[[[1,"            "],[10,0],[14,0,"admin-section-landing-item ai-feature-card"],[15,"data-feature-name",[30,3,["name"]]],[12],[1,"\\n              "],[10,0],[14,0,"admin-section-landing-item__content"],[12],[1,"\\n                "],[10,0],[14,0,"ai-feature-card__feature-name"],[12],[1,"\\n                  "],[1,[28,[32,0],[[28,[32,1],["discourse_ai.features.",[30,2,["module_name"]],".",[30,3,["name"]]],null]],null]],[1,"\\n"],[41,[51,[30,3,["enabled"]]],[[[1,"                    "],[10,1],[12],[1,[28,[32,0],["discourse_ai.features.disabled"],null]],[13],[1,"\\n"]],[]],null],[1,"                "],[13],[1,"\\n                "],[10,0],[14,0,"ai-feature-card__persona"],[12],[1,"\\n                  "],[10,1],[12],[1,[28,[32,0],["discourse_ai.features.persona"],null]],[13],[1,"\\n"],[41,[30,3,["persona"]],[[[1,"                    "],[8,[32,2],[[24,0,"btn-flat btn-small ai-feature-card__persona-button"]],[["@translatedLabel","@route","@routeModels"],[[30,3,["persona","name"]],"adminPlugins.show.discourse-ai-personas.edit",[30,3,["persona","id"]]]],null],[1,"\\n"]],[]],[[[1,"                    "],[1,[28,[32,0],["discourse_ai.features.no_persona"],null]],[1,"\\n"]],[]]],[1,"                "],[13],[1,"\\n"],[41,[30,3,["persona"]],[[[1,"                  "],[10,0],[14,0,"ai-feature-card__groups"],[12],[1,"\\n                    "],[10,1],[12],[1,[28,[32,0],["discourse_ai.features.groups"],null]],[13],[1,"\\n"],[41,[28,[32,3],[[30,3,["persona","allowed_groups","length"]],0],null],[[[1,"                      "],[10,"ul"],[14,0,"ai-feature-card__item-groups"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,3,["persona","allowed_groups"]]],null]],null],null,[[[1,"                          "],[10,"li"],[12],[1,[30,4,["name"]]],[13],[1,"\\n"]],[4]],null],[1,"                      "],[13],[1,"\\n"]],[]],[[[1,"                      "],[1,[28,[32,0],["discourse_ai.features.no_groups"],null]],[1,"\\n"]],[]]],[1,"                  "],[13],[1,"\\n"]],[]],null],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[3]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[2]],null],[1,"  "],[13],[1,"\\n"]],["@modules","module","feature","group"],false,["each","-track-array","unless","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-features-list.js",scope:()=>[o.i18n,t.concat,i.default,s.gt],isStrictMode:!0}),(0,r.default)(void 0,"ai-features-list:AiFeaturesList"))
e.default=l})),define("discourse/plugins/discourse-ai/discourse/components/ai-features",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","truth-helpers","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/helpers/concat-class","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-features-list","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const g="configured",_="unconfigured"
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"adminPluginNavManager",[n.service]))()
#re=(()=>{dt7948.i(this,"adminPluginNavManager")})()
static#s=(()=>dt7948.g(this.prototype,"selectedFeatureGroup",[s.tracked],(function(){return g})))()
#le=(()=>{dt7948.i(this,"selectedFeatureGroup")})()
constructor(){super(...arguments),0===this.configuredFeatures.length&&(this.selectedFeatureGroup=_)}get featureGroups(){return[{id:g,label:"discourse_ai.features.nav.configured"},{id:_,label:"discourse_ai.features.nav.unconfigured"}]}get configuredFeatures(){return this.args.features.filter((e=>!0===e.module_enabled))}get unconfiguredFeatures(){return this.args.features.filter((e=>!1===e.module_enabled))}selectFeatureGroup(e){this.selectedFeatureGroup=e}static#o=(()=>dt7948.n(this.prototype,"selectFeatureGroup",[o.action]))()
static#a=(()=>(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"VavLl9fI",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-features"]],[28,[32,1],["discourse_ai.features.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-features admin-detail"],[12],[1,"\\n      "],[8,[32,2],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.features.short_title"],null],[28,[32,1],["discourse_ai.features.description"],null],"todo"]],null],[1,"\\n\\n      "],[10,0],[14,0,"ai-feature-groups"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["featureGroups"]]],null]],null],null,[[[1,"          "],[8,[32,3],[[16,0,[28,[32,4],[[30,1,["id"]],[52,[28,[32,5],[[30,0,["selectedFeatureGroup"]],[30,1,["id"]]],null],"btn-primary","btn-default"]],null]]],[["@action","@label"],[[28,[32,6],[[30,0,["selectFeatureGroup"]],[30,1,["id"]]],null],[30,1,["label"]]]],null],[1,"\\n"]],[1]],null],[1,"      "],[13],[1,"\\n\\n"],[41,[28,[32,5],[[30,0,["selectedFeatureGroup"]],"configured"],null],[[[1,"        "],[8,[32,7],null,[["@modules"],[[30,0,["configuredFeatures"]]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,7],null,[["@modules"],[[30,0,["unconfiguredFeatures"]]]],null],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["groupData"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-features.js",scope:()=>[r.default,c.i18n,d.default,l.default,u.default,a.eq,i.fn,p.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/ai-full-page-search",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-update","@ember/service","discourse/components/d-toggle-switch","discourse/controllers/full-page-search","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/search","discourse-i18n","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class y extends t.default{static#e=(()=>dt7948.g(this.prototype,"appEvents",[a.service]))()
#H=(()=>{dt7948.i(this,"appEvents")})()
static#s=(()=>dt7948.g(this.prototype,"router",[a.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#o=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#a=(()=>dt7948.g(this.prototype,"searchPreferencesManager",[a.service]))()
#de=(()=>{dt7948.i(this,"searchPreferencesManager")})()
static#l=(()=>dt7948.g(this.prototype,"searching",[s.tracked]))()
#ue=(()=>{dt7948.i(this,"searching")})()
static#u=(()=>dt7948.g(this.prototype,"AiResults",[s.tracked],(function(){return[]})))()
#ce=(()=>{dt7948.i(this,"AiResults")})()
static#p=(()=>dt7948.g(this.prototype,"showingAiResults",[s.tracked],(function(){return!1})))()
#pe=(()=>{dt7948.i(this,"showingAiResults")})()
static#h=(()=>dt7948.g(this.prototype,"sortOrder",[s.tracked],(function(){return this.args.sortOrder})))()
#me=(()=>{dt7948.i(this,"sortOrder")})()
initialSearchTerm=this.args.searchTerm
constructor(){super(...arguments),this.appEvents.on("full-page-search:trigger-search",this,this.onSearch),this.onSearch()}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("full-page-search:trigger-search",this,this.onSearch)}onSearch(){if(this.searchEnabled)return this.initialSearchTerm=this.args.searchTerm,this.searching=!0,this.resetAiResults(),this.performHyDESearch()}static#_=(()=>dt7948.n(this.prototype,"onSearch",[o.action]))()
get disableToggleSwitch(){if(this.searching||0===this.AiResults.length||!this.validSearchOrder)return!0}get validSearchOrder(){return 0===this.sortOrder}get searchStateText(){return this.validSearchOrder?this.searching?(0,h.i18n)("discourse_ai.embeddings.semantic_search_loading"):this.AiResults.length&&this.showingAiResults?(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.toggle",{count:this.AiResults.length}):this.AiResults.length&&!this.showingAiResults?(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.toggle_hidden",{count:this.AiResults.length}):0===this.AiResults.length&&this.searchTerm!==this.initialSearchTerm?(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.new"):0===this.AiResults.length?(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.none"):void 0:(0,h.i18n)("discourse_ai.embeddings.semantic_search_results.unavailable")}get settled(){return this.validSearchOrder&&!this.searching&&this.searchTerm===this.initialSearchTerm}get noResults(){return this.settled&&0===this.AiResults.length}get searchTerm(){return this.initialSearchTerm!==this.args.searchTerm&&(this.initialSearchTerm=void 0),this.args.searchTerm}get searchEnabled(){return this.args.searchType===l.SEARCH_TYPE_DEFAULT&&(0,m.isValidSearchTerm)(this.searchTerm,this.siteSettings)&&this.validSearchOrder}get searchClass(){return this.validSearchOrder?this.searching?"in-progress":this.noResults?"no-results":void 0:"unavailable"}get tooltipText(){return(0,h.i18n)("discourse_ai.embeddings.semantic_search_tooltips."+(this.validSearchOrder?"results_explanation":"invalid_sort"))}toggleAiResults(){this.appEvents.trigger("full-page-search:ai-results-toggled",{enabled:!this.showingAiResults}),this.showingAiResults?this.args.addSearchResults([],"topic_id"):this.args.addSearchResults(this.AiResults,"topic_id"),this.showingAiResults=!this.showingAiResults}static#f=(()=>dt7948.n(this.prototype,"toggleAiResults",[o.action]))()
resetAiResults(){this.AiResults=[],this.showingAiResults=!1,this.args.addSearchResults([],"topic_id")}static#b=(()=>dt7948.n(this.prototype,"resetAiResults",[o.action]))()
performHyDESearch(){this.resetAiResults(),(0,c.ajax)("/discourse-ai/embeddings/semantic-search",{data:{q:this.searchTerm}}).then((async e=>{const t=await(0,m.translateResults)(e)||{}
0!==t.posts?.length&&(t.posts.forEach((e=>{e.generatedByAi=!0})),this.AiResults=t.posts)})).catch(p.popupAjaxError).finally((()=>{this.searching=!1}))}sortChanged(){this.sortOrder!==this.args.sortOrder&&(this.sortOrder=this.args.sortOrder,this.validSearchOrder?this.onSearch():(this.showingAiResults=!1,this.resetAiResults()))}static#y=(()=>dt7948.n(this.prototype,"sortChanged",[o.action]))()
static#v=(()=>(0,f.setComponentTemplate)((0,b.createTemplateFactory)({id:"XAcP21aU",block:'[[[1,"\\n    "],[11,0],[24,0,"semantic-search__container search-results"],[24,"role","region"],[4,[32,0],[[30,0,["sortChanged"]],[30,1]],null],[12],[1,"\\n      "],[10,0],[14,0,"semantic-search__results"],[12],[1,"\\n        "],[10,0],[15,0,[28,[32,1],["semantic-search__searching",[30,0,["searchClass"]]],null]],[12],[1,"\\n          "],[8,[32,2],[[16,"disabled",[30,0,["disableToggleSwitch"]]],[24,0,"semantic-search__results-toggle"],[4,[32,3],["click",[30,0,["toggleAiResults"]]],null]],[["@state"],[[30,0,["showingAiResults"]]]],null],[1,"\\n\\n          "],[10,0],[14,0,"semantic-search__searching-text"],[12],[1,"\\n            "],[1,[28,[32,4],["discourse-sparkles"],null]],[1,"\\n            "],[1,[30,0,["searchStateText"]]],[1,"\\n          "],[13],[1,"\\n\\n"],[41,[30,0,["validSearchOrder"]],[[[1,"            "],[8,[32,5],null,[["@loading"],[[30,0,["searching"]]]],null],[1,"\\n"]],[]],null],[1,"\\n          "],[8,[32,6],[[24,0,"semantic-search__tooltip"]],[["@identifier"],["semantic-search-tooltip"]],[["trigger","content"],[[[[1,"\\n              "],[1,[28,[32,4],["far-circle-question"],null]],[1,"\\n            "]],[]],[[[1,"\\n              "],[1,[30,0,["tooltipText"]]],[1,"\\n            "]],[]]]]],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@sortOrder"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-full-page-search.js",scope:()=>[n.default,d.default,r.default,i.on,u.default,_.default,g.default],isStrictMode:!0}),this))()}e.default=y})),define("discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/body-class","discourse/helpers/d-icon","discourse-i18n","float-kit/components/d-menu","truth-helpers/helpers/eq","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"gists",[o.service]))()
#he=(()=>{dt7948.i(this,"gists")})()
get buttons(){return[{id:"table",label:"discourse_ai.summarization.topic_list_layout.button.compact",icon:"discourse-table"},{id:"table-ai",label:"discourse_ai.summarization.topic_list_layout.button.expanded",icon:"discourse-table-sparkles",description:"discourse_ai.summarization.topic_list_layout.button.expanded_description"}]}get selectedOptionId(){return this.gists.get("preference")}get currentButton(){return this.buttons.find((e=>e.id===this.selectedOptionId))||this.buttons[0]}onRegisterApi(e){this.dMenu=e}static#s=(()=>dt7948.n(this.prototype,"onRegisterApi",[i.action]))()
onSelect(e){this.gists.setPreference(e),this.dMenu.close()}static#o=(()=>dt7948.n(this.prototype,"onSelect",[i.action]))()
static#a=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"WNCmZBDe",block:'[[[1,"\\n"],[41,[30,0,["gists","shouldShow"]],[[[1,"      "],[1,[28,[32,0],[[28,[32,1],["topic-list-layout-",[30,0,["gists","preference"]]],null]],null]],[1,"\\n      "],[8,[32,2],null,[["@modalForMobile","@autofocus","@identifier","@onRegisterApi","@triggerClass"],[true,true,"topic-list-layout",[30,0,["onRegisterApi"]],"btn-default btn-icon"]],[["trigger","content"],[[[[1,"\\n          "],[1,[28,[32,3],[[30,0,["currentButton","icon"]]],null]],[1,"\\n        "]],[]],[[[1,"\\n          "],[8,[32,4],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["buttons"]]],null]],null],null,[[[1,"              "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,5],[[16,0,[29,["btn-transparent\\n                    ",[52,[30,2,["description"]],"--with-description"],"\\n                    ",[52,[28,[32,6],[[30,0,["currentButton","id"]],[30,2,["id"]]],null],"--active"]]]]],[["@label","@icon","@action"],[[30,2,["label"]],[30,2,["icon"]],[28,[32,7],[[30,0,["onSelect"]],[30,2,["id"]]],null]]],[["default"],[[[[1,"\\n"],[41,[30,2,["description"]],[[[1,"                    "],[10,0],[14,0,"btn__description"],[12],[1,"\\n                      "],[1,[28,[32,8],[[30,2,["description"]]],null]],[1,"\\n                    "],[13],[1,"\\n"]],[]],null],[1,"                "]],[]]]]],[1,"\\n              "]],[]]]]],[1,"\\n"]],[2]],null],[1,"          "]],[1]]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","button"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle.js",scope:()=>[r.default,s.concat,u.default,l.default,a.default,n.default,c.default,s.fn,d.i18n],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/helpers/with-event-value","discourse-i18n","truth-helpers/helpers/not","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{sendInput(e){if("Enter"===e.key)return this.args.submit(this.args.promptArgs)}static#e=(()=>dt7948.n(this.prototype,"sendInput",[o.action]))()
static#s=(()=>(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"P6muo3ex",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-custom-prompt"],[12],[1,"\\n\\n      "],[11,"input"],[16,2,[30,1]],[16,"placeholder",[28,[32,0],["discourse_ai.ai_helper.context_menu.custom_prompt.placeholder"],null]],[24,0,"ai-custom-prompt__input"],[24,"autofocus","autofocus"],[24,4,"text"],[4,[32,1],["input",[28,[32,2],[[28,[32,3],[[28,[31,0],[[30,1]],null]],null]],null]],null],[4,[32,1],["keydown",[30,0,["sendInput"]]],null],[12],[13],[1,"\\n\\n      "],[8,[32,4],[[24,0,"ai-custom-prompt__submit btn-primary"]],[["@icon","@action","@disabled"],["discourse-sparkles",[28,[32,3],[[30,2],[30,3]],null],[28,[32,5],[[30,1,["length"]]],null]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@value","@submit","@promptArgs"],false,["mut"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt.js",scope:()=>[r.i18n,i.on,a.default,s.fn,n.default,l.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-loading",["exports","discourse/components/d-button","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"qC8lok7p",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-helper-loading"],[12],[1,"\\n    "],[10,0],[14,0,"dot-falling"],[12],[13],[1,"\\n    "],[10,1],[12],[1,"\\n      "],[1,[28,[32,0],["discourse_ai.ai_helper.context_menu.loading"],null]],[1,"\\n    "],[13],[1,"\\n    "],[8,[32,1],[[24,0,"btn-flat cancel-request"]],[["@icon","@title","@action"],["xmark","discourse_ai.ai_helper.context_menu.cancel",[30,1]]],null],[1,"\\n  "],[13],[1,"\\n"]],["@cancel"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-loading.js",scope:()=>[s.i18n,t.default],isStrictMode:!0}),(0,n.default)(void 0,"ai-helper-loading:AiHelperLoading"))
e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list",["exports","@glimmer/component","@ember/helper","@ember/service","truth-helpers","discourse/components/d-button","discourse/lib/keyboard-shortcuts","discourse/lib/utilities","truth-helpers/helpers/eq","discourse/plugins/discourse-ai/discourse/components/ai-helper-custom-prompt","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{static#e=(()=>dt7948.g(this.prototype,"site",[i.service]))()
#F=(()=>{dt7948.i(this,"site")})()
get showShortcut(){return this.site.desktopView&&this.args.shortcutVisible}get shortcut(){return(0,r.translateModKey)(`${a.PLATFORM_KEY_MODIFIER}+alt+p`)}static#s=(()=>(0,u.setComponentTemplate)((0,c.createTemplateFactory)({id:"s635M6zL",block:'[[[1,"\\n    "],[10,"ul"],[14,0,"ai-helper-options"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,1]],null]],null],null,[[[41,[28,[32,0],[[30,2,["name"]],"custom_prompt"],null],[[[1,"          "],[8,[32,1],null,[["@value","@promptArgs","@submit"],[[30,3],[30,2],[30,4]]],null],[1,"\\n"]],[]],[[[1,"          "],[10,"li"],[15,"data-name",[30,2,["translated_name"]]],[15,"data-value",[30,2,["name"]]],[12],[1,"\\n            "],[8,[32,2],[[16,"data-name",[30,2,["name"]]],[24,0,"ai-helper-options__button"]],[["@icon","@translatedLabel","@action"],[[30,2,["icon"]],[30,2,["translated_name"]],[28,[32,3],[[30,4],[30,2]],null]]],[["default"],[[[[1,"\\n"],[41,[28,[32,4],[[28,[32,0],[[30,2,["name"]],"proofread"],null],[30,0,["showShortcut"]]],null],[[[1,"                "],[10,"kbd"],[14,0,"shortcut"],[12],[1,[30,0,["shortcut"]]],[13],[1,"\\n"]],[]],null],[1,"            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"]],[]]]],[2]],null],[1,"    "],[13],[1,"\\n  "]],["@options","option","@customPromptValue","@performAction"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list.js",scope:()=>[l.default,d.default,n.default,s.fn,o.and],isStrictMode:!0}),this))()}e.default=p}))
define("discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave",["exports","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=[".",".","."],n=(0,t.setComponentTemplate)((0,s.createTemplateFactory)({id:"2VboNjAG",block:'[[[1,"\\n"],[41,[30,1],[[[1,"    "],[10,1],[14,0,"ai-indicator-wave"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[32,0]],null]],null],null,[[[1,"        "],[10,1],[14,0,"ai-indicator-wave__dot"],[12],[1,[30,2]],[13],[1,"\\n"]],[2]],null],[1,"    "],[13],[1,"\\n"]],[]],null]],["@loading","dot"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave.js",scope:()=>[o],isStrictMode:!0}),(0,i.default)(void 0,"ai-indicator-wave:AiIndicatorWave"))
e.default=n})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/routing","@ember/runloop","@ember/service","truth-helpers","discourse/components/conditional-loading-spinner","discourse/components/form","discourse/helpers/bound-avatar-template","discourse/helpers/d-icon","discourse/lib/ajax-error","discourse-i18n","admin/models/admin-user","discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector","discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class v extends t.default{static#e=(()=>dt7948.g(this.prototype,"toasts",[r.service]))()
#Z=(()=>{dt7948.i(this,"toasts")})()
static#s=(()=>dt7948.g(this.prototype,"router",[r.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#o=(()=>dt7948.g(this.prototype,"dialog",[r.service]))()
#X=(()=>{dt7948.i(this,"dialog")})()
static#a=(()=>dt7948.g(this.prototype,"modal",[r.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
static#l=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#te=(()=>{dt7948.i(this,"isSaving")})()
static#u=(()=>dt7948.g(this.prototype,"testRunning",[s.tracked],(function(){return!1})))()
#ie=(()=>{dt7948.i(this,"testRunning")})()
static#p=(()=>dt7948.g(this.prototype,"testResult",[s.tracked],(function(){return null})))()
#oe=(()=>{dt7948.i(this,"testResult")})()
static#h=(()=>dt7948.g(this.prototype,"testError",[s.tracked],(function(){return null})))()
#ne=(()=>{dt7948.i(this,"testError")})()
get formData(){if(this.args.llmTemplate){let[e,t]=this.args.llmTemplate.split(/-(.*)/)
if("none"===e)return{provider_params:{}}
const s=this.args.llms.resultSetMeta.presets.findBy("id",e),i=s.models.findBy("name",t)
return{max_prompt_tokens:i.tokens,max_output_tokens:i.max_output_tokens,tokenizer:s.tokenizer,url:i.endpoint||s.endpoint,display_name:i.display_name,name:i.name,provider:s.provider,provider_params:this.computeProviderParams(s.provider),input_cost:i.input_cost,output_cost:i.output_cost,cached_input_cost:i.cached_input_cost}}const{model:e}=this.args
return{max_prompt_tokens:e.max_prompt_tokens,max_output_tokens:e.max_output_tokens,api_key:e.api_key,tokenizer:e.tokenizer,url:e.url,display_name:e.display_name,name:e.name,provider:e.provider,enabled_chat_bot:e.enabled_chat_bot,vision_enabled:e.vision_enabled,input_cost:e.input_cost,output_cost:e.output_cost,cached_input_cost:e.cached_input_cost,provider_params:this.computeProviderParams(e.provider,e.provider_params),llm_quotas:e.llm_quotas}}static#_=(()=>dt7948.n(this.prototype,"formData",[s.cached]))()
get selectedProviders(){return this.args.llms.resultSetMeta.providers.map((e=>{return{id:e,name:(t=e,(0,h.i18n)(`discourse_ai.llms.providers.${t}`))}
var t})).sort(((e,t)=>e.name.localeCompare(t.name)))}get tokenizers(){return this.args.llms.resultSetMeta.tokenizers.sort(((e,t)=>e.name.localeCompare(t.name)))}get adminUser(){return g.default.create(this.args.model?.user)}get testErrorMessage(){return(0,h.i18n)("discourse_ai.llms.tests.failure",{error:this.testError})}get displayTestResult(){return this.testRunning||null!==this.testResult}get modulesUsingModel(){const e=this.args.model.used_by?.filter((e=>"ai_bot"!==e.type))
if(!e||0===e.length)return null
return e.map((e=>(0,h.i18n)(`discourse_ai.llms.usage.${e.type}`,{persona:e.name}))).join(", ")}get inUseWarning(){return(0,h.i18n)("discourse_ai.llms.in_use_warning",{settings:this.modulesUsingModel,count:this.args.model.used_by.length})}get showAddQuotaButton(){return!this.args.model.isNew}computeProviderParams(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}
const s=this.args.llms.resultSetMeta.provider_params[e]??{}
return Object.fromEntries(Object.entries(s).map((e=>{let[s,i]=e
return[s,t[s]??("enum"===i?.type?i.default:null)]})))}canEditURL(e){return"aws_bedrock"!==e}static#f=(()=>dt7948.n(this.prototype,"canEditURL",[o.action]))()
openAddQuotaModal(e){this.modal.show(f.default,{model:{llm:this.args.model,addItemToCollection:e}})}static#b=(()=>dt7948.n(this.prototype,"openAddQuotaModal",[o.action]))()
metaProviderParams(e){const t=this.args.llms.resultSetMeta.provider_params[e]||{}
return Object.entries(t).reduce(((e,t)=>{let[s,i]=t
return"string"==typeof i?e[s]={type:i}:"object"==typeof i?(i.values&&(i={...i},i.values=i.values.map((e=>({id:e,name:e})))),e[s]={type:i.type||"text",values:i.values||[],default:i.default??void 0}):e[s]={type:"text"},e}),{})}static#y=(()=>dt7948.n(this.prototype,"metaProviderParams",[o.action]))()
async save(e){this.isSaving=!0
const t=this.args.model.isNew,s={...e}
e.max_output_tokens||(s.max_output_tokens=null)
try{await this.args.model.save(s),t?(this.args.llms.addObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-llms.index")):this.toasts.success({data:{message:(0,h.i18n)("discourse_ai.llms.saved")},duration:2e3})}catch(i){(0,m.popupAjaxError)(i)}finally{(0,a.later)((()=>{this.isSaving=!1}),1e3)}}static#v=(()=>dt7948.n(this.prototype,"save",[o.action]))()
async test(e){this.testRunning=!0
try{const t=await this.args.model.testConfig(e)
this.testResult=t.success,this.testResult?this.testError=null:this.testError=t.error}catch(t){(0,m.popupAjaxError)(t)}finally{(0,a.later)((()=>{this.testRunning=!1}),1e3)}}static#w=(()=>dt7948.n(this.prototype,"test",[o.action]))()
setProvider(e,t){let{set:s}=t
s("provider_params",this.computeProviderParams(e)),s("provider",e)}static#L=(()=>dt7948.n(this.prototype,"setProvider",[o.action]))()
delete(){return this.dialog.confirm({message:(0,h.i18n)("discourse_ai.llms.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then((()=>{this.args.llms.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-llms.index")})).catch(m.popupAjaxError)})}static#N=(()=>dt7948.n(this.prototype,"delete",[o.action]))()
providerParamsKeys(e){return e?Object.keys(e):[]}static#U=(()=>dt7948.n(this.prototype,"providerParamsKeys",[o.action]))()
static#q=(()=>(0,b.setComponentTemplate)((0,y.createTemplateFactory)({id:"MCqdrhke",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-llm-editor"]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["modulesUsingModel"]],[[[1,"        "],[8,[30,1,["Alert"]],null,[["@icon"],["circle-info"]],[["default"],[[[[1,"\\n          "],[1,[30,0,["inUseWarning"]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["display_name",[28,[32,1],["discourse_ai.llms.display_name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.llms.hints.display_name"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,3,["Input"]],null,null,null],[1,"\\n      "]],[3]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@validation","@format"],["name",[28,[32,1],["discourse_ai.llms.name"],null],[28,[32,1],["discourse_ai.llms.hints.name"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,4,["Input"]],null,null,null],[1,"\\n      "]],[4]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@format","@validation","@onSet"],["provider",[28,[32,1],["discourse_ai.llms.provider"],null],"large","required",[30,0,["setProvider"]]]],[["default"],[[[[1,"\\n        "],[8,[30,5,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["selectedProviders"]]],null]],null],null,[[[1,"            "],[8,[30,6,["Option"]],null,[["@value"],[[30,7,["id"]]]],[["default"],[[[[1,[30,7,["name"]]]],[]]]]],[1,"\\n"]],[7]],null],[1,"        "]],[6]]]]],[1,"\\n      "]],[5]]]]],[1,"\\n\\n"],[41,[28,[30,0,["canEditURL"]],[[30,2,["provider"]]],null],[[[1,"        "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["url",[28,[32,1],["discourse_ai.llms.url"],null],"required","large"]],[["default"],[[[[1,"\\n          "],[8,[30,8,["Input"]],null,null,null],[1,"\\n        "]],[8]]]]],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["api_key",[28,[32,1],["discourse_ai.llms.api_key"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,9,["Password"]],null,null,null],[1,"\\n      "]],[9]]]]],[1,"\\n\\n      "],[8,[30,1,["Object"]],null,[["@name"],["provider_params"]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["providerParamsKeys"]],[[30,11]],null]],null]],null],null,[[[44,[[28,[32,2],[[28,[30,0,["metaProviderParams"]],[[30,2,["provider"]]],null],[30,12]],null]],[[[1,"            "],[8,[30,10,["Field"]],null,[["@name","@title","@format"],[[30,12],[28,[32,1],[[28,[32,3],["discourse_ai.llms.provider_fields.",[30,12]],null]],null],"large"]],[["default"],[[[[1,"\\n"],[41,[28,[32,4],[[30,13,["type"]],"enum"],null],[[[1,"                "],[8,[30,14,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,13,["values"]]],null]],null],null,[[[1,"                    "],[8,[30,15,["Option"]],null,[["@value"],[[30,16,["id"]]]],[["default"],[[[[1,[30,16,["name"]]]],[]]]]],[1,"\\n"]],[16]],null],[1,"                "]],[15]]]]],[1,"\\n"]],[]],[[[41,[28,[32,4],[[30,13,["type"]],"checkbox"],null],[[[1,"                "],[8,[30,14,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[1,"                "],[8,[30,14,["Input"]],null,[["@type"],[[30,13,["type"]]]],null],[1,"\\n              "]],[]]]],[]]],[1,"            "]],[14]]]]],[1,"\\n"]],[13]]]],[12]],null],[1,"      "]],[10,11]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@format","@validation"],["tokenizer",[28,[32,1],["discourse_ai.llms.tokenizer"],null],"large","required"]],[["default"],[[[[1,"\\n        "],[8,[30,17,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["tokenizers"]]],null]],null],null,[[[1,"            "],[8,[30,18,["Option"]],null,[["@value"],[[30,19,["id"]]]],[["default"],[[[[1,[30,19,["name"]]]],[]]]]],[1,"\\n"]],[19]],null],[1,"        "]],[18]]]]],[1,"\\n      "]],[17]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@validation","@format"],["max_prompt_tokens",[28,[32,1],["discourse_ai.llms.max_prompt_tokens"],null],[28,[32,1],["discourse_ai.llms.hints.max_prompt_tokens"],null],"required","large"]],[["default"],[[[[1,"\\n        "],[8,[30,20,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[20]]]]],[1,"\\n\\n      "],[8,[30,1,["InputGroup"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,21,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["input_cost",[28,[32,1],["discourse_ai.llms.cost_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,22,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[22]]]]],[1,"\\n\\n        "],[8,[30,21,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["cached_input_cost",[28,[32,1],["discourse_ai.llms.cost_cached_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_cached_input"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,23,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[23]]]]],[1,"\\n\\n        "],[8,[30,21,["Field"]],null,[["@name","@title","@tooltip","@helpText"],["output_cost",[28,[32,1],["discourse_ai.llms.cost_output"],null],[28,[32,1],["discourse_ai.llms.hints.cost_output"],null],[28,[32,1],["discourse_ai.llms.hints.cost_measure"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,24,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[24]]]]],[1,"\\n      "]],[21]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_output_tokens",[28,[32,1],["discourse_ai.llms.max_output_tokens"],null],[28,[32,1],["discourse_ai.llms.hints.max_output_tokens"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,25,["Input"]],[[24,"step","any"],[24,"min","0"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[25]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["vision_enabled",[28,[32,1],["discourse_ai.llms.vision_enabled"],null],[28,[32,1],["discourse_ai.llms.hints.vision_enabled"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,26,["Checkbox"]],null,null,null],[1,"\\n      "]],[26]]]]],[1,"\\n\\n      "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["enabled_chat_bot",[28,[32,1],["discourse_ai.llms.enabled_chat_bot"],null],[28,[32,1],["discourse_ai.llms.hints.enabled_chat_bot"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,27,["Checkbox"]],null,null,null],[1,"\\n      "]],[27]]]]],[1,"\\n\\n"],[41,[30,28,["user"]],[[[1,"        "],[8,[30,1,["Container"]],null,[["@title"],[[28,[32,1],["discourse_ai.llms.ai_bot_user"],null]]],[["default"],[[[[1,"\\n          "],[10,3],[14,0,"avatar"],[15,6,[30,28,["user","path"]]],[15,"data-user-card",[30,28,["user","username"]]],[12],[1,"\\n            "],[1,[28,[32,5],[[30,28,["user","avatar_template"]],"small"],null]],[1,"\\n          "],[13],[1,"\\n          "],[8,[32,6],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n            "],[1,[30,28,["user","username"]]],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,7],[[30,2,["llm_quotas","length"]],0],null],[[[1,"        "],[8,[30,1,["Container"]],null,[["@title"],[[28,[32,1],["discourse_ai.llms.quotas.title"],null]]],[["default"],[[[[1,"\\n          "],[10,"table"],[14,0,"ai-llm-quotas__table"],[12],[1,"\\n            "],[10,"thead"],[14,0,"ai-llm-quotas__table-head"],[12],[1,"\\n              "],[10,"tr"],[14,0,"ai-llm-quotas__header-row"],[12],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.group"],null]],[13],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.max_tokens"],null]],[13],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.max_usages"],null]],[13],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header"],[12],[1,[28,[32,1],["discourse_ai.llms.quotas.duration"],null]],[13],[1,"\\n                "],[10,"th"],[14,0,"ai-llm-quotas__header ai-llm-quotas__header--actions"],[12],[13],[1,"\\n                "],[10,"th"],[12],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"tbody"],[14,0,"ai-llm-quotas__table-body"],[12],[1,"\\n              "],[8,[30,1,["Collection"]],[[24,0,"ai-llm-quotas__row"]],[["@name","@tagName"],["llm_quotas","tr"]],[["default"],[[[[1,"\\n                "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,[30,31,["group_name"]]],[13],[1,"\\n                "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n                  "],[8,[30,29,["Field"]],null,[["@name","@title","@showTitle"],["max_tokens","max_tokens",false]],[["default"],[[[[1,"\\n                    "],[8,[30,32,["Input"]],[[24,0,"ai-llm-quotas__input"],[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n                  "]],[32]]]]],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n                  "],[8,[30,29,["Field"]],null,[["@name","@title","@showTitle"],["max_usages","max_usages",false]],[["default"],[[[[1,"\\n                    "],[8,[30,33,["Input"]],[[24,0,"ai-llm-quotas__input"],[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n                  "]],[33]]]]],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[14,0,"ai-llm-quotas__cell"],[12],[1,"\\n                  "],[8,[30,29,["Field"]],null,[["@name","@title","@showTitle"],["duration_seconds","duration_seconds",false]],[["default"],[[[[1,"\\n                    "],[8,[30,34,["Custom"]],null,null,[["default"],[[[[1,"\\n                      "],[8,[32,8],null,[["@value","@onChange"],[[30,31,["duration_seconds"]],[30,34,["set"]]]],null],[1,"\\n                    "]],[]]]]],[1,"\\n                  "]],[34]]]]],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[12],[1,"\\n                  "],[8,[30,1,["Button"]],[[24,0,"btn-danger ai-llm-quotas__delete-btn"]],[["@icon","@action"],["trash-can",[28,[32,9],[[30,29,["remove"]],[30,30]],null]]],null],[1,"\\n                "],[13],[1,"\\n              "]],[29,30,31]]]]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[8,[30,1,["Button"]],[[24,0,"ai-llm-editor__add-quota-btn"]],[["@action","@icon","@label"],[[28,[32,9],[[30,0,["openAddQuotaModal"]],[28,[32,9],[[30,1,["addItemToCollection"]],"llm_quotas"],null]],null],"plus","discourse_ai.llms.quotas.add"]],null],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,1,["Actions"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,1,["Button"]],null,[["@action","@disabled","@label"],[[28,[32,9],[[30,0,["test"]],[30,2]],null],[30,0,["testRunning"]],"discourse_ai.llms.tests.title"]],null],[1,"\\n\\n        "],[8,[30,1,["Submit"]],null,null,null],[1,"\\n\\n"],[41,[28,[32,4],[[30,2,["llm_quotas","length"]],0],null],[[[1,"          "],[8,[30,1,["Button"]],[[24,0,"ai-llm-editor__add-quota-btn"]],[["@action","@label"],[[28,[32,9],[[30,0,["openAddQuotaModal"]],[28,[32,9],[[30,1,["addItemToCollection"]],"llm_quotas"],null]],null],"discourse_ai.llms.quotas.add"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[51,[30,28,["isNew"]]],[[[1,"          "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.llms.delete"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["displayTestResult"]],[[[1,"        "],[8,[30,1,["Container"]],null,[["@format"],["full"]],[["default"],[[[[1,"\\n          "],[8,[32,10],null,[["@size","@condition"],["small",[30,0,["testRunning"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"              "],[10,0],[14,0,"ai-llm-editor-tests__success"],[12],[1,"\\n                "],[1,[28,[32,11],["check"],null]],[1,"\\n                "],[1,[28,[32,1],["discourse_ai.llms.tests.success"],null]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,0],[14,0,"ai-llm-editor-tests__failure"],[12],[1,"\\n                "],[1,[28,[32,11],["xmark"],null]],[1,"\\n                "],[1,[30,0,["testErrorMessage"]]],[1,"\\n              "],[13],[1,"\\n"]],[]]],[1,"          "]],[]]]]],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null],[1,"    "]],[1,2]]]]],[1,"\\n  "]],["form","data","field","field","field","select","provider","field","field","object","providerParamsData","name","params","field","select","option","field","select","tokenizer","field","inputGroup","field","field","field","field","field","field","@model","collection","index","collectionData","field","field","field"],false,["if","each","-track-array","let","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form.js",scope:()=>[u.default,h.i18n,i.get,i.concat,l.eq,c.default,n.LinkTo,l.gt,_.default,i.fn,d.default,p.default],isStrictMode:!0}),this))()}e.default=v})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-editor",["exports","discourse/components/back-button","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor-form","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"Tv683ucY",block:'[[[1,"\\n  "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-llms","discourse_ai.llms.back"]],null],[1,"\\n  "],[8,[32,1],null,[["@model","@llmTemplate","@llms"],[[30,1],[30,2],[30,3]]],null],[1,"\\n"]],["@model","@llmTemplate","@llms"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-editor.js",scope:()=>[t.default,s.default],isStrictMode:!0}),(0,n.default)(void 0,"ai-llm-editor:AiLlmEditor"))
e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-llm-selector",["exports","@ember/helper","select-kit/components/combo-box","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"nJvrK5ml",block:'[[[1,"\\n  "],[8,[32,0],[[16,0,[30,1]]],[["@value","@content","@onChange","@options"],[[30,2],[30,3],[30,4],[28,[32,1],null,[["filterable","none"],[true,"discourse_ai.ai_persona.no_llm_selected"]]]]],null],[1,"\\n"]],["@class","@value","@llms","@onChange"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llm-selector.js",scope:()=>[s.default,t.hash],isStrictMode:!0}),(0,n.default)(void 0,"ai-llm-selector:AiLlmSelector"))
e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/service","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse-i18n","admin/components/admin-section-landing-item","admin/components/admin-section-landing-wrapper","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-llm-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
function g(e){if(e.id<0)return!0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"adminPluginNavManager",[o.service]))()
#re=(()=>{dt7948.i(this,"adminPluginNavManager")})()
static#s=(()=>dt7948.g(this.prototype,"router",[o.service]))()
#t=(()=>{dt7948.i(this,"router")})()
modelDescription(e){let t=""
return t="number"==typeof e.id?`${e.provider}-${e.name}`:e.id.replace(/\./g,"-"),t=`discourse_ai.llms.model_description.${t}`,l.default.lookup(t,{ignoreMissing:!0})?(0,l.i18n)(t):""}static#o=(()=>dt7948.n(this.prototype,"modelDescription",[i.action]))()
preseededDescription(e){if(g(e))return(0,l.i18n)("discourse_ai.llms.preseeded_model_description",{model:e.name})}static#a=(()=>dt7948.n(this.prototype,"preseededDescription",[i.action]))()
sanitizedTranslationKey(e){return e.replace(/\./g,"-")}get hasLlmElements(){return 0!==this.args.llms.length}get preconfiguredTitle(){return this.hasLlmElements?"discourse_ai.llms.preconfigured.title":"discourse_ai.llms.preconfigured.title_no_llms"}get preConfiguredLlms(){const e=[{id:"none",name:(0,l.i18n)("discourse_ai.llms.preconfigured.fake"),provider:"fake"}],t=this.args.llms.content.map((e=>({provider:e.provider,name:e.name})))
return this.args.llms.resultSetMeta.presets.forEach((s=>{s.models&&s.models.forEach((i=>{const o=`${s.id}-${i.name}`
t.some((e=>e.provider===s.provider&&e.name===i.name))||e.push({id:o,name:i.display_name,provider:s.provider})}))})),e}transitionToLlmEditor(e){this.router.transitionTo("adminPlugins.show.discourse-ai-llms.new",{queryParams:{llmTemplate:e}})}static#l=(()=>dt7948.n(this.prototype,"transitionToLlmEditor",[i.action]))()
localizeUsage(e){return"ai_persona"===e.type?(0,l.i18n)("discourse_ai.llms.usage.ai_persona",{persona:e.name}):"automation"===e.type?(0,l.i18n)("discourse_ai.llms.usage.automation",{name:e.name}):(0,l.i18n)("discourse_ai.llms.usage."+e.type)}static#u=(()=>(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"W9+HDws7",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-llms"]],[28,[32,1],["discourse_ai.llms.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-llm-list-editor admin-detail"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,2],null,[["@model","@llms","@llmTemplate"],[[30,1],[30,2],[30,3]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.llms.short_title"],null],[28,[32,1],["discourse_ai.llms.preconfigured.description"],null],"https://meta.discourse.org/t/discourse-ai-large-language-model-llm-settings-page/319903"]],null],[1,"\\n"],[41,[30,0,["hasLlmElements"]],[[[1,"          "],[10,"section"],[14,0,"ai-llms-list-editor__configured"],[12],[1,"\\n            "],[8,[32,3],null,[["@titleLabel"],[[28,[32,1],["discourse_ai.llms.configured.title"],null]]],null],[1,"\\n            "],[10,"table"],[14,0,"d-admin-table"],[12],[1,"\\n              "],[10,"thead"],[12],[1,"\\n                "],[10,"tr"],[12],[1,"\\n                  "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.display_name"],null]],[13],[1,"\\n                  "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[13],[1,"\\n                  "],[10,"th"],[12],[13],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"                  "],[10,"tr"],[15,"data-llm-id",[30,4,["name"]]],[14,0,"ai-llm-list__row d-admin-row__content"],[12],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n\\n                      "],[10,0],[14,0,"ai-llm-list__name"],[12],[1,"\\n                        "],[10,"strong"],[12],[1,"\\n                          "],[1,[30,4,["display_name"]]],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n                      "],[10,0],[14,0,"ai-llm-list__description"],[12],[1,"\\n                        "],[1,[28,[30,0,["modelDescription"]],[[30,4]],null]],[1,"\\n                        "],[1,[28,[30,0,["preseededDescription"]],[[30,4]],null]],[1,"\\n                      "],[13],[1,"\\n"],[41,[30,4,["used_by"]],[[[1,"                        "],[10,"ul"],[14,0,"ai-llm-list-editor__usages"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,4,["used_by"]]],null]],null],null,[[[1,"                            "],[10,"li"],[12],[1,[28,[30,0,["localizeUsage"]],[[30,5]],null]],[13],[1,"\\n"]],[5]],null],[1,"                        "],[13],[1,"\\n"]],[]],null],[1,"                    "],[13],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                      "],[10,0],[14,0,"d-admin-row__mobile-label"],[12],[1,"\\n                        "],[1,[28,[32,1],["discourse_ai.llms.provider"],null]],[1,"\\n                      "],[13],[1,"\\n                      "],[1,[28,[32,1],[[28,[32,4],["discourse_ai.llms.providers.",[30,4,["provider"]]],null]],null]],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n"],[41,[28,[32,5],[[30,4]],null],[[[1,"                        "],[8,[32,6],[[24,0,"ai-llm-list__edit-disabled-tooltip"]],null,[["trigger","content"],[[[[1,"\\n                            "],[8,[32,7],[[24,0,"btn btn-default btn-small disabled"]],[["@label"],["discourse_ai.llms.edit"]],null],[1,"\\n                          "]],[]],[[[1,"\\n                            "],[1,[28,[32,1],["discourse_ai.llms.seeded_warning"],null]],[1,"\\n                          "]],[]]]]],[1,"\\n"]],[]],[[[1,"                        "],[8,[32,7],[[24,0,"btn btn-default btn-small ai-llm-list__delete-button"]],[["@label","@route","@routeModels"],["discourse_ai.llms.edit","adminPlugins.show.discourse-ai-llms.edit",[30,4,["id"]]]],null],[1,"\\n"]],[]]],[1,"                    "],[13],[1,"\\n                  "],[13],[1,"\\n"]],[4]],null],[1,"              "],[13],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"        "],[10,"section"],[14,0,"ai-llms-list-editor__templates"],[12],[1,"\\n          "],[8,[32,3],null,[["@titleLabel"],[[28,[32,1],[[30,0,["preconfiguredTitle"]]],null]]],null],[1,"\\n          "],[8,[32,8],[[24,0,"ai-llms-list-editor__templates-list"]],null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["preConfiguredLlms"]]],null]],null],null,[[[1,"              "],[8,[32,9],[[16,"data-llm-id",[30,6,["id"]]],[24,0,"ai-llms-list-editor__templates-list-item"]],[["@titleLabelTranslated","@descriptionLabelTranslated","@taglineLabel"],[[30,6,["name"]],[28,[30,0,["modelDescription"]],[[30,6]],null],[28,[32,4],["discourse_ai.llms.providers.",[30,6,["provider"]]],null]]],[["buttons"],[[[[1,"\\n                  "],[8,[30,7,["Default"]],null,[["@action","@icon","@label"],[[28,[32,10],[[30,0,["transitionToLlmEditor"]],[30,6,["id"]]],null],"gear","discourse_ai.llms.preconfigured.button"]],null],[1,"\\n                "]],[7]]]]],[1,"\\n"]],[6]],null],[1,"          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentLlm","@llms","@llmTemplate","llm","usage","llm","buttons"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-llms-list-editor.js",scope:()=>[n.default,l.i18n,p.default,r.default,s.concat,g,c.default,a.default,u.default,d.default,s.fn],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/routing","@ember/runloop","@ember/service","truth-helpers","discourse/components/back-button","discourse/components/form","discourse/helpers/bound-avatar-template","discourse/lib/ajax-error","discourse/models/group","discourse-i18n","admin/models/admin-user","select-kit/components/group-chooser","discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","discourse/plugins/discourse-ai/discourse/components/ai-persona-example","discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options","discourse/plugins/discourse-ai/discourse/components/ai-tool-selector","discourse/plugins/discourse-ai/discourse/components/rag-options-fk","discourse/plugins/discourse-ai/discourse/components/rag-uploader","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T,P){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class C extends t.default{static#e=(()=>dt7948.g(this.prototype,"router",[l.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#s=(()=>dt7948.g(this.prototype,"store",[l.service]))()
#ee=(()=>{dt7948.i(this,"store")})()
static#o=(()=>dt7948.g(this.prototype,"dialog",[l.service]))()
#X=(()=>{dt7948.i(this,"dialog")})()
static#a=(()=>dt7948.g(this.prototype,"toasts",[l.service]))()
#Z=(()=>{dt7948.i(this,"toasts")})()
static#l=(()=>dt7948.g(this.prototype,"siteSettings",[l.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#u=(()=>dt7948.g(this.prototype,"allGroups",[s.tracked],(function(){return[]})))()
#ge=(()=>{dt7948.i(this,"allGroups")})()
static#p=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#te=(()=>{dt7948.i(this,"isSaving")})()
dirtyFormData=null
get formData(){if(this.dirtyFormData){const e=this.dirtyFormData
return this.dirtyFormData=null,e}{const e=this.args.model.toPOJO()
return e.tools&&(e.toolOptions=this.mapToolOptions(e.toolOptions,e.tools)),e}}static#h=(()=>dt7948.n(this.prototype,"formData",[s.cached]))()
get chatPluginEnabled(){return this.siteSettings.chat_enabled}get allTools(){return this.args.personas.resultSetMeta.tools}get maxPixelValues(){const e=e=>(0,g.i18n)(`discourse_ai.ai_persona.vision_max_pixel_sizes.${e}`)
return[{name:e("low"),id:65536},{name:e("medium"),id:262144},{name:e("high"),id:1048576}]}get forcedToolStrategies(){const e=[{id:-1,name:(0,g.i18n)("discourse_ai.ai_persona.tool_strategies.all")}]
return[1,2,5].forEach((t=>{e.push({id:t,name:(0,g.i18n)("discourse_ai.ai_persona.tool_strategies.replies",{count:t})})})),e}async updateAllGroups(){const e=await h.default.findAll({include_everyone:!0})
if(!e.find((e=>0===e.id))){const t="everyone"
e.push({id:0,name:t})}this.allGroups=e}static#_=(()=>dt7948.n(this.prototype,"updateAllGroups",[o.action]))()
async save(e){const t=this.args.model.isNew
this.isSaving=!0
try{const s=Object.assign(this.args.model,this.args.model.fromPOJO(e))
await s.save(),this.#_e(),t&&0===this.args.model.rag_uploads.length?(this.args.personas.addObject(s),this.router.transitionTo("adminPlugins.show.discourse-ai-personas.edit",s)):this.toasts.success({data:{message:(0,g.i18n)("discourse_ai.ai_persona.saved")},duration:2e3})}catch(s){(0,m.popupAjaxError)(s)}finally{(0,r.later)((()=>{this.isSaving=!1}),1e3)}}static#f=(()=>dt7948.n(this.prototype,"save",[o.action]))()
get adminUser(){const e=Object.assign({},this.args.model?.user)
return _.default.create(e)}delete(){return this.dialog.confirm({message:(0,g.i18n)("discourse_ai.ai_persona.confirm_delete"),didConfirm:()=>this.args.model.destroyRecord().then((()=>{this.args.personas.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-personas.index")}))})}static#b=(()=>dt7948.n(this.prototype,"delete",[o.action]))()
async toggleEnabled(e,t,s){let{set:i}=s
i("enabled",t),await this.persistField(e,"enabled",t)}static#y=(()=>dt7948.n(this.prototype,"toggleEnabled",[o.action]))()
async togglePriority(e,t,s){let{set:i}=s
i("priority",t),await this.persistField(e,"priority",t,!0)}static#v=(()=>dt7948.n(this.prototype,"togglePriority",[o.action]))()
async createUser(e){try{let t=await this.args.model.createUser()
e.set("user",t),e.set("user_id",t.id)}catch(t){(0,m.popupAjaxError)(t)}}static#w=(()=>dt7948.n(this.prototype,"createUser",[o.action]))()
updateUploads(e,t){e.set("rag_uploads",t)}static#L=(()=>dt7948.n(this.prototype,"updateUploads",[o.action]))()
async removeUpload(e,t,s,i){const o=s.filter((e=>e.id!==i.id))
e.set("rag_uploads",o),this.args.model.isNew||await this.persistField(t,"rag_uploads",o)}static#N=(()=>dt7948.n(this.prototype,"removeUpload",[o.action]))()
updateToolNames(e,t,s){const i=t?.tools?.filter((e=>!s.includes(e)))||[],o=this.mapToolOptions(t.toolOptions,s)
if(e.setProperties({tools:s,toolOptions:o}),t.forcedTools?.length>0){const s=t.forcedTools.filter((e=>!i.includes(e)))
e.set("forcedTools",s)}}static#U=(()=>dt7948.n(this.prototype,"updateToolNames",[o.action]))()
availableForcedTools(e){return this.allTools.filter((t=>e.includes(t.id)))}static#q=(()=>dt7948.n(this.prototype,"availableForcedTools",[o.action]))()
addExamplesPair(e,t){const s=[...t.examples,["",""]]
e.set("examples",s)}static#B=(()=>dt7948.n(this.prototype,"addExamplesPair",[o.action]))()
mapToolOptions(e,t){const s=Object.assign({},e)
return t.forEach((e=>{const t=this.allTools.findBy("id",e),i=t?.options
if(!i||s[e])return
const o={}
Object.keys(i).forEach((e=>{o[e]=null})),s[e]=o})),s}async persistField(e,t,s,i){if(!this.args.model.isNew){const n=Object.assign({},e)
n[t]=s
try{const e={}
e[t]=s,this.dirtyFormData=n,await this.args.model.update(e),i&&this.#_e()}catch(o){(0,m.popupAjaxError)(o)}}}#_e(){const e=this.args.personas.toArray().sort(((e,t)=>e.priority&&!t.priority?-1:!e.priority&&t.priority?1:e.name.localeCompare(t.name)))
this.args.personas.clear(),this.args.personas.setObjects(e)}static#z=(()=>(0,T.setComponentTemplate)((0,P.createTemplateFactory)({id:"+cIR8Qyt",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-personas","discourse_ai.ai_persona.back"]],null],[1,"\\n    "],[11,0],[24,0,"ai-persona-editor"],[4,[32,1],[[30,0,["updateAllGroups"]],[30,1,["id"]]],null],[12],[1,"\\n      "],[8,[32,2],null,[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["name",[28,[32,3],["discourse_ai.ai_persona.name"],null],"required|length:1,100",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,4,["Input"]],null,null,null],[1,"\\n        "]],[4]]]]],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["description",[28,[32,3],["discourse_ai.ai_persona.description"],null],"required|length:1,100",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,5,["Textarea"]],null,null,null],[1,"\\n        "]],[5]]]]],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@disabled","@format"],["system_prompt",[28,[32,3],["discourse_ai.ai_persona.system_prompt"],null],"required|length:1,100000",[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,6,["Textarea"]],null,null,null],[1,"\\n        "]],[6]]]]],[1,"\\n\\n        "],[8,[32,4],null,[["@form","@data"],[[30,2],[30,3]]],null],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["default_llm_id",[28,[32,3],["discourse_ai.ai_persona.default_llm"],null],[28,[32,3],["discourse_ai.ai_persona.default_llm_help"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,7,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,5],null,[["@value","@llms","@onChange","@class"],[[30,7,["value"]],[30,8,["resultSetMeta","llms"]],[30,7,["set"]],"ai-persona-editor__llms"]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[7]]]]],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["allowed_group_ids",[28,[32,3],["discourse_ai.ai_persona.allowed_groups"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,9,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,6],null,[["@value","@content","@onChange"],[[30,3,["allowed_group_ids"]],[30,0,["allGroups"]],[30,9,["set"]]]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[9]]]]],[1,"\\n\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["vision_enabled",[28,[32,3],["discourse_ai.ai_persona.vision_enabled"],null],[28,[32,3],["discourse_ai.ai_persona.vision_enabled_help"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,10,["Checkbox"]],null,null,null],[1,"\\n        "]],[10]]]]],[1,"\\n\\n"],[41,[30,3,["vision_enabled"]],[[[1,"          "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet","@format"],["vision_max_pixels",[28,[32,3],["discourse_ai.ai_persona.vision_max_pixels"],null],[30,0,["onChangeMaxPixels"]],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,11,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["maxPixelValues"]]],null]],null],null,[[[1,"                "],[8,[30,12,["Option"]],null,[["@value"],[[30,13,["id"]]]],[["default"],[[[[1,[30,13,["name"]]]],[]]]]],[1,"\\n"]],[13]],null],[1,"            "]],[12]]]]],[1,"\\n          "]],[11]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_context_posts",[28,[32,3],["discourse_ai.ai_persona.max_context_posts"],null],[28,[32,3],["discourse_ai.ai_persona.max_context_posts_help"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,14,["Input"]],[[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n        "]],[14]]]]],[1,"\\n\\n"],[41,[51,[30,3,["system"]]],[[[1,"          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@disabled","@format"],["temperature",[28,[32,3],["discourse_ai.ai_persona.temperature"],null],[28,[32,3],["discourse_ai.ai_persona.temperature_help"],null],[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,15,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n          "]],[15]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@disabled","@format"],["top_p",[28,[32,3],["discourse_ai.ai_persona.top_p"],null],[28,[32,3],["discourse_ai.ai_persona.top_p_help"],null],[30,3,["system"]],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,16,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n          "]],[16]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,2,["Section"]],null,[["@title","@subtitle"],[[28,[32,3],["discourse_ai.ai_persona.examples.title"],null],[28,[32,3],["discourse_ai.ai_persona.examples.examples_help"],null]]],[["default"],[[[[1,"\\n"],[41,[51,[30,3,["system"]]],[[[1,"            "],[8,[30,2,["Container"]],null,null,[["default"],[[[[1,"\\n              "],[8,[30,2,["Button"]],[[24,0,"ai-persona-editor__new_example"]],[["@action","@label"],[[28,[32,7],[[30,0,["addExamplesPair"]],[30,2],[30,3]],null],"discourse_ai.ai_persona.examples.new"]],null],[1,"\\n            "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["examples","length"]],0],null],[[[1,"            "],[8,[30,2,["Collection"]],null,[["@name"],["examples"]],[["default"],[[[[1,"\\n              "],[8,[32,9],null,[["@examplesCollection","@exampleNumber","@system","@form"],[[30,17],[30,18],[30,3,["system"]],[30,2]]],null],[1,"\\n            "]],[17,18]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n\\n        "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.ai_persona.ai_tools"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["tools",[28,[32,3],["discourse_ai.ai_persona.tools"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,19,["Custom"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,10],null,[["@value","@disabled","@onChange","@content"],[[30,19,["value"]],[30,3,["system"]],[28,[32,7],[[30,0,["updateToolNames"]],[30,2],[30,3]],null],[30,8,["resultSetMeta","tools"]]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[19]]]]],[1,"\\n\\n"],[41,[28,[32,8],[[30,3,["tools","length"]],0],null],[[[1,"            "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["forcedTools",[28,[32,3],["discourse_ai.ai_persona.forced_tools"],null],"large"]],[["default"],[[[[1,"\\n              "],[8,[30,20,["Custom"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,10],null,[["@value","@disabled","@onChange","@content"],[[30,20,["value"]],[30,3,["system"]],[30,20,["set"]],[28,[30,0,["availableForcedTools"]],[[30,3,["tools"]]],null]]],null],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[20]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["forcedTools","length"]],0],null],[[[1,"            "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["forced_tool_count",[28,[32,3],["discourse_ai.ai_persona.forced_tool_strategy"],null],"large"]],[["default"],[[[[1,"\\n              "],[8,[30,21,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["forcedToolStrategies"]]],null]],null],null,[[[1,"                  "],[8,[30,22,["Option"]],null,[["@value"],[[30,23,["id"]]]],[["default"],[[[[1,[30,23,["name"]]]],[]]]]],[1,"\\n"]],[23]],null],[1,"              "]],[22]]]]],[1,"\\n            "]],[21]]]]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[28,[32,8],[[30,3,["tools","length"]],0],null],[[[1,"            "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["tool_details",[28,[32,3],["discourse_ai.ai_persona.tool_details"],null],[28,[32,3],["discourse_ai.ai_persona.tool_details_help"],null],"large"]],[["default"],[[[[1,"\\n              "],[8,[30,24,["Checkbox"]],null,null,null],[1,"\\n            "]],[24]]]]],[1,"\\n\\n            "],[8,[32,11],null,[["@form","@data","@llms","@allTools"],[[30,2],[30,3],[30,8,["resultSetMeta","llms"]],[30,8,["resultSetMeta","tools"]]]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"          "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.rag.title"],null]]],[["default"],[[[[1,"\\n            "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["rag_uploads",[28,[32,3],["discourse_ai.rag.uploads.title"],null],"full"]],[["default"],[[[[1,"\\n              "],[8,[30,25,["Custom"]],null,null,[["default"],[[[[1,"\\n                "],[8,[32,12],null,[["@target","@targetName","@updateUploads","@onRemove","@allowImages"],[[30,3],"AiPersona",[28,[32,7],[[30,0,["updateUploads"]],[30,2]],null],[28,[32,7],[[30,0,["removeUpload"]],[30,2],[30,3],[30,25,["value"]]],null],[30,8,["resultSetMeta","settings","rag_images_enabled"]]]],null],[1,"\\n              "]],[]]]]],[1,"\\n            "]],[25]]]]],[1,"\\n\\n            "],[8,[32,13],null,[["@form","@data","@llms","@allowImages"],[[30,2],[30,3],[30,8,["resultSetMeta","llms"]],[30,8,["resultSetMeta","settings","rag_images_enabled"]]]],[["default"],[[[[1,"\\n              "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_conversation_chunks",[28,[32,3],["discourse_ai.ai_persona.rag_conversation_chunks"],null],[28,[32,3],["discourse_ai.ai_persona.rag_conversation_chunks_help"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,26,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n              "]],[26]]]]],[1,"\\n\\n              "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["question_consolidator_llm_id",[28,[32,3],["discourse_ai.ai_persona.question_consolidator_llm"],null],[28,[32,3],["discourse_ai.ai_persona.question_consolidator_llm_help"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,27,["Custom"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,5],null,[["@value","@llms","@onChange","@class"],[[30,27,["value"]],[30,8,["resultSetMeta","llms"]],[30,27,["set"]],"ai-persona-editor__llms"]],null],[1,"\\n                "]],[]]]]],[1,"\\n              "]],[27]]]]],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[]]]]],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,2,["Section"]],null,[["@title"],[[28,[32,3],["discourse_ai.ai_persona.ai_bot.title"],null]]],[["default"],[[[[1,"\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet"],["enabled",[28,[32,3],["discourse_ai.ai_persona.enabled"],null],[28,[32,7],[[30,0,["toggleEnabled"]],[30,3]],null]]],[["default"],[[[[1,"\\n            "],[8,[30,28,["Toggle"]],null,null,null],[1,"\\n          "]],[28]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@onSet","@tooltip"],["priority",[28,[32,3],["discourse_ai.ai_persona.priority"],null],[28,[32,7],[[30,0,["togglePriority"]],[30,3]],null],[28,[32,3],["discourse_ai.ai_persona.priority_help"],null]]],[["default"],[[[[1,"\\n            "],[8,[30,29,["Toggle"]],null,null,null],[1,"\\n          "]],[29]]]]],[1,"\\n\\n"],[41,[30,1,["isNew"]],[[[1,"            "],[10,0],[12],[1,[28,[32,3],["discourse_ai.ai_persona.ai_bot.save_first"],null]],[13],[1,"\\n"]],[]],[[[41,[30,3,["default_llm_id"]],[[[1,"              "],[8,[30,2,["Field"]],null,[["@name","@title","@format"],["force_default_llm",[28,[32,3],["discourse_ai.ai_persona.force_default_llm"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,30,["Checkbox"]],null,null,null],[1,"\\n              "]],[30]]]]],[1,"\\n"]],[]],null],[1,"\\n            "],[8,[30,2,["Container"]],[[24,0,"ai-persona-editor__ai_bot_user"]],[["@title","@tooltip"],[[28,[32,3],["discourse_ai.ai_persona.user"],null],[52,[51,[30,3,["user"]]],[28,[32,3],["discourse_ai.ai_persona.create_user_help"],null]]]],[["default"],[[[[1,"\\n"],[41,[30,3,["user"]],[[[1,"                "],[10,3],[14,0,"avatar"],[15,6,[30,3,["user","path"]]],[15,"data-user-card",[30,3,["user","username"]]],[12],[1,"\\n                  "],[1,[28,[32,14],[[30,3,["user","avatar_template"]],"small"],null]],[1,"\\n                "],[13],[1,"\\n                "],[8,[32,15],null,[["@route","@model"],["adminUser",[30,0,["adminUser"]]]],[["default"],[[[[1,"\\n                  "],[1,[30,3,["user","username"]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[]],[[[1,"                "],[8,[30,2,["Button"]],[[24,0,"ai-persona-editor__create-user"]],[["@action","@label"],[[28,[32,7],[[30,0,["createUser"]],[30,2]],null],"discourse_ai.ai_persona.create_user"]],null],[1,"\\n"]],[]]],[1,"            "]],[]]]]],[1,"\\n\\n"],[41,[30,3,["user"]],[[[1,"              "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_personal_messages",[28,[32,3],["discourse_ai.ai_persona.allow_personal_messages"],null],[28,[32,3],["discourse_ai.ai_persona.allow_personal_messages_help"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,31,["Checkbox"]],null,null,null],[1,"\\n              "]],[31]]]]],[1,"\\n\\n              "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_topic_mentions",[28,[32,3],["discourse_ai.ai_persona.allow_topic_mentions"],null],[28,[32,3],["discourse_ai.ai_persona.allow_topic_mentions_help"],null],"large"]],[["default"],[[[[1,"\\n                "],[8,[30,32,["Checkbox"]],null,null,null],[1,"\\n              "]],[32]]]]],[1,"\\n\\n"],[41,[30,0,["chatPluginEnabled"]],[[[1,"                "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_chat_direct_messages",[28,[32,3],["discourse_ai.ai_persona.allow_chat_direct_messages"],null],[28,[32,3],["discourse_ai.ai_persona.allow_chat_direct_messages_help"],null],"large"]],[["default"],[[[[1,"\\n                  "],[8,[30,33,["Checkbox"]],null,null,null],[1,"\\n                "]],[33]]]]],[1,"\\n\\n                "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["allow_chat_channel_mentions",[28,[32,3],["discourse_ai.ai_persona.allow_chat_channel_mentions"],null],[28,[32,3],["discourse_ai.ai_persona.allow_chat_channel_mentions_help"],null],"large"]],[["default"],[[[[1,"\\n                  "],[8,[30,34,["Checkbox"]],null,null,null],[1,"\\n                "]],[34]]]]],[1,"\\n"]],[]],null]],[]],null]],[]]],[1,"        "]],[]]]]],[1,"\\n\\n        "],[8,[30,2,["Actions"]],null,null,[["default"],[[[[1,"\\n          "],[8,[30,2,["Submit"]],null,null,null],[1,"\\n\\n"],[41,[51,[28,[32,16],[[30,1,["isNew"]],[30,1,["system"]]],null]],[[[1,"            "],[8,[30,2,["Button"]],[[24,0,"btn-danger"]],[["@action","@label"],[[30,0,["delete"]],"discourse_ai.ai_persona.delete"]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n      "]],[2,3]]]]],[1,"\\n    "],[13],[1,"\\n  "]],["@model","form","data","field","field","field","field","@personas","field","field","field","select","pixelValue","field","field","field","exCollection","exCollectionIdx","field","field","field","select","fts","field","field","field","field","field","field","field","field","field","field","field"],false,["if","each","-track-array","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-editor.js",scope:()=>[u.default,n.default,c.default,g.i18n,b.default,y.default,f.default,i.fn,d.gt,v.default,S.default,w.default,k.default,x.default,p.default,a.LinkTo,d.or],isStrictMode:!0}),this))()}e.default=C})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-example",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","truth-helpers","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"collapsed",[s.tracked],(function(){return!0})))()
#fe=(()=>{dt7948.i(this,"collapsed")})()
get caretIcon(){return this.collapsed?"angle-right":"angle-down"}toggleExample(){this.collapsed=!this.collapsed}static#s=(()=>dt7948.n(this.prototype,"toggleExample",[n.action]))()
deletePair(){this.collapsed=!0,this.args.examplesCollection.remove(this.args.exampleNumber)}static#o=(()=>dt7948.n(this.prototype,"deletePair",[n.action]))()
get exampleTitle(){return(0,l.i18n)("discourse_ai.ai_persona.examples.collapsable_title",{number:this.args.exampleNumber+1})}static#a=(()=>(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"VT1ymzpg",block:'[[[1,"\\n    "],[11,0],[24,"role","button"],[4,[32,0],["click",[30,0,["toggleExample"]]],null],[12],[1,"\\n      "],[10,1],[12],[1,[28,[32,1],[[30,0,["caretIcon"]]],null]],[13],[1,"\\n      "],[1,[30,0,["exampleTitle"]]],[1,"\\n    "],[13],[1,"\\n"],[41,[51,[30,0,["collapsed"]]],[[[1,"      "],[8,[30,1,["Collection"]],null,null,[["default"],[[[[1,"\\n        "],[8,[30,2,["Field"]],null,[["@title","@validation","@disabled"],[[28,[32,2],[[28,[32,3],["discourse_ai.ai_persona.examples.",[52,[28,[32,4],[[30,3],0],null],"user","model"]],null]],null],"required|length:1,5000",[30,4]]],[["default"],[[[[1,"\\n          "],[8,[30,5,["Textarea"]],null,null,null],[1,"\\n        "]],[5]]]]],[1,"\\n      "]],[2,3]]]]],[1,"\\n\\n"],[41,[51,[30,4]],[[[1,"        "],[8,[30,6,["Container"]],null,null,[["default"],[[[[1,"\\n          "],[8,[30,6,["Button"]],[[24,0,"ai-persona-editor__delete_example btn-danger"]],[["@action","@label"],[[30,0,["deletePair"]],"discourse_ai.ai_persona.examples.remove"]],null],[1,"\\n        "]],[]]]]],[1,"\\n"]],[]],null]],[]],null],[1,"  "]],["@examplesCollection","exPair","pairIdx","@system","field","@form"],false,["unless","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-example.js",scope:()=>[o.on,r.default,l.i18n,i.concat,a.eq],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor",["exports","@glimmer/component","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/service","discourse/components/d-breadcrumbs-item","discourse/components/d-page-subheader","discourse/components/d-toggle-switch","discourse/helpers/concat-class","discourse/lib/ajax-error","discourse-i18n","admin/components/admin-config-area-empty-list","discourse/plugins/discourse-ai/discourse/components/ai-persona-editor","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"adminPluginNavManager",[a.service]))()
#re=(()=>{dt7948.i(this,"adminPluginNavManager")})()
async toggleEnabled(e){const t=e.enabled,s=!t
try{e.set("enabled",s),await e.save()}catch(i){e.set("enabled",t),(0,c.popupAjaxError)(i)}}static#s=(()=>dt7948.n(this.prototype,"toggleEnabled",[o.action]))()
static#o=(()=>(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"70As7cgM",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-personas"]],[28,[32,1],["discourse_ai.ai_persona.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-persona-list-editor__current admin-detail pull-left"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[8,[32,2],null,[["@model","@personas"],[[30,1],[30,2]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,3],null,[["@titleLabel","@descriptionLabel","@learnMoreUrl"],[[28,[32,1],["discourse_ai.ai_persona.short_title"],null],[28,[32,1],["discourse_ai.ai_persona.persona_description"],null],"https://meta.discourse.org/t/ai-bot-personas/306099"]],[["actions"],[[[[1,"\\n            "],[8,[30,3,["Primary"]],[[24,0,"ai-persona-list-editor__new-button"]],[["@label","@route","@icon"],["discourse_ai.ai_persona.new","adminPlugins.show.discourse-ai-personas.new","plus"]],null],[1,"\\n          "]],[3]]]]],[1,"\\n\\n"],[41,[30,2],[[[1,"          "],[10,"table"],[14,0,"content-list ai-persona-list-editor d-admin-table"],[12],[1,"\\n            "],[10,"thead"],[12],[1,"\\n              "],[10,"tr"],[12],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.name"],null]],[13],[1,"\\n                "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.ai_persona.list.enabled"],null]],[13],[1,"\\n                "],[10,"th"],[12],[13],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n            "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,2]],null]],null],null,[[[1,"                "],[10,"tr"],[15,"data-persona-id",[30,4,["id"]]],[15,0,[28,[32,4],["ai-persona-list__row d-admin-row__content",[52,[30,4,["priority"]],"priority"]],null]],[12],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-persona-list__name-with-description"],[12],[1,"\\n                      "],[10,0],[14,0,"ai-persona-list__name"],[12],[1,"\\n                        "],[10,"strong"],[12],[1,"\\n                          "],[1,[30,4,["name"]]],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n                      "],[10,0],[14,0,"ai-persona-list__description"],[12],[1,"\\n                        "],[1,[30,4,["description"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__detail"],[12],[1,"\\n                    "],[8,[32,5],[[4,[32,6],["click",[28,[32,7],[[30,0,["toggleEnabled"]],[30,4]],null]],null]],[["@state"],[[30,4,["enabled"]]]],null],[1,"\\n                  "],[13],[1,"\\n                  "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                    "],[8,[32,8],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-personas.edit",[30,4]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.ai_persona.edit"],null]],[1," "]],[]]]]],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n"]],[4]],null],[1,"            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[8,[32,9],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.ai_persona.new","adminPlugins.show.discourse-ai-personas.new","ai-persona-list-editor__empty-new-button","discourse_ai.ai_persona.no_personas"]],null],[1,"\\n"]],[]]]],[]]],[1,"    "],[13],[1,"\\n  "]],["@currentPersona","@personas","actions","persona"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-list-editor.js",scope:()=>[r.default,p.i18n,h.default,l.default,u.default,d.default,i.on,s.fn,n.LinkTo,m.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/runloop","@ember/service","discourse-i18n","select-kit/components/dropdown-select-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const u="ai_persona_selector_id",c="ai_llm_selector_id"
class p extends t.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[n.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#s=(()=>dt7948.g(this.prototype,"keyValueStore",[n.service]))()
#be=(()=>{dt7948.i(this,"keyValueStore")})()
static#o=(()=>dt7948.g(this.prototype,"llm",[s.tracked]))()
#ye=(()=>{dt7948.i(this,"llm")})()
static#a=(()=>dt7948.g(this.prototype,"allowLLMSelector",[s.tracked],(function(){return!0})))()
#ve=(()=>{dt7948.i(this,"allowLLMSelector")})()
constructor(){super(...arguments),this.botOptions?.length&&(this.#we(),this.#Se(),(0,o.next)((()=>{this.resetTargetRecipients()})))}get composer(){return this.args?.outletArgs?.model}get hasLlmSelector(){return this.currentUser.ai_enabled_chat_bots.any((e=>!e.is_persona))}get botOptions(){if(!this.currentUser.ai_enabled_personas)return
let e=this.currentUser.ai_enabled_personas
return this.hasLlmSelector||(e=e.filter((e=>e.username))),e.map((e=>({id:e.id,name:e.name,description:e.description})))}get filterable(){return this.botOptions.length>8}get value(){return this._value}set value(e){this._value=e,this.keyValueStore.setItem(u,e),this.args.setPersonaId(e),this.setAllowLLMSelector(),this.resetTargetRecipients()}setAllowLLMSelector(){if(!this.hasLlmSelector)return void(this.allowLLMSelector=!1)
const e=this.currentUser.ai_enabled_personas.find((e=>e.id===this._value))
this.allowLLMSelector=!e?.force_default_llm}get currentLlm(){return this.llm}set currentLlm(e){this.llm=e,this.keyValueStore.setItem(c,e),this.resetTargetRecipients()}resetTargetRecipients(){if(this.allowLLMSelector){const e=this.currentUser.ai_enabled_chat_bots.find((e=>e.id===this.llm)).username
this.args.setTargetRecipient(e)}else{const e=this.currentUser.ai_enabled_personas.find((e=>e.id===this._value))
this.args.setTargetRecipient(e.username||"")}}get llmOptions(){return this.currentUser.ai_enabled_chat_bots.filter((e=>!e.is_persona)).filter(Boolean).map((e=>({id:e.id,name:e.display_name}))).sort(((e,t)=>e.name.localeCompare(t.name)))}get showLLMSelector(){return this.allowLLMSelector&&this.llmOptions.length>1}#we(){let e=this.keyValueStore.getItem(u)
this._value=this.botOptions[0].id,e&&(e=parseInt(e,10),this.botOptions.any((t=>t.id===e))&&(this._value=e)),this.args.setPersonaId(this._value)}#Se(){if(this.setAllowLLMSelector(),this.hasLlmSelector){let e=this.keyValueStore.getItem(c)
e&&(e=parseInt(e,10))
const t=this.llmOptions.find((t=>t.id===e))||this.llmOptions[0]
e=t?t.id:"",e&&(0,o.next)((()=>{this.currentLlm=e}))}}static#l=(()=>(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"38qykDxh",block:'[[[1,"\\n    "],[10,0],[14,0,"persona-llm-selector"],[12],[1,"\\n      "],[10,0],[14,0,"persona-llm-selector__selection-wrapper gpt-persona"],[12],[1,"\\n"],[41,[30,1],[[[1,"          "],[10,"label"],[12],[1,[28,[32,0],["discourse_ai.ai_bot.persona"],null]],[13],[1,"\\n"]],[]],null],[1,"        "],[8,[32,1],[[24,0,"persona-llm-selector__persona-dropdown"]],[["@value","@content","@options"],[[30,0,["value"]],[30,0,["botOptions"]],[28,[32,2],null,[["icon","filterable"],[[52,[30,1],"angle-down","robot"],[30,0,["filterable"]]]]]]],null],[1,"\\n      "],[13],[1,"\\n"],[41,[30,0,["showLLMSelector"]],[[[1,"        "],[10,0],[14,0,"persona-llm-selector__selection-wrapper llm-selector"],[12],[1,"\\n"],[41,[30,1],[[[1,"            "],[10,"label"],[12],[1,[28,[32,0],["discourse_ai.ai_bot.llm"],null]],[13],[1,"\\n"]],[]],null],[1,"          "],[8,[32,1],[[24,0,"persona-llm-selector__llm-dropdown"]],[["@value","@content","@options"],[[30,0,["currentLlm"]],[30,0,["llmOptions"]],[28,[32,2],null,[["icon"],[[52,[30,1],"angle-down","globe"]]]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@showLabels"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector.js",scope:()=>[a.i18n,r.default,i.hash],isStrictMode:!0}),this))()}e.default=p})),define("discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options",["exports","@glimmer/component","@ember/object","truth-helpers","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{get showToolOptions(){const e=this.args.allTools
return!(!e||!this.args.data.tools)&&this.args.data?.tools.any((t=>e.findBy("id",t)?.options))}get toolsMetadata(){const e={}
return this.args.allTools.map((t=>{e[t.id]={name:t.name,...t?.options}})),e}formObjectKeys(e){return e?Object.keys(e):[]}static#e=(()=>dt7948.n(this.prototype,"formObjectKeys",[s.action]))()
toolOptionKeys(e){const t=this.toolsMetadata[e]
if(!t)return[]
return Object.keys(t).filter((e=>"name"!==e))}static#s=(()=>dt7948.n(this.prototype,"toolOptionKeys",[s.action]))()
static#o=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"bmPlYxJA",block:'[[[1,"\\n"],[41,[30,0,["showToolOptions"]],[[[1,"      "],[8,[30,1,["Container"]],null,[["@title","@direction","@format"],[[28,[32,0],["discourse_ai.ai_persona.tool_options"],null],"column","full"]],[["default"],[[[[1,"\\n        "],[8,[30,1,["Object"]],null,[["@name","@title"],["toolOptions",[28,[32,0],["discourse_ai.ai_persona.tool_options"],null]]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["formObjectKeys"]],[[30,3]],null]],null]],null],null,[[[1,"            "],[10,0],[14,0,"ai-persona-editor__tool-options"],[12],[1,"\\n"],[44,[[28,[32,1],[[30,0,["toolsMetadata"]],[30,4]],null]],[[[1,"                "],[10,0],[14,0,"ai-persona-editor__tool-options-name"],[12],[1,"\\n                  "],[1,[30,5,["name"]]],[1,"\\n                "],[13],[1,"\\n                "],[8,[30,2,["Object"]],null,[["@name"],[[30,4]]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[28,[30,0,["toolOptionKeys"]],[[30,4]],null]],null]],null],null,[[[44,[[28,[32,1],[[30,5],[30,7]],null]],[[[1,"                      "],[8,[30,6,["Field"]],null,[["@name","@title","@helpText","@format"],[[30,7],[30,8,["name"]],[30,8,["description"]],"full"]],[["default"],[[[[1,"\\n"],[41,[28,[32,2],[[30,8,["type"]],"enum"],null],[[[1,"                          "],[8,[30,9,["Select"]],null,[["@includeNone"],[false]],[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,6,["values"]]],null]],null],null,[[[1,"                              "],[8,[30,10,["Option"]],null,[["@value"],[[30,11]]],[["default"],[[[[1,[30,11]]],[]]]]],[1,"\\n"]],[11]],null],[1,"                          "]],[10]]]]],[1,"\\n"]],[]],[[[41,[28,[32,2],[[30,8,["type"]],"llm"],null],[[[1,"                          "],[8,[30,9,["Custom"]],null,null,[["default"],[[[[1,"\\n                            "],[8,[32,3],null,[["@value","@llms","@onChange","@class"],[[30,9,["value"]],[30,12],[30,9,["set"]],"ai-persona-tool-option-editor__llms"]],null],[1,"\\n                          "]],[]]]]],[1,"\\n"]],[]],[[[41,[28,[32,2],[[30,8,["type"]],"boolean"],null],[[[1,"                          "],[8,[30,9,["Checkbox"]],null,null,null],[1,"\\n"]],[]],[[[1,"                          "],[8,[30,9,["Input"]],null,null,null],[1,"\\n                        "]],[]]]],[]]]],[]]],[1,"                      "]],[9]]]]],[1,"\\n"]],[8]]]],[7]],null],[1,"                "]],[6]]]]],[1,"\\n"]],[5]]],[1,"            "],[13],[1,"\\n"]],[4]],null],[1,"        "]],[2,3]]]]],[1,"\\n      "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["@form","toolObj","optsPerTool","toolId","toolMeta","optionsObj","optionName","optionMeta","field","select","v","@llms"],false,["if","each","-track-array","let"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-persona-tool-options.js",scope:()=>[o.i18n,s.get,i.eq,n.default],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/will-destroy","@ember/service","ember-modifier","truth-helpers","discourse/components/cook-text","discourse/components/d-button","discourse/components/fast-edit","discourse/components/modal/fast-edit","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/plugin-api","discourse/lib/text","discourse/lib/utilities","discourse-i18n","truth-helpers/helpers/eq","discourse/plugins/discourse-ai/discourse/components/ai-helper-loading","discourse/plugins/discourse-ai/discourse/components/ai-helper-options-list","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T,P){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class C extends t.default{static#e=(()=>dt7948.g(this.prototype,"messageBus",[a.service]))()
#xe=(()=>{dt7948.i(this,"messageBus")})()
static#s=(()=>dt7948.g(this.prototype,"site",[a.service]))()
#F=(()=>{dt7948.i(this,"site")})()
static#o=(()=>dt7948.g(this.prototype,"modal",[a.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
static#a=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#l=(()=>dt7948.g(this.prototype,"currentUser",[a.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#u=(()=>dt7948.g(this.prototype,"menu",[a.service]))()
#ke=(()=>{dt7948.i(this,"menu")})()
static#p=(()=>dt7948.g(this.prototype,"tooltip",[a.service]))()
#Te=(()=>{dt7948.i(this,"tooltip")})()
static#h=(()=>dt7948.g(this.prototype,"menuState",[s.tracked],(function(){return this.MENU_STATES.options})))()
#Pe=(()=>{dt7948.i(this,"menuState")})()
static#_=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#f=(()=>dt7948.g(this.prototype,"suggestion",[s.tracked],(function(){return""})))()
#je=(()=>{dt7948.i(this,"suggestion")})()
static#b=(()=>dt7948.g(this.prototype,"customPromptValue",[s.tracked],(function(){return""})))()
#J=(()=>{dt7948.i(this,"customPromptValue")})()
static#y=(()=>dt7948.g(this.prototype,"copyButtonIcon",[s.tracked],(function(){return"copy"})))()
#Me=(()=>{dt7948.i(this,"copyButtonIcon")})()
static#v=(()=>dt7948.g(this.prototype,"copyButtonLabel",[s.tracked],(function(){return"discourse_ai.ai_helper.post_options_menu.copy"})))()
#Ae=(()=>{dt7948.i(this,"copyButtonLabel")})()
static#w=(()=>dt7948.g(this.prototype,"showFastEdit",[s.tracked],(function(){return!1})))()
#Oe=(()=>{dt7948.i(this,"showFastEdit")})()
static#L=(()=>dt7948.g(this.prototype,"showAiButtons",[s.tracked],(function(){return!0})))()
#Ee=(()=>{dt7948.i(this,"showAiButtons")})()
static#N=(()=>dt7948.g(this.prototype,"streaming",[s.tracked],(function(){return!1})))()
#Re=(()=>{dt7948.i(this,"streaming")})()
static#U=(()=>dt7948.g(this.prototype,"lastSelectedOption",[s.tracked],(function(){return null})))()
#Ie=(()=>{dt7948.i(this,"lastSelectedOption")})()
static#q=(()=>dt7948.g(this.prototype,"isSavingFootnote",[s.tracked],(function(){return!1})))()
#Fe=(()=>{dt7948.i(this,"isSavingFootnote")})()
static#B=(()=>dt7948.g(this.prototype,"supportsAddFootnote",[s.tracked],(function(){return this.args.data.supportsFastEdit})))()
#De=(()=>{dt7948.i(this,"supportsAddFootnote")})()
static#z=(()=>dt7948.g(this.prototype,"smoothStreamer",[s.tracked],(function(){return new k.default((()=>this.suggestion),(e=>this.suggestion=e))})))()
#Le=(()=>{dt7948.i(this,"smoothStreamer")})()
MENU_STATES={options:"OPTIONS",loading:"LOADING",result:"RESULT"}
showFootnoteTooltip=(()=>(0,r.modifier)((e=>{if(this.supportsAddFootnote||this.streaming)return
const t=this.tooltip.register(e,{identifier:"cannot-add-footnote-tooltip",content:(0,v.i18n)("discourse_ai.ai_helper.post_options_menu.footnote_disabled"),placement:"top",triggers:"hover"})
return()=>{t.destroy()}})))()
static#Ne=(()=>dt7948.g(this.prototype,"_activeAiRequest",[s.tracked],(function(){return null})))()
#Ue=(()=>{dt7948.i(this,"_activeAiRequest")})()
constructor(){super(...arguments),(0,f.withPluginApi)((e=>{e.registerValueTransformer("post-text-selection-prevent-close",(e=>{let{value:t}=e
return this.menuState===this.MENU_STATES.result||t}))}))}get footnoteDisabled(){return this.streaming||!this.supportsAddFootnote}get helperOptions(){let e=this.currentUser?.ai_helper_prompts
e=e.filter((e=>e.location.includes("post")))
const t=e.findIndex((e=>"custom_prompt"===e.name))
if(-1!==t){const s=e.splice(t,1)[0]
e.unshift(s)}return this._showUserCustomPrompts()||(e=e.filter((e=>"custom_prompt"!==e.name))),this.args.data.canEditPost||(e=e.filter((e=>"proofread"!==e.name))),e}get highlightedTextToggleIcon(){return this.showHighlightedText?"angle-double-left":"angle-double-right"}get allowInsertFootnote(){const e=this.siteSettings,t=this.args.data.canEditPost
return!!(e?.enable_markdown_footnotes&&e?.display_footnotes_inline&&t)&&"explain"===this.lastSelectedOption?.name}_showUserCustomPrompts(){return this.currentUser?.can_use_custom_prompts}_sanitizeForFootnote(e){return e=(e=(e=e.replace(/[\r\n]+/g," ")).replace(/^(#+)\s+/gm,"")).trim(),(0,b.sanitize)(e)}subscribe(){const e=`/discourse-ai/ai-helper/stream_suggestion/${this.args.data.quoteState.postId}`
this.messageBus.subscribe(e,this._updateResult)}static#qe=(()=>dt7948.n(this.prototype,"subscribe",[_.bind]))()
unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/ai-helper/stream_suggestion/*",this._updateResult)}static#Be=(()=>dt7948.n(this.prototype,"unsubscribe",[_.bind]))()
async _updateResult(e){this.streaming=!e.done,await this.smoothStreamer.updateResult(e,"result")}static#ze=(()=>dt7948.n(this.prototype,"_updateResult",[_.bind]))()
toggleHighlightedTextPreview(){this.showHighlightedText=!this.showHighlightedText}static#He=(()=>dt7948.n(this.prototype,"toggleHighlightedTextPreview",[i.action]))()
async performAiSuggestion(e){this.menuState=this.MENU_STATES.loading,this.lastSelectedOption=e
return["explain","translate","custom_prompt"].includes(e.name)?this._handleStreamedResult(e):(this._activeAiRequest=(0,h.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:e.name,text:this.args.data.quoteState.buffer,custom_prompt:this.customPromptValue}}),this._activeAiRequest.then((t=>{let{suggestions:s}=t
if(this.suggestion=s[0].trim(),"proofread"===e.name)return this._handleProofreadOption()})).catch(g.popupAjaxError).finally((()=>{this.loading=!1,this.menuState=this.MENU_STATES.result})),this._activeAiRequest)}static#$e=(()=>dt7948.n(this.prototype,"performAiSuggestion",[i.action]))()
_handleStreamedResult(e){this.menuState=this.MENU_STATES.result
const t=this.menu.getByIdentifier("post-text-selection-toolbar")
t&&(t.options.placement="bottom")
return this._activeAiRequest=(0,h.ajax)("/discourse-ai/ai-helper/stream_suggestion",{method:"POST",data:{location:"post",mode:e.name,text:this.args.data.selectedText,post_id:this.args.data.quoteState.postId,custom_prompt:this.customPromptValue,client_id:this.messageBus.clientId}}),this._activeAiRequest}_handleProofreadOption(){return this.showAiButtons=!1,this.site.desktopView?void(this.showFastEdit=!0):this.modal.show(p.default,{model:{initialValue:this.args.data.quoteState.buffer,newValue:this.suggestion,post:this.args.data.post,close:this.closeFastEdit}})}cancelAiAction(){this._activeAiRequest&&(this._activeAiRequest.abort(),this._activeAiRequest=null,this.loading=!1,this.menuState=this.MENU_STATES.options)}static#Ve=(()=>dt7948.n(this.prototype,"cancelAiAction",[i.action]))()
copySuggestion(){this.suggestion?.length>0&&((0,y.clipboardCopy)(this.suggestion),this.copyButtonIcon="check",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copied",setTimeout((()=>{this.copyButtonIcon="copy",this.copyButtonLabel="discourse_ai.ai_helper.post_options_menu.copy"}),3500))}static#Ge=(()=>dt7948.n(this.prototype,"copySuggestion",[i.action]))()
closeMenu(){if(this.site.mobileView)return this.args.close()
const e=this.menu.getByIdentifier("post-text-selection-toolbar")
return e?.close()}static#Ye=(()=>dt7948.n(this.prototype,"closeMenu",[i.action]))()
async closeFastEdit(){this.showFastEdit=!1,await this.args.data.hideToolbar()}static#We=(()=>dt7948.n(this.prototype,"closeFastEdit",[i.action]))()
async insertFootnote(){if(this.isSavingFootnote=!0,this.allowInsertFootnote)try{const e=await(0,h.ajax)(`/posts/${this.args.data.post.id}`),t=this._sanitizeForFootnote(this.suggestion),s=(0,v.i18n)("discourse_ai.ai_helper.post_options_menu.footnote_credits"),i=`${this.args.data.selectedText} ^[${t} (${s})]`,o=e.raw.replace(this.args.data.selectedText,i)
await this.args.data.post.save({raw:o})}catch(e){(0,g.popupAjaxError)(e)}finally{this.isSavingFootnote=!1,await this.closeMenu()}}static#Ke=(()=>dt7948.n(this.prototype,"insertFootnote",[i.action]))()
static#Je=(()=>(0,T.setComponentTemplate)((0,P.createTemplateFactory)({id:"QYEKx1TA",block:'[[[1,"\\n"],[41,[28,[32,0],[[30,0,["site","mobileView"]],[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null]],null],[[[1,"      "],[10,0],[14,0,"ai-post-helper-menu__selected-text"],[12],[1,"\\n        "],[1,[30,1,["selectedText"]]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showAiButtons"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n"],[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null],[[[1,"          "],[8,[32,2],null,[["@options","@customPromptValue","@performAction","@shortcutVisible"],[[30,0,["helperOptions"]],[30,0,["customPromptValue"]],[30,0,["performAiSuggestion"]],false]],null],[1,"\\n"]],[]],[[[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","loading"]]],null],[[[1,"          "],[8,[32,3],null,[["@cancel"],[[30,0,["cancelAiAction"]]]],null],[1,"\\n"]],[]],[[[41,[28,[32,1],[[30,0,["menuState"]],[30,0,["MENU_STATES","result"]]],null],[[[1,"          "],[11,0],[24,0,"ai-post-helper__suggestion"],[4,[32,4],[[30,0,["subscribe"]]],null],[4,[32,5],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n"],[41,[30,0,["suggestion"]],[[[1,"              "],[10,0],[15,0,[28,[32,6],[[52,[30,0,["smoothStreamer","isStreaming"]],"streaming"],"streamable-content","ai-post-helper__suggestion__text"],null]],[14,"dir","auto"],[12],[1,"\\n                "],[8,[32,7],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamer","renderedText"]]]],null],[1,"\\n              "],[13],[1,"\\n              "],[10,0],[14,0,"ai-post-helper__suggestion__buttons"],[12],[1,"\\n                "],[8,[32,8],[[24,0,"btn-flat ai-post-helper__suggestion__cancel"]],[["@icon","@label","@action"],["xmark","discourse_ai.ai_helper.post_options_menu.cancel",[30,0,["cancelAiAction"]]]],null],[1,"\\n                "],[8,[32,8],[[24,0,"btn-flat ai-post-helper__suggestion__copy"]],[["@icon","@label","@action","@disabled"],[[30,0,["copyButtonIcon"]],[30,0,["copyButtonLabel"]],[30,0,["copySuggestion"]],[30,0,["streaming"]]]],null],[1,"\\n"],[41,[30,0,["allowInsertFootnote"]],[[[1,"                  "],[8,[32,8],[[24,0,"btn-flat ai-post-helper__suggestion__insert-footnote"],[4,[30,0,["showFootnoteTooltip"]],null,null]],[["@icon","@label","@action","@isLoading","@disabled"],["asterisk","discourse_ai.ai_helper.post_options_menu.insert_footnote",[30,0,["insertFootnote"]],[30,0,["isSavingFootnote"]],[30,0,["footnoteDisabled"]]]],null],[1,"\\n"]],[]],null],[1,"              "],[13],[1,"\\n"]],[]],[[[1,"              "],[8,[32,3],null,[["@cancel"],[[30,0,["cancelAiAction"]]]],null],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n        "]],[]],null]],[]]]],[]]],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showFastEdit"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper__fast-edit"],[12],[1,"\\n        "],[8,[32,9],null,[["@initialValue","@newValue","@post","@close"],[[30,1,["quoteState","buffer"]],[30,0,["suggestion"]],[30,1,["post"]],[30,0,["closeFastEdit"]]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["@data"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu.js",scope:()=>[l.and,w.default,x.default,S.default,o.default,n.default,m.default,d.default,u.default,c.default],isStrictMode:!0}),this))()}e.default=C})),define("discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","discourse-i18n","select-kit/components/combo-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=[{id:"3600",seconds:3600,nameKey:"discourse_ai.llms.quotas.durations.hour"},{id:"21600",seconds:21600,nameKey:"discourse_ai.llms.quotas.durations.six_hours"},{id:"86400",seconds:86400,nameKey:"discourse_ai.llms.quotas.durations.day"},{id:"604800",seconds:604800,nameKey:"discourse_ai.llms.quotas.durations.week"},{id:"custom",nameKey:"discourse_ai.llms.quotas.durations.custom"}]
class u extends t.default{static#e=(()=>dt7948.g(this.prototype,"selectedPresetId",[s.tracked],(function(){return"86400"})))()
#Qe=(()=>{dt7948.i(this,"selectedPresetId")})()
static#s=(()=>dt7948.g(this.prototype,"customHours",[s.tracked],(function(){return null})))()
#Ze=(()=>{dt7948.i(this,"customHours")})()
constructor(){super(...arguments)
const e=this.args.value,t=d.find((t=>t.seconds===e))
t?this.selectedPresetId=t.id:(this.selectedPresetId="custom",this.customHours=Math.round(e/3600))}get presetOptions(){return d.map((e=>({id:e.id,name:(0,n.i18n)(e.nameKey),seconds:e.seconds})))}get isCustom(){return"custom"===this.selectedPresetId}get currentDurationSeconds(){return this.isCustom?this.customHours?3600*this.customHours:0:parseInt(this.selectedPresetId,10)}onPresetChange(e){this.selectedPresetId=e,this.updateValue()}static#o=(()=>dt7948.n(this.prototype,"onPresetChange",[o.action]))()
onCustomHoursChange(e){this.customHours=parseInt(e.target.value,10),this.updateValue()}static#a=(()=>dt7948.n(this.prototype,"onCustomHoursChange",[o.action]))()
updateValue(){this.args.onChange&&this.args.onChange(this.currentDurationSeconds)}static#l=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"qzu/tJzR",block:'[[[1,"\\n    "],[10,0],[14,0,"duration-selector"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"duration-selector__preset"]],[["@content","@value","@onChange"],[[30,0,["presetOptions"]],[30,0,["selectedPresetId"]],[30,0,["onPresetChange"]]]],null],[1,"\\n\\n"],[41,[30,0,["isCustom"]],[[[1,"        "],[10,0],[14,0,"duration-selector__custom"],[12],[1,"\\n          "],[11,"input"],[16,2,[30,0,["customHours"]]],[24,0,"duration-selector__hours-input"],[24,"min","1"],[24,4,"number"],[4,[32,1],["input",[30,0,["onCustomHoursChange"]]],null],[12],[13],[1,"\\n          "],[10,1],[14,0,"duration-selector__hours-label"],[12],[1,"\\n            "],[1,[28,[32,2],["discourse_ai.llms.quotas.hours"],null]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector.js",scope:()=>[a.default,i.on,n.i18n],isStrictMode:!0}),this))()}e.default=u})),define("discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip",["exports","@glimmer/component","@ember/service","discourse/components/d-button","discourse/helpers/d-icon","discourse-i18n","float-kit/components/d-tooltip","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static#e=(()=>dt7948.g(this.prototype,"discobotDiscoveries",[s.service]))()
#Xe=(()=>{dt7948.i(this,"discobotDiscoveries")})()
static#s=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"0UF2Kv3u",block:'[[[1,"\\n    "],[10,1],[14,0,"ai-search-discoveries-tooltip"],[12],[1,"\\n      "],[8,[32,0],null,[["@placement","@interactive"],["top-end",true]],[["trigger","content"],[[[[1,"\\n          "],[1,[28,[32,1],["circle-info"],null]],[1,"\\n        "]],[]],[[[1,"\\n          "],[10,0],[14,0,"ai-search-discoveries-tooltip__content"],[12],[1,"\\n            "],[10,0],[14,0,"ai-search-discoveries-tooltip__header"],[12],[1,"\\n              "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.tooltip.header"],null]],[1,"\\n            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"ai-search-discoveries-tooltip__description"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","modelUsed"]],[[[1,"                "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.tooltip.content"],[["model"],[[30,0,["discobotDiscoveries","modelUsed"]]]]]],[1,"\\n"]],[]],null],[1,"            "],[13],[1,"\\n\\n            "],[10,0],[14,0,"ai-search-discoveries-tooltip__actions"],[12],[1,"\\n              "],[8,[32,3],[[24,0,"btn-transparent btn-primary"]],[["@label","@href"],["discourse_ai.discobot_discoveries.tooltip.actions.info","https://meta.discourse.org/t/conversational-ai-search-coming-to-discourse-ai/355939"]],null],[1,"\\n              "],[8,[32,3],[[24,0,"btn-transparent btn-danger"]],[["@label","@action"],["discourse_ai.discobot_discoveries.tooltip.actions.disable",[30,0,["discobotDiscoveries","disableDiscoveries"]]]],null],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip.js",scope:()=>[a.default,o.default,n.i18n,i.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/runloop","@ember/service","discourse/components/cook-text","discourse/components/d-button","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/plugin-api","discourse/lib/url","discourse/models/topic","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static#e=(()=>dt7948.g(this.prototype,"search",[l.service]))()
#et=(()=>{dt7948.i(this,"search")})()
static#s=(()=>dt7948.g(this.prototype,"messageBus",[l.service]))()
#xe=(()=>{dt7948.i(this,"messageBus")})()
static#o=(()=>dt7948.g(this.prototype,"discobotDiscoveries",[l.service]))()
#Xe=(()=>{dt7948.i(this,"discobotDiscoveries")})()
static#a=(()=>dt7948.g(this.prototype,"appEvents",[l.service]))()
#H=(()=>{dt7948.i(this,"appEvents")})()
static#l=(()=>dt7948.g(this.prototype,"currentUser",[l.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#u=(()=>dt7948.g(this.prototype,"siteSettings",[l.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#p=(()=>dt7948.g(this.prototype,"composer",[l.service]))()
#$=(()=>{dt7948.i(this,"composer")})()
static#h=(()=>dt7948.g(this.prototype,"loadingConversationTopic",[s.tracked],(function(){return!1})))()
#tt=(()=>{dt7948.i(this,"loadingConversationTopic")})()
static#_=(()=>dt7948.g(this.prototype,"hideDiscoveries",[s.tracked],(function(){return!1})))()
#st=(()=>{dt7948.i(this,"hideDiscoveries")})()
static#f=(()=>dt7948.g(this.prototype,"fullDiscoveryToggled",[s.tracked],(function(){return!1})))()
#it=(()=>{dt7948.i(this,"fullDiscoveryToggled")})()
static#b=(()=>dt7948.g(this.prototype,"discoveryPreviewLength",[s.tracked],(function(){return this.args.discoveryPreviewLength||150})))()
#ot=(()=>{dt7948.i(this,"discoveryPreviewLength")})()
static#y=(()=>dt7948.g(this.prototype,"smoothStreamer",[s.tracked],(function(){return new y.default((()=>this.discobotDiscoveries.discovery),(e=>this.discobotDiscoveries.discovery=e))})))()
#Le=(()=>{dt7948.i(this,"smoothStreamer")})()
discoveryTimeout=null
constructor(){super(...arguments),this.appEvents.on("full-page-search:trigger-search",this,this.triggerDiscovery)}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("full-page-search:trigger-search",this,this.triggerDiscovery)}detectSearch(){0===this.query?.length&&this.discobotDiscoveries.discovery?.length>0&&(this.discobotDiscoveries.resetDiscovery(),this.smoothStreamer.resetStreaming()),(0,g.withPluginApi)((e=>{e.addSearchMenuOnKeyDownCallback(((e,t)=>{if(e)return this.discobotDiscoveries.lastQuery===this.query||"Enter"===t.key&&this.query&&this.triggerDiscovery(),!0}))}))}static#v=(()=>dt7948.n(this.prototype,"detectSearch",[h.bind]))()
async _updateDiscovery(e){this.query===e.query&&(this.discoveryTimeout&&(0,r.cancel)(this.discoveryTimeout),this.discobotDiscoveries.discovery||(this.discobotDiscoveries.discovery=""),this.discobotDiscoveries.modelUsed=e.model_used,this.discobotDiscoveries.loadingDiscoveries=!1,this.smoothStreamer.updateResult(e,"ai_discover_reply"))}static#w=(()=>dt7948.n(this.prototype,"_updateDiscovery",[h.bind]))()
unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/ai-bot/discover",this._updateDiscovery)}static#L=(()=>dt7948.n(this.prototype,"unsubscribe",[h.bind]))()
subscribe(){this.messageBus.subscribe("/discourse-ai/ai-bot/discover",this._updateDiscovery)}static#N=(()=>dt7948.n(this.prototype,"subscribe",[h.bind]))()
get query(){return this.args?.searchTerm||this.search.activeGlobalSearchTerm}get toggleLabel(){return this.fullDiscoveryToggled?"discourse_ai.discobot_discoveries.collapse":"discourse_ai.discobot_discoveries.tell_me_more"}get toggleIcon(){return this.fullDiscoveryToggled?"chevron-up":""}get canShowExpandtoggle(){return!this.discobotDiscoveries.loadingDiscoveries&&this.smoothStreamer.renderedText.length>this.discoveryPreviewLength}get renderPreviewOnly(){return!this.fullDiscoveryToggled&&this.canShowExpandtoggle}get canContinueConversation(){const e=this.currentUser?.ai_enabled_personas
if(!e)return!1
if(this.discobotDiscoveries.discoveryTimedOut)return!1
const t=e.find((e=>e.id===parseInt(this.siteSettings?.ai_bot_discover_persona,10))),s=t?.username
return this.discobotDiscoveries.discovery?.length>0&&!this.smoothStreamer.isStreaming&&s}get continueConvoBtnLabel(){return this.loadingConversationTopic?"discourse_ai.discobot_discoveries.loading_convo":"discourse_ai.discobot_discoveries.continue_convo"}async triggerDiscovery(){if(0===this.query?.length)return this.discobotDiscoveries.resetDiscovery(),void this.smoothStreamer.resetStreaming()
if(this.discobotDiscoveries.lastQuery!==this.query){this.smoothStreamer.resetStreaming(),this.discobotDiscoveries.resetDiscovery(),this.hideDiscoveries=!1,this.discobotDiscoveries.loadingDiscoveries=!0,this.discoveryTimeout=(0,r.later)(this,this.timeoutDiscovery,1e4)
try{this.discobotDiscoveries.lastQuery=this.query,await(0,p.ajax)("/discourse-ai/ai-bot/discover",{data:{query:this.query}})}catch{this.hideDiscoveries=!0}}else this.hideDiscoveries=!1}static#U=(()=>dt7948.n(this.prototype,"triggerDiscovery",[i.action]))()
toggleDiscovery(){this.fullDiscoveryToggled=!this.fullDiscoveryToggled}static#q=(()=>dt7948.n(this.prototype,"toggleDiscovery",[i.action]))()
async continueConversation(){const e={user_id:this.currentUser.id,query:this.query,context:this.discobotDiscoveries.discovery}
try{this.loadingConversationTopic=!0
const t=await(0,p.ajax)("/discourse-ai/ai-bot/discover/continue-convo",{type:"POST",data:e}),s=await f.default.find(t.topic_id,{}),i=f.default.create(s)
_.default.routeTo(`/t/${t.topic_id}`,{afterRouteComplete:()=>{this.args.closeSearchMenu&&this.args.closeSearchMenu(),this.composer.focusComposer({topic:i})}})}catch(t){(0,m.popupAjaxError)(t)}finally{this.loadingConversationTopic=!1}}static#B=(()=>dt7948.n(this.prototype,"continueConversation",[i.action]))()
timeoutDiscovery(){this.discobotDiscoveries.discovery?.length>0||(this.discobotDiscoveries.loadingDiscoveries=!1,this.discobotDiscoveries.discovery="",this.discobotDiscoveries.discoveryTimedOut=!0)}static#z=(()=>(0,S.setComponentTemplate)((0,x.createTemplateFactory)({id:"beVZ2Biz",block:'[[[1,"\\n    "],[11,0],[24,0,"ai-search-discoveries"],[4,[32,0],[[30,0,["subscribe"]],[30,0,["query"]]],null],[4,[32,1],[[30,0,["subscribe"]],[30,0,["query"]]],null],[4,[32,1],[[30,0,["detectSearch"]],[30,0,["query"]]],null],[4,[32,0],[[30,0,["triggerDiscovery"]],[30,0,["query"]]],null],[4,[32,2],[[30,0,["unsubscribe"]]],null],[12],[1,"\\n      "],[10,0],[14,0,"ai-search-discoveries__completion"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","loadingDiscoveries"]],[[[1,"          "],[8,[32,3],null,null,null],[1,"\\n"]],[]],[[[41,[30,0,["discobotDiscoveries","discoveryTimedOut"]],[[[1,"          "],[1,[28,[32,4],["discourse_ai.discobot_discoveries.timed_out"],null]],[1,"\\n"]],[]],[[[1,"          "],[10,"article"],[15,0,[28,[32,5],["ai-search-discoveries__discovery",[52,[30,0,["renderPreviewOnly"]],"preview"],[52,[30,0,["smoothStreamer","isStreaming"]],"streaming"],"streamable-content"],null]],[12],[1,"\\n            "],[8,[32,6],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamer","renderedText"]]]],null],[1,"\\n          "],[13],[1,"\\n\\n"],[41,[30,0,["canShowExpandtoggle"]],[[[1,"            "],[8,[32,7],[[24,0,"btn-flat btn-text ai-search-discoveries__toggle"]],[["@label","@icon","@action"],[[30,0,["toggleLabel"]],[30,0,["toggleIcon"]],[30,0,["toggleDiscovery"]]]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]],[]]],[1,"      "],[13],[1,"\\n\\n"],[41,[30,0,["canContinueConversation"]],[[[1,"        "],[10,0],[14,0,"ai-search-discoveries__continue-conversation"],[12],[1,"\\n          "],[8,[32,7],[[24,0,"btn-small"]],[["@action","@label"],[[30,0,["continueConversation"]],[30,0,["continueConvoBtnLabel"]]]],[["default"],[[[[1,"\\n            "],[8,[32,8],null,[["@loading"],[[30,0,["loadingConversationTopic"]]]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries.js",scope:()=>[o.default,n.default,a.default,v.default,b.i18n,c.default,d.default,u.default,w.default],isStrictMode:!0}),this))()}e.default=k})),define("discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar",["exports","@ember/helper","@ember/template","truth-helpers","discourse-i18n","float-kit/components/d-tooltip","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"RxLInASj",block:'[[[1,"\\n"],[41,[28,[32,0],[[30,1],0],null],[[[1,"    "],[8,[32,1],[[16,0,[28,[32,2],["sentiment-horizontal-bar__",[30,2]],null]],[16,5,[28,[32,3],[[28,[32,2],["width: ",[30,3],"%"],null]],null]]],null,[["trigger","content"],[[[[1,"\\n        "],[10,1],[14,0,"sentiment-horizontal-bar__count"],[12],[1,"\\n          "],[1,[30,1]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[1,[28,[32,4],[[28,[32,2],["discourse_ai.sentiments.sentiment_analysis.filter_types.",[30,2]],null]],null]],[1,":\\n        "],[1,[30,1]],[1,"\\n      "]],[]]]]],[1,"\\n"]],[]],null]],["@score","@type","@width"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-sentiment-horizontal-bar.js",scope:()=>[i.gt,n.default,t.concat,s.htmlSafe,o.i18n],isStrictMode:!0}),(0,l.default)(void 0,"ai-sentiment-horizontal-bar:AiSentimentHorizontalBar"))
e.default=d})),define("discourse/plugins/discourse-ai/discourse/components/ai-spam",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/routing","@ember/service","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-stat-tiles","discourse/components/d-toggle-switch","discourse/components/d-tooltip","discourse/helpers/d-icon","discourse/helpers/with-event-value","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse-i18n","admin/components/admin-config-area-card","select-kit/components/combo-box","discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class k extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[r.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#s=(()=>dt7948.g(this.prototype,"toasts",[r.service]))()
#Z=(()=>{dt7948.i(this,"toasts")})()
static#o=(()=>dt7948.g(this.prototype,"modal",[r.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
static#a=(()=>dt7948.g(this.prototype,"stats",[s.tracked],(function(){return{scanned_count:0,spam_detected:0,false_positives:0,false_negatives:0,daily_data:[]}})))()
#nt=(()=>{dt7948.i(this,"stats")})()
static#l=(()=>dt7948.g(this.prototype,"isEnabled",[s.tracked],(function(){return!1})))()
#at=(()=>{dt7948.i(this,"isEnabled")})()
static#u=(()=>dt7948.g(this.prototype,"selectedLLM",[s.tracked],(function(){return null})))()
#rt=(()=>{dt7948.i(this,"selectedLLM")})()
static#p=(()=>dt7948.g(this.prototype,"customInstructions",[s.tracked],(function(){return""})))()
#lt=(()=>{dt7948.i(this,"customInstructions")})()
static#h=(()=>dt7948.g(this.prototype,"errors",[s.tracked],(function(){return[]})))()
#dt=(()=>{dt7948.i(this,"errors")})()
constructor(){super(...arguments),this.initializeFromModel(),!1===this.args.model?.spam_scanning_user?.admin&&this.errors.push({message:(0,b.i18n)("discourse_ai.spam.errors.scan_not_admin.message"),button:{label:(0,b.i18n)("discourse_ai.spam.errors.scan_not_admin.action"),action:this.fixScanUserNotAdmin}})}async fixScanUserNotAdmin(){const e=this.args.model.spam_scanning_user
if(e&&!e.admin)try{(await(0,g.ajax)("/admin/plugins/discourse-ai/ai-spam/fix-errors",{type:"POST",data:{error:"spam_scanner_not_admin"}})).success&&this.toasts.success({data:{message:(0,b.i18n)("discourse_ai.spam.errors.resolved")},duration:2e3})}catch(t){(0,_.popupAjaxError)(t)}finally{window.location.reload()}}static#_=(()=>dt7948.n(this.prototype,"fixScanUserNotAdmin",[n.action]))()
initializeFromModel(){const e=this.args.model
this.isEnabled=e.is_enabled,e.llm_id?this.selectedLLM="custom:"+e.llm_id:this.availableLLMs.length&&(this.selectedLLM=this.availableLLMs[0].id,this.autoSelectedLLM=!0),this.customInstructions=e.custom_instructions,this.stats=e.stats}static#f=(()=>dt7948.n(this.prototype,"initializeFromModel",[n.action]))()
get availableLLMs(){return this.args.model?.available_llms||[]}async toggleEnabled(){this.isEnabled=!this.isEnabled
const e={is_enabled:this.isEnabled}
this.autoSelectedLLM&&(e.llm_model_id=this.llmId)
try{const t=await(0,g.ajax)("/admin/plugins/discourse-ai/ai-spam.json",{type:"PUT",data:e})
this.autoSelectedLLM=!1,this.isEnabled=t.is_enabled}catch(t){this.isEnabled=!this.isEnabled,(0,_.popupAjaxError)(t)}}static#b=(()=>dt7948.n(this.prototype,"toggleEnabled",[n.action]))()
get llmId(){return this.selectedLLM.toString().split(":")[1]}async updateLLM(e){this.selectedLLM=e}static#y=(()=>dt7948.n(this.prototype,"updateLLM",[n.action]))()
async save(){try{await(0,g.ajax)("/admin/plugins/discourse-ai/ai-spam.json",{type:"PUT",data:{llm_model_id:this.llmId,custom_instructions:this.customInstructions}}),this.toasts.success({data:{message:(0,b.i18n)("discourse_ai.spam.settings_saved")},duration:2e3})}catch(e){(0,_.popupAjaxError)(e)}}static#v=(()=>dt7948.n(this.prototype,"save",[n.action]))()
showTestModal(){this.modal.show(w.default,{model:{customInstructions:this.customInstructions,llmId:this.llmId}})}static#w=(()=>dt7948.n(this.prototype,"showTestModal",[n.action]))()
get metrics(){const e={label:(0,b.i18n)("discourse_ai.spam.spam_detected"),value:this.stats.spam_detected},t={label:(0,b.i18n)("discourse_ai.spam.false_positives"),value:this.stats.false_positives,tooltip:(0,b.i18n)("discourse_ai.spam.stat_tooltips.incorrectly_flagged")},s={label:(0,b.i18n)("discourse_ai.spam.false_negatives"),value:this.stats.false_negatives,tooltip:(0,b.i18n)("discourse_ai.spam.stat_tooltips.missed_spam")}
return this.args.model.flagging_username&&(e.href=(0,f.default)(`/review?flagged_by=${this.args.model.flagging_username}&status=all&sort_order=created_at`),t.href=(0,f.default)(`/review?flagged_by=${this.args.model.flagging_username}&status=rejected&sort_order=created_at`),s.href=(0,f.default)(`/review?status=approved&sort_order=created_at&additional_filters={"ai_spam_false_negative":true}&order=created&score_type=${this.args.model.spam_score_type}`)),[{label:(0,b.i18n)("discourse_ai.spam.scanned_count"),value:this.stats.scanned_count},e,t,s]}static#L=(()=>(0,S.setComponentTemplate)((0,x.createTemplateFactory)({id:"h6+24r0F",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-spam"],[12],[1,"\\n      "],[10,"section"],[14,0,"ai-spam__settings"],[12],[1,"\\n        "],[10,0],[14,0,"ai-spam__errors"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["errors"]]],null]],null],null,[[[1,"            "],[10,0],[14,0,"alert alert-error"],[12],[1,"\\n              "],[1,[28,[32,0],["triangle-exclamation"],null]],[1,"\\n              "],[10,2],[12],[1,[30,1,["message"]]],[13],[1,"\\n              "],[8,[32,1],null,[["@action","@translatedLabel"],[[30,1,["button","action"]],[30,1,["button","label"]]]],null],[1,"\\n            "],[13],[1,"\\n"]],[1]],null],[1,"        "],[13],[1,"\\n        "],[8,[32,2],null,[["@titleLabel","@descriptionLabel"],[[28,[32,3],["discourse_ai.spam.title"],null],[28,[32,3],["discourse_ai.spam.spam_description"],null]]],null],[1,"\\n        "],[10,0],[14,0,"control-group ai-spam__enabled"],[12],[1,"\\n          "],[8,[32,4],[[24,0,"ai-spam__toggle"],[4,[32,5],["click",[30,0,["toggleEnabled"]]],null]],[["@state","@label"],[[30,0,["isEnabled"]],"discourse_ai.spam.enable"]],null],[1,"\\n          "],[8,[32,6],null,[["@icon","@content"],["circle-question",[28,[32,3],["discourse_ai.spam.spam_tip"],null]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-spam__llm"],[12],[1,"\\n          "],[10,"label"],[14,0,"ai-spam__llm-label"],[12],[1,[28,[32,3],["discourse_ai.spam.select_llm"],null]],[13],[1,"\\n"],[41,[30,0,["availableLLMs","length"]],[[[1,"            "],[8,[32,7],[[24,0,"ai-spam__llm-selector"]],[["@value","@content","@onChange"],[[30,0,["selectedLLM"]],[30,0,["availableLLMs"]],[30,0,["updateLLM"]]]],null],[1,"\\n"]],[]],[[[1,"            "],[10,1],[14,0,"ai-spam__llm-placeholder"],[12],[1,"\\n              "],[8,[32,8],null,[["@route"],["adminPlugins.show.discourse-ai-llms.index"]],[["default"],[[[[1,"\\n                "],[1,[28,[32,3],["discourse_ai.spam.no_llms"],null]],[1,"\\n              "]],[]]]]],[1,"\\n            "],[13],[1,"\\n"]],[]]],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-spam__instructions"],[12],[1,"\\n          "],[10,"label"],[14,0,"ai-spam__instructions-label"],[12],[1,"\\n            "],[1,[28,[32,3],["discourse_ai.spam.custom_instructions"],null]],[1,"\\n            "],[8,[32,6],null,[["@icon","@content"],["circle-question",[28,[32,3],["discourse_ai.spam.custom_instructions_help"],null]]],null],[1,"\\n          "],[13],[1,"\\n          "],[11,"textarea"],[24,0,"ai-spam__instructions-input"],[16,"placeholder",[28,[32,3],["discourse_ai.spam.custom_instructions_placeholder"],null]],[4,[32,5],["input",[28,[32,9],[[28,[32,10],[[28,[31,3],[[30,0,["customInstructions"]]],null]],null]],null]],null],[12],[1,[30,0,["customInstructions"]]],[13],[1,"\\n          "],[8,[32,1],[[24,0,"ai-spam__instructions-save btn-primary"]],[["@action","@label"],[[30,0,["save"]],"discourse_ai.spam.save_button"]],null],[1,"\\n          "],[8,[32,1],[[24,0,"btn-default"]],[["@action","@label"],[[30,0,["showTestModal"]],"discourse_ai.spam.test_button"]],null],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[8,[32,11],[[24,0,"ai-spam__stats"]],[["@heading"],["discourse_ai.spam.last_seven_days"]],[["content"],[[[[1,"\\n          "],[8,[32,12],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["metrics"]]],null]],null],null,[[[1,"              "],[8,[30,2,["Tile"]],null,[["@label","@url","@value","@tooltip"],[[30,3,["label"]],[30,3,["href"]],[30,3,["value"]],[30,3,["tooltip"]]]],null],[1,"\\n"]],[3]],null],[1,"          "]],[2]]]]],[1,"\\n        "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],["e","tiles","metric"],false,["each","-track-array","if","mut"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-spam.js",scope:()=>[m.default,l.default,d.default,b.i18n,c.default,o.on,p.default,v.default,a.LinkTo,h.default,i.fn,y.default,u.default],isStrictMode:!0}),this))()}e.default=k})),define("discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","float-kit/components/d-menu","truth-helpers/helpers/eq","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"site",[a.service]))()
#F=(()=>{dt7948.i(this,"site")})()
static#s=(()=>dt7948.g(this.prototype,"menu",[a.service]))()
#ke=(()=>{dt7948.i(this,"menu")})()
static#o=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return[]})))()
#ut=(()=>{dt7948.i(this,"suggestions")})()
static#a=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#l=(()=>dt7948.g(this.prototype,"icon",[s.tracked],(function(){return"discourse-sparkles"})))()
#ct=(()=>{dt7948.i(this,"icon")})()
SUGGESTION_TYPES={title:"suggest_title",category:"suggest_category",tag:"suggest_tags"}
get input(){return this.args.selectedPosts.map((e=>e.cooked)).join("\n")}get disabled(){return this.loading||this.suggestions.length>0}loadSuggestions(){this.loading||this.suggestions.length>0||(this.loading=!0,(0,d.ajax)(`/discourse-ai/ai-helper/${this.args.mode}`,{method:"POST",data:{text:this.input}}).then((e=>{if(this.args.mode===this.SUGGESTION_TYPES.title)this.suggestions=e.suggestions
else if(this.args.mode===this.SUGGESTION_TYPES.category){const t=e.assistant.map((e=>e.id)),s=this.site.categories.filter((e=>t.includes(e.id)))
this.suggestions=s}else this.args.mode===this.SUGGESTION_TYPES.tag&&(this.suggestions=e.assistant.map((e=>({name:e.name,count:e.count}))))})).catch(u.popupAjaxError).finally((()=>{this.loading=!1})))}static#u=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
applySuggestion(e,t){if(this.args.mode){if(this.args.mode===this.SUGGESTION_TYPES.title)return this.args.updateAction(e),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.category)return this.args.updateAction(e.id),t.close()
if(this.args.mode===this.SUGGESTION_TYPES.tag){if(this.args.currentValue)if(Array.isArray(this.args.currentValue)){const t=[...this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else{const t=[this.args.currentValue,e]
this.args.updateAction([...new Set(t)])}else Array.isArray(e)?this.args.updateAction([...e]):this.args.updateAction([e])
return t.close()}}}static#p=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
static#h=(()=>(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"4ZszHd3J",block:'[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"      "],[8,[32,0],[[24,0,"ai-split-topic-loading-placeholder"]],[["@disabled","@icon"],[true,"spinner"]],null],[1,"\\n"]],[]],null],[1,"    "],[8,[32,1],[[24,0,"ai-split-topic-suggestion-button"],[16,"data-suggestion-mode",[30,1]],[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@icon","@interactive","@identifier"],["discourse-sparkles",true,"ai-split-topic-suggestion-menu"]],[["default"],[[[[1,"\\n      "],[10,"ul"],[14,0,"ai-split-topic-suggestion__results"],[12],[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[41,[28,[32,3],[[30,1],"suggest_category"],null],[[[1,"              "],[11,"li"],[16,"data-name",[30,3,["name"]]],[16,"data-value",[30,3,["id"]]],[24,0,"ai-split-topic-suggestion__category-result"],[24,"role","button"],[4,[32,2],["click",[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]],null],[12],[1,"\\n                "],[1,[28,[32,5],[[30,3]],null]],[1,"\\n                "],[10,1],[14,0,"topic-count"],[12],[1,"x\\n                  "],[1,[30,3,["totalTopicCount"]]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[41,[28,[32,3],[[30,1],"suggest_tags"],null],[[[1,"              "],[10,"li"],[15,"data-name",[30,3,["name"]]],[15,"data-value",[30,4]],[12],[1,"\\n                "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3,["name"]],[28,[32,4],[[30,0,["applySuggestion"]],[30,3,["name"]],[30,2]],null]]],[["default"],[[[[1,"\\n                  "],[10,1],[14,0,"topic-count"],[12],[1,"x"],[1,[30,3,["count"]]],[13],[1,"\\n                "]],[]]]]],[1,"\\n              "],[13],[1,"\\n"]],[]],[[[1,"              "],[10,"li"],[15,"data-name",[30,3]],[15,"data-value",[30,4]],[12],[1,"\\n                "],[8,[32,0],null,[["@translatedLabel","@action"],[[30,3],[28,[32,4],[[30,0,["applySuggestion"]],[30,3],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "]],[]]]],[]]]],[3,4]],null]],[]],null],[1,"      "],[13],[1,"\\n    "]],[2]]]]],[1,"\\n  "]],["@mode","menu","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester.js",scope:()=>[r.default,c.default,o.on,p.default,i.fn,l.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton",["exports","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-blinking-animation","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const r=(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"ndQrZh9f",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-summary__container"],[12],[1,"\\n    "],[8,[32,0],null,null,null],[1,"\\n\\n    "],[10,1],[12],[1,"\\n      "],[10,0],[14,0,"ai-summary__generating-text"],[12],[1,"\\n        "],[1,[28,[32,1],["summary.in_progress"],null]],[1,"\\n      "],[13],[1,"\\n      "],[8,[32,2],null,[["@loading"],[true]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton.js",scope:()=>[s.default,t.i18n,i.default],isStrictMode:!0}),(0,a.default)(void 0,"ai-summary-skeleton:AiSummarySkeleton"))
e.default=r})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","truth-helpers","discourse/components/form","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal","discourse/plugins/discourse-ai/discourse/components/rag-options-fk","discourse/plugins/discourse-ai/discourse/components/rag-uploader","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"modal",[n.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
static#s=(()=>dt7948.g(this.prototype,"siteSettings",[n.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#o=(()=>dt7948.g(this.prototype,"dialog",[n.service]))()
#X=(()=>{dt7948.i(this,"dialog")})()
static#a=(()=>dt7948.g(this.prototype,"router",[n.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#l=(()=>dt7948.g(this.prototype,"toasts",[n.service]))()
#Z=(()=>{dt7948.i(this,"toasts")})()
static#u=(()=>dt7948.g(this.prototype,"uploadedFiles",[s.tracked],(function(){return[]})))()
#pt=(()=>{dt7948.i(this,"uploadedFiles")})()
static#p=(()=>dt7948.g(this.prototype,"isSaving",[s.tracked],(function(){return!1})))()
#te=(()=>{dt7948.i(this,"isSaving")})()
PARAMETER_TYPES=[{name:"string",id:"string"},{name:"number",id:"number"},{name:"boolean",id:"boolean"},{name:"array",id:"array"}]
get formData(){const e=(this.args.editingModel.parameters??[]).map((e=>{const t={...e}
return t.isEnum=e.enum&&e.enum.length>0,t.isEnum||delete t.enum,t}))
return{name:this.args.editingModel.name||"",tool_name:this.args.editingModel.tool_name||"",description:this.args.editingModel.description||"",summary:this.args.editingModel.summary||"",parameters:e,script:this.args.editingModel.script||"",rag_uploads:this.args.editingModel.rag_uploads||[]}}toggleIsEnum(e,t){let{name:s,parentName:i,set:o}=t
o(`${i}.enum`,e?[""]:[]),o(s,e)}static#h=(()=>dt7948.n(this.prototype,"toggleIsEnum",[o.action]))()
async save(e){this.isSaving=!0
const t=JSON.parse(JSON.stringify(e))
t.parameters&&t.parameters.forEach((e=>{e.isEnum||delete e.enum,delete e.isEnum}))
try{await this.args.model.save(t),this.toasts.success({data:{message:(0,d.i18n)("discourse_ai.tools.saved")},duration:2e3}),this.args.tools.any((e=>e.id===this.args.model.id))||this.args.tools.pushObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-tools.edit",this.args.model)}catch(s){(0,l.popupAjaxError)(s)}finally{this.isSaving=!1}}static#_=(()=>dt7948.n(this.prototype,"save",[o.action]))()
delete(){return this.dialog.confirm({message:(0,d.i18n)("discourse_ai.tools.confirm_delete"),didConfirm:async()=>{await this.args.model.destroyRecord(),this.args.tools.removeObject(this.args.model),this.router.transitionTo("adminPlugins.show.discourse-ai-tools.index")}})}static#f=(()=>dt7948.n(this.prototype,"delete",[o.action]))()
updateUploads(e,t){const s=t.filter((e=>!this.uploadedFiles.some((t=>t.id===e.id))))
e("rag_uploads",s),this.uploadedFiles=[...this.uploadedFiles,...s]}static#b=(()=>dt7948.n(this.prototype,"updateUploads",[o.action]))()
removeUpload(e,t){this.uploadedFiles=this.uploadedFiles.filter((e=>e.id!==t.id)),e.set("rag_uploads",this.uploadedFiles)}static#y=(()=>dt7948.n(this.prototype,"removeUpload",[o.action]))()
openTestModal(){this.modal.show(u.default,{model:{tool:this.args.editingModel}})}static#v=(()=>dt7948.n(this.prototype,"openTestModal",[o.action]))()
currentParameterSelection(e,t){return e.parameters[t].type}get ragUploadsDescription(){return this.siteSettings.rag_images_enabled?(0,d.i18n)("discourse_ai.rag.uploads.description_with_images"):(0,d.i18n)("discourse_ai.rag.uploads.description")}static#w=(()=>(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"gZLnbYqP",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-tool-editor"]],[["@onSubmit","@data"],[[30,0,["save"]],[30,0,["formData"]]]],[["default"],[[[[1,"\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["name",[28,[32,1],["discourse_ai.tools.name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.tools.name_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,3,["Input"]],[[24,0,"ai-tool-editor__name"]],null,null],[1,"\\n      "]],[3]]]]],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["tool_name",[28,[32,1],["discourse_ai.tools.tool_name"],null],"required|length:1,100","large",[28,[32,1],["discourse_ai.tools.tool_name_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,4,["Input"]],[[24,0,"ai-tool-editor__tool_name"]],null,null],[1,"\\n      "]],[4]]]]],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["description",[28,[32,1],["discourse_ai.tools.description"],null],"required|length:1,1000","full",[28,[32,1],["discourse_ai.tools.description_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,5,["Textarea"]],[[24,0,"ai-tool-editor__description"],[16,"placeholder",[28,[32,1],["discourse_ai.tools.description_help"],null]]],[["@height"],[60]],null],[1,"\\n      "]],[5]]]]],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format","@tooltip"],["summary",[28,[32,1],["discourse_ai.tools.summary"],null],"required|length:1,255","large",[28,[32,1],["discourse_ai.tools.summary_help"],null]]],[["default"],[[[[1,"\\n        "],[8,[30,6,["Input"]],[[24,0,"ai-tool-editor__summary"]],null,null],[1,"\\n      "]],[6]]]]],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Collection"]],null,[["@name"],["parameters"]],[["default"],[[[[1,"\\n        "],[8,[30,1,["Container"]],[[24,0,"ai-tool-parameter"]],null,[["default"],[[[[1,"\\n          "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n            "],[8,[30,10,["Col"]],null,[["@size"],[6]],[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["name",[28,[32,1],["discourse_ai.tools.parameter_name"],null],"required|length:1,100","full"]],[["default"],[[[[1,"\\n                "],[8,[30,11,["Input"]],null,null,null],[1,"\\n              "]],[11]]]]],[1,"\\n            "]],[]]]]],[1,"\\n\\n            "],[8,[30,10,["Col"]],null,[["@size"],[6]],[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["type",[28,[32,1],["discourse_ai.tools.parameter_type"],null],"required","full"]],[["default"],[[[[1,"\\n                "],[8,[30,12,["Select"]],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["PARAMETER_TYPES"]]],null]],null],null,[[[1,"                    "],[8,[30,13,["Option"]],null,[["@value"],[[30,14,["id"]]]],[["default"],[[[[1,[30,14,["name"]]]],[]]]]],[1,"\\n"]],[14]],null],[1,"                "]],[13]]]]],[1,"\\n              "]],[12]]]]],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[10]]]]],[1,"\\n\\n          "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n            "],[8,[30,15,["Col"]],null,[["@size"],[12]],[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title","@validation","@format"],["description",[28,[32,1],["discourse_ai.tools.parameter_description"],null],"required|length:1,1000","full"]],[["default"],[[[[1,"\\n                "],[8,[30,16,["Input"]],[[24,0,"ai-tool-editor__parameter-description"]],null,null],[1,"\\n              "]],[16]]]]],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[15]]]]],[1,"\\n\\n          "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n            "],[8,[30,17,["Col"]],null,null,[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title"],["required","Required"]],[["default"],[[[[1,"\\n                "],[8,[30,18,["Checkbox"]],null,null,null],[1,"\\n              "]],[18]]]]],[1,"\\n            "]],[]]]]],[1,"\\n\\n            "],[8,[30,17,["Col"]],null,null,[["default"],[[[[1,"\\n              "],[8,[30,7,["Field"]],null,[["@name","@title","@onSet"],["isEnum","Enum",[30,0,["toggleIsEnum"]]]],[["default"],[[[[1,"\\n                "],[8,[30,19,["Checkbox"]],null,null,null],[1,"\\n              "]],[19]]]]],[1,"\\n            "]],[]]]]],[1,"\\n\\n"],[41,[30,9,["isEnum"]],[[[1,"              "],[8,[30,17,["Col"]],null,[["@size"],[8]],[["default"],[[[[1,"\\n                "],[8,[30,7,["Collection"]],null,[["@name"],["enum"]],[["default"],[[[[1,"\\n                  "],[8,[30,1,["Container"]],[[24,0,"ai-tool-parameter__enum-values"]],null,[["default"],[[[[1,"\\n                    "],[8,[30,20,["Field"]],null,[["@title","@validation"],[[28,[32,1],["discourse_ai.tools.enum_value"],null],"required"]],[["default"],[[[[1,"\\n                      "],[8,[30,22,["Input"]],null,null,null],[1,"\\n\\n"],[41,[28,[32,2],[[28,[32,3],[[30,9,["enum","length"]],1],null],[28,[32,3],[[30,21],0],null]],null],[[[1,"                        "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@icon","@action"],["trash-can",[28,[32,4],[[30,20,["remove"]],[30,21]],null]]],null],[1,"\\n"]],[]],null],[1,"                    "]],[22]]]]],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[20,21]]]]],[1,"\\n              "]],[]]]]],[1,"\\n\\n              "],[8,[30,17,["Col"]],null,[["@size"],[8]],[["default"],[[[[1,"\\n                "],[8,[30,1,["Button"]],null,[["@icon","@label","@action"],["plus","discourse_ai.tools.add_enum_value",[28,[32,4],[[30,1,["addItemToCollection"]],[28,[32,5],["parameters.",[30,8],".enum"],null],""],null]]],null],[1,"\\n              "]],[]]]]],[1,"\\n"]],[]],null],[1,"          "]],[17]]]]],[1,"\\n          "],[8,[30,1,["Row"]],null,null,[["default"],[[[[1,"\\n            "],[8,[30,23,["Col"]],[[24,0,"ai-tool-parameter-actions"]],null,[["default"],[[[[1,"\\n              "],[8,[30,1,["Button"]],[[24,0,"btn-danger"]],[["@label","@icon","@action"],["discourse_ai.tools.remove_parameter","trash-can",[28,[32,4],[[30,7,["remove"]],[30,8]],null]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[23]]]]],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[7,8,9]]]]],[1,"\\n\\n      "],[8,[30,1,["Button"]],null,[["@icon","@label","@action"],["plus","discourse_ai.tools.add_parameter",[28,[32,4],[[30,1,["addItemToCollection"]],"parameters",[28,[32,6],null,[["name","type","description","required","isEnum"],["","string","",false,false]]]],null]]],null],[1,"\\n\\n"],[1,"      "],[8,[30,1,["Field"]],null,[["@name","@title","@validation","@format"],["script",[28,[32,1],["discourse_ai.tools.script"],null],"required|length:1,100000","full"]],[["default"],[[[[1,"\\n        "],[8,[30,24,["Code"]],null,[["@lang","@height"],["javascript",600]],null],[1,"\\n      "]],[24]]]]],[1,"\\n\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"        "],[8,[30,1,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_uploads",[28,[32,1],["discourse_ai.rag.uploads.title"],null],[30,0,["ragUploadsDescription"]],"full"]],[["default"],[[[[1,"\\n          "],[8,[30,25,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,7],null,[["@target","@updateUploads","@onRemove","@allowImages"],[[30,26],[28,[32,4],[[30,0,["updateUploads"]],[30,1,["addItemToCollection"]]],null],[28,[32,4],[[30,0,["removeUpload"]],[30,1]],null],[30,27,["rag_images_enabled"]]]],null],[1,"\\n            "],[8,[32,8],null,[["@form","@data","@llms","@allowImages"],[[30,1],[30,2],[30,28],[30,27,["rag_images_enabled"]]]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[25]]]]],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[30,1,["Actions"]],null,null,[["default"],[[[[1,"\\n"],[41,[51,[30,29]],[[[1,"          "],[8,[30,1,["Button"]],[[24,0,"ai-tool-editor__test-button"]],[["@label","@action"],["discourse_ai.tools.test",[30,0,["openTestModal"]]]],null],[1,"\\n\\n          "],[8,[30,1,["Button"]],[[24,0,"btn-danger ai-tool-editor__delete"]],[["@label","@icon","@action"],["discourse_ai.tools.delete","trash-can",[30,0,["delete"]]]],null],[1,"\\n"]],[]],null],[1,"\\n        "],[8,[30,1,["Submit"]],[[24,0,"ai-tool-editor__save"]],[["@label"],["discourse_ai.tools.save"]],null],[1,"\\n      "]],[]]]]],[1,"\\n    "]],[1,2]]]]],[1,"\\n  "]],["form","data","field","field","field","field","collection","index","collectionData","row","field","field","select","type","row","field","row","field","field","child","childIndex","field","row","field","field","@editingModel","@settings","@llms","@isNew"],false,["each","-track-array","if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form.js",scope:()=>[r.default,d.i18n,a.and,a.gt,i.fn,i.concat,i.hash,p.default,c.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-editor",["exports","@glimmer/component","@ember/service","discourse/components/back-button","discourse/plugins/discourse-ai/discourse/components/ai-tool-editor-form","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static#e=(()=>dt7948.g(this.prototype,"store",[s.service]))()
#ee=(()=>{dt7948.i(this,"store")})()
get selectedPreset(){return this.args.selectedPreset?this.args.presets.findBy("preset_id",this.args.selectedPreset):this.args.presets.findBy("preset_id","empty_tool")}get editingModel(){return this.args.model.isNew?this.store.createRecord("ai-tool",this.selectedPreset):this.args.model}static#s=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"+YeIg+yc",block:'[[[1,"\\n    "],[8,[32,0],null,[["@route","@label"],["adminPlugins.show.discourse-ai-tools","discourse_ai.tools.back"]],null],[1,"\\n\\n    "],[8,[32,1],null,[["@model","@tools","@editingModel","@isNew","@selectedPreset"],[[30,1],[30,2],[30,0,["editingModel"]],[30,1,["isNew"]],[30,0,["selectedPreset"]]]],null],[1,"\\n  "]],["@model","@tools"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-editor.js",scope:()=>[i.default,o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor",["exports","@glimmer/component","@ember/helper","@ember/object","@ember/routing","@ember/service","truth-helpers","discourse/components/d-breadcrumbs-item","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/dropdown-menu","discourse-i18n","admin/components/admin-config-area-empty-list","float-kit/components/d-menu","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"adminPluginNavManager",[n.service]))()
#re=(()=>{dt7948.i(this,"adminPluginNavManager")})()
static#s=(()=>dt7948.g(this.prototype,"router",[n.service]))()
#t=(()=>{dt7948.i(this,"router")})()
get lastIndexOfPresets(){return this.args.tools.resultSetMeta.presets.length-1}routeToNewTool(e){return this.router.transitionTo("adminPlugins.show.discourse-ai-tools.new",{queryParams:{presetId:e.preset_id}})}static#o=(()=>dt7948.n(this.prototype,"routeToNewTool",[i.action]))()
static#a=(()=>(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"Jrk25YVu",block:'[[[1,"\\n    "],[8,[32,0],null,[["@path","@label"],[[29,["/admin/plugins/",[30,0,["adminPluginNavManager","currentPlugin","name"]],"/ai-tools"]],[28,[32,1],["discourse_ai.tools.short_title"],null]]],null],[1,"\\n    "],[10,"section"],[14,0,"ai-tool-list-editor__current admin-detail pull-left"],[12],[1,"\\n      "],[8,[32,2],null,[["@titleLabel","@learnMoreUrl","@descriptionLabel"],[[28,[32,1],["discourse_ai.tools.short_title"],null],"https://meta.discourse.org/t/ai-bot-custom-tools/314103",[28,[32,1],["discourse_ai.tools.subheader_description"],null]]],[["actions"],[[[[1,"\\n          "],[8,[32,3],null,[["@triggerClass","@label","@icon","@placement"],["btn-primary btn-small ai-tool-list-editor__new-button",[28,[32,1],["discourse_ai.tools.new"],null],"plus","bottom-end"]],[["content"],[[[[1,"\\n              "],[8,[32,4],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["resultSetMeta","presets"]]],null]],null],null,[[[41,[28,[32,5],[[30,4],[30,0,["lastIndexOfPresets"]]],null],[[[1,"                    "],[8,[30,1,["divider"]],null,null,null],[1,"\\n"]],[]],null],[1,"\\n                  "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                    "],[8,[32,6],[[24,0,"btn-transparent"],[16,"data-option",[30,3,["preset_id"]]]],[["@translatedLabel","@action"],[[30,3,["preset_name"]],[28,[32,7],[[30,0,["routeToNewTool"]],[30,3]],null]]],null],[1,"\\n                  "]],[]]]]],[1,"\\n"]],[3,4]],null],[1,"              "]],[1]]]]],[1,"\\n\\n            "]],[]]]]],[1,"\\n        "]],[]]]]],[1,"\\n\\n"],[41,[30,2],[[[1,"        "],[10,"table"],[14,0,"d-admin-table ai-tool-list-editor"],[12],[1,"\\n          "],[10,"thead"],[12],[1,"\\n            "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.tools.name"],null]],[13],[1,"\\n            "],[10,"th"],[12],[13],[1,"\\n          "],[13],[1,"\\n          "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2]],null]],null],null,[[[1,"              "],[10,"tr"],[15,"data-tool-id",[30,5,["id"]]],[14,0,"ai-tool-list__row d-admin-row__content"],[12],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__overview"],[12],[1,"\\n                  "],[10,0],[14,0,"ai-tool-list__name-with-description"],[12],[1,"\\n                    "],[10,0],[14,0,"ai-tool-list__name"],[12],[1,"\\n                      "],[10,"strong"],[12],[1,"\\n                        "],[1,[30,5,["name"]]],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,0],[14,0,"ai-tool-list__description"],[12],[1,"\\n                      "],[1,[30,5,["description"]]],[1,"\\n                    "],[13],[1,"\\n                  "],[13],[1,"\\n                "],[13],[1,"\\n                "],[10,"td"],[14,0,"d-admin-row__controls"],[12],[1,"\\n                  "],[8,[32,8],[[24,0,"btn btn-text btn-small"]],[["@route","@model"],["adminPlugins.show.discourse-ai-tools.edit",[30,5]]],[["default"],[[[[1,[28,[32,1],["discourse_ai.tools.edit"],null]]],[]]]]],[1,"\\n                "],[13],[1,"\\n              "],[13],[1,"\\n"]],[5]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[1,"        "],[8,[32,9],null,[["@ctaLabel","@ctaRoute","@ctaClass","@emptyLabel"],["discourse_ai.tools.new","adminPlugins.show.discourse-ai-tools.new","ai-tool-list-editor__empty-new-button","discourse_ai.tools.no_tools"]],null],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["dropdown","@tools","preset","index","tool"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-list-editor.js",scope:()=>[r.default,c.i18n,d.default,m.default,u.default,a.eq,l.default,s.fn,o.LinkTo,p.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/components/ai-tool-selector",["exports","@ember/helper","select-kit/components/multi-select","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"gsEPc7NG",block:'[[[1,"\\n  "],[8,[32,0],null,[["@value","@onChange","@content","@options"],[[30,1],[30,2],[30,3],[28,[32,1],null,[["filterable","allowAny","disabled"],[true,false,[30,4]]]]]],null],[1,"\\n"]],["@value","@onChange","@content","@disabled"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-tool-selector.js",scope:()=>[s.default,t.hash],isStrictMode:!0}),(0,n.default)(void 0,"ai-tool-selector:AiToolSelector"))
e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-topic-gist",["exports","@glimmer/component","@ember/service","@ember/template","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static#e=(()=>dt7948.g(this.prototype,"gists",[s.service]))()
#he=(()=>{dt7948.i(this,"gists")})()
get shouldShow(){return"table-ai"===this.gists.preference&&this.gists.shouldShow}get hasGist(){return!!this.gist}get gist(){return this.args.topic.get("ai_topic_gist")}get escapedExcerpt(){return this.args.topic.get("escapedExcerpt")}static#s=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"DDbV96Wf",block:'[[[1,"\\n"],[41,[30,0,["shouldShow"]],[[[41,[30,0,["hasGist"]],[[[1,"        "],[10,0],[14,0,"excerpt"],[12],[1,"\\n          "],[10,0],[14,0,"excerpt__contents"],[12],[1,[30,0,["gist"]]],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],[[[41,[30,0,["escapedExcerpt"]],[[[1,"          "],[10,0],[14,0,"excerpt"],[12],[1,"\\n            "],[10,0],[14,0,"excerpt__contents"],[12],[1,"\\n              "],[1,[28,[32,0],[[30,0,["escapedExcerpt"]]],null]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null]],[]]]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-topic-gist.js",scope:()=>[i.htmlSafe],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/ai-usage",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/routing","@ember/service","truth-helpers","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-page-subheader","discourse/components/d-stat-tiles","discourse/components/date-time-input-range","discourse/helpers/avatar","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/decorators","discourse/lib/formatter","discourse-i18n","admin/components/admin-config-area-card","admin/components/admin-config-area-empty-list","admin/components/chart","select-kit/components/combo-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k,T,P){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class C extends t.default{static#e=(()=>dt7948.g(this.prototype,"store",[l.service]))()
#ee=(()=>{dt7948.i(this,"store")})()
static#s=(()=>dt7948.g(this.prototype,"startDate",[s.tracked],(function(){return moment().subtract(30,"days").toDate()})))()
#mt=(()=>{dt7948.i(this,"startDate")})()
static#o=(()=>dt7948.g(this.prototype,"endDate",[s.tracked],(function(){return new Date})))()
#ht=(()=>{dt7948.i(this,"endDate")})()
static#a=(()=>dt7948.g(this.prototype,"data",[s.tracked],(function(){return this.args.model})))()
#gt=(()=>{dt7948.i(this,"data")})()
static#l=(()=>dt7948.g(this.prototype,"selectedFeature",[s.tracked]))()
#_t=(()=>{dt7948.i(this,"selectedFeature")})()
static#u=(()=>dt7948.g(this.prototype,"selectedModel",[s.tracked]))()
#ft=(()=>{dt7948.i(this,"selectedModel")})()
static#p=(()=>dt7948.g(this.prototype,"selectedPeriod",[s.tracked],(function(){return"month"})))()
#bt=(()=>{dt7948.i(this,"selectedPeriod")})()
static#h=(()=>dt7948.g(this.prototype,"isCustomDateActive",[s.tracked],(function(){return!1})))()
#yt=(()=>{dt7948.i(this,"isCustomDateActive")})()
static#_=(()=>dt7948.g(this.prototype,"loadingData",[s.tracked],(function(){return!0})))()
#vt=(()=>{dt7948.i(this,"loadingData")})()
constructor(){super(...arguments),this.fetchData()}async fetchData(){const e=await(0,f.ajax)("/admin/plugins/discourse-ai/ai-usage-report.json",{data:{start_date:moment(this.startDate).format("YYYY-MM-DD"),end_date:moment(this.endDate).format("YYYY-MM-DD"),feature:this.selectedFeature,model:this.selectedModel}})
this.data=e,this.loadingData=!1,this._cachedFeatures=null,this._cachedModels=null}static#f=(()=>dt7948.n(this.prototype,"fetchData",[o.action]))()
async onFilterChange(){await this.fetchData()}static#b=(()=>dt7948.n(this.prototype,"onFilterChange",[o.action]))()
onFeatureChanged(e){this.selectedFeature=e,this.onFilterChange()}static#y=(()=>dt7948.n(this.prototype,"onFeatureChanged",[o.action]))()
onModelChanged(e){this.selectedModel=e,this.onFilterChange()}static#v=(()=>dt7948.n(this.prototype,"onModelChanged",[o.action]))()
addCurrencyChar(e){e.querySelectorAll(".d-stat-tile__label").forEach((e=>{if(e.innerText.trim()===(0,v.i18n)("discourse_ai.usage.total_spending")){const t=e.closest(".d-stat-tile")?.querySelector(".d-stat-tile__value")
t&&(t.innerText=`$${t.innerText}`)}}))}static#w=(()=>dt7948.n(this.prototype,"addCurrencyChar",[o.action]))()
takeUsers(e,t){return this.data.users.slice(e,t)}static#L=(()=>dt7948.n(this.prototype,"takeUsers",[b.bind]))()
normalizeTimeSeriesData(e){if(!e?.length)return[]
const t=moment(this.startDate),s=moment(this.endDate),i=[]
let o,n
"hour"===this.data.period?(o="hour",n="YYYY-MM-DD HH:00:00"):"day"===this.data.period?(o="day",n="YYYY-MM-DD"):(o="month",n="YYYY-MM")
const a=new Map(e.map((e=>[moment(e.period).format(n),e])))
for(let r=moment(t);r.isSameOrBefore(s);r.add(1,o)){const e=r.format(n),t=a.get(e)
i.push(t||{period:r.format(),total_tokens:0,total_cached_tokens:0,total_request_tokens:0,total_response_tokens:0})}return i}get metrics(){return[{label:(0,v.i18n)("discourse_ai.usage.total_requests"),value:this.data.summary.total_requests,tooltip:(0,v.i18n)("discourse_ai.usage.stat_tooltips.total_requests")},{label:(0,v.i18n)("discourse_ai.usage.total_tokens"),value:this.data.summary.total_tokens,tooltip:(0,v.i18n)("discourse_ai.usage.stat_tooltips.total_tokens")},{label:(0,v.i18n)("discourse_ai.usage.request_tokens"),value:this.data.summary.total_request_tokens,tooltip:(0,v.i18n)("discourse_ai.usage.stat_tooltips.request_tokens")},{label:(0,v.i18n)("discourse_ai.usage.response_tokens"),value:this.data.summary.total_response_tokens,tooltip:(0,v.i18n)("discourse_ai.usage.stat_tooltips.response_tokens")},{label:(0,v.i18n)("discourse_ai.usage.cached_tokens"),value:this.data.summary.total_cached_tokens,tooltip:(0,v.i18n)("discourse_ai.usage.stat_tooltips.cached_tokens")},{label:(0,v.i18n)("discourse_ai.usage.total_spending"),value:this.data.summary.total_spending,tooltip:(0,v.i18n)("discourse_ai.usage.stat_tooltips.total_spending")}]}get chartConfig(){if(!this.data?.data)return
const e=this.normalizeTimeSeriesData(this.data.data),t=document.querySelector(".ai-usage__chart"),s=getComputedStyle(t),i={response:s.getPropertyValue("--chart-response-color").trim(),request:s.getPropertyValue("--chart-request-color").trim(),cached:s.getPropertyValue("--chart-cached-color").trim()}
return{type:"bar",data:{labels:e.map((e=>{const t=moment(e.period)
return"hour"===this.data.period?t.format("HH:00"):"day"===this.data.period?t.format("DD-MMM"):t.format("MMM-YY")})),datasets:[{label:(0,v.i18n)("discourse_ai.usage.response_tokens"),data:e.map((e=>e.total_response_tokens)),backgroundColor:i.response},{label:(0,v.i18n)("discourse_ai.usage.net_request_tokens"),data:e.map((e=>e.total_request_tokens-e.total_cached_tokens)),backgroundColor:i.request},{label:(0,v.i18n)("discourse_ai.usage.cached_request_tokens"),data:e.map((e=>e.total_cached_tokens)),backgroundColor:i.cached}]},options:{responsive:!0,scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0}}}}}get availableFeatures(){return this._cachedFeatures=this._cachedFeatures||(this.data?.features||[]).map((e=>({id:e.feature_name,name:e.feature_name}))),this._cachedFeatures}get availableModels(){return this._cachedModels=this._cachedModels||(this.data?.models||[]).map((e=>({id:e.llm,name:e.llm}))),this._cachedModels}get periodOptions(){return[{id:"day",name:(0,v.i18n)("discourse_ai.usage.periods.last_day")},{id:"week",name:(0,v.i18n)("discourse_ai.usage.periods.last_week")},{id:"month",name:(0,v.i18n)("discourse_ai.usage.periods.last_month")}]}setPeriodDates(e){const t=moment()
switch(e){case"day":this.startDate=t.clone().subtract(1,"day").toDate(),this.endDate=t.toDate()
break
case"week":this.startDate=t.clone().subtract(7,"days").toDate(),this.endDate=t.toDate()
break
case"month":this.startDate=t.clone().subtract(30,"days").toDate(),this.endDate=t.toDate()}}static#N=(()=>dt7948.n(this.prototype,"setPeriodDates",[o.action]))()
onPeriodSelect(e){this.selectedPeriod=e,this.isCustomDateActive=!1,this.setPeriodDates(e),this.fetchData()}static#U=(()=>dt7948.n(this.prototype,"onPeriodSelect",[o.action]))()
onCustomDateClick(){this.isCustomDateActive=!this.isCustomDateActive,this.isCustomDateActive&&(this.selectedPeriod=null)}static#q=(()=>dt7948.n(this.prototype,"onCustomDateClick",[o.action]))()
onDateChange(){this.isCustomDateActive=!0,this.selectedPeriod=null,this.fetchData()}static#B=(()=>dt7948.n(this.prototype,"onDateChange",[o.action]))()
onChangeDateRange(e){let{from:t,to:s}=e
this._startDate=t,this._endDate=s}static#z=(()=>dt7948.n(this.prototype,"onChangeDateRange",[o.action]))()
onRefreshDateRange(){this.startDate=this._startDate,this.endDate=this._endDate,this.fetchData()}static#Ne=(()=>dt7948.n(this.prototype,"onRefreshDateRange",[o.action]))()
totalSpending(e,t,s){return`$${(e+t+s).toFixed(2)}`}static#qe=(()=>(0,T.setComponentTemplate)((0,P.createTemplateFactory)({id:"hX10WeQL",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-usage admin-detail"],[12],[1,"\\n      "],[8,[32,0],null,[["@titleLabel","@learnMoreUrl","@descriptionLabel"],[[28,[32,1],["discourse_ai.usage.short_title"],null],"https://meta.discourse.org/t/-/348677",[28,[32,1],["discourse_ai.usage.subheader_description"],null]]],null],[1,"\\n      "],[10,0],[14,0,"ai-usage__filters"],[12],[1,"\\n        "],[10,0],[14,0,"ai-usage__filters-dates"],[12],[1,"\\n          "],[10,0],[14,0,"ai-usage__period-buttons"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["periodOptions"]]],null]],null],null,[[[1,"              "],[8,[32,2],[[16,0,[52,[28,[32,3],[[30,0,["selectedPeriod"]],[30,1,["id"]]],null],"btn-primary","btn-default"]]],[["@action","@translatedLabel"],[[28,[32,4],[[30,0,["onPeriodSelect"]],[30,1,["id"]]],null],[30,1,["name"]]]],null],[1,"\\n"]],[1]],null],[1,"            "],[8,[32,2],[[16,0,[52,[30,0,["isCustomDateActive"]],"btn-primary","btn-default"]]],[["@action","@label"],[[30,0,["onCustomDateClick"]],"discourse_ai.usage.periods.custom"]],null],[1,"\\n          "],[13],[1,"\\n\\n"],[41,[30,0,["isCustomDateActive"]],[[[1,"            "],[10,0],[14,0,"ai-usage__custom-date-pickers"],[12],[1,"\\n\\n              "],[8,[32,5],null,[["@from","@to","@onChange","@showFromTime","@showToTime"],[[30,0,["startDate"]],[30,0,["endDate"]],[30,0,["onChangeDateRange"]],false,false]],null],[1,"\\n\\n              "],[8,[32,2],null,[["@action","@label"],[[30,0,["onRefreshDateRange"]],"refresh"]],null],[1,"\\n            "],[13],[1,"\\n"]],[]],null],[1,"        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"ai-usage__filters-row"],[12],[1,"\\n          "],[8,[32,6],[[24,0,"ai-usage__feature-selector"]],[["@value","@content","@onChange","@options"],[[30,0,["selectedFeature"]],[30,0,["availableFeatures"]],[30,0,["onFeatureChanged"]],[28,[32,7],null,[["none"],["discourse_ai.usage.all_features"]]]]],null],[1,"\\n\\n          "],[8,[32,6],[[24,0,"ai-usage__model-selector"]],[["@value","@content","@onChange","@options"],[[30,0,["selectedModel"]],[30,0,["availableModels"]],[30,0,["onModelChanged"]],[28,[32,7],null,[["none"],["discourse_ai.usage.all_models"]]]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[8,[32,8],null,[["@condition"],[[30,0,["loadingData"]]]],[["default"],[[[[1,"\\n          "],[8,[32,9],[[24,0,"ai-usage__summary"]],[["@heading"],["discourse_ai.usage.summary"]],[["content"],[[[[1,"\\n              "],[8,[32,10],[[4,[32,11],[[30,0,["addCurrencyChar"]],[30,0,["metrics"]]],null],[4,[32,12],[[30,0,["addCurrencyChar"]],[30,0,["metrics"]]],null]],null,[["default"],[[[[1,"\\n\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["metrics"]]],null]],null],null,[[[1,"                  "],[8,[30,2,["Tile"]],[[24,0,"bar"]],[["@label","@href","@value","@tooltip"],[[30,3,["label"]],[30,3,["href"]],[30,3,["value"]],[30,3,["tooltip"]]]],null],[1,"\\n"]],[3]],null],[1,"              "]],[2]]]]],[1,"\\n            "]],[]]]]],[1,"\\n\\n          "],[8,[32,9],[[24,0,"ai-usage__charts"]],[["@heading"],["discourse_ai.usage.tokens_over_time"]],[["content"],[[[[1,"\\n              "],[10,0],[14,0,"ai-usage__chart-container"],[12],[1,"\\n                "],[8,[32,13],[[24,0,"ai-usage__chart"]],[["@chartConfig"],[[30,0,["chartConfig"]]]],null],[1,"\\n              "],[13],[1,"\\n            "]],[]]]]],[1,"\\n\\n          "],[10,0],[14,0,"ai-usage__breakdowns"],[12],[1,"\\n            "],[8,[32,9],[[24,0,"ai-usage__features"]],[["@heading"],["discourse_ai.usage.features_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","features","length"]]],[[[1,"                  "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_features"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["data","features","length"]],[[[1,"                  "],[10,"table"],[14,0,"ai-usage__features-table"],[12],[1,"\\n                    "],[10,"thead"],[12],[1,"\\n                      "],[10,"tr"],[12],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.feature"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["data","features"]]],null]],null],null,[[[1,"                        "],[10,"tr"],[14,0,"ai-usage__features-row"],[12],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__features-cell"],[12],[1,[30,4,["feature_name"]]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__features-cell"],[15,"title",[30,4,["usage_count"]]],[12],[1,[28,[32,15],[[30,4,["usage_count"]]],null]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__features-cell"],[15,"title",[30,4,["total_tokens"]]],[12],[1,[28,[32,15],[[30,4,["total_tokens"]]],null]],[13],[1,"\\n                          "],[10,"td"],[12],[1,"\\n                            "],[1,[28,[30,0,["totalSpending"]],[[30,4,["input_spending"]],[30,4,["cached_input_spending"]],[30,4,["output_spending"]]],null]],[1,"\\n                          "],[13],[1,"\\n                        "],[13],[1,"\\n"]],[4]],null],[1,"                    "],[13],[1,"\\n                  "],[13],[1,"\\n"]],[]],null],[1,"              "]],[]]]]],[1,"\\n\\n            "],[8,[32,9],[[24,0,"ai-usage__models"]],[["@heading"],["discourse_ai.usage.models_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","models","length"]]],[[[1,"                  "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_models"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["data","models","length"]],[[[1,"                  "],[10,"table"],[14,0,"ai-usage__models-table"],[12],[1,"\\n                    "],[10,"thead"],[12],[1,"\\n                      "],[10,"tr"],[12],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.model"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["data","models"]]],null]],null],null,[[[1,"                        "],[10,"tr"],[14,0,"ai-usage__models-row"],[12],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__models-cell"],[12],[1,[30,5,["llm"]]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__models-cell"],[15,"title",[30,5,["usage_count"]]],[12],[1,[28,[32,15],[[30,5,["usage_count"]]],null]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__models-cell"],[15,"title",[30,5,["total_tokens"]]],[12],[1,[28,[32,15],[[30,5,["total_tokens"]]],null]],[13],[1,"\\n                          "],[10,"td"],[12],[1,"\\n                            "],[1,[28,[30,0,["totalSpending"]],[[30,5,["input_spending"]],[30,5,["cached_input_spending"]],[30,5,["output_spending"]]],null]],[1,"\\n                          "],[13],[1,"\\n                        "],[13],[1,"\\n"]],[5]],null],[1,"                    "],[13],[1,"\\n                  "],[13],[1,"\\n"]],[]],null],[1,"              "]],[]]]]],[1,"\\n\\n            "],[8,[32,9],[[24,0,"ai-usage__users"]],[["@heading"],["discourse_ai.usage.users_breakdown"]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["data","users","length"]]],[[[1,"                  "],[8,[32,14],null,[["@emptyLabel"],["discourse_ai.usage.no_users"]],null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["data","users","length"]],[[[1,"                  "],[10,"table"],[15,0,[28,[32,16],["ai-usage__users-table",[52,[28,[32,17],[[30,0,["data","users","length"]],25],null],"-double-width"]],null]],[12],[1,"\\n                    "],[10,"thead"],[12],[1,"\\n                      "],[10,"tr"],[12],[1,"\\n                        "],[10,"th"],[14,0,"ai-usage__users-username"],[12],[1,[28,[32,1],["discourse_ai.usage.username"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_spending"],null]],[13],[1,"\\n                      "],[13],[1,"\\n                    "],[13],[1,"\\n                    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[28,[30,0,["takeUsers"]],[0,24],null]],null]],null],null,[[[1,"                        "],[10,"tr"],[14,0,"ai-usage__users-row"],[12],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,"\\n                            "],[10,0],[14,0,"user-info"],[12],[1,"\\n                              "],[8,[32,18],[[24,0,"username"]],[["@route","@model"],["user",[30,6,["username"]]]],[["default"],[[[[1,"\\n                                "],[1,[28,[32,19],[[30,6]],[["imageSize"],["tiny"]]]],[1,"\\n                                "],[1,[30,6,["username"]]],[1,"\\n                              "]],[]]]]],[1,"\\n                            "],[13],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,6,["usage_count"]]],[12],[1,[28,[32,15],[[30,6,["usage_count"]]],null]],[13],[1,"\\n                          "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,6,["total_tokens"]]],[12],[1,[28,[32,15],[[30,6,["total_tokens"]]],null]],[13],[1,"\\n                          "],[10,"td"],[12],[1,"\\n                            "],[1,[28,[30,0,["totalSpending"]],[[30,6,["input_spending"]],[30,6,["cached_input_spending"]],[30,6,["output_spending"]]],null]],[1,"\\n                          "],[13],[1,"\\n                        "],[13],[1,"\\n"]],[6]],null],[1,"                    "],[13],[1,"\\n                  "],[13],[1,"\\n\\n"],[41,[28,[32,20],[[30,0,["data","users","length"]],25],null],[[[1,"                    "],[10,"table"],[14,0,"ai-usage__users-table"],[12],[1,"\\n                      "],[10,"thead"],[12],[1,"\\n                        "],[10,"tr"],[12],[1,"\\n                          "],[10,"th"],[14,0,"ai-usage__users-username"],[12],[1,[28,[32,1],["discourse_ai.usage.username"],null]],[13],[1,"\\n                          "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.usage_count"],null]],[13],[1,"\\n                          "],[10,"th"],[12],[1,[28,[32,1],["discourse_ai.usage.total_tokens"],null]],[13],[1,"\\n                        "],[13],[1,"\\n                      "],[13],[1,"\\n                      "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[28,[30,0,["takeUsers"]],[25,49],null]],null]],null],null,[[[1,"                          "],[10,"tr"],[14,0,"ai-usage__users-row"],[12],[1,"\\n                            "],[10,"td"],[14,0,"ai-usage__users-cell"],[12],[1,"\\n                              "],[10,0],[14,0,"user-info"],[12],[1,"\\n                                "],[8,[32,18],[[24,0,"username"]],[["@route","@model"],["user",[30,7,["username"]]]],[["default"],[[[[1,"\\n                                  "],[1,[28,[32,19],[[30,7]],[["imageSize"],["tiny"]]]],[1,"\\n                                  "],[1,[30,7,["username"]]],[1,"\\n                                "]],[]]]]],[1,"\\n                              "],[13],[13],[1,"\\n                            "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,7,["usage_count"]]],[12],[1,[28,[32,15],[[30,7,["usage_count"]]],null]],[13],[1,"\\n                            "],[10,"td"],[14,0,"ai-usage__users-cell"],[15,"title",[30,7,["total_tokens"]]],[12],[1,[28,[32,15],[[30,7,["total_tokens"]]],null]],[13],[1,"\\n                          "],[13],[1,"\\n"]],[7]],null],[1,"                      "],[13],[1,"\\n                    "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"              "]],[]]]]],[1,"\\n          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["option","tiles","metric","feature","model","user","user"],false,["each","-track-array","if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/ai-usage.js",scope:()=>[p.default,v.i18n,c.default,d.eq,i.fn,h.default,k.default,i.hash,u.default,w.default,m.default,n.default,a.default,x.default,S.default,y.number,_.default,d.lt,r.LinkTo,g.default,d.gt],isStrictMode:!0}),this))()}e.default=C})),define("discourse/plugins/discourse-ai/discourse/components/doughnut-chart",["exports","@glimmer/component","@glimmer/tracking","admin/components/chart","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static#e=(()=>dt7948.g(this.prototype,"canvasSize",[s.tracked],(function(){return null})))()
#wt=(()=>{dt7948.i(this,"canvasSize")})()
get config(){const e=this.args.totalScore||""
return{type:"doughnut",data:{labels:this.args.labels,datasets:[{data:this.args.data,backgroundColor:this.args.colors,cutout:"50%",radius:100}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:this.args.displayLegend||!1,position:"bottom"}}},plugins:[{id:"centerText",afterDraw:function(t){const s=getComputedStyle(document.documentElement).getPropertyValue("--primary-high")||"#000",i=getComputedStyle(document.documentElement).getPropertyValue("--font-up-4")||"1.3em",o=getComputedStyle(document.documentElement).getPropertyValue("--font-family")||"sans-serif",{ctx:n,chartArea:a}=t,r=(a.left+a.right)/2,l=(a.top+a.bottom)/2
n.restore(),n.textAlign="center",n.textBaseline="middle",n.fillStyle=s.trim(),n.font=`bold ${i.trim()} ${o.trim()}`,n.fillText(e,r,l),n.save()}},{id:"doughnutLabels",afterDraw(e){const t=e.ctx,s=e.data.datasets[0],i=e.getDatasetMeta(0),o=getComputedStyle(document.documentElement).getPropertyValue("--font-down-2")||"1.3em",n=getComputedStyle(document.documentElement).getPropertyValue("--font-family")||"sans-serif"
t.font=`${o.trim()} ${n.trim()}`,t.fillStyle="#fafafa",t.textAlign="center",t.textBaseline="middle",i.data.forEach(((e,i)=>{const{x:o,y:n}=e.tooltipPosition(),a=s.data[i],r=s.data.filter((e=>e>0)).length
0!==a&&1!==r&&t.fillText(a,o,n)}))}}]}}static#s=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"HiYQwgXb",block:'[[[1,"\\n"],[41,[30,0,["config"]],[[[1,"      "],[10,"h3"],[14,0,"doughnut-chart-title"],[12],[1,[30,1]],[13],[1,"\\n      "],[8,[32,0],[[24,0,"admin-report-doughnut"]],[["@chartConfig"],[[30,0,["config"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@doughnutTitle"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/doughnut-chart.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/service","discourse/components/d-modal","discourse/components/form","discourse-i18n","select-kit/components/group-chooser","discourse/plugins/discourse-ai/discourse/components/ai-quota-duration-selector","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class m extends t.default{static#e=(()=>dt7948.g(this.prototype,"site",[n.service]))()
#F=(()=>{dt7948.i(this,"site")})()
save(e){const t={...e}
t.group_name=this.site.groups.findBy("id",e.group_id).name,t.llm_model_id=this.args.model.id,this.args.model.addItemToCollection(t),this.args.closeModal(),this.args.model.onSave&&this.args.model.onSave()}static#s=(()=>dt7948.n(this.prototype,"save",[o.action]))()
get availableGroups(){const e=this.args.model.llm.llm_quotas.map((e=>e.group_id))||[]
return this.site.groups.filter((t=>!e.includes(t.id)&&0!==t.id))}get quota(){return{group_id:null,llm_model_id:null,max_tokens:null,max_usages:null,duration_seconds:moment.duration(1,"day").asSeconds()}}static#o=(()=>dt7948.n(this.prototype,"quota",[s.cached]))()
setGroupId(e,t){e.set(t[0])}static#a=(()=>dt7948.n(this.prototype,"setGroupId",[o.action]))()
validateForm(e,t){let{addError:s,removeError:i}=t
e.max_tokens||e.max_usages?(i("max_tokens"),i("max_usages")):(s("max_tokens",{title:(0,l.i18n)("discourse_ai.llms.quotas.max_tokens"),message:(0,l.i18n)("discourse_ai.llms.quotas.max_tokens_required")}),s("max_usages",{title:(0,l.i18n)("discourse_ai.llms.quotas.max_usages"),message:(0,l.i18n)("discourse_ai.llms.quotas.max_usages_required")}))}static#l=(()=>dt7948.n(this.prototype,"validateForm",[o.action]))()
static#u=(()=>(0,c.setComponentTemplate)((0,p.createTemplateFactory)({id:"MLB+nwD5",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-llm-quota-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.llms.quotas.add_title"],null],[30,1]]],[["body"],[[[[1,"\\n        "],[8,[32,2],null,[["@validate","@onSubmit","@data"],[[30,0,["validateForm"]],[30,0,["save"]],[30,0,["quota"]]]],[["default"],[[[[1,"\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@format"],["group_id",[28,[32,1],["discourse_ai.llms.quotas.group"],null],"required","large"]],[["default"],[[[[1,"\\n            "],[8,[30,4,["Custom"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,3],null,[["@value","@content","@onChange","@options"],[[30,3,["group_id"]],[30,0,["availableGroups"]],[28,[32,4],[[30,0,["setGroupId"]],[30,4]],null],[28,[32,5],null,[["maximum"],[1]]]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[4]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_tokens",[28,[32,1],["discourse_ai.llms.quotas.max_tokens"],null],[28,[32,1],["discourse_ai.llms.quotas.max_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,5,["Input"]],[[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n          "]],[5]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["max_usages",[28,[32,1],["discourse_ai.llms.quotas.max_usages"],null],[28,[32,1],["discourse_ai.llms.quotas.max_usages_help"],null],"large"]],[["default"],[[[[1,"\\n            "],[8,[30,6,["Input"]],[[24,"min","1"]],[["@type"],["number"]],null],[1,"\\n          "]],[6]]]]],[1,"\\n\\n          "],[8,[30,2,["Field"]],null,[["@name","@title","@validation","@format"],["duration_seconds",[28,[32,1],["discourse_ai.llms.quotas.duration"],null],"required","large"]],[["default"],[[[[1,"\\n            "],[8,[30,7,["Custom"]],null,null,[["default"],[[[[1,"\\n              "],[8,[32,6],null,[["@value","@onChange"],[[30,3,["duration_seconds"]],[30,7,["set"]]]],null],[1,"\\n            "]],[]]]]],[1,"\\n          "]],[7]]]]],[1,"\\n\\n          "],[8,[30,2,["Submit"]],[[24,0,"btn-primary"]],[["@label"],["discourse_ai.llms.quotas.add"]],null],[1,"\\n        "]],[2,3]]]]],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","form","data","field","field","field","field"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-llm-quota-modal.js",scope:()=>[a.default,l.i18n,r.default,d.default,i.fn,i.hash,u.default],isStrictMode:!0}),this))()}e.default=m})),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","truth-helpers","discourse/components/modal/json-schema-editor","discourse/lib/formatter","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"showJsonEditorModal",[s.tracked],(function(){return!1})))()
#St=(()=>{dt7948.i(this,"showJsonEditorModal")})()
jsonSchema=(()=>({type:"array",uniqueItems:!0,title:(0,l.i18n)("discourse_ai.ai_persona.response_format.modal.root_title"),items:{type:"object",title:(0,l.i18n)("discourse_ai.ai_persona.response_format.modal.key_title"),properties:{key:{type:"string"},type:{type:"string",enum:["string","integer","boolean","array"]},array_type:{type:"string",enum:["string","integer","boolean"],options:{dependencies:{type:"array"}}}},required:["key","type"]}}))()
get editorTitle(){return(0,l.i18n)("discourse_ai.ai_persona.response_format.title")}get responseFormatAsJSON(){return JSON.stringify(this.args.data.response_format)}get displayJSON(){const e={}
return this.args.data.response_format.forEach((t=>{"array"===t.type?e[t.key]=`[${t.array_type}]`:e[t.key]=t.type})),(0,r.prettyJSON)(e)}openModal(){this.showJsonEditorModal=!0}static#s=(()=>dt7948.n(this.prototype,"openModal",[o.action]))()
closeModal(){this.showJsonEditorModal=!1}static#o=(()=>dt7948.n(this.prototype,"closeModal",[o.action]))()
updateResponseFormat(e,t){e.set("response_format",JSON.parse(t))}static#a=(()=>dt7948.n(this.prototype,"updateResponseFormat",[o.action]))()
static#l=(()=>(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"TiBnMIeT",block:'[[[1,"\\n    "],[8,[30,1,["Container"]],null,[["@title","@format"],[[30,0,["editorTitle"]],"large"]],[["default"],[[[[1,"\\n      "],[10,0],[14,0,"ai-persona-editor__response-format"],[12],[1,"\\n"],[41,[28,[32,0],[[30,2,["response_format","length"]],0],null],[[[1,"          "],[10,"pre"],[14,0,"ai-persona-editor__response-format-pre"],[12],[1,"            "],[10,"code"],[12],[1,[30,0,["displayJSON"]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,0],[14,0,"ai-persona-editor__response-format-none"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_persona.response_format.no_format"],null]],[1,"\\n          "],[13],[1,"\\n"]],[]]],[1,"\\n        "],[8,[30,1,["Button"]],null,[["@action","@label","@disabled"],[[30,0,["openModal"]],"discourse_ai.ai_persona.response_format.open_modal",[30,2,["system"]]]],null],[1,"\\n      "],[13],[1,"\\n    "]],[]]]]],[1,"\\n\\n"],[41,[30,0,["showJsonEditorModal"]],[[[1,"      "],[8,[32,2],null,[["@model","@closeModal"],[[28,[32,3],null,[["value","updateValue","settingName","jsonSchema"],[[30,0,["responseFormatAsJSON"]],[28,[32,4],[[30,0,["updateResponseFormat"]],[30,1]],null],[30,0,["editorTitle"]],[30,0,["jsonSchema"]]]]],[30,0,["closeModal"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@form","@data"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-persona-response-format-editor.js",scope:()=>[n.gt,l.i18n,a.default,i.hash,i.fn],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","truth-helpers","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/concat-class","discourse/helpers/d-icon","discourse/helpers/html-class","discourse/lib/ajax","discourse/lib/decorators","discourse/lib/formatter","discourse-i18n","float-kit/components/d-tooltip","discourse/plugins/discourse-ai/discourse/components/ai-summary-skeleton","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S,x,k){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class T extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[l.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#s=(()=>dt7948.g(this.prototype,"messageBus",[l.service]))()
#xe=(()=>{dt7948.i(this,"messageBus")})()
static#o=(()=>dt7948.g(this.prototype,"currentUser",[l.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#a=(()=>dt7948.g(this.prototype,"site",[l.service]))()
#F=(()=>{dt7948.i(this,"site")})()
static#l=(()=>dt7948.g(this.prototype,"modal",[l.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
static#u=(()=>dt7948.g(this.prototype,"text",[s.tracked],(function(){return""})))()
#xt=(()=>{dt7948.i(this,"text")})()
static#p=(()=>dt7948.g(this.prototype,"summarizedOn",[s.tracked],(function(){return null})))()
#kt=(()=>{dt7948.i(this,"summarizedOn")})()
static#h=(()=>dt7948.g(this.prototype,"summarizedBy",[s.tracked],(function(){return null})))()
#Tt=(()=>{dt7948.i(this,"summarizedBy")})()
static#_=(()=>dt7948.g(this.prototype,"newPostsSinceSummary",[s.tracked],(function(){return null})))()
#Pt=(()=>{dt7948.i(this,"newPostsSinceSummary")})()
static#f=(()=>dt7948.g(this.prototype,"outdated",[s.tracked],(function(){return!1})))()
#Ct=(()=>{dt7948.i(this,"outdated")})()
static#b=(()=>dt7948.g(this.prototype,"canRegenerate",[s.tracked],(function(){return!1})))()
#jt=(()=>{dt7948.i(this,"canRegenerate")})()
static#y=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#v=(()=>dt7948.g(this.prototype,"currentIndex",[s.tracked],(function(){return 0})))()
#Mt=(()=>{dt7948.i(this,"currentIndex")})()
static#w=(()=>dt7948.g(this.prototype,"smoothStreamer",[s.tracked],(function(){return new S.default((()=>this.text),(e=>this.text=e))})))()
#Le=(()=>{dt7948.i(this,"smoothStreamer")})()
get outdatedSummaryWarningText(){let e=(0,y.i18n)("summary.outdated")
return!this.topRepliesSummaryEnabled&&this.newPostsSinceSummary>0&&(e+=" ",e+=(0,y.i18n)("summary.outdated_posts",{count:this.newPostsSinceSummary})),e}resetSummary(){this.smoothStreamer.resetStreaming(),this.currentIndex=0,this.text="",this.summarizedOn=null,this.summarizedBy=null,this.newPostsSinceSummary=null,this.outdated=!1,this.canRegenerate=!1,this.loading=!1,this._channel=null}get topRepliesSummaryEnabled(){return this.args.model.postStream.summary}get topicId(){return this.args.model.topic.id}get baseSummarizationURL(){return`/discourse-ai/summarization/t/${this.topicId}`}subscribe(){const e=`/discourse-ai/summaries/topic/${this.args.model.topic.id}`
this._channel=e,this.messageBus.subscribe(e,this._updateSummary)}static#L=(()=>dt7948.n(this.prototype,"subscribe",[f.bind]))()
unsubscribe(){this.messageBus.unsubscribe("/discourse-ai/summaries/topic/*",this._updateSummary),this.resetSummary()}static#N=(()=>dt7948.n(this.prototype,"unsubscribe",[f.bind]))()
generateSummary(){let e=this.baseSummarizationURL
return this.currentUser&&(e+="?stream=true"),this._requestSummary(e)}static#U=(()=>dt7948.n(this.prototype,"generateSummary",[o.action]))()
regenerateSummary(){let e=this.baseSummarizationURL
return this.currentUser&&(e+="?stream=true",this.canRegenerate&&(e+="&skip_age_check=true")),this.resetSummary(),this._requestSummary(e)}static#q=(()=>dt7948.n(this.prototype,"regenerateSummary",[o.action]))()
_requestSummary(e){if(!(this.loading||this.text&&!this.canRegenerate))return this.loading=!0,this.summarizedOn=null,(0,_.ajax)(e).then((e=>{e?.ai_topic_summary?.summarized_text&&(e.done=!0,this._updateSummary(e))}))}static#B=(()=>dt7948.n(this.prototype,"_requestSummary",[o.action]))()
async _updateSummary(e){const t={done:e.done,raw:e.ai_topic_summary?.summarized_text,...e.ai_topic_summary}
this.loading=!1,this.smoothStreamer.updateResult(t,"raw"),e.done&&(this.summarizedOn=(0,b.shortDateNoYear)(moment(t.updated_at,"YYYY-MM-DD HH:mm:ss Z")),this.summarizedBy=t.algorithm,this.newPostsSinceSummary=t.new_posts_since_summary,this.outdated=t.outdated,this.canRegenerate=t.outdated&&t.can_regenerate)}static#z=(()=>dt7948.n(this.prototype,"_updateSummary",[f.bind]))()
onRegisterApi(e){this.dMenu=e}static#Ne=(()=>dt7948.n(this.prototype,"onRegisterApi",[o.action]))()
handleClose(){this.modal.triggerElement=null,this.args.closeModal()}static#qe=(()=>dt7948.n(this.prototype,"handleClose",[o.action]))()
static#Be=(()=>(0,x.setComponentTemplate)((0,k.createTemplateFactory)({id:"hwMiUKLt",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-summary-modal"],[4,[32,3],[[30,0,["subscribe"]],[30,1,["topic","id"]]],null],[4,[32,4],[[30,0,["subscribe"]],[30,1,["topic","id"]]],null],[4,[32,5],[[30,0,["unsubscribe"]]],null]],[["@title","@closeModal","@bodyClass","@hideFooter"],[[28,[32,1],["discourse_ai.summarization.topic.title"],null],[30,0,["handleClose"]],"ai-summary-modal__body",[28,[32,2],[[30,0,["summarizedOn"]]],null]]],[["body","footer"],[[[[1,"\\n        "],[1,[28,[32,6],["scrollable-modal"],null]],[1,"\\n        "],[11,0],[24,0,"ai-summary-container"],[4,[32,3],[[30,0,["generateSummary"]]],null],[12],[1,"\\n          "],[10,"article"],[15,0,[28,[32,7],["ai-summary-box","streamable-content",[52,[30,0,["smoothStreamer","isStreaming"]],"streaming"]],null]],[12],[1,"\\n"],[41,[30,0,["loading"]],[[[1,"              "],[8,[32,8],null,null,null],[1,"\\n"]],[]],[[[1,"              "],[10,0],[14,0,"generated-summary cooked"],[12],[1,"\\n                "],[8,[32,9],null,[["@rawText"],[[30,0,["smoothStreamer","renderedText"]]]],null],[1,"\\n              "],[13],[1,"\\n"]],[]]],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,2],[14,0,"summarized-on"],[12],[1,"\\n          "],[1,[28,[32,1],["summary.summarized_on"],[["date"],[[30,0,["summarizedOn"]]]]]],[1,"\\n          "],[8,[32,10],null,[["@placements"],[[28,[32,11],["top-end"],null]]],[["trigger","content"],[[[[1,"\\n              "],[1,[28,[32,12],["circle-info"],null]],[1,"\\n            "]],[]],[[[1,"\\n              "],[1,[28,[32,1],["summary.model_used"],[["model"],[[30,0,["summarizedBy"]]]]]],[1,"\\n            "]],[]]]]],[1,"\\n        "],[13],[1,"\\n"],[41,[30,0,["outdated"]],[[[1,"          "],[10,2],[14,0,"summary-outdated"],[12],[1,[30,0,["outdatedSummaryWarningText"]]],[13],[1,"\\n"]],[]],null],[41,[30,0,["canRegenerate"]],[[[1,"          "],[8,[32,13],null,[["@label","@title","@action","@icon"],["summary.buttons.regenerate","summary.buttons.regenerate",[30,0,["regenerateSummary"]],"arrows-rotate"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@model"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal.js",scope:()=>[p.default,y.i18n,d.not,n.default,a.default,r.default,g.default,m.default,w.default,u.default,v.default,i.array,h.default,c.default],isStrictMode:!0}),this))()}e.default=T})),define("discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"testResult",[s.tracked]))()
#oe=(()=>{dt7948.i(this,"testResult")})()
static#s=(()=>dt7948.g(this.prototype,"isLoading",[s.tracked],(function(){return!1})))()
#At=(()=>{dt7948.i(this,"isLoading")})()
parameterValues={}
updateParameter(e,t){this.parameterValues[e]=t.target.value}static#o=(()=>dt7948.n(this.prototype,"updateParameter",[n.action]))()
async runTest(){this.isLoading=!0
try{const e=await(0,l.ajax)(`/admin/plugins/discourse-ai/ai-tools/${this.args.model.tool.id}/test.json`,{type:"POST",data:JSON.stringify({ai_tool:this.args.model.tool,parameters:this.parameterValues}),contentType:"application/json"})
this.testResult=(0,c.jsonToHtml)(e.output)}catch(e){(0,d.popupAjaxError)(e)}finally{this.isLoading=!1}}static#a=(()=>dt7948.n(this.prototype,"runTest",[n.action]))()
static#l=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"LJMGtGI7",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-tool-test-modal"]],[["@title","@closeModal","@bodyClass"],[[28,[32,1],["discourse_ai.tools.test_modal.title"],null],[30,1],"ai-tool-test-modal__body"]],[["body","footer"],[[[[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,2,["tool","parameters"]]],null]],null],null,[[[1,"          "],[10,0],[14,0,"control-group"],[12],[1,"\\n            "],[10,"label"],[12],[1,[30,3,["name"]]],[13],[1,"\\n            "],[11,"input"],[16,3,[30,3,["name"]]],[24,4,"text"],[4,[32,2],["input",[28,[32,3],[[30,0,["updateParameter"]],[30,3,["name"]]],null]],null],[12],[13],[1,"\\n          "],[13],[1,"\\n"]],[3]],null],[1,"\\n"],[41,[30,0,["testResult"]],[[[1,"          "],[10,0],[14,0,"ai-tool-test-modal__test-result"],[12],[1,"\\n            "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.tools.test_modal.result"],null]],[13],[1,"\\n            "],[10,0],[12],[1,[30,0,["testResult"]]],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary ai-tool-test-modal__run-button"]],[["@action","@label","@disabled"],[[30,0,["runTest"]],"discourse_ai.tools.test_modal.run",[30,0,["isLoading"]]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@model","param"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/ai-tool-test-modal.js",scope:()=>[r.default,u.i18n,o.on,i.fn,a.default],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/conditional-loading-section","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","select-kit/components/combo-box","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"chatApi",[o.service]))()
#Ot=(()=>{dt7948.i(this,"chatApi")})()
static#s=(()=>dt7948.g(this.prototype,"sinceHours",[s.tracked],(function(){return null})))()
#Et=(()=>{dt7948.i(this,"sinceHours")})()
static#o=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#a=(()=>dt7948.g(this.prototype,"summary",[s.tracked],(function(){return null})))()
#Rt=(()=>{dt7948.i(this,"summary")})()
availableSummaries={}
sinceOptions=[1,3,6,12,24,72,168].map((e=>({name:(0,u.i18n)("discourse_ai.summarization.chat.since",{count:e}),value:e})))
get channelId(){return this.args.model.channelId}summarize(e){return this.sinceHours=e,this.loading=!0,this.availableSummaries[e]?(this.summary=this.availableSummaries[e],void(this.loading=!1)):(0,l.ajax)(`/discourse-ai/summarization/channels/${this.channelId}.json`,{type:"GET",data:{since:e}}).then((e=>{this.availableSummaries[this.sinceHours]=e.summary,this.summary=this.availableSummaries[this.sinceHours]})).catch(d.popupAjaxError).finally((()=>this.loading=!1))}static#l=(()=>dt7948.n(this.prototype,"summarize",[i.action]))()
static#u=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"ye9ZWC9O",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"chat-modal-channel-summary"]],[["@closeModal","@title"],[[30,1],[28,[32,1],["discourse_ai.summarization.chat.title"],null]]],[["body","footer"],[[[[1,"\\n        "],[10,1],[12],[1,[28,[32,1],["discourse_ai.summarization.chat.description"],null]],[13],[1,"\\n        "],[8,[32,2],[[24,0,"summarization-since"]],[["@value","@content","@onChange","@valueProperty"],[[30,0,["sinceHours"]],[30,0,["sinceOptions"]],[30,0,["summarize"]],"value"]],null],[1,"\\n        "],[8,[32,3],null,[["@isLoading"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n          "],[10,2],[14,0,"summary-area"],[12],[1,[30,0,["summary"]]],[13],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,4],null,[["@close"],[[30,1]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary.js",scope:()=>[a.default,u.i18n,c.default,n.default,r.default],isStrictMode:!0}),this))()}e.default=h}))
define("discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/runloop","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/later","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/utilities","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"info",[s.tracked],(function(){return null})))()
#It=(()=>{dt7948.i(this,"info")})()
static#s=(()=>dt7948.g(this.prototype,"justCopiedText",[s.tracked],(function(){return""})))()
#Ft=(()=>{dt7948.i(this,"justCopiedText")})()
static#o=(()=>dt7948.g(this.prototype,"activeTab",[s.tracked],(function(){return"request"})))()
#Dt=(()=>{dt7948.i(this,"activeTab")})()
constructor(){super(...arguments),(0,n.next)((()=>{this.loadApiRequestInfo()}))}get htmlContext(){if(!this.info)return""
let e
try{if("request"!==this.activeTab)return this.formattedResponse(this.info.raw_response_payload)
e=JSON.parse(this.info.raw_request_payload)}catch{return this.info.raw_request_payload}return(0,h.jsonToHtml)(e)}formattedResponse(e){const t=e.split("\n").map((e=>(0,p.escapeExpression)(e))).join("<br>")
return(0,a.htmlSafe)(t)}copyRequest(){this.copy(this.info.raw_request_payload)}static#a=(()=>dt7948.n(this.prototype,"copyRequest",[o.action]))()
copyResponse(){this.copy(this.info.raw_response_payload)}static#l=(()=>dt7948.n(this.prototype,"copyResponse",[o.action]))()
async loadLog(e){try{await(0,d.ajax)(`/discourse-ai/ai-bot/show-debug-info/${e}.json`).then((e=>{this.info=e}))}catch(t){(0,u.popupAjaxError)(t)}}prevLog(){this.loadLog(this.info.prev_log_id)}static#u=(()=>dt7948.n(this.prototype,"prevLog",[o.action]))()
nextLog(){this.loadLog(this.info.next_log_id)}static#p=(()=>dt7948.n(this.prototype,"nextLog",[o.action]))()
copy(e){(0,p.clipboardCopy)(e),this.justCopiedText=(0,m.i18n)("discourse_ai.ai_bot.conversation_shared"),(0,c.default)((()=>{this.justCopiedText=""}),2e3)}loadApiRequestInfo(){(0,d.ajax)(`/discourse-ai/ai-bot/post/${this.args.model.id}/show-debug-info.json`).then((e=>{this.info=e})).catch((e=>{(0,u.popupAjaxError)(e)}))}get requestActive(){return"request"===this.activeTab?"active":""}get responseActive(){return"response"===this.activeTab?"active":""}requestClicked(e){this.activeTab="request",e.preventDefault()}static#h=(()=>dt7948.n(this.prototype,"requestClicked",[o.action]))()
responseClicked(e){this.activeTab="response",e.preventDefault()}static#_=(()=>dt7948.n(this.prototype,"responseClicked",[o.action]))()
static#f=(()=>(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"/0GMjCML",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-debug-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,"ul"],[14,0,"nav nav-pills ai-debug-modal__nav"],[12],[1,"\\n          "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["requestActive"]]],[4,[32,2],["click",[30,0,["requestClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request"],null]],[13],[13],[1,"\\n          "],[10,"li"],[12],[11,3],[24,6,""],[16,0,[30,0,["responseActive"]]],[4,[32,2],["click",[30,0,["responseClicked"]]],null],[12],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response"],null]],[13],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"ai-debug-modal__tokens"],[12],[1,"\\n          "],[10,1],[14,0,"ai-debug-modal__tokens__count"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.request_tokens"],null]],[1,"\\n            "],[1,[30,0,["info","request_tokens"]]],[1,"\\n          "],[13],[1,"\\n          "],[10,1],[14,0,"ai-debug-modal__tokens__count"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.debug_ai_modal.response_tokens"],null]],[1,"\\n            "],[1,[30,0,["info","response_tokens"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"debug-ai-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyRequest"]],"discourse_ai.ai_bot.debug_ai_modal.copy_request"]],null],[1,"\\n        "],[8,[32,3],[[24,0,"btn confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyResponse"]],"discourse_ai.ai_bot.debug_ai_modal.copy_response"]],null],[1,"\\n"],[41,[30,0,["info","prev_log_id"]],[[[1,"          "],[8,[32,3],[[24,0,"btn"]],[["@icon","@action","@label"],["angles-left",[30,0,["prevLog"]],"discourse_ai.ai_bot.debug_ai_modal.previous_log"]],null],[1,"\\n"]],[]],null],[41,[30,0,["info","next_log_id"]],[[[1,"          "],[8,[32,3],[[24,0,"btn"]],[["@icon","@action","@label"],["angles-right",[30,0,["nextLog"]],"discourse_ai.ai_bot.debug_ai_modal.next_log"]],null],[1,"\\n"]],[]],null],[1,"        "],[10,1],[14,0,"ai-debut-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal.js",scope:()=>[l.default,m.i18n,i.on,r.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/modal/diff-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/will-destroy","@ember/service","@ember/template","truth-helpers","discourse/components/cook-text","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/concat-class","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/decorators","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/diff-streamer","discourse/plugins/discourse-ai/discourse/lib/smooth-streamer","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_,f,b,y,v,w,S){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const x="/discourse-ai/ai-helper/stream_composer_suggestion"
class k extends t.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[a.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#s=(()=>dt7948.g(this.prototype,"messageBus",[a.service]))()
#xe=(()=>{dt7948.i(this,"messageBus")})()
static#o=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#a=(()=>dt7948.g(this.prototype,"finalResult",[s.tracked],(function(){return""})))()
#Lt=(()=>{dt7948.i(this,"finalResult")})()
static#l=(()=>dt7948.g(this.prototype,"escapedSelectedText",[s.tracked],(function(){return(0,_.escapeExpression)(this.args.model.selectedText)})))()
#Nt=(()=>{dt7948.i(this,"escapedSelectedText")})()
static#u=(()=>dt7948.g(this.prototype,"diffStreamer",[s.tracked],(function(){return new b.default(this.args.model.selectedText)})))()
#Ut=(()=>{dt7948.i(this,"diffStreamer")})()
static#p=(()=>dt7948.g(this.prototype,"suggestion",[s.tracked],(function(){return""})))()
#je=(()=>{dt7948.i(this,"suggestion")})()
static#h=(()=>dt7948.g(this.prototype,"smoothStreamer",[s.tracked],(function(){return new y.default((()=>this.suggestion),(e=>this.suggestion=e))})))()
#Le=(()=>{dt7948.i(this,"smoothStreamer")})()
constructor(){super(...arguments),this.suggestChanges()}get diffResult(){return this.loading?this.escapedSelectedText:this.diffStreamer.diff?.length>0?this.diffStreamer.diff:this.escapedSelectedText}get smoothStreamerResult(){return this.loading?this.escapedSelectedText:this.smoothStreamer.renderedText}get isStreaming(){return this.args.model.showResultAsDiff?!this.diffStreamer.isDone:this.smoothStreamer.isStreaming}get primaryBtnLabel(){return this.loading?(0,f.i18n)("discourse_ai.ai_helper.context_menu.loading"):(0,f.i18n)("discourse_ai.ai_helper.context_menu.confirm")}get primaryBtnDisabled(){return this.loading||this.isStreaming}subscribe(){this.messageBus.subscribe(x,this.updateResult)}static#_=(()=>dt7948.n(this.prototype,"subscribe",[g.bind]))()
cleanup(){this.smoothStreamer.resetStreaming(),this.diffStreamer.reset(),this.messageBus.unsubscribe(x,this.updateResult)}static#f=(()=>dt7948.n(this.prototype,"cleanup",[g.bind]))()
updateResult(e){this.loading=!1,e.done&&(this.finalResult=e.result,this.loading=!1),this.args.model.showResultAsDiff?this.diffStreamer.updateResult(e,"result"):this.smoothStreamer.updateResult(e,"result")}static#b=(()=>dt7948.n(this.prototype,"updateResult",[i.action]))()
async suggestChanges(){this.smoothStreamer.resetStreaming(),this.diffStreamer.reset()
try{return this.loading=!0,await(0,m.ajax)("/discourse-ai/ai-helper/stream_suggestion",{method:"POST",data:{location:"composer",mode:this.args.model.mode,text:this.args.model.selectedText,custom_prompt:this.args.model.customPromptValue,force_default_locale:!0,client_id:this.messageBus.clientId}})}catch(e){(0,h.popupAjaxError)(e)}}static#y=(()=>dt7948.n(this.prototype,"suggestChanges",[i.action]))()
triggerConfirmChanges(){this.args.closeModal(),this.suggestion&&this.args.model.toolbarEvent.replaceText(this.args.model.selectedText,this.suggestion)
const e=this.finalResult?.length>0?this.finalResult:this.diffStreamer.suggestion
this.args.model.showResultAsDiff&&e&&this.args.model.toolbarEvent.replaceText(this.args.model.selectedText,e)}static#v=(()=>dt7948.n(this.prototype,"triggerConfirmChanges",[i.action]))()
static#w=(()=>(0,w.setComponentTemplate)((0,S.createTemplateFactory)({id:"QrFnaByD",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"composer-ai-helper-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.context_menu.changes"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[11,0],[24,0,"text-preview"],[4,[32,2],[[30,0,["subscribe"]]],null],[4,[32,3],[[30,0,["cleanup"]]],null],[12],[1,"\\n          "],[10,0],[15,0,[28,[32,4],["composer-ai-helper-modal__suggestion","streamable-content",[52,[30,0,["isStreaming"]],"streaming"],[52,[30,2,["showResultAsDiff"]],"inline-diff"],[52,[30,0,["diffStreamer","isThinking"]],"thinking"],[52,[30,0,["loading"]],"composer-ai-helper-modal__loading"]],null]],[12],[41,[30,2,["showResultAsDiff"]],[[[10,1],[14,0,"diff-inner"],[12],[1,[28,[32,5],[[30,0,["diffResult"]]],null]],[13],[1,"\\n"]],[]],[[[41,[28,[32,6],[[30,0,["loading"]],[30,0,["smoothStreamer","isStreaming"]]],null],[[[1,"                "],[8,[32,7],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamerResult"]]]],null],[1,"\\n"]],[]],[[[1,"                "],[10,0],[14,0,"composer-ai-helper-modal__old-value"],[12],[1,[30,0,["escapedSelectedText"]]],[13],[1,"\\n                "],[10,0],[14,0,"composer-ai-helper-modal__new-value"],[12],[1,"\\n                  "],[8,[32,7],[[24,0,"cooked"]],[["@rawText"],[[30,0,["smoothStreamerResult"]]]],null],[1,"\\n                "],[13],[1,"\\n"]],[]]]],[]]],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,8],[[24,0,"btn-primary confirm"]],[["@disabled","@action","@translatedLabel"],[[30,0,["primaryBtnDisabled"]],[30,0,["triggerConfirmChanges"]],[30,0,["primaryBtnLabel"]]]],[["default"],[[[[1,"\\n"],[41,[30,0,["loading"]],[[[1,"            "],[8,[32,9],null,[["@loading"],[[30,0,["loading"]]]],null],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n        "],[8,[32,8],[[24,0,"btn-flat discard"]],[["@action","@label"],[[30,1],"discourse_ai.ai_helper.context_menu.discard"]],null],[1,"\\n        "],[8,[32,8],[[24,0,"regenerate"]],[["@icon","@action","@label"],["arrows-rotate",[30,0,["suggestChanges"]],"discourse_ai.ai_helper.context_menu.regen"]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","@model"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/diff-modal.js",scope:()=>[c.default,f.i18n,o.default,n.default,p.default,r.htmlSafe,l.or,d.default,u.default,v.default],isStrictMode:!0}),this))()}e.default=k})),define("discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-url","discourse/lib/utilities","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"toasts",[n.service]))()
#Z=(()=>{dt7948.i(this,"toasts")})()
static#s=(()=>dt7948.g(this.prototype,"shareKey",[s.tracked],(function(){return""})))()
#qt=(()=>{dt7948.i(this,"shareKey")})()
constructor(){super(...arguments),this.shareKey=this.args.model.share_key}get htmlContext(){let e=[]
return this.args.model.context.forEach((t=>{e.push(`<p><b>${t.username}:</b></p>`),e.push(t.cooked)})),(0,a.htmlSafe)(e.join("\n"))}async generateShareURL(){try{const e=await(0,d.ajax)("/discourse-ai/ai-bot/shared-ai-conversations",{type:"POST",data:{topic_id:this.args.model.topic_id}}),t=(0,c.getAbsoluteURL)(`/discourse-ai/ai-bot/shared-ai-conversations/${e.share_key}`)
return this.shareKey=e.share_key,new Blob([t],{type:"text/plain"})}catch(e){return void(0,u.popupAjaxError)(e)}}get primaryLabel(){return this.shareKey?"discourse_ai.ai_bot.share_full_topic_modal.update":"discourse_ai.ai_bot.share_full_topic_modal.share"}async deleteLink(){try{await(0,d.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/${this.shareKey}.json`,{type:"DELETE"}),this.shareKey=null}catch(e){(0,u.popupAjaxError)(e)}}static#o=(()=>dt7948.n(this.prototype,"deleteLink",[o.action]))()
async share(){await(0,p.clipboardCopyAsync)(this.generateShareURL.bind(this)),this.toasts.success({duration:3e3,data:{message:(0,m.i18n)("discourse_ai.ai_bot.conversation_shared")}})}static#a=(()=>dt7948.n(this.prototype,"share",[o.action]))()
async maybeCopyEmbed(e){if(!e.target.classList.contains("copy-embed"))return!0
e.stopPropagation(),e.preventDefault()
let t=""
e.target.dataset.artifactVersion&&(t=`data-ai-artifact-version="${e.target.dataset.artifactVersion}"`)
const s=`<div class="ai-artifact" ${t} data-ai-artifact-id="${e.target.dataset.artifactId}"></div>`,i=new Promise((e=>{e(s)}))
await(0,p.clipboardCopyAsync)((()=>i)),this.toasts.success({duration:3e3,data:{message:(0,m.i18n)("discourse_ai.ai_bot.embed_copied")}})}static#l=(()=>dt7948.n(this.prototype,"maybeCopyEmbed",[o.action]))()
static#u=(()=>(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"usffRdOP",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-full-topic-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_full_topic_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n"],[1,"        "],[11,0],[24,0,"ai-share-full-topic-modal__body"],[4,[32,2],["click",[30,0,["maybeCopyEmbed"]]],null],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n"],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,3],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["share"]],[30,0,["primaryLabel"]]]],null],[1,"\\n"],[41,[30,0,["shareKey"]],[[[1,"          "],[8,[32,3],[[24,0,"btn-danger"]],[["@icon","@action","@label"],["far-trash-can",[30,0,["deleteLink"]],"discourse_ai.ai_bot.share_full_topic_modal.delete"]],null],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal.js",scope:()=>[l.default,m.i18n,i.on,r.default],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/components/modal/share-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/component","@ember/modifier","@ember/object","@ember/service","@ember/template","discourse/components/d-button","discourse/components/d-modal","discourse/lib/later","discourse-i18n","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"modal",[a.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
static#s=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#o=(()=>dt7948.g(this.prototype,"currentUser",[a.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#a=(()=>dt7948.g(this.prototype,"contextValue",[s.tracked],(function(){return 1})))()
#Bt=(()=>{dt7948.i(this,"contextValue")})()
static#l=(()=>dt7948.g(this.prototype,"htmlContext",[s.tracked],(function(){return""})))()
#zt=(()=>{dt7948.i(this,"htmlContext")})()
static#u=(()=>dt7948.g(this.prototype,"maxContext",[s.tracked],(function(){return 0})))()
#Ht=(()=>{dt7948.i(this,"maxContext")})()
static#p=(()=>dt7948.g(this.prototype,"allPosts",[s.tracked],(function(){return[]})))()
#$t=(()=>{dt7948.i(this,"allPosts")})()
static#h=(()=>dt7948.g(this.prototype,"justCopiedText",[s.tracked],(function(){return""})))()
#Ft=(()=>{dt7948.i(this,"justCopiedText")})()
constructor(){super(...arguments)
const e=this.args.model.topic.get("postStream")
let t=[]
for(let s=1;s<=this.args.model.post_number;s++)t.push(s)
this.allPosts=t.map((t=>{let s=e.findPostIdForPostNumber(t)
if(s)return e.findLoadedPost(s)})).filter((e=>e)),this.maxContext=this.allPosts.length/2,this.contextValue=1,this.updateHtmlContext()}updateHtmlContext(){let e=[]
for(let t=this.allPosts.length-2*this.contextValue;t<this.allPosts.length;t++){const s=this.allPosts[t]
e.push(`<p><b>${s.username}:</b></p>`),e.push(s.cooked)}this.htmlContext=(0,r.htmlSafe)(e.join("\n"))}static#_=(()=>dt7948.n(this.prototype,"updateHtmlContext",[n.action]))()
async copyContext(){const e=this.allPosts[this.allPosts.length-2*this.contextValue].post_number,t=this.args.model.post_number
await(0,m.default)(this.args.model.topic,e,t),this.justCopiedText=(0,c.i18n)("discourse_ai.ai_bot.conversation_shared"),(0,u.default)((()=>{this.justCopiedText=""}),2e3)}static#f=(()=>dt7948.n(this.prototype,"copyContext",[n.action]))()
shareConversationModal(e){return e?.preventDefault(),this.args.closeModal(),(0,p.showShareConversationModal)(this.modal,this.args.model.topic_id),!1}static#b=(()=>dt7948.n(this.prototype,"shareConversationModal",[n.action]))()
static#y=(()=>(0,i.setComponentTemplate)((0,h.createTemplateFactory)({id:"Ccsc9yzh",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"ai-share-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_bot.share_modal.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__preview"],[12],[1,"\\n          "],[1,[30,0,["htmlContext"]]],[1,"\\n        "],[13],[1,"\\n      "]],[]],[[[1,"\\n        "],[10,0],[14,0,"ai-share-modal__slider"],[12],[1,"\\n          "],[8,[32,2],[[24,"min","1"],[16,"max",[30,0,["maxContext"]]],[4,[32,3],["change",[30,0,["updateHtmlContext"]]],null]],[["@type","@value"],["range",[30,0,["contextValue"]]]],null],[1,"\\n          "],[10,0],[14,0,"ai-share-modal__context"],[12],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.context"],null]],[1,"\\n            "],[1,[30,0,["contextValue"]]],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary confirm"]],[["@icon","@action","@label"],["copy",[30,0,["copyContext"]],"discourse_ai.ai_bot.share_modal.copy"]],null],[1,"\\n        "],[10,1],[14,0,"ai-share-modal__just-copied"],[12],[1,[30,0,["justCopiedText"]]],[13],[1,"\\n"],[41,[30,0,["currentUser","can_share_ai_bot_conversations"]],[[[1,"          "],[11,3],[24,6,""],[4,[32,3],["click",[30,0,["shareConversationModal"]]],null],[12],[1,"\\n            "],[10,1],[14,0,"ai-share-modal__share-tip"],[12],[1,"\\n              "],[1,[28,[32,1],["discourse_ai.ai_bot.share_modal.share_tip"],null]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/share-modal.js",scope:()=>[d.default,c.i18n,i.Input,o.on,l.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/d-modal","discourse/helpers/with-event-value","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-indicator-wave","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"testResult",[s.tracked]))()
#oe=(()=>{dt7948.i(this,"testResult")})()
static#s=(()=>dt7948.g(this.prototype,"isLoading",[s.tracked],(function(){return!1})))()
#At=(()=>{dt7948.i(this,"isLoading")})()
static#o=(()=>dt7948.g(this.prototype,"postUrl",[s.tracked],(function(){return""})))()
#Vt=(()=>{dt7948.i(this,"postUrl")})()
static#a=(()=>dt7948.g(this.prototype,"scanLog",[s.tracked],(function(){return""})))()
#Gt=(()=>{dt7948.i(this,"scanLog")})()
static#l=(()=>dt7948.g(this.prototype,"isSpam",[s.tracked]))()
#Yt=(()=>{dt7948.i(this,"isSpam")})()
async runTest(){this.isLoading=!0
try{const e=await(0,d.ajax)("/admin/plugins/discourse-ai/ai-spam/test.json",{type:"POST",data:{post_url:this.postUrl,custom_instructions:this.args.model.customInstructions,llm_id:this.args.model.llmId}})
this.isSpam=e.is_spam,this.testResult=e.is_spam?(0,c.i18n)("discourse_ai.spam.test_modal.spam"):(0,c.i18n)("discourse_ai.spam.test_modal.not_spam"),this.scanLog=e.log}catch(e){(0,u.popupAjaxError)(e)}finally{this.isLoading=!1}}static#u=(()=>dt7948.n(this.prototype,"runTest",[n.action]))()
static#p=(()=>(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"34+xPAxG",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"spam-test-modal"]],[["@title","@closeModal","@bodyClass"],[[28,[32,1],["discourse_ai.spam.test_modal.title"],null],[30,1],"spam-test-modal__body"]],[["body","footer"],[[[[1,"\\n        "],[10,0],[14,0,"control-group"],[12],[1,"\\n          "],[10,"label"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.post_url_label"],null]],[13],[1,"\\n          "],[11,"input"],[16,"placeholder",[28,[32,1],["discourse_ai.spam.test_modal.post_url_placeholder"],null]],[24,4,"text"],[4,[32,2],["input",[28,[32,3],[[28,[32,4],[[28,[31,0],[[30,0,["postUrl"]]],null]],null]],null]],null],[12],[13],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,0,["testResult"]],[[[1,"          "],[10,0],[14,0,"spam-test-modal__test-result"],[12],[1,"\\n            "],[10,"h3"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.result"],null]],[13],[1,"\\n            "],[10,0],[15,0,[29,["spam-test-modal__verdict\\n                ",[52,[30,0,["isSpam"]],"is-spam","not-spam"]]]],[12],[1,"\\n              "],[1,[30,0,["testResult"]]],[1,"\\n            "],[13],[1,"\\n"],[41,[30,0,["scanLog"]],[[[1,"              "],[10,0],[14,0,"spam-test-modal__log"],[12],[1,"\\n                "],[10,"h4"],[12],[1,[28,[32,1],["discourse_ai.spam.test_modal.scan_log"],null]],[13],[1,"\\n                "],[10,"pre"],[12],[1,[30,0,["scanLog"]]],[13],[1,"\\n              "],[13],[1,"\\n"]],[]],null],[1,"          "],[13],[1,"\\n"]],[]],null],[1,"      "]],[]],[[[1,"\\n        "],[8,[32,5],[[24,0,"btn-primary spam-test-modal__run-button"]],[["@action","@label","@disabled"],[[30,0,["runTest"]],"discourse_ai.spam.test_modal.run",[30,0,["isLoading"]]]],[["default"],[[[[1,"\\n          "],[8,[32,6],null,[["@loading"],[[30,0,["isLoading"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal"],false,["mut","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/spam-test-modal.js",scope:()=>[r.default,c.i18n,o.on,l.default,i.fn,a.default,p.default],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-modal","discourse/components/d-modal-cancel","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class h extends t.default{static#e=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#s=(()=>dt7948.g(this.prototype,"selectedImages",[s.tracked],(function(){return[]})))()
#Wt=(()=>{dt7948.i(this,"selectedImages")})()
static#o=(()=>dt7948.g(this.prototype,"thumbnails",[s.tracked],(function(){return null})))()
#Kt=(()=>{dt7948.i(this,"thumbnails")})()
constructor(){super(...arguments),this.findThumbnails()}get isDisabled(){return 0===this.selectedImages.length}async findThumbnails(){this.loading=!0
try{const e=await(0,l.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.args.model.mode,text:this.args.model.selectedText,force_default_locale:!0}})
this.thumbnails=e.thumbnails}catch(e){(0,d.popupAjaxError)(e)}finally{this.loading=!1}}addSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=[...this.selectedImages,t]}static#a=(()=>dt7948.n(this.prototype,"addSelection",[i.action]))()
removeSelection(e){const t=`![${e.original_filename}|${e.width}x${e.height}](${e.short_url})`
this.selectedImages=this.selectedImages.filter((e=>{if(e!==t)return e}))}static#l=(()=>dt7948.n(this.prototype,"removeSelection",[i.action]))()
appendSelectedImages(){const e="\n\n"+this.selectedImages.join("\n"),t=document.querySelector(".d-editor-input")
t.setSelectionRange(t.value.length,t.value.length),t.focus(),document.execCommand("insertText",!1,e),this.args.closeModal()}static#u=(()=>dt7948.n(this.prototype,"appendSelectedImages",[i.action]))()
static#p=(()=>(0,p.setComponentTemplate)((0,m.createTemplateFactory)({id:"NK1Pg0q5",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"thumbnail-suggestions-modal"]],[["@title","@closeModal"],[[28,[32,1],["discourse_ai.ai_helper.thumbnail_suggestions.title"],null],[30,1]]],[["body","footer"],[[[[1,"\\n        "],[8,[32,2],null,[["@condition"],[[30,0,["loading"]]]],[["default"],[[[[1,"\\n          "],[10,0],[14,0,"ai-thumbnail-suggestions"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["thumbnails"]]],null]],null],null,[[[1,"              "],[8,[32,3],null,[["@thumbnail","@addSelection","@removeSelection"],[[30,2],[30,0,["addSelection"]],[30,0,["removeSelection"]]]],null],[1,"\\n"]],[2]],null],[1,"          "],[13],[1,"\\n        "]],[]]]]],[1,"\\n      "]],[]],[[[1,"\\n        "],[8,[32,4],[[24,0,"btn-primary create"]],[["@action","@label","@disabled"],[[30,0,["appendSelectedImages"]],"save",[30,0,["isDisabled"]]]],null],[1,"\\n        "],[8,[32,5],null,[["@close"],[[30,1]]],null],[1,"\\n      "]],[]]]]],[1,"\\n  "]],["@closeModal","thumbnail"],false,["each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/modal/thumbnail-suggestions.js",scope:()=>[a.default,u.i18n,o.default,c.default,n.default,r.default],isStrictMode:!0}),this))()}e.default=h})),define("discourse/plugins/discourse-ai/discourse/components/model-accuracies",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=(0,i.createTemplateFactory)({id:"ik7ZG6Vr",block:'[[[41,[30,1],[[[1,"  "],[10,"table"],[14,0,"reviewable-scores"],[12],[1,"\\n    "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[37,4],[[30,1]],null],null,[[[1,"        "],[10,"tr"],[12],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[35,7],["discourse_ai.reviewables.model_used"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,3]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","4"],[12],[1,[28,[35,7],["discourse_ai.reviewables.accuracy"],null]],[13],[1,"\\n          "],[10,"td"],[14,"colspan","3"],[12],[1,[30,2]],[1,"%"],[13],[1,"\\n        "],[13],[1,"\\n"]],[2,3]],null],[1,"    "],[13],[1,"\\n  "],[13],[1,"\\n"]],[]],null]],["@accuracies","acc","model"],false,["if","table","tbody","each","-each-in","tr","td","i18n"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/model-accuracies.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(o,(0,s.default)(void 0,"model-accuracies"))})),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button",["exports","@glimmer/component","@ember/object","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{async cancelStreaming(){const e=this.args.post
try{await(0,o.ajax)(`/discourse-ai/ai-bot/post/${e.id}/stop-streaming`,{type:"POST"}),document.querySelector(`#post_${e.post_number}`).classList.remove("streaming")}catch(t){(0,n.popupAjaxError)(t)}}static#e=(()=>dt7948.n(this.prototype,"cancelStreaming",[s.action]))()
static#s=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"eS4Xq4iv",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__ai-cancel-streaming cancel-streaming"],[17,1]],[["@action","@icon","@title"],[[30,0,["cancelStreaming"]],"pause","discourse_ai.ai_bot.cancel_streaming"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/components/modal/debug-ai-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static shouldRender(e){return(0,n.isPostFromAiBot)(e.post,e.state.currentUser)}static#e=(()=>dt7948.g(this.prototype,"modal",[i.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
debugAiResponse(){this.modal.show(a.default,{model:this.args.post})}static#s=(()=>dt7948.n(this.prototype,"debugAiResponse",[s.action]))()
static#o=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"a7gp58E/",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__debug-ai"],[17,1]],[["@action","@icon","@title"],[[30,0,["debugAiResponse"]],"info","discourse_ai.ai_bot.debug_ai"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/copy-conversation","discourse/plugins/discourse-ai/discourse/components/modal/share-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e){return(0,n.isPostFromAiBot)(e.post,e.state.currentUser)}static#e=(()=>dt7948.g(this.prototype,"modal",[i.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
async shareAiResponse(){const e=this.args.post
e.post_number<=4?(await(0,a.default)(e.topic,1,e.post_number),this.args.showFeedback("discourse_ai.ai_bot.conversation_shared")):this.modal.show(r.default,{model:e})}static#s=(()=>dt7948.n(this.prototype,"shareAiResponse",[s.action]))()
static#o=(()=>(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"GGDSzGUM",block:'[[[1,"\\n    "],[8,[32,0],[[24,0,"post-action-menu__share-ai"],[17,1]],[["@action","@icon","@title"],[[30,0,["shareAiResponse"]],"far-copy","discourse_ai.ai_bot.share"]],null],[1,"\\n  "]],["&attrs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=u})),define("discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e){return(0,s.isGPTBot)(e.post.user)}static#e=(()=>(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"g/xynBPl",block:'[[[1,"\\n    "],[10,1],[14,0,"persona-flair"],[12],[1,"\\n      "],[1,[30,1,["post","topic","ai_persona_name"]]],[1,"\\n    "],[13],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair.js",isStrictMode:!0}),this))()}e.default=n})),define("discourse/plugins/discourse-ai/discourse/components/rag-options-fk",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-llm-selector","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static#e=(()=>dt7948.g(this.prototype,"showIndexingOptions",[s.tracked],(function(){return!1})))()
#Jt=(()=>{dt7948.i(this,"showIndexingOptions")})()
toggleIndexingOptions(e){this.showIndexingOptions=!this.showIndexingOptions,e.preventDefault(),e.stopPropagation()}static#s=(()=>dt7948.n(this.prototype,"toggleIndexingOptions",[o.action]))()
get indexingOptionsText(){return this.showIndexingOptions?(0,n.i18n)("discourse_ai.rag.options.hide_indexing_options"):(0,n.i18n)("discourse_ai.rag.options.show_indexing_options")}get visionLlms(){return this.args.llms.filter((e=>e.vision_enabled))}static#o=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"aJfOKu/I",block:'[[[1,"\\n"],[41,[30,1,["rag_uploads"]],[[[1,"      "],[11,3],[24,6,"#"],[24,0,"rag-options__indexing-options"],[4,[32,0],["click",[30,0,["toggleIndexingOptions"]]],null],[12],[1,[30,0,["indexingOptionsText"]]],[13],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showIndexingOptions"]],[[[1,"      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_chunk_tokens",[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens"],null],[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,3,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[3]]]]],[1,"\\n\\n      "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_chunk_overlap_tokens",[28,[32,1],["discourse_ai.rag.options.rag_chunk_tokens"],null],[28,[32,1],["discourse_ai.rag.options.rag_chunk_overlap_tokens_help"],null],"large"]],[["default"],[[[[1,"\\n        "],[8,[30,4,["Input"]],[[24,"step","any"],[24,"lang","en"]],[["@type"],["number"]],null],[1,"\\n      "]],[4]]]]],[1,"\\n\\n"],[41,[30,5],[[[1,"        "],[8,[30,2,["Field"]],null,[["@name","@title","@tooltip","@format"],["rag_llm_model_id",[28,[32,1],["discourse_ai.rag.options.rag_llm_model"],null],[28,[32,1],["discourse_ai.rag.options.rag_llm_model_help"],null],"large"]],[["default"],[[[[1,"\\n          "],[8,[30,6,["Custom"]],null,null,[["default"],[[[[1,"\\n            "],[8,[32,2],null,[["@value","@llms","@onChange","@class"],[[30,6,["value"]],[30,0,["visionLlms"]],[30,6,["set"]],"ai-persona-editor__llms"]],null],[1,"\\n          "]],[]]]]],[1,"\\n        "]],[6]]]]],[1,"\\n"]],[]],null],[1,"      "],[18,7,null],[1,"\\n"]],[]],null],[1,"  "]],["@data","@form","field","field","@allowImages","field","&default"],false,["if","yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-options-fk.js",scope:()=>[i.on,n.i18n,a.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/components/rag-upload-progress",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/helpers/d-icon","discourse/lib/decorators","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static#e=(()=>dt7948.g(this.prototype,"messageBus",[n.service]))()
#xe=(()=>{dt7948.i(this,"messageBus")})()
static#s=(()=>dt7948.g(this.prototype,"updatedProgress",[s.tracked],(function(){return null})))()
#Qt=(()=>{dt7948.i(this,"updatedProgress")})()
willDestroy(){super.willDestroy(...arguments),this.messageBus.unsubscribe(`/discourse-ai/rag/${this.args.upload.id}`)}trackProgress(){this.messageBus.subscribe(`/discourse-ai/rag/${this.args.upload.id}`,this.onIndexingUpdate)}static#o=(()=>dt7948.n(this.prototype,"trackProgress",[i.action]))()
onIndexingUpdate(e){(!this.updatedProgress||0===this.updatedProgress.left||this.updatedProgress.left>e.left||e.total===e.indexed)&&(this.updatedProgress=e)}static#a=(()=>dt7948.n(this.prototype,"onIndexingUpdate",[r.bind]))()
get calculateProgress(){return 0===this.progress.total?0:Math.ceil(100*this.progress.indexed/this.progress.total)}get fullyIndexed(){return this.progress&&0!==this.progress.total&&0===this.progress.left}get progress(){return this.updatedProgress?this.updatedProgress:this.args.ragIndexingStatuses?this.args.ragIndexingStatuses[this.args.upload.id]:[]}static#l=(()=>(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"AyWODt7W",block:'[[[1,"\\n    "],[11,"td"],[24,0,"rag-uploader__upload-status"],[4,[32,0],[[30,0,["trackProgress"]]],null],[12],[1,"\\n"],[41,[30,0,["progress"]],[[[41,[30,0,["fullyIndexed"]],[[[1,"          "],[10,1],[14,0,"indexed"],[12],[1,"\\n            "],[1,[28,[32,1],["check"],null]],[1,"\\n            "],[1,[28,[32,2],["discourse_ai.rag.uploads.indexed"],null]],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,1],[14,0,"indexing"],[12],[1,"\\n            "],[1,[28,[32,1],["robot"],null]],[1,"\\n            "],[1,[28,[32,2],["discourse_ai.rag.uploads.indexing"],null]],[1,"\\n            "],[1,[30,0,["calculateProgress"]]],[1,"%\\n          "],[13],[1,"\\n"]],[]]]],[]],[[[1,"        "],[10,1],[14,0,"uploaded"],[12],[1,[28,[32,2],["discourse_ai.rag.uploads.uploaded"],null]],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-upload-progress.js",scope:()=>[o.default,a.default,l.i18n],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/components/rag-uploader",["exports","@glimmer/tracking","@ember/component","@ember/helper","@ember/modifier","@ember/object","@ember/owner","@ember/render-modifiers/modifiers/did-insert","@ember/service","discourse/components/d-button","discourse/helpers/d-icon","discourse/lib/ajax","discourse/lib/debounce","discourse/lib/uppy/uppy-upload","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/rag-upload-progress","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends s.default{static#e=(()=>dt7948.g(this.prototype,"appEvents",[l.service]))()
#H=(()=>{dt7948.i(this,"appEvents")})()
static#s=(()=>dt7948.g(this.prototype,"term",[t.tracked],(function(){return null})))()
#Zt=(()=>{dt7948.i(this,"term")})()
static#o=(()=>dt7948.g(this.prototype,"filteredUploads",[t.tracked],(function(){return null})))()
#Xt=(()=>{dt7948.i(this,"filteredUploads")})()
static#a=(()=>dt7948.g(this.prototype,"ragIndexingStatuses",[t.tracked],(function(){return null})))()
#es=(()=>{dt7948.i(this,"ragIndexingStatuses")})()
static#l=(()=>dt7948.g(this.prototype,"ragUploads",[t.tracked],(function(){return null})))()
#ts=(()=>{dt7948.i(this,"ragUploads")})()
uppyUpload=(()=>new m.default((0,a.getOwner)(this),{id:"discourse-ai-rag-uploader",maxFiles:20,type:"discourse_ai_rag_upload",uploadUrl:"/admin/plugins/discourse-ai/rag-document-fragments/files/upload",preventDirectS3Uploads:!0,uploadDone:e=>{const t=e.upload
t.status="uploaded",t.statusText=(0,h.i18n)("discourse_ai.rag.uploads.uploaded"),this.ragUploads.pushObject(t),this.debouncedSearch()}}))()
willDestroy(){super.willDestroy(...arguments),this.appEvents.off(`upload-mixin:${this.uppyUpload.config}:all-uploads-complete`,this,"_updateTargetWithUploads")}didReceiveAttrs(){super.didReceiveAttrs(...arguments),this.uppyUpload.inProgressUploads?.length>0&&this.uppyUpload.cancelAllUploads(),this.ragUploads=this.target?.rag_uploads?.slice()||[],this.filteredUploads=this.ragUploads
const e=this.targetName||this.target?.constructor?.name
this.ragUploads?.length&&this.target?.id&&(0,c.ajax)(`/admin/plugins/discourse-ai/rag-document-fragments/files/status.json?target_type=${e}&target_id=${this.target.id}`).then((e=>{this.set("ragIndexingStatuses",e)})),this.appEvents.on(`upload-mixin:${this.uppyUpload.config.id}:all-uploads-complete`,this,"_updateTargetWithUploads")}_updateTargetWithUploads(){this.updateUploads(this.ragUploads)}get acceptedFileTypes(){return this.args?.allowImages?".txt,.md,.png,.jpg,.jpeg":".txt,.md,.pdf"}submitFiles(){this.uppyUpload.openPicker()}static#u=(()=>dt7948.n(this.prototype,"submitFiles",[n.action]))()
cancelUploading(e){this.uppyUpload.cancelSingleUpload({fileId:e.id})}static#p=(()=>dt7948.n(this.prototype,"cancelUploading",[n.action]))()
search(){this.term?this.filteredUploads=this.ragUploads.filter((e=>e.original_filename.toUpperCase().indexOf(this.term.toUpperCase())>-1)):this.filteredUploads=this.ragUploads}static#h=(()=>dt7948.n(this.prototype,"search",[n.action]))()
debouncedSearch(){(0,p.default)(this,this.search,100)}static#_=(()=>dt7948.n(this.prototype,"debouncedSearch",[n.action]))()
removeUpload(e){this.ragUploads.removeObject(e),this.onRemove(e),this.debouncedSearch()}static#f=(()=>dt7948.n(this.prototype,"removeUpload",[n.action]))()
static#b=(()=>(0,s.setComponentTemplate)((0,_.createTemplateFactory)({id:"XwEOHoWK",block:'[[[1,"\\n    "],[10,0],[14,0,"rag-uploader"],[12],[1,"\\n"],[41,[30,1],[[[1,"        "],[10,2],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.description_with_images"],null]],[13],[1,"\\n"]],[]],[[[1,"        "],[10,2],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.description"],null]],[13],[1,"\\n"]],[]]],[1,"\\n"],[41,[30,0,["ragUploads"]],[[[1,"        "],[10,0],[14,0,"rag-uploader__search-input-container"],[12],[1,"\\n          "],[10,0],[14,0,"rag-uploader__search-input"],[12],[1,"\\n            "],[1,[28,[32,1],["magnifying-glass"],[["class"],["rag-uploader__search-input__search-icon"]]]],[1,"\\n            "],[8,[32,2],[[24,0,"rag-uploader__search-input__input"],[16,"placeholder",[28,[32,0],["discourse_ai.rag.uploads.filter"],null]],[4,[32,3],["keyup",[30,0,["debouncedSearch"]]],null]],[["@value"],[[30,0,["term"]]]],null],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[10,"table"],[14,0,"rag-uploader__uploads-list"],[12],[1,"\\n        "],[10,"tbody"],[12],[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["filteredUploads"]]],null]],null],null,[[[1,"            "],[10,"tr"],[12],[1,"\\n              "],[10,"td"],[12],[1,"\\n                "],[10,1],[14,0,"rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n                "],[1,[30,2,["original_filename"]]],[1,"\\n              "],[13],[1,"\\n              "],[8,[32,4],null,[["@upload","@ragIndexingStatuses"],[[30,2],[30,0,["ragIndexingStatuses"]]]],null],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__remove-file"],[12],[1,"\\n                "],[8,[32,5],[[24,0,"btn-flat"]],[["@icon","@title","@action"],["xmark","discourse_ai.rag.uploads.remove",[28,[32,6],[[30,0,["removeUpload"]],[30,2]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[2]],null],[42,[28,[31,2],[[28,[31,2],[[30,0,["uppyUpload","inProgressUploads"]]],null]],null],null,[[[1,"            "],[10,"tr"],[12],[1,"\\n              "],[10,"td"],[12],[10,1],[14,0,"rag-uploader__rag-file-icon"],[12],[1,[28,[32,1],["file"],null]],[13],[1,"\\n                "],[1,[30,3,["original_filename"]]],[13],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__upload-status"],[12],[1,"\\n                "],[10,0],[14,0,"spinner small"],[12],[13],[1,"\\n                "],[10,1],[12],[1,[28,[32,0],["discourse_ai.rag.uploads.uploading"],null]],[1,"\\n                  "],[1,[30,3,["uploadProgress"]]],[1,"%"],[13],[1,"\\n              "],[13],[1,"\\n              "],[10,"td"],[14,0,"rag-uploader__remove-file"],[12],[1,"\\n                "],[8,[32,5],[[24,0,"btn-flat"]],[["@icon","@title","@action"],["xmark","discourse_ai.rag.uploads.remove",[28,[32,6],[[30,0,["cancelUploading"]],[30,3]],null]]],null],[1,"\\n              "],[13],[1,"\\n            "],[13],[1,"\\n"]],[3]],null],[1,"        "],[13],[1,"\\n      "],[13],[1,"\\n\\n      "],[11,"input"],[24,0,"hidden-upload-field"],[16,"disabled",[30,0,["uploading"]]],[24,"multiple","multiple"],[16,"accept",[30,0,["acceptedFileTypes"]]],[24,4,"file"],[4,[32,7],[[30,0,["uppyUpload","setup"]]],null],[12],[13],[1,"\\n      "],[8,[32,5],[[24,0,"btn-default"]],[["@label","@icon","@title","@action"],["discourse_ai.rag.uploads.button","plus","discourse_ai.rag.uploads.button",[30,0,["submitFiles"]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@allowImages","upload","upload"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/rag-uploader.js",scope:()=>[h.i18n,u.default,s.Input,o.on,g.default,d.default,i.fn,r.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message",["exports","@ember/component","@glimmer/component","discourse/plugins/chat/discourse/models/chat-channel","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const n=(0,o.createTemplateFactory)({id:"JlFBNZVw",block:'[[[41,[30,0,["chatChannel"]],[[[1,"  "],[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n    "],[8,[39,2],null,[["@route","@models"],["chat.channel.near-message",[28,[37,3],[[30,0,["chatChannel","slugifiedTitle"]],[30,0,["chatChannel","id"]],[30,1,["target_id"]]],null]]],[["default"],[[[[1,"\\n      "],[8,[39,4],null,[["@channel"],[[30,0,["chatChannel"]]]],null],[1,"\\n    "]],[]]]]],[1,"\\n  "],[13],[1,"\\n"]],[]],null],[1,"\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[39,5],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[39,6],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n      "],[1,[28,[35,7],[[28,[37,8],[[30,1,["payload","message_cooked"]],[30,1,["cooked"]]],null]],null]],[1,"\\n    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[39,10],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],false,["if","div","link-to","array","chat-channel-title","reviewable-created-by","reviewable-post-header","html-safe","or","yield","model-accuracies"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/reviewable-ai-chat-message.hbs",isStrictMode:!1})
class a extends s.default{get chatChannel(){if(this.args.reviewable.chat_channel)return i.default.create(this.args.reviewable.chat_channel)}}e.default=a,(0,t.setComponentTemplate)(n,a)})),define("discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post",["exports","@ember/component","@ember/component/template-only","@ember/template-factory"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const o=(0,i.createTemplateFactory)({id:"Cs7KWxKV",block:'[[[10,0],[14,0,"flagged-post-header"],[12],[1,"\\n  "],[8,[39,1],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n  "],[8,[39,2],null,[["@reviewable","@tagName"],[[30,1],""]],null],[1,"\\n"],[13],[1,"\\n\\n"],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n  "],[8,[39,3],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n  "],[10,0],[14,0,"post-contents"],[12],[1,"\\n    "],[8,[39,4],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n    "],[10,0],[14,0,"post-body"],[12],[1,"\\n"],[41,[30,1,["blank_post"]],[[[1,"        "],[10,2],[12],[1,[28,[35,7],["review.deleted_post"],null]],[13],[1,"\\n"]],[]],[[[1,"        "],[1,[28,[35,8],[[30,1,["cooked"]]],null]],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n\\n    "],[18,2,null],[1,"\\n\\n    "],[8,[39,10],null,[["@accuracies"],[[30,1,["payload","accuracies"]]]],null],[1,"\\n  "],[13],[1,"\\n"],[13]],["@reviewable","&default"],false,["div","reviewable-topic-link","reviewable-post-edits","reviewable-created-by","reviewable-post-header","if","p","i18n","html-safe","yield","model-accuracies"]]',moduleName:"discourse/plugins/discourse-ai/discourse/components/reviewable-ai-post.hbs",isStrictMode:!1})
e.default=(0,t.setComponentTemplate)(o,(0,s.default)(void 0,"reviewable-ai-post"))})),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/category-badge","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#s=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#o=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return null})))()
#ut=(()=>{dt7948.i(this,"suggestions")})()
static#a=(()=>dt7948.g(this.prototype,"untriggers",[s.tracked],(function(){return[]})))()
#ss=(()=>{dt7948.i(this,"untriggers")})()
static#l=(()=>dt7948.g(this.prototype,"triggerIcon",[s.tracked],(function(){return"discourse-sparkles"})))()
#is=(()=>{dt7948.i(this,"triggerIcon")})()
static#u=(()=>dt7948.g(this.prototype,"content",[s.tracked],(function(){return null})))()
#os=(()=>{dt7948.i(this,"content")})()
get showSuggestionButton(){const e=document.querySelector(".composer-fields")
this.content=this.args.composer?.reply
const t=this.content?.length>h.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return e&&(t?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),this.siteSettings.ai_embeddings_enabled&&t}async loadSuggestions(){if(this.suggestions&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{assistant:t}=await(0,u.ajax)("/discourse-ai/ai-helper/suggest_category",{method:"POST",data:e})
this.suggestions=t}catch(t){(0,c.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static#p=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
applySuggestion(e){const t=this.args.composer,s=this.args.buffered
return t&&(t.set("categoryId",e.id),t.get("categoryId")),s&&this.args.buffered.set("category_id",e.id),this.dMenu.close()}static#h=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
onRegisterApi(e){this.dMenu=e}static#_=(()=>dt7948.n(this.prototype,"onRegisterApi",[n.action]))()
onClose(){this.triggerIcon="discourse-sparkles"}static#f=(()=>dt7948.n(this.prototype,"onClose",[n.action]))()
static#b=(()=>(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"ckFiQc91",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-category-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-category-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[24,0,"category-row"],[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,3]],[16,"title",[30,2,["name"]]]],[["@action"],[[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[10,0],[14,0,"category-status"],[12],[1,"\\n                      "],[1,[28,[32,6],[[30,2]],null]],[1,"\\n                      "],[10,1],[14,0,"topic-count"],[12],[1,"x\\n                        "],[1,[30,2,["topicCount"]]],[13],[1,"\\n                    "],[13],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester.js",scope:()=>[m.default,p.i18n,o.on,l.default,r.default,i.fn,d.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","@ember/service","discourse/components/d-button","discourse/components/dropdown-menu","discourse/helpers/discourse-tag","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g,_){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class f extends t.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[a.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#s=(()=>dt7948.g(this.prototype,"toasts",[a.service]))()
#Z=(()=>{dt7948.i(this,"toasts")})()
static#o=(()=>dt7948.g(this.prototype,"composer",[a.service]))()
#$=(()=>{dt7948.i(this,"composer")})()
static#a=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#l=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return null})))()
#ut=(()=>{dt7948.i(this,"suggestions")})()
static#u=(()=>dt7948.g(this.prototype,"untriggers",[s.tracked],(function(){return[]})))()
#ss=(()=>{dt7948.i(this,"untriggers")})()
static#p=(()=>dt7948.g(this.prototype,"triggerIcon",[s.tracked],(function(){return"discourse-sparkles"})))()
#is=(()=>{dt7948.i(this,"triggerIcon")})()
static#h=(()=>dt7948.g(this.prototype,"content",[s.tracked],(function(){return null})))()
#os=(()=>{dt7948.i(this,"content")})()
get showSuggestionButton(){if(this.composer.disableTagsChooser)return!1
const e=document.querySelector(".composer-fields")
this.content=this.args.composer?.reply
const t=this.content?.length>h.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return e&&(t?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),this.siteSettings.ai_embeddings_enabled&&t}get showDropdown(){return this.suggestions?.length<=0&&this.dMenu.close(),!this.loading&&this.suggestions?.length>0}async loadSuggestions(){if(this.suggestions&&this.suggestions?.length>0&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{assistant:t}=await(0,u.ajax)("/discourse-ai/ai-helper/suggest_tags",{method:"POST",data:e})
this.suggestions=t
const s=this.args.composer?this.args.composer:this.args.buffered
if(this.#ns()&&(this.suggestions=this.suggestions.filter((e=>!s.get("tags").includes(e.name)))),this.suggestions?.length<=0)return void this.toasts.error({class:"ai-suggestion-error",duration:3e3,data:{message:(0,p.i18n)("discourse_ai.ai_helper.suggest_errors.no_suggestions")}})}catch(t){(0,c.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static#_=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
#ns(){const e=this.args.composer?this.args.composer:this.args.buffered
return e.get("tags")&&e.get("tags").length>0}#as(e){return this.suggestions=this.suggestions.filter((t=>t.id!==e.id))}applySuggestion(e){const t=this.siteSettings.max_tags_per_topic,s=this.args.composer?this.args.composer:this.args.buffered
if(!s)return
const i=s.get("tags")
return i?i?.length>=t?this.toasts.error({class:"ai-suggestion-error",duration:3e3,data:{message:(0,p.i18n)("discourse_ai.ai_helper.suggest_errors.too_many_tags",{count:t})}}):(i.push(e.name),s.set("tags",[...i]),e.disabled=!0,void this.#as(e)):(s.set("tags",[e.name]),void this.#as(e))}static#f=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
onRegisterApi(e){this.dMenu=e}static#b=(()=>dt7948.n(this.prototype,"onRegisterApi",[n.action]))()
onClose(){this.suggestions?.length>0&&(this.triggerIcon="discourse-sparkles")}static#y=(()=>dt7948.n(this.prototype,"onClose",[n.action]))()
static#v=(()=>(0,g.setComponentTemplate)((0,_.createTemplateFactory)({id:"8IJI8bF5",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-tag-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-tags-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[30,0,["showDropdown"]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,2],[[28,[31,2],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[24,0,"tag-row"],[16,"data-name",[30,2,["name"]]],[16,"data-value",[30,3]],[16,"title",[30,2,["name"]]]],[["@translatedLabel","@disabled","@action"],[[30,2,["name"]],[28,[30,0,["isDisabled"]],[[30,2]],null],[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[1,[28,[32,6],[[30,2,["name"]]],[["count","noHref"],[[30,2,["count"]],true]]]],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester.js",scope:()=>[m.default,p.i18n,o.on,l.default,r.default,i.fn,d.default],isStrictMode:!0}),this))()}e.default=f})),define("discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/modifier","@ember/object","discourse/components/d-button","discourse/components/dropdown-menu","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","float-kit/components/d-menu","discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class g extends t.default{static#e=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#s=(()=>dt7948.g(this.prototype,"suggestions",[s.tracked],(function(){return null})))()
#ut=(()=>{dt7948.i(this,"suggestions")})()
static#o=(()=>dt7948.g(this.prototype,"untriggers",[s.tracked],(function(){return[]})))()
#ss=(()=>{dt7948.i(this,"untriggers")})()
static#a=(()=>dt7948.g(this.prototype,"triggerIcon",[s.tracked],(function(){return"discourse-sparkles"})))()
#is=(()=>{dt7948.i(this,"triggerIcon")})()
static#l=(()=>dt7948.g(this.prototype,"content",[s.tracked],(function(){return null})))()
#os=(()=>{dt7948.i(this,"content")})()
get showSuggestionButton(){const e=document.querySelector(".composer-fields"),t=document.querySelector(".edit-topic-title")
this.content=this.args.composer?.reply
const s=this.content?.length>p.MIN_CHARACTER_COUNT||"edit"===this.args.topicState
return e&&(s?e.classList.add("showing-ai-suggestions"):e.classList.remove("showing-ai-suggestions")),t&&(s?t.classList.add("showing-ai-suggestions"):t.classList.remove("showing-ai-suggestions")),s}async loadSuggestions(){if(this.suggestions&&!this.dMenu.expanded)return this.suggestions
this.loading=!0,this.triggerIcon="spinner"
const e={}
this.content?e.text=this.content:e.topic_id=this.args.buffered.content.id
try{const{suggestions:t}=await(0,l.ajax)("/discourse-ai/ai-helper/suggest_title",{method:"POST",data:e})
this.suggestions=t}catch(t){(0,d.popupAjaxError)(t)}finally{this.loading=!1,this.triggerIcon="rotate"}return this.suggestions}static#u=(()=>dt7948.n(this.prototype,"loadSuggestions",[n.action]))()
applySuggestion(e){const t=this.args.composer?this.args.composer:this.args.buffered
t&&(t.set("title",e),this.dMenu.close())}static#p=(()=>dt7948.n(this.prototype,"applySuggestion",[n.action]))()
onRegisterApi(e){this.dMenu=e}static#h=(()=>dt7948.n(this.prototype,"onRegisterApi",[n.action]))()
onClose(){this.triggerIcon="discourse-sparkles"}static#_=(()=>dt7948.n(this.prototype,"onClose",[n.action]))()
static#f=(()=>(0,m.setComponentTemplate)((0,h.createTemplateFactory)({id:"+B/3+brg",block:'[[[1,"\\n"],[41,[30,0,["showSuggestionButton"]],[[[1,"      "],[8,[32,0],[[4,[32,2],["click",[30,0,["loadSuggestions"]]],null]],[["@title","@icon","@identifier","@onClose","@triggerClass","@contentClass","@onRegisterApi","@modalForMobile","@untriggers"],[[28,[32,1],["discourse_ai.ai_helper.suggest"],null],[30,0,["triggerIcon"]],"ai-title-suggester",[30,0,["onClose"]],[29,["btn-transparent suggestion-button suggest-titles-button ",[52,[30,0,["loading"]],"is-loading"]]],"ai-suggestions-menu",[30,0,["onRegisterApi"]],true,[30,0,["untriggers"]]]],[["content"],[[[[1,"\\n"],[41,[51,[30,0,["loading"]]],[[[1,"            "],[8,[32,3],null,null,[["default"],[[[[1,"\\n"],[42,[28,[31,3],[[28,[31,3],[[30,0,["suggestions"]]],null]],null],null,[[[1,"                "],[8,[30,1,["item"]],null,null,[["default"],[[[[1,"\\n                  "],[8,[32,4],[[16,"data-name",[30,2]],[16,"data-value",[30,3]],[16,"title",[30,2]]],[["@action"],[[28,[32,5],[[30,0,["applySuggestion"]],[30,2]],null]]],[["default"],[[[[1,"\\n                    "],[1,[30,2]],[1,"\\n                  "]],[]]]]],[1,"\\n                "]],[]]]]],[1,"\\n"]],[2,3]],null],[1,"            "]],[1]]]]],[1,"\\n"]],[]],null],[1,"        "]],[]]]]],[1,"\\n"]],[]],null],[1,"  "]],["dropdown","suggestion","index"],false,["if","unless","each","-track-array"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester.js",scope:()=>[c.default,u.i18n,o.on,r.default,a.default,i.fn],isStrictMode:!0}),this))()}e.default=g})),define("discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/object","discourse/components/d-button","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static#e=(()=>dt7948.g(this.prototype,"selected",[s.tracked],(function(){return!1})))()
#rs=(()=>{dt7948.i(this,"selected")})()
static#s=(()=>dt7948.g(this.prototype,"selectIcon",[s.tracked],(function(){return"far-circle"})))()
#ls=(()=>{dt7948.i(this,"selectIcon")})()
static#o=(()=>dt7948.g(this.prototype,"selectLabel",[s.tracked],(function(){return"discourse_ai.ai_helper.thumbnail_suggestions.select"})))()
#ds=(()=>{dt7948.i(this,"selectLabel")})()
toggleSelection(e){return this.selected?(this.selectIcon="far-circle",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.select",this.selected=!1,this.args.removeSelection(e)):(this.selectIcon="circle-check",this.selectLabel="discourse_ai.ai_helper.thumbnail_suggestions.selected",this.selected=!0,this.args.addSelection(e))}static#a=(()=>dt7948.n(this.prototype,"toggleSelection",[o.action]))()
static#l=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"BsBgpDKw",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-thumbnail-suggestions__item"],[12],[1,"\\n      "],[8,[32,0],[[16,0,[52,[30,0,["selected"]],"btn-primary"]]],[["@icon","@label","@action"],[[30,0,["selectIcon"]],[30,0,["selectLabel"]],[28,[32,1],[[30,0,["toggleSelection"]],[30,1]],null]]],null],[1,"\\n      "],[10,"img"],[15,"src",[30,1,["url"]]],[14,"loading","lazy"],[15,"width",[30,1,["thumbnail_width"]]],[15,"height",[30,1,["thumbnail_height"]]],[12],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@thumbnail"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/components/thumbnail-suggestion-item.js",scope:()=>[n.default,i.fn],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard",["exports","@glimmer/component","@ember/routing","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return t.siteSettings.ai_sentiment_enabled}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"aCrw9598",block:'[[[1,"\\n    "],[10,"li"],[14,0,"navigation-item sentiment"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"navigation-link"]],[["@route"],["admin.dashboardSentiment"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/admin-dashboard-tabs-after/admin-sentiment-dashbboard.js",scope:()=>[s.LinkTo,i.i18n],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>dt7948.g(this.prototype,"composer",[s.service]))()
#$=(()=>{dt7948.i(this,"composer")})()
static#s=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"doeO/ThB",block:'[[[1,"\\n"],[41,[51,[30,0,["composer","disableCategoryChooser"]]],[[[1,"      "],[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-category-input/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"u3rz9DLM",block:'[[[1,"\\n    "],[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-tag-input/ai-tag-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"Ptl68I7m",block:'[[[1,"\\n"],[41,[51,[30,1,["composer","disableTitleInput"]]],[[[1,"      "],[8,[32,0],null,[["@composer","@topicState"],[[30,1,["composer"]],"new"]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-composer-title-input/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/after-d-editor/composer-open",["exports","@glimmer/component","@ember/object","@ember/service","discourse-i18n"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[i.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#s=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
get composerModel(){return this.args?.outletArgs?.composer}get renderChatWarning(){return this.siteSettings.ai_bot_enable_chat_warning}get aiBotClasses(){return this.composerModel?.title===(0,o.i18n)("discourse_ai.ai_bot.default_pm_prefix")?"ai-bot-chat":"ai-bot-pm"}static#o=(()=>dt7948.n(this.prototype,"aiBotClasses",[(0,s.computed)("composerModel.targetRecipients","composerModel.title")]))()
get isAiBotChat(){if(this.composerModel&&this.composerModel.targetRecipients&&this.currentUser.ai_enabled_chat_bots){let e=this.composerModel.targetRecipients.split(",")
return this.currentUser.ai_enabled_chat_bots.any((t=>e.any((e=>e===t.username))))}return!1}static#a=(()=>dt7948.n(this.prototype,"isAiBotChat",[(0,s.computed)("composerModel.targetRecipients")]))()}e.default=n})),define("discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration",["exports","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const a=(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"+zzrKPCx",block:'[[[1,"\\n  "],[10,0],[14,0,"ai-result__icon"],[15,"title",[28,[32,0],["discourse_ai.embeddings.ai_generated_result"],null]],[12],[1,"\\n    "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n  "],[13],[1,"\\n"]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/after-search-result-entry/search-result-decoration.js",scope:()=>[s.i18n,t.default],isStrictMode:!0}),(0,n.default)(void 0,"search-result-decoration:SearchResultDecoration"))
e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/before-create-topic-button/topic-list-gist-toggle",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-gist-toggle","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static#e=(()=>dt7948.g(this.prototype,"topicThumbnails",[s.service]))()
#us=(()=>{dt7948.i(this,"topicThumbnails")})()
get shouldShow(){return!this.topicThumbnails?.enabledForRoute}static#s=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"7j6Az6wp",block:"[[[8,[32,0],null,null,null]],[],false,[]]",moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/before-create-topic-button/topic-list-gist-toggle.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/composer-after-save-or-cancel/ai-image-caption-loader",["exports","@glimmer/component","@ember/service","discourse/helpers/loading-spinner","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static#e=(()=>dt7948.g(this.prototype,"imageCaptionPopup",[s.service]))()
#cs=(()=>{dt7948.i(this,"imageCaptionPopup")})()
static#s=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"/15Zu2iM",block:'[[[1,"\\n"],[41,[30,0,["imageCaptionPopup","showAutoCaptionLoader"]],[[[1,"      "],[10,0],[14,0,"auto-image-caption-loader"],[12],[1,"\\n        "],[1,[28,[32,0],null,[["size"],["small"]]]],[1,"\\n        "],[10,1],[12],[1,[28,[32,1],["discourse_ai.ai_helper.image_caption.automatic_caption_loading"],null]],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-after-save-or-cancel/ai-image-caption-loader.js",scope:()=>[i.default,o.i18n],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector",["exports","@glimmer/component","@ember/object","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-persona-llm-selector","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return t?.currentUser?.ai_enabled_personas&&function(e,t){if(e&&e.targetRecipients&&t.ai_enabled_chat_bots){const s=e.targetRecipients.split(",")
return t.ai_enabled_chat_bots.filter((e=>e.username)).any((e=>s.any((t=>t===e.username))))}return!1}(e.model,t.currentUser)}static#e=(()=>dt7948.g(this.prototype,"currentUser",[i.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
setPersonaIdOnComposer(e){this.args.outletArgs.model.metaData={ai_persona_id:e}}static#s=(()=>dt7948.n(this.prototype,"setPersonaIdOnComposer",[s.action]))()
setTargetRecipientsOnComposer(e){this.args.outletArgs.model.set("targetRecipients",e)}static#o=(()=>dt7948.n(this.prototype,"setTargetRecipientsOnComposer",[s.action]))()
static#a=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"35crcj6G",block:'[[[1,"\\n    "],[8,[32,0],null,[["@setPersonaId","@setTargetRecipient"],[[30,0,["setPersonaIdOnComposer"]],[30,0,["setTargetRecipientsOnComposer"]]]],null],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/composer-fields/persona-llm-selector.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-category__after/ai-category-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-category-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"xD6ygZtG",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-category__after/ai-category-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a}))
define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-tags__after/ai-tag-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-tag-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"3ec6gwOx",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-tags__after/ai-tag-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/edit-topic-title__after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/suggestion-menus/ai-title-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showComposerAiHelper)(e?.composer,t.siteSettings,t.currentUser,"suggestions")}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"QwHpqwnO",block:'[[[1,"\\n    "],[8,[32,0],null,[["@buffered","@topicState"],[[30,1,["buffered"]],"edit"]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/edit-topic-title__after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container",["exports","@glimmer/component","@ember/modifier","@ember/object","@ember/render-modifiers/modifiers/did-insert","@ember/render-modifiers/modifiers/did-update","@ember/render-modifiers/modifiers/will-destroy","@ember/service","discourse/components/conditional-loading-spinner","discourse/components/d-button","discourse/components/d-textarea","discourse/helpers/d-icon","discourse/modifiers/auto-focus","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c,p,m,h,g){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class _ extends t.default{static#e=(()=>dt7948.g(this.prototype,"imageCaptionPopup",[r.service]))()
#cs=(()=>{dt7948.i(this,"imageCaptionPopup")})()
updateCaption(e){e.preventDefault(),this.imageCaptionPopup.newCaption=e.target.value}static#s=(()=>dt7948.n(this.prototype,"updateCaption",[i.action]))()
saveCaption(){this.imageCaptionPopup.updateCaption(),this.hidePopup()}static#o=(()=>dt7948.n(this.prototype,"saveCaption",[i.action]))()
resizeTextarea(e){const t=window.getComputedStyle(e),s=parseInt(t.borderTopWidth,10),i=parseInt(t.borderBottomWidth,10)
e.scrollTop=0,e.style.height=`${e.scrollHeight+s+i}px`}static#a=(()=>dt7948.n(this.prototype,"resizeTextarea",[i.action]))()
hidePopup(){this.imageCaptionPopup.showPopup=!1,this.imageCaptionPopup._request&&(this.imageCaptionPopup._request.abort(),this.imageCaptionPopup._request=null,this.imageCaptionPopup.toggleLoadingState(!1))}static#l=(()=>dt7948.n(this.prototype,"hidePopup",[i.action]))()
static#u=(()=>(0,h.setComponentTemplate)((0,g.createTemplateFactory)({id:"84lcZtW4",block:'[[[1,"\\n"],[41,[30,0,["imageCaptionPopup","showPopup"]],[[[1,"      "],[11,0],[24,0,"composer-popup education-message ai-caption-popup"],[4,[32,0],[[30,0,["hidePopup"]]],null],[12],[1,"\\n        "],[8,[32,1],null,[["@condition"],[[30,0,["imageCaptionPopup","loading"]]]],[["default"],[[[[1,"\\n          "],[8,[32,2],[[4,[32,3],[[30,0,["resizeTextarea"]]],null],[4,[32,4],[[30,0,["resizeTextarea"]],[30,0,["imageCaptionPopup","newCaption"]]],null],[4,[32,5],["change",[30,0,["updateCaption"]]],null],[4,[32,6],null,null]],[["@value"],[[30,0,["imageCaptionPopup","newCaption"]]]],null],[1,"\\n        "]],[]]]]],[1,"\\n\\n        "],[10,0],[14,0,"actions"],[12],[1,"\\n          "],[8,[32,7],[[24,0,"btn-primary"]],[["@label","@icon","@action"],["discourse_ai.ai_helper.image_caption.save_caption","check",[30,0,["saveCaption"]]]],null],[1,"\\n          "],[8,[32,7],[[24,0,"btn-flat cancel-request"]],[["@label","@action"],["cancel",[30,0,["hidePopup"]]]],null],[1,"\\n\\n          "],[10,1],[14,0,"credits"],[12],[1,"\\n            "],[1,[28,[32,8],["discourse-sparkles"],null]],[1,"\\n            "],[10,1],[12],[1,[28,[32,9],["discourse_ai.ai_helper.image_caption.credits"],null]],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/editor-preview/ai-image-caption-container.js",scope:()=>[a.default,l.default,u.default,o.default,n.default,s.on,p.default,d.default,c.default,m.i18n],isStrictMode:!0}),this))()}e.default=_})),define("discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,t){return(0,l.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"currentUser",[o.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#s=(()=>dt7948.g(this.prototype,"loading",[s.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#o=(()=>dt7948.g(this.prototype,"suggestion",[s.tracked],(function(){return""})))()
#je=(()=>{dt7948.i(this,"suggestion")})()
static#a=(()=>dt7948.g(this.prototype,"_activeAIRequest",[s.tracked],(function(){return null})))()
#ps=(()=>{dt7948.i(this,"_activeAIRequest")})()
get disabled(){return this.loading||this.suggestion?.length>0}get mode(){return this.currentUser?.ai_helper_prompts.find((e=>"proofread"===e.name))}suggest(){return this.loading=!0,this._activeAIRequest=(0,a.ajax)("/discourse-ai/ai-helper/suggest",{method:"POST",data:{mode:this.mode.name,text:this.args.outletArgs.initialValue,custom_prompt:""}}),this._activeAIRequest.then((e=>{let{suggestions:t}=e
this.suggestion=t[0].trim(),this.args.outletArgs.updateValue(this.suggestion)})).catch(r.popupAjaxError).finally((()=>{this.loading=!1})),this._activeAIRequest}static#l=(()=>dt7948.n(this.prototype,"suggest",[i.action]))()
static#u=(()=>(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"9jHc25oQ",block:'[[[1,"\\n"],[41,[51,[30,1,["newValue"]]],[[[1,"      "],[8,[32,0],[[24,0,"btn-small btn-ai-suggest-edit"]],[["@action","@icon","@label","@isLoading","@disabled"],[[30,0,["suggest"]],"discourse-sparkles","discourse_ai.ai_helper.fast_edit.suggest_button",[30,0,["loading"]],[30,0,["disabled"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/fast-edit-footer-after/ai-edit-suggestion-button.js",scope:()=>[n.default],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-discobot-discoveries",["exports","@glimmer/component","@ember/service","discourse/helpers/body-class","discourse/helpers/d-icon","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e,t){let{siteSettings:s,currentUser:i}=t
return s.ai_bot_discover_persona&&i?.can_use_ai_bot_discover_persona&&i?.user_option?.ai_search_discoveries}static#e=(()=>dt7948.g(this.prototype,"capabilities",[s.service]))()
#ms=(()=>{dt7948.i(this,"capabilities")})()
static#s=(()=>dt7948.g(this.prototype,"discobotDiscoveries",[s.service]))()
#Xe=(()=>{dt7948.i(this,"discobotDiscoveries")})()
static#o=(()=>dt7948.g(this.prototype,"site",[s.service]))()
#F=(()=>{dt7948.i(this,"site")})()
get previewLength(){return this.capabilities.viewport.md?1e4:50}static#a=(()=>(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"lInfOcXN",block:'[[[1,"\\n    "],[1,[28,[32,0],["has-discoveries"],null]],[1,"\\n    "],[10,0],[14,0,"ai-search-discoveries__discoveries-wrapper"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","showDiscoveryTitle"]],[[[1,"        "],[10,"h3"],[14,0,"ai-search-discoveries__discoveries-title full-page-discoveries"],[12],[1,"\\n          "],[10,1],[12],[1,"\\n            "],[1,[28,[32,1],["discobot"],null]],[1,"\\n            "],[1,[28,[32,2],["discourse_ai.discobot_discoveries.main_title"],null]],[1,"\\n          "],[13],[1,"\\n          "],[8,[32,3],null,null,null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[10,0],[14,0,"full-page-discoveries"],[12],[1,"\\n        "],[8,[32,4],null,[["@discoveryPreviewLength","@searchTerm"],[[30,0,["previewLength"]],[30,1,["search"]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-discobot-discoveries.js",scope:()=>[i.default,o.default,n.i18n,r.default,a.default],isStrictMode:!0}),this))()}e.default=u})),define("discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-search",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-full-page-search","@ember/component","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){let{siteSettings:s}=t
return s.ai_embeddings_semantic_search_enabled}static#e=(()=>(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"4RggybC1",block:'[[[1,"\\n    "],[8,[32,0],null,[["@sortOrder","@searchTerm","@searchType","@addSearchResults"],[[30,1,["sortOrder"]],[30,1,["search"]],[30,1,["type"]],[30,1,["addSearchResults"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/full-page-search-below-search-header/ai-full-page-search.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=n})),define("discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-post-helper-trigger",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/virtual-element-from-text-range","truth-helpers/helpers/eq","discourse/plugins/discourse-ai/discourse/components/ai-post-helper-menu","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class p extends t.default{static shouldRender(e,t){return(0,d.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"site",[o.service]))()
#F=(()=>{dt7948.i(this,"site")})()
static#s=(()=>dt7948.g(this.prototype,"menu",[o.service]))()
#ke=(()=>{dt7948.i(this,"menu")})()
static#o=(()=>dt7948.g(this.prototype,"menuState",[s.tracked],(function(){return this.MENU_STATES.triggers})))()
#Pe=(()=>{dt7948.i(this,"menuState")})()
static#a=(()=>dt7948.g(this.prototype,"showMainButtons",[s.tracked],(function(){return!0})))()
#hs=(()=>{dt7948.i(this,"showMainButtons")})()
static#l=(()=>dt7948.g(this.prototype,"showAiButtons",[s.tracked],(function(){return!0})))()
#Ee=(()=>{dt7948.i(this,"showAiButtons")})()
static#u=(()=>dt7948.g(this.prototype,"postHighlighted",[s.tracked],(function(){return!1})))()
#gs=(()=>{dt7948.i(this,"postHighlighted")})()
static#p=(()=>dt7948.g(this.prototype,"currentMenu",[s.tracked],(function(){return this.menu.getByIdentifier("post-text-selection-toolbar")})))()
#_s=(()=>{dt7948.i(this,"currentMenu")})()
MENU_STATES={triggers:"TRIGGERS",options:"OPTIONS"}
willDestroy(){super.willDestroy(...arguments),this.removeHighlightedText()}highlightSelectedText(){const e=this.args.outletArgs.data.quoteState.postId
if(!document.querySelector(`article[data-post-id='${e}'] .cooked`))return
this.selectedText=this.args.outletArgs.data.quoteState.buffer
const t=window.getSelection()
if(!t.rangeCount)return
const s=t.getRangeAt(0)
if(s.startContainer.nodeType===Node.TEXT_NODE&&s.startOffset>0){const e=s.startContainer.splitText(s.startOffset)
s.setStart(e,0)}s.endContainer.nodeType===Node.TEXT_NODE&&s.endOffset<s.endContainer.length&&s.endContainer.splitText(s.endOffset)
const i=document.createTreeWalker(s.commonAncestorContainer,NodeFilter.SHOW_TEXT,{acceptNode:e=>s.intersectsNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}),o=[]
if(i.currentNode?.nodeType===Node.TEXT_NODE)o.push(i.currentNode)
else for(;i.nextNode();)o.push(i.currentNode)
for(let n of o){const e=document.createElement("span")
e.classList.add("ai-helper-highlighted-selection")
const t=n.cloneNode(!0)
e.appendChild(t),n.parentNode.replaceChild(e,n)}t.removeAllRanges(),this.postHighlighted=!0}removeHighlightedText(){if(!this.postHighlighted)return
const e=this.args.outletArgs.data.quoteState.postId,t=document.querySelector(`article[data-post-id='${e}'] .cooked`)
if(!t)return
t.querySelectorAll("span.ai-helper-highlighted-selection").forEach((e=>{const t=document.createTextNode(e.textContent)
e.parentNode.replaceChild(t,e)})),this.postHighlighted=!1}async showAiPostHelperMenu(){this.highlightSelectedText(),this.site.mobileView&&(this.currentMenu.close(),await this.menu.show((0,a.default)(),{identifier:"ai-post-helper-menu",component:l.default,inline:!0,interactive:!0,placement:this.shouldRenderUnder?"bottom-start":"top-start",fallbackPlacements:this.shouldRenderUnder?["bottom-end","top-start"]:["bottom-start"],trapTab:!1,closeOnScroll:!1,modalForMobile:!0,data:this.menuData})),this.showMainButtons=!1,this.menuState=this.MENU_STATES.options}static#h=(()=>dt7948.n(this.prototype,"showAiPostHelperMenu",[i.action]))()
get menuData(){return{...this.args.outletArgs.data,quoteState:{buffer:this.args.outletArgs.data.quoteState.buffer,opts:this.args.outletArgs.data.quoteState.opts,postId:this.args.outletArgs.data.quoteState.postId},post:this.args.outletArgs.post,selectedText:this.selectedText}}static#_=(()=>(0,u.setComponentTemplate)((0,c.createTemplateFactory)({id:"NUAbK/gN",block:'[[[1,"\\n"],[41,[30,0,["showMainButtons"]],[[[1,"      "],[18,1,null],[1,"\\n"]],[]],null],[1,"\\n"],[41,[30,0,["showAiButtons"]],[[[1,"      "],[10,0],[14,0,"ai-post-helper"],[12],[1,"\\n"],[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","triggers"]]],null],[[[1,"          "],[8,[32,1],[[24,0,"btn-flat ai-post-helper__trigger"]],[["@icon","@title","@label","@action"],["discourse-sparkles","discourse_ai.ai_helper.post_options_menu.title","discourse_ai.ai_helper.post_options_menu.trigger",[30,0,["showAiPostHelperMenu"]]]],null],[1,"\\n\\n"]],[]],[[[41,[28,[32,0],[[30,0,["menuState"]],[30,0,["MENU_STATES","options"]]],null],[[[1,"          "],[8,[32,2],null,[["@data"],[[30,0,["menuData"]]]],null],[1,"\\n        "]],[]],null]],[]]],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["&default"],false,["if","yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/post-text-buttons/ai-post-helper-trigger.js",scope:()=>[r.default,n.default,l.default],isStrictMode:!0}),this))()}e.default=p})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader",["exports","@glimmer/component","@ember/service","discourse/helpers/loading-spinner","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static#e=(()=>dt7948.g(this.prototype,"quickSearch",[s.service]))()
#fs=(()=>{dt7948.i(this,"quickSearch")})()
static#s=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"apo2cAJf",block:'[[[1,"\\n"],[41,[30,0,["quickSearch","loading"]],[[[1,"      "],[10,0],[14,0,"ai-quick-search-spinner"],[12],[1,"\\n        "],[1,[32,0]],[1,"\\n      "],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-before-advanced-search/ai-quick-search-loader.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-initial-options/ai-quick-semantic-search",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/search-menu/results/assistant-item","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/search","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class c extends t.default{static shouldRender(e,t){let{siteSettings:s}=t
return s.ai_embeddings_semantic_quick_search_enabled}static#e=(()=>dt7948.g(this.prototype,"search",[i.service]))()
#et=(()=>{dt7948.i(this,"search")})()
static#s=(()=>dt7948.g(this.prototype,"quickSearch",[i.service]))()
#fs=(()=>{dt7948.i(this,"quickSearch")})()
static#o=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
async searchTermChanged(){if(this.search.activeGlobalSearchTerm){if(!(0,r.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings))return this.search.noResults=!0,this.search.results={},this.quickSearch.loading=!1,void(this.quickSearch.invalidTerm=!0)
await this.performSearch()}else this.search.noResults=!1,this.search.results={},this.quickSearch.loading=!1,this.quickSearch.invalidTerm=!1}static#a=(()=>dt7948.n(this.prototype,"searchTermChanged",[s.action]))()
async performSearch(){this.quickSearch.loading=!0,this.quickSearch.invalidTerm=!1
try{const e=await(0,n.ajax)("/discourse-ai/embeddings/quick-search",{data:{q:this.search.activeGlobalSearchTerm}}),t=await(0,r.translateResults)(e)
t&&(this.search.noResults=0===e.resultTypes.length,this.search.results=t)}catch(e){(0,a.popupAjaxError)(e)}finally{this.quickSearch.loading=!1}}static#l=(()=>(0,d.setComponentTemplate)((0,u.createTemplateFactory)({id:"xqHDbd5x",block:'[[[1,"\\n    "],[18,3,null],[1,"\\n\\n"],[41,[30,0,["search","activeGlobalSearchTerm"]],[[[1,"      "],[8,[32,0],null,[["@suffix","@icon","@closeSearchMenu","@searchTermChanged","@suggestionKeyword"],[[28,[32,1],["discourse_ai.embeddings.quick_search.suffix"],null],"discourse-sparkles",[30,1],[30,0,["searchTermChanged"]],[30,2]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@closeSearchMenu","@suggestionKeyword","&default"],false,["yield","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-initial-options/ai-quick-semantic-search.js",scope:()=>[o.default,l.i18n],isStrictMode:!0}),this))()}e.default=c})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-discobot-discoveries",["exports","@glimmer/component","@ember/service","discourse/helpers/d-icon","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries","discourse/plugins/discourse-ai/discourse/components/ai-search-discoveries-tooltip","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class d extends t.default{static shouldRender(e,t){let{siteSettings:s,currentUser:i}=t
return s.ai_bot_discover_persona&&i?.can_use_ai_bot_discover_persona&&i?.user_option?.ai_search_discoveries}static#e=(()=>dt7948.g(this.prototype,"discobotDiscoveries",[s.service]))()
#Xe=(()=>{dt7948.i(this,"discobotDiscoveries")})()
static#s=(()=>dt7948.g(this.prototype,"search",[s.service]))()
#et=(()=>{dt7948.i(this,"search")})()
static#o=(()=>(0,r.setComponentTemplate)((0,l.createTemplateFactory)({id:"kJMYLbPh",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-discobot-discoveries"],[12],[1,"\\n"],[41,[30,0,["discobotDiscoveries","showDiscoveryTitle"]],[[[1,"        "],[10,"h3"],[14,0,"ai-search-discoveries__discoveries-title"],[12],[1,"\\n          "],[10,1],[12],[1,"\\n            "],[1,[28,[32,0],["discobot"],null]],[1,"\\n            "],[1,[28,[32,1],["discourse_ai.discobot_discoveries.main_title"],null]],[1,"\\n          "],[13],[1,"\\n\\n          "],[8,[32,2],null,null,null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"\\n      "],[8,[32,3],null,[["@searchTerm","@discoveryPreviewLength","@closeSearchMenu"],[[30,1,["searchTerm"]],50,[30,1,["closeSearchMenu"]]]],null],[1,"\\n\\n"],[41,[30,0,["search","results","topics","length"]],[[[1,"        "],[10,"h3"],[14,0,"ai-search-discoveries__regular-results-title"],[12],[1,"\\n          "],[1,[28,[32,0],["bars-staggered"],null]],[1,"\\n          "],[1,[28,[32,1],["discourse_ai.discobot_discoveries.regular_results"],null]],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-discobot-discoveries.js",scope:()=>[i.default,o.i18n,a.default,n.default],isStrictMode:!0}),this))()}e.default=d})),define("discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info",["exports","@glimmer/component","@ember/service","discourse/lib/search","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static#e=(()=>dt7948.g(this.prototype,"search",[s.service]))()
#et=(()=>{dt7948.i(this,"search")})()
static#s=(()=>dt7948.g(this.prototype,"siteSettings",[s.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#o=(()=>dt7948.g(this.prototype,"quickSearch",[s.service]))()
#fs=(()=>{dt7948.i(this,"quickSearch")})()
get termTooShort(){return!(0,i.isValidSearchTerm)(this.search.activeGlobalSearchTerm,this.siteSettings)&&this.quickSearch.invalidTerm&&this.search.activeGlobalSearchTerm?.length>0}static#a=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"k6uzZwr4",block:'[[[1,"\\n"],[41,[30,0,["termTooShort"]],[[[1,"      "],[10,0],[14,0,"no-results"],[12],[1,[28,[32,0],["search.too_short"],null]],[13],[1,"\\n"]],[]],null],[1,"  "]],[],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/search-menu-results-top/ai-quick-search-info.js",scope:()=>[o.i18n],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[s.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#s=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"4O7HJkah",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_category",[30,1,["updateCategoryId"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-category-after/ai-category-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion",["exports","@glimmer/component","@ember/service","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return(0,o.showPostAIHelper)(e,t)}static#e=(()=>dt7948.g(this.prototype,"siteSettings",[s.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#s=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"jo6+zYZR",block:'[[[1,"\\n"],[41,[30,0,["siteSettings","ai_embeddings_enabled"]],[[[1,"      "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction","@currentValue"],[[30,1,["selectedPosts"]],"suggest_tags",[30,1,["updateTags"]],[30,1,["tags"]]]],null],[1,"\\n"]],[]],null],[1,"  "]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-tag-after/ai-tag-suggestion.js",scope:()=>[i.default],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-split-topic-suggester","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class a extends t.default{static shouldRender(e,t){return(0,i.showPostAIHelper)(e,t)}static#e=(()=>(0,o.setComponentTemplate)((0,n.createTemplateFactory)({id:"obhR2Q8M",block:'[[[1,"\\n    "],[8,[32,0],null,[["@selectedPosts","@mode","@updateAction"],[[30,1,["selectedPosts"]],"suggest_title",[30,1,["updateTopicName"]]]],null],[1,"\\n  "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/split-new-topic-title-after/ai-title-suggestion.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=a})),define("discourse/plugins/discourse-ai/discourse/connectors/topic-list-before-category/ai-topic-gist-placement",["exports","@glimmer/component","discourse/plugins/discourse-ai/discourse/components/ai-topic-gist","@ember/component","@ember/template-factory"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends t.default{static shouldRender(e,t){const s=t.siteSettings
return s.discourse_ai_enabled&&s.ai_summarization_enabled}static#e=(()=>(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"H1L5toqM",block:'[[[8,[32,0],null,[["@topic"],[[30,1,["topic"]]]],null]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-list-before-category/ai-topic-gist-placement.js",scope:()=>[s.default],isStrictMode:!0}),this))()}e.default=n})),define("discourse/plugins/discourse-ai/discourse/connectors/topic-map-expanded-after/ai-summary-trigger",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/plugins/discourse-ai/discourse/components/modal/ai-summary-modal","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends t.default{static#e=(()=>dt7948.g(this.prototype,"modal",[i.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
get isAiConversation(){return this.args.outletArgs.topic.is_bot_pm}openAiSummaryModal(){this.modal.show(n.default,{model:{topic:this.args.outletArgs.topic,postStream:this.args.outletArgs.postStream}})}static#s=(()=>dt7948.n(this.prototype,"openAiSummaryModal",[s.action]))()
static#o=(()=>(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"zAyGCacI",block:'[[[1,"\\n"],[41,[51,[30,0,["isAiConversation"]]],[[[41,[30,1,["topic","summarizable"]],[[[1,"        "],[10,"section"],[14,0,"topic-map__additional-contents toggle-summary"],[12],[1,"\\n          "],[8,[32,0],[[24,0,"btn-default ai-summarization-button"]],[["@label","@icon","@action"],["summary.buttons.generate","discourse-sparkles",[30,0,["openAiSummaryModal"]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null]],[]],null],[1,"  "]],["@outletArgs"],false,["unless","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-map-expanded-after/ai-summary-trigger.js",scope:()=>[o.default],isStrictMode:!0}),this))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/connectors/topic-map-participants-after/ai-conversation-invite",["exports","@glimmer/component","@ember/object","@ember/service","truth-helpers","discourse/components/d-button","discourse/components/header/topic/participant","discourse/components/modal/add-pm-participants","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class u extends t.default{static shouldRender(e){return e.topic.is_bot_pm}static#e=(()=>dt7948.g(this.prototype,"site",[i.service]))()
#F=(()=>{dt7948.i(this,"site")})()
static#s=(()=>dt7948.g(this.prototype,"modal",[i.service]))()
#Y=(()=>{dt7948.i(this,"modal")})()
static#o=(()=>dt7948.g(this.prototype,"header",[i.service]))()
#bs=(()=>{dt7948.i(this,"header")})()
static#a=(()=>dt7948.g(this.prototype,"sidebarState",[i.service]))()
#G=(()=>{dt7948.i(this,"sidebarState")})()
get participants(){return[...this.header.topicInfo.details?.allowed_users??[],...this.header.topicInfo.details?.allowed_groups??[]]}showInvite(){this.modal.show(r.default,{model:{title:"discourse_ai.ai_bot.invite_ai_conversation.title",inviteModel:this.args.outletArgs.topic}})}static#l=(()=>dt7948.n(this.prototype,"showInvite",[s.action]))()
static#u=(()=>(0,l.setComponentTemplate)((0,d.createTemplateFactory)({id:"iRQqMyq7",block:'[[[1,"\\n    "],[10,0],[14,0,"ai-conversation__participants"],[12],[1,"\\n      "],[8,[32,0],[[24,0,"btn-default ai-conversations__invite-button"]],[["@icon","@label","@action"],["user-plus","discourse_ai.ai_bot.invite_ai_conversation.button",[30,0,["showInvite"]]]],null],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["participants"]]],null]],null],null,[[[1,"        "],[8,[32,1],null,[["@user","@type","@username","@avatarSize"],[[30,1],[52,[30,1,["username"]],"user","group"],[28,[32,2],[[30,1,["username"]],[30,1,["name"]]],null],"medium"]],null],[1,"\\n"]],[1]],null],[1,"    "],[13],[1,"\\n  "]],["participant"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/topic-map-participants-after/ai-conversation-invite.js",scope:()=>[n.default,a.default,o.or],isStrictMode:!0}),this))()}e.default=u})),define("discourse/plugins/discourse-ai/discourse/connectors/user-preferences-nav/ai-preferences",["exports","@glimmer/component","@ember/routing","discourse/helpers/d-icon","discourse-i18n","@ember/component","@ember/template-factory"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends t.default{static shouldRender(e,t){return t.siteSettings.discourse_ai_enabled&&function(e,t){const s=t.ai_helper_enabled_features.split("|")
return e?.user_allowed_ai_auto_image_captions&&s.includes("image_caption")&&t.ai_helper_enabled}(e.model,t.siteSettings)}static#e=(()=>(0,n.setComponentTemplate)((0,a.createTemplateFactory)({id:"/y5E1bgJ",block:'[[[1,"\\n    "],[10,"li"],[14,0,"user-nav__preferences-ai"],[12],[1,"\\n      "],[8,[32,0],null,[["@route"],["preferences.ai"]],[["default"],[[[[1,"\\n        "],[1,[28,[32,1],["discourse-sparkles"],null]],[1,"\\n        "],[10,1],[12],[1,[28,[32,2],["discourse_ai.title"],null]],[13],[1,"\\n      "]],[]]]]],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/connectors/user-preferences-nav/ai-preferences.js",scope:()=>[s.LinkTo,i.default,o.i18n],isStrictMode:!0}),this))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/controllers/admin-dashboard-sentiment",["exports","@ember/object","admin/controllers/admin-dashboard-tab"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{get filters(){return{startDate:this.startDate,endDate:this.endDate}}static#e=(()=>dt7948.n(this.prototype,"filters",[(0,t.computed)("startDate","endDate")]))()
get emotionFilters(){return{startDate:moment().subtract(2,"month").format("YYYY-MM-DD"),endDate:moment().format("YYYY-MM-DD")}}get emotions(){return["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","neutral","optimism","pride","realization","relief","remorse","sadness","surprise"]}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/controllers/preferences-ai",["exports","@glimmer/tracking","@ember/controller","@ember/object","@ember/service","discourse/lib/ajax-error","discourse/lib/environment"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class r extends s.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[o.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#s=(()=>dt7948.g(this.prototype,"saved",[t.tracked],(function(){return!1})))()
#ys=(()=>{dt7948.i(this,"saved")})()
get booleanSettings(){return[{key:"auto_image_caption",label:"discourse_ai.ai_helper.image_caption.automatic_caption_setting",settingName:"auto-image-caption",checked:this.model.user_option.auto_image_caption,isIncluded:(()=>{const e=this.siteSettings.ai_helper_enabled_features.split("|")
return this.model?.user_allowed_ai_auto_image_captions&&e.includes("image_caption")&&this.siteSettings.ai_helper_enabled})()},{key:"ai_search_discoveries",label:"discourse_ai.discobot_discoveries.user_setting",settingName:"ai-search-discoveries",checked:this.model.user_option.ai_search_discoveries,isIncluded:(()=>this.siteSettings.ai_bot_discover_persona&&this.model?.can_use_ai_bot_discover_persona&&this.siteSettings.ai_bot_enabled)()}]}get userSettingAttributes(){const e=[]
return this.booleanSettings.forEach((t=>{t.isIncluded&&e.push(t.key)})),e}save(){return this.saved=!1,this.model.save(this.userSettingAttributes).then((()=>{this.saved=!0,(0,a.isTesting)()||location.reload()})).catch(n.popupAjaxError)}static#o=(()=>dt7948.n(this.prototype,"save",[i.action]))()}e.default=r})),define("discourse/plugins/discourse-ai/discourse/discourse-ai-bot-dashboard-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("discourse-ai-bot-conversations",{path:"/discourse-ai/ai-bot/conversations"})}})),define("discourse/plugins/discourse-ai/discourse/discourse-ai-shared-conversation-show-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){this.route("discourse-ai-shared-conversation-show",{path:"/discourse-ai/ai-bot/shared-ai-conversations/:share_key"})}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/get-owner","discourse/models/composer","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/modal/share-full-topic-modal"],(function(e,t,s,i,o,n,a){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.composeAiBotMessage=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{skipFocus:!1,topicBody:"",personaUsername:null}
const i=t.currentUser,a="new_private_message_ai_"+(new Date).getTime()
let r
r=e?i.ai_enabled_chat_bots.find((t=>t.model_name===e))?.username:s.personaUsername?s.personaUsername:i.ai_enabled_chat_bots[0].username
const l={action:o.default.PRIVATE_MESSAGE,recipients:r,topicTitle:(0,n.i18n)("discourse_ai.ai_bot.default_pm_prefix"),archetypeId:"private_message",draftKey:a,hasGroups:!1,warningsDisabled:!0}
s.skipFocus?(l.topicBody=s.topicBody,await t.open(l)):t.focusComposer({fallbackToNewTopic:!0,openOpts:l})},e.getBotType=function(e){if(!e)return
d()
const t=l[e.id]
if(!t)return
return t.is_persona?"persona":"llm"},e.isGPTBot=function(e){if(!e)return
return d(),!!l[e.id]},e.isPostFromAiBot=function(e,t){return e.user_id<=r||!!t?.ai_enabled_chat_bots?.any((t=>e.username===t.username))},e.showShareConversationModal=function(e,i){(0,t.ajax)(`/discourse-ai/ai-bot/shared-ai-conversations/preview/${i}.json`).then((t=>{e.show(a.default,{model:t})})).catch(s.popupAjaxError)}
const r=-1200
let l=null
function d(){if(!l){const e=(0,i.getOwnerWithFallback)(this).lookup("service:current-user")
l={},e.ai_enabled_chat_bots.forEach((e=>{l[e.id]=e}))}}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-helper-suggestions",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_CHARACTER_COUNT=void 0
e.MIN_CHARACTER_COUNT=40})),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers",["exports","@ember/runloop","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/post-updater"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.MIN_LETTERS_PER_INTERVAL=void 0,e.addProgressDot=function(e){let t=e
for(;;){let e=l(t)
if(!e)break
if(e.nodeType!==Node.ELEMENT_NODE)break
t=e}const s=document.createElement("span")
s.classList.add("progress-dot"),t.appendChild(s)},e.applyProgress=d,e.default=function(e,s,o){const n=new e(s,o)
r||(r=(0,t.later)((async()=>{await d(s,n),r=null,s.done||await d(s,n)}),i))},e.streamPostText=function(e,t){if(t.noop)return;(e.aiStreamingStatus=e.aiStreamingStatus||{})[t.post_id]=t,u(e)}
const i=40,o=6e5,n=e.MIN_LETTERS_PER_INTERVAL=6,a=800
let r=null
function l(e){let t=e.lastChild
for(;t&&t.nodeType===Node.TEXT_NODE&&!/\S/.test(t.textContent);)t=t.previousSibling
return t}async function d(e,t){if(e.startTime=e.startTime||Date.now(),Date.now()-e.startTime>o)return t.streaming=!1,!0
if(!t.element)return!1
const s=t.raw
if(e.raw===s&&!e.done){if(t.element.querySelector(".progress-dot"))return!1}if(void 0!==e.raw){let o=e.raw
if(!e.done)if(0===s.length&&-1!==o.indexOf("</details>"))o=e.raw
else{const t=o.length-s.length
let r=Math.floor(t/(a/i))
r<n&&(r=n),o=e.raw.substring(0,s.length+r)}await t.setRaw(o,e.done)}return e.done&&(e.cooked&&await t.setCooked(e.cooked),t.streaming=!1),e.done}function u(e){r||(r=(0,t.later)((async()=>{const t=await async function(e){const t=e.aiStreamingStatus
let i=!1
const o=Object.keys(t).map((async o=>{let n=t[o]
const a=new s.default(e,n.post_id)
await d(n,a)?delete t[o]:i=!0}))
return await Promise.all(o),i}(e)
r=null,t&&u(e)}),i))}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/post-updater",["exports","discourse/lib/load-morphlex","discourse/lib/text","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/stream-updater"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n extends o.default{morphingOptions={beforeAttributeUpdated:(e,t)=>!("DETAILS"===e.tagName&&"open"===t)}
constructor(e,t){super(),this.postStream=e,this.postId=t,this.post=e.findLoadedPost(t)
const s=e.topic.id
this.post&&(this.postElement=document.querySelector(`.topic-area[data-topic-id="${s}"] #post_${this.post.post_number}`))}get element(){return this.postElement}set streaming(e){this.postElement&&(e?this.postElement.classList.add("streaming"):this.postElement.classList.remove("streaming"))}async setRaw(e,t){this.post.set("raw",e)
const o=await(0,s.cook)(e)
this.element.classList.remove("streaming"),this.element.offsetWidth,this.element.classList.add("streaming")
const n=document.createElement("div")
n.innerHTML=o,t||(0,i.addProgressDot)(n),await this.setCooked(n.innerHTML)}async setCooked(e){this.postElement&&(this.post.set("cooked",e),(await(0,t.default)()).morphInner(this.postElement.querySelector(".cooked"),`<div>${e}</div>`,this.morphingOptions))}get raw(){return this.post.get("raw")||""}}e.default=n})),define("discourse/plugins/discourse-ai/discourse/lib/ai-streamer/updaters/stream-updater",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=class{set streaming(e){throw"not implemented"}async setCooked(){throw"not implemented"}async setRaw(){throw"not implemented"}get element(){throw"not implemented"}get raw(){throw"not implemented"}}})),define("discourse/plugins/discourse-ai/discourse/lib/ai-topic-summary",["exports","@glimmer/tracking","discourse/lib/ajax","discourse/lib/formatter","discourse/lib/text"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n{static#e=(()=>dt7948.g(this.prototype,"text",[t.tracked],(function(){return""})))()
#xt=(()=>{dt7948.i(this,"text")})()
static#s=(()=>dt7948.g(this.prototype,"summarizedOn",[t.tracked],(function(){return null})))()
#kt=(()=>{dt7948.i(this,"summarizedOn")})()
static#o=(()=>dt7948.g(this.prototype,"summarizedBy",[t.tracked],(function(){return null})))()
#Tt=(()=>{dt7948.i(this,"summarizedBy")})()
static#a=(()=>dt7948.g(this.prototype,"newPostsSinceSummary",[t.tracked],(function(){return null})))()
#Pt=(()=>{dt7948.i(this,"newPostsSinceSummary")})()
static#l=(()=>dt7948.g(this.prototype,"outdated",[t.tracked],(function(){return!1})))()
#Ct=(()=>{dt7948.i(this,"outdated")})()
static#u=(()=>dt7948.g(this.prototype,"canRegenerate",[t.tracked],(function(){return!1})))()
#jt=(()=>{dt7948.i(this,"canRegenerate")})()
static#p=(()=>dt7948.g(this.prototype,"regenerated",[t.tracked],(function(){return!1})))()
#vs=(()=>{dt7948.i(this,"regenerated")})()
static#h=(()=>dt7948.g(this.prototype,"showSummaryBox",[t.tracked],(function(){return!1})))()
#ws=(()=>{dt7948.i(this,"showSummaryBox")})()
static#_=(()=>dt7948.g(this.prototype,"canCollapseSummary",[t.tracked],(function(){return!1})))()
#Ss=(()=>{dt7948.i(this,"canCollapseSummary")})()
static#f=(()=>dt7948.g(this.prototype,"loadingSummary",[t.tracked],(function(){return!1})))()
#xs=(()=>{dt7948.i(this,"loadingSummary")})()
processUpdate(e){const t=e.ai_topic_summary
return(0,o.cook)(t.summarized_text).then((e=>{this.text=e,this.loading=!1})).then((()=>{e.done&&(this.summarizedOn=(0,i.shortDateNoYear)(t.summarized_on),this.summarizedBy=t.algorithm,this.newPostsSinceSummary=t.new_posts_since_summary,this.outdated=t.outdated,this.newPostsSinceSummary=t.new_posts_since_summary,this.canRegenerate=t.outdated&&t.can_regenerate)}))}collapse(){this.showSummaryBox=!1,this.canCollapseSummary=!1}generateSummary(e,t){if(this.showSummaryBox=!0,this.text&&!this.canRegenerate)return void(this.canCollapseSummary=!1)
let i=`/discourse-ai/summarization/t/${t}?`
return e&&(i+="stream=true",this.canRegenerate&&(i+="&skip_age_check=true")),this.loading=!0,(0,s.ajax)(i).then((t=>{e||(t.done=!0,this.processUpdate(t))}))}}e.default=n})),define("discourse/plugins/discourse-ai/discourse/lib/copy-conversation",["exports","discourse/lib/ajax","discourse/lib/utilities","discourse-i18n"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=async function(e,o,n){await(0,s.clipboardCopyAsync)((async()=>{const s=await async function(e,s,o){const n=e.get("postStream")
let a=[]
for(let t=s;t<=o;t++)a.push(t)
const r=a.map((e=>n.findPostIdForPostNumber(e))),l=`/t/${e.id}/posts.json`,d={post_ids:r,include_raw:!0},u=await(0,t.ajax)(l,{data:d})
let c=[]
c.push("<details class='ai-quote'>"),c.push("<summary>"),c.push(`<span>${e.title}</span>`),c.push(`<span title='${(0,i.i18n)("discourse_ai.ai_bot.ai_title")}'>${(0,i.i18n)("discourse_ai.ai_bot.ai_label")}</span>`),c.push("</summary>"),u.post_stream.posts.forEach((e=>{c.push(""),c.push(`**${e.username}:**`),c.push(""),c.push(e.raw)})),c.push("</details>")
const p=c.join("\n")
return p}(e,o,n)
return new Blob([s],{type:"text/plain"})}))}})),define("discourse/plugins/discourse-ai/discourse/lib/diff-streamer",["exports","@glimmer/tracking","@ember/runloop","discourse/lib/load-js-diff","discourse/lib/utilities"],(function(e,t,s,i,o){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class n{static#e=(()=>dt7948.g(this.prototype,"isStreaming",[t.tracked],(function(){return!1})))()
#ks=(()=>{dt7948.i(this,"isStreaming")})()
static#s=(()=>dt7948.g(this.prototype,"words",[t.tracked],(function(){return[]})))()
#Ts=(()=>{dt7948.i(this,"words")})()
static#o=(()=>dt7948.g(this.prototype,"lastResultText",[t.tracked],(function(){return""})))()
#Ps=(()=>{dt7948.i(this,"lastResultText")})()
static#a=(()=>dt7948.g(this.prototype,"diff",[t.tracked],(function(){return this.selectedText})))()
#K=(()=>{dt7948.i(this,"diff")})()
static#l=(()=>dt7948.g(this.prototype,"suggestion",[t.tracked],(function(){return""})))()
#je=(()=>{dt7948.i(this,"suggestion")})()
static#u=(()=>dt7948.g(this.prototype,"isDone",[t.tracked],(function(){return!1})))()
#Cs=(()=>{dt7948.i(this,"isDone")})()
static#p=(()=>dt7948.g(this.prototype,"isThinking",[t.tracked],(function(){return!0})))()
#js=(()=>{dt7948.i(this,"isThinking")})()
typingTimer=null
currentWordIndex=0
currentCharIndex=0
jsDiff=null
bufferedToken=null
rushMode=!1
rushBatchSize=1
rushTicksLeft=0
receivedFinalUpdate=!1
constructor(e,t){this.selectedText=e,this.typingDelay=t||10,this.loadJSDiff()}async loadJSDiff(){this.jsDiff=await(0,i.default)()}async updateResult(e,t){if(this.receivedFinalUpdate)return
this.jsDiff||await this.loadJSDiff(),this.isThinking=!1
const i=e[t]
if(!!e?.done){this.receivedFinalUpdate=!0,this.typingTimer&&((0,s.cancel)(this.typingTimer),this.typingTimer=null),this.bufferedToken&&(this.words.push(this.bufferedToken),this.bufferedToken=null)
const e=i.slice(this.lastResultText.length)
e.length&&this.words.push(...this.#Ms(e))
const t=i.length-this.suggestion.length
return t<=0?(this.suggestion=i,this.diff=this.#As(this.jsDiff.diffWordsWithSpace(this.selectedText,i),!1),this.isStreaming=!1,void(this.isDone=!0)):(this.rushBatchSize=Math.ceil(t/10),this.rushTicksLeft=10,this.rushMode=!0,this.isStreaming=!0,this.lastResultText=i,void this.#Os())}const o=i.slice(this.lastResultText.length)
if(!o)return void(this.lastResultText=i)
const n=(this.bufferedToken||"")+o,a=this.#Ms(n)
this.bufferedToken=a.pop()||null,a.length&&this.words.push(...a),this.isStreaming=!0,this.typingTimer||this.#Os(),this.lastResultText=i}reset(){this.diff="",this.suggestion="",this.lastResultText="",this.words=[],this.currentWordIndex=0,this.currentCharIndex=0,this.bufferedToken=null,this.isStreaming=!1,this.isDone=!1,this.receivedFinalUpdate=!1,this.isThinking=!0,this.rushMode=!1,this.rushBatchSize=1,this.rushTicksLeft=0,this.typingTimer&&((0,s.cancel)(this.typingTimer),this.typingTimer=null)}streamingDiff(e,t){const s=Math.floor(t.length+.1*t.length+10),i=e.slice(0,s),o=e.slice(s),n=this.jsDiff.diffWordsWithSpace(i,t)
if(o.length){let e=n.at(-1),t=n.at(-2)
e.added&&t?.removed&&(n.splice(-2,2,e,t),e=t),e.removed||(e={added:!1,removed:!0,value:""},n.push(e)),e.value+=o}return n}#Os(){if(!this.isStreaming)return
const e=this.rushMode?this.rushBatchSize:1
let t=0
for(;t<e&&this.currentWordIndex<this.words.length;){const e=this.words[this.currentWordIndex]
this.suggestion+=e.charAt(this.currentCharIndex),this.currentCharIndex++,t++,this.currentCharIndex>=e.length&&(this.currentWordIndex++,this.currentCharIndex=0)}let i=!1
if(this.rushMode?this.rushTicksLeft>0&&(this.rushTicksLeft--,i=!0):i=0===this.currentCharIndex,i||this.currentWordIndex>=this.words.length){const e=this.currentWordIndex<this.words.length||this.rushMode
this.diff=this.#As(e?this.streamingDiff(this.selectedText,this.suggestion):this.jsDiff.diffWordsWithSpace(this.selectedText,this.suggestion),!this.rushMode)}if(this.currentWordIndex>=this.words.length)this.isStreaming=!1,this.rushMode=!1,this.typingTimer=null,this.receivedFinalUpdate&&(this.isDone=!0)
else{const e=this.rushMode?100:this.typingDelay
this.typingTimer=(0,s.later)(this,this.#Os,e)}}#Ms(e){return e.split(/(?<=\S)(?=\s)/)}#Es(e,t){return"added"===t?`<ins>${e}</ins>`:"removed"===t?/^\s+$/.test(e)?"":`<del>${e}</del>`:`<span>${e}</span>`}#As(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]
const s=[]
e.forEach((e=>(e.value.match(/\S+|\s+/g)||[]).forEach((t=>s.push({text:t,type:e.added?"added":e.removed?"removed":"unchanged"})))))
let i=-1
if(t)for(let o=s.length-1;o>=0;o--)if("removed"!==s[o].type&&/\S/.test(s[o].text)){i=o
break}const n=[]
for(let a=0;a<=i;a++){let{text:e,type:r}=s[a]
if(e=(0,o.escapeExpression)(e),/^\s+$/.test(e)){n.push(e)
continue}let l=this.#Es(e,r)
t&&a===i&&(l=`<mark class="highlight">${l}</mark>`),n.push(l)}for(let a=i+1;a<s.length;){const e=s[a].type
let t=""
for(;a<s.length&&s[a].type===e;)t+=s[a++].text
n.push(this.#Es((0,o.escapeExpression)(t),e))}return n.join("")}}e.default=n}))
define("discourse/plugins/discourse-ai/discourse/lib/show-ai-helper",["exports"],(function(e){"use strict"
function t(e){return e.discourse_ai_enabled&&e.ai_helper_enabled}Object.defineProperty(e,"__esModule",{value:!0}),e.showComposerAiHelper=function(e,s,i,o){const n=t(s),a=i.can_use_assistant,r=s.ai_helper_allowed_in_pm,l=s.ai_helper_enabled_features.includes(o)
if(e?.privateMessage)return n&&a&&r&&l
return n&&a&&l},e.showPostAIHelper=function(e,s){return t(s.siteSettings)&&s.currentUser?.can_use_assistant_in_post}})),define("discourse/plugins/discourse-ai/discourse/lib/smooth-streamer",["exports","@glimmer/tracking","@ember/runloop"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i{static#e=(()=>dt7948.g(this.prototype,"isStreaming",[t.tracked],(function(){return!1})))()
#ks=(()=>{dt7948.i(this,"isStreaming")})()
static#s=(()=>dt7948.g(this.prototype,"streamedText",[t.tracked],(function(){return""})))()
#Rs=(()=>{dt7948.i(this,"streamedText")})()
typingTimer=null
streamedTextLength=0
constructor(e,t,s){this.getRealtimeText=e,this.setRealtimeText=t,this.typingDelay=s||15}get renderedText(){return this.isStreaming?this.streamedText:this.realtimeText}get realtimeText(){return this.getRealtimeText()}set realtimeText(e){this.setRealtimeText(e)}resetStreaming(){this.#Is(),this.isStreaming=!1,this.streamedText="",this.streamedTextLength=0}async updateResult(e,t){const s=e[t]
e?.done?(this.streamedText=s,this.realtimeText=s,this.isStreaming=!1,this.#Is()):s.length>this.realtimeText.length&&(this.realtimeText=s,this.isStreaming=!0,await this.#Fs())}#Ds(){this.streamedTextLength<this.realtimeText.length?(this.streamedText+=this.realtimeText.charAt(this.streamedTextLength),this.streamedTextLength++,this.typingTimer=(0,s.later)(this,this.#Ds,this.typingDelay)):this.typingTimer=null}#Fs(){this.#Is(),this.#Ds()}#Is(){this.typingTimer&&(0,s.cancel)(this.typingTimer)}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/lib/utilities",["exports","@ember/template","discourse/lib/utilities"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.jsonToHtml=function e(i){if(null===i)return"null"
if("object"!=typeof i)return(0,s.escapeExpression)(i)
let o="<ul>"
for(let[t,n]of Object.entries(i))o+="<li>",t=(0,s.escapeExpression)(t),"object"==typeof n&&Array.isArray(n)?o+=`<strong>${t}:</strong> ${e(n)}`:"object"==typeof n?o+=`<strong>${t}:</strong> <ul><li>${e(n)}</li></ul>`:("string"==typeof n&&(n=(0,s.escapeExpression)(n).replace(/\n/g,"<br>")),o+=`<strong>${t}:</strong> ${n}`),o+="</li>"
return o+="</ul>",(0,t.htmlSafe)(o)}})),define("discourse/plugins/discourse-ai/discourse/lib/virtual-element-from-caret-coords",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,s){return new t(e,s)}
class t{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0]
this.caretCoords=e,this.offset=t,this.updateRect()}updateRect(){const[e,t]=this.offset
return this.rect={top:this.caretCoords.y+t,right:this.caretCoords.x,bottom:this.caretCoords.y+t,left:this.caretCoords.x+e,width:0,height:0,x:this.caretCoords.x,y:this.caretCoords.y,toJSON(){return this}},this.rect}getBoundingClientRect(){return this.rect}getClientRects(){return[this.rect]}get clientWidth(){return this.rect.width}get clientHeight(){return this.rect.height}}})),define("discourse/plugins/discourse-ai/discourse/preferences-ai-route-map",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={resource:"user.preferences",map(){this.route("ai")}}})),define("discourse/plugins/discourse-ai/discourse/routes/discourse-ai-shared-conversation-show",["exports","@ember/service","discourse/routes/discourse"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[t.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
beforeModel(e){this.currentUser?.user_option?.external_links_in_new_tab?window.open(e.intent.url,"_blank"):this.redirect(e.intent.url),e.abort()}redirect(e){window.location=e}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/routes/preferences-ai",["exports","@ember/service","discourse/lib/utilities","discourse/routes/restricted-user"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends i.default{static#e=(()=>dt7948.g(this.prototype,"siteSettings",[t.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
setupController(e,t){if(!this.siteSettings.discourse_ai_enabled)return this.router.transitionTo(`discovery.${(0,s.defaultHomepage)()}`)
e.set("model",t)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/services/ai-bot-conversations-hidden-submit",["exports","@ember/object","@ember/runloop","@ember/service","@ember-compat/tracked-built-ins","discourse/lib/ajax","discourse/lib/uploads","discourse-i18n"],(function(e,t,s,i,o,n,a,r){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class l extends i.default{static#e=(()=>dt7948.g(this.prototype,"aiConversationsSidebarManager",[i.service]))()
#Ls=(()=>{dt7948.i(this,"aiConversationsSidebarManager")})()
static#s=(()=>dt7948.g(this.prototype,"appEvents",[i.service]))()
#H=(()=>{dt7948.i(this,"appEvents")})()
static#o=(()=>dt7948.g(this.prototype,"composer",[i.service]))()
#$=(()=>{dt7948.i(this,"composer")})()
static#a=(()=>dt7948.g(this.prototype,"dialog",[i.service]))()
#X=(()=>{dt7948.i(this,"dialog")})()
static#l=(()=>dt7948.g(this.prototype,"router",[i.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#u=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#S=(()=>{dt7948.i(this,"siteSettings")})()
static#p=(()=>dt7948.g(this.prototype,"loading",[o.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
personaId
targetUsername
uploads=[]
inputValue=""
focusInput(){this.composer.destroyDraft(),this.composer.close(),(0,s.next)((()=>{document.getElementById("ai-bot-conversations-input").focus()}))}static#h=(()=>dt7948.n(this.prototype,"focusInput",[t.action]))()
async submitToBot(){if(this.inputValue.length<this.siteSettings.min_personal_message_post_length)return this.dialog.alert({message:(0,r.i18n)("discourse_ai.ai_bot.conversations.min_input_length_message",{count:this.siteSettings.min_personal_message_post_length}),didConfirm:()=>this.focusInput(),didCancel:()=>this.focusInput()})
if(document.querySelector(".ai-bot-upload--in-progress"))return this.dialog.alert({message:(0,r.i18n)("discourse_ai.ai_bot.conversations.uploads_in_progress")})
this.loading=!0
const e=(0,r.i18n)("discourse_ai.ai_bot.default_pm_prefix")
let t=this.inputValue
this.uploads&&this.uploads.length>0&&(t+="\n\n",this.uploads.forEach((e=>{const s=(0,a.getUploadMarkdown)(e)
t+=s+"\n"})))
try{const s=await(0,n.ajax)("/posts.json",{method:"POST",data:{raw:t,title:e,archetype:"private_message",target_recipients:this.targetUsername,meta_data:{ai_persona_id:this.personaId}}})
this.uploads=[],this.inputValue="",this.appEvents.trigger("discourse-ai:bot-pm-created",{id:s.topic_id,slug:s.topic_slug,title:e}),this.router.transitionTo(s.post_url)}finally{this.loading=!1}}static#_=(()=>dt7948.n(this.prototype,"submitToBot",[t.action]))()}e.default=l})),define("discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager",["exports","@glimmer/tracking","@ember/runloop","@ember/service","@ember/template","@ember-compat/tracked-built-ins","discourse/lib/ajax","discourse/lib/debounce","discourse/lib/formatter","discourse/lib/sidebar/panels","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-empty-state"],(function(e,t,s,i,o,n,a,r,l,d,u,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.AI_CONVERSATIONS_PANEL=void 0
const p=e.AI_CONVERSATIONS_PANEL="ai-conversations"
class m extends i.default{static#e=(()=>dt7948.g(this.prototype,"appEvents",[i.service]))()
#H=(()=>{dt7948.i(this,"appEvents")})()
static#s=(()=>dt7948.g(this.prototype,"sidebarState",[i.service]))()
#G=(()=>{dt7948.i(this,"sidebarState")})()
static#o=(()=>dt7948.g(this.prototype,"messageBus",[i.service]))()
#xe=(()=>{dt7948.i(this,"messageBus")})()
static#a=(()=>dt7948.g(this.prototype,"topics",[t.tracked],(function(){return[]})))()
#Ns=(()=>{dt7948.i(this,"topics")})()
static#l=(()=>dt7948.g(this.prototype,"sections",[t.tracked],(function(){return new n.TrackedArray})))()
#Us=(()=>{dt7948.i(this,"sections")})()
static#u=(()=>dt7948.g(this.prototype,"isLoading",[t.tracked],(function(){return!0})))()
#At=(()=>{dt7948.i(this,"isLoading")})()
api=null
isFetching=!1
page=0
hasMore=!0
_registered=(()=>new Set)()
_hasScrollListener=!1
_scrollElement=null
_didInit=!1
_debouncedScrollHandler=()=>{(0,r.default)(this,(()=>{const e=this._scrollElement
if(!e)return
const{scrollTop:t,scrollHeight:s,clientHeight:i}=e
s-t-i-100<100&&!this.isFetching&&this.hasMore&&this.fetchMessages()}),100)}
constructor(){super(...arguments),this.appEvents.on("discourse-ai:bot-pm-created",this,this._handleNewBotPM),this.appEvents.on("discourse-ai:conversations-sidebar-updated",this,this._attachScrollListener)}willDestroy(){super.willDestroy(...arguments),this.appEvents.off("discourse-ai:bot-pm-created",this,this._handleNewBotPM),this.appEvents.off("discourse-ai:conversations-sidebar-updated",this,this._attachScrollListener)}forceCustomSidebar(){return document.body.classList.add("has-ai-conversations-sidebar"),this.sidebarState.isForcingSidebar||this.appEvents.trigger("discourse-ai:force-conversations-sidebar"),this.sidebarState.isForcingSidebar=!0,this.sidebarState.setPanel(p),this.sidebarState.setSeparatedMode(),this.sidebarState.hideSwitchPanelButtons(),this._didInit||(this._didInit=!0,this.fetchMessages().then((()=>{this.sidebarState.setPanel(p)}))),!0}_attachScrollListener(){const e=document.querySelector(".sidebar-sections.ai-conversations-panel")
this._scrollElement=e,!this._hasScrollListener&&this._scrollElement&&(e.addEventListener("scroll",this._debouncedScrollHandler),this._hasScrollListener=!0)}_removeScrollListener(){this._hasScrollListener&&(this._scrollElement.removeEventListener("scroll",this._debouncedScrollHandler),this._hasScrollListener=!1,this._scrollElement=null)}stopForcingCustomSidebar(){document.body.classList.remove("has-ai-conversations-sidebar")
const e=this.sidebarState.currentPanel?.key===d.ADMIN_PANEL
this.sidebarState.isForcingSidebar&&!e&&(this.sidebarState.setPanel(d.MAIN_PANEL),this.sidebarState.isForcingSidebar=!1,this.appEvents.trigger("discourse-ai:stop-forcing-conversations-sidebar")),this._removeScrollListener()}async fetchMessages(){if(this.isFetching||!this.hasMore)return
const e=0===this.page
this.isFetching=!0
try{let{conversations:t,meta:s}=await(0,a.ajax)("/discourse-ai/ai-bot/conversations.json",{data:{page:this.page,per_page:40}})
e?this.topics=t:(this.topics=[...this.topics,...t],this.sidebarState.setPanel(p)),this.page+=1,this.hasMore=s.has_more,this._rebuildSections()}finally{this.isFetching=!1,this.isLoading=!1}}_handleNewBotPM(e){this.topics=[e,...this.topics],this._rebuildSections(),this._watchForTitleUpdate(e.id)}_watchForTitleUpdate(e){if(this._subscribedTopicIds?.has(e))return
this._subscribedTopicIds=this._subscribedTopicIds||new Set,this._subscribedTopicIds.add(e)
const t=`/discourse-ai/ai-bot/topic/${e}`
this.messageBus.subscribe(t,(s=>{this._applyTitleUpdate(e,s.title),this.messageBus.unsubscribe(t)}))}_applyTitleUpdate(e,t){this.topics=this.topics.map((s=>s.id===e?{...s,title:t}:s)),this._rebuildSections()}_rebuildSections(){const e=Date.now(),t=[],a={name:"today",title:(0,u.i18n)("discourse_ai.ai_bot.conversations.today"),links:new n.TrackedArray}
t.push(a),this.topics.forEach((s=>{const i=new Date(s.last_posted_at||e).valueOf(),o=Math.floor((e-i)/864e5)
let r,d
if(o<=1)r="today"
else if(o<=7)r="last-7-days"
else if(o<=30)r="last-30-days"
else{const e=new Date(i),t=`${e.getFullYear()}-${e.getMonth()}`
r=t}if(d="today"===r?a:t.find((e=>e.name===r)),!d){let e
switch(r){case"last-7-days":e=(0,u.i18n)("discourse_ai.ai_bot.conversations.last_7_days")
break
case"last-30-days":e=(0,u.i18n)("discourse_ai.ai_bot.conversations.last_30_days")
break
default:e=(0,l.autoUpdatingRelativeAge)(new Date(s.last_posted_at))}d={name:r,title:e,links:new n.TrackedArray},t.push(d)}d.links.push({key:s.id,route:"topic.fromParamsNear",models:[s.slug,s.id,s.last_read_post_number||0],title:s.title,text:s.title,classNames:`ai-conversation-${s.id}`})})),this.sections=new n.TrackedArray(t)
for(let n of t)this._registered.has(n.name)||(this._registered.add(n.name),this.api.addSidebarSection((e=>class extends e{static#e=(()=>dt7948.g(this.prototype,"manager",[(0,i.service)("ai-conversations-sidebar-manager")]))()
#qs=(()=>{dt7948.i(this,"manager")})()
static#s=(()=>dt7948.g(this.prototype,"events",[(0,i.service)("appEvents")]))()
#Bs=(()=>{dt7948.i(this,"events")})()
constructor(){super(...arguments),(0,s.scheduleOnce)("afterRender",this,this.triggerEvent)}triggerEvent(){this.events.trigger("discourse-ai:conversations-sidebar-updated")}get name(){return n.name}get title(){return n.title}get text(){return(0,o.htmlSafe)(n.title)}get links(){return this.manager.sections.find((e=>e.name===n.name))?.links||[]}get emptyStateComponent(){if(!this.manager.isLoading&&0===this.links.length)return c.default}}),p))}}e.default=m})),define("discourse/plugins/discourse-ai/discourse/services/discobot-discoveries",["exports","@glimmer/tracking","@ember/object","@ember/service"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends i.default{static#e=(()=>dt7948.g(this.prototype,"currentUser",[i.service]))()
#R=(()=>{dt7948.i(this,"currentUser")})()
static#s=(()=>dt7948.g(this.prototype,"discovery",[t.tracked],(function(){return""})))()
#zs=(()=>{dt7948.i(this,"discovery")})()
static#o=(()=>dt7948.g(this.prototype,"lastQuery",[t.tracked],(function(){return""})))()
#Hs=(()=>{dt7948.i(this,"lastQuery")})()
static#a=(()=>dt7948.g(this.prototype,"discoveryTimedOut",[t.tracked],(function(){return!1})))()
#$s=(()=>{dt7948.i(this,"discoveryTimedOut")})()
static#l=(()=>dt7948.g(this.prototype,"modelUsed",[t.tracked],(function(){return""})))()
#Vs=(()=>{dt7948.i(this,"modelUsed")})()
static#u=(()=>dt7948.g(this.prototype,"loadingDiscoveries",[t.tracked],(function(){return!1})))()
#Gs=(()=>{dt7948.i(this,"loadingDiscoveries")})()
resetDiscovery(){this.loadingDiscoveries=!1,this.discovery="",this.discoveryTimedOut=!1,this.modelUsed=""}get showDiscoveryTitle(){return this.discovery.length>0||this.loadingDiscoveries||this.discoveryTimedOut}async disableDiscoveries(){this.currentUser.user_option.ai_search_discoveries=!1,await this.currentUser.save(["ai_search_discoveries"]),location.reload()}static#p=(()=>dt7948.n(this.prototype,"disableDiscoveries",[s.action]))()}e.default=o})),define("discourse/plugins/discourse-ai/discourse/services/gists",["exports","@glimmer/tracking","@ember/service"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static#e=(()=>dt7948.g(this.prototype,"router",[s.service]))()
#t=(()=>{dt7948.i(this,"router")})()
static#s=(()=>dt7948.g(this.prototype,"preference",[t.tracked],(function(){return localStorage.getItem("topicListLayout")})))()
#Ys=(()=>{dt7948.i(this,"preference")})()
get shouldShow(){return this.router.currentRoute.attributes?.list?.topics?.some((e=>e.ai_topic_gist))}setPreference(e){this.preference=e,localStorage.setItem("topicListLayout",e),"table-ai"===this.preference&&localStorage.setItem("aiPreferred",!0)}}e.default=i})),define("discourse/plugins/discourse-ai/discourse/services/image-caption-popup",["exports","@glimmer/tracking","@ember/service","discourse/lib/uploads"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class o extends s.default{static#e=(()=>dt7948.g(this.prototype,"composer",[s.service]))()
#$=(()=>{dt7948.i(this,"composer")})()
static#s=(()=>dt7948.g(this.prototype,"appEvents",[s.service]))()
#H=(()=>{dt7948.i(this,"appEvents")})()
static#o=(()=>dt7948.g(this.prototype,"showPopup",[t.tracked],(function(){return!1})))()
#Ws=(()=>{dt7948.i(this,"showPopup")})()
static#a=(()=>dt7948.g(this.prototype,"imageIndex",[t.tracked],(function(){return null})))()
#Ks=(()=>{dt7948.i(this,"imageIndex")})()
static#l=(()=>dt7948.g(this.prototype,"imageSrc",[t.tracked],(function(){return null})))()
#Js=(()=>{dt7948.i(this,"imageSrc")})()
static#u=(()=>dt7948.g(this.prototype,"newCaption",[t.tracked],(function(){return null})))()
#Qs=(()=>{dt7948.i(this,"newCaption")})()
static#p=(()=>dt7948.g(this.prototype,"loading",[t.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#h=(()=>dt7948.g(this.prototype,"popupTrigger",[t.tracked],(function(){return null})))()
#Zs=(()=>{dt7948.i(this,"popupTrigger")})()
static#_=(()=>dt7948.g(this.prototype,"showAutoCaptionLoader",[t.tracked],(function(){return!1})))()
#Xs=(()=>{dt7948.i(this,"showAutoCaptionLoader")})()
static#f=(()=>dt7948.g(this.prototype,"_request",[t.tracked],(function(){return null})))()
#ei=(()=>{dt7948.i(this,"_request")})()
updateCaption(){const e=this.composer.model.reply.match(i.IMAGE_MARKDOWN_REGEX)
if(e){const t=e[this.imageIndex],s=t.replace(i.IMAGE_MARKDOWN_REGEX,`![${this.newCaption}|$2$3$4]($5)`)
t&&this.appEvents.trigger("composer:replace-text",t,s)}}toggleLoadingState(e){return e?(this.popupTrigger?.classList.add("disabled"),this.loading=!0):(this.popupTrigger?.classList.remove("disabled"),this.loading=!1)}}e.default=o})),define("discourse/plugins/discourse-ai/discourse/services/quick-search",["exports","@glimmer/tracking","@ember/service"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
class i extends s.default{static#e=(()=>dt7948.g(this.prototype,"loading",[t.tracked],(function(){return!1})))()
#Ce=(()=>{dt7948.i(this,"loading")})()
static#s=(()=>dt7948.g(this.prototype,"invalidTerm",[t.tracked],(function(){return!1})))()
#ti=(()=>{dt7948.i(this,"invalidTerm")})()}e.default=i})),define("discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"kVhVidsY",block:'[[[10,0],[14,0,"sentiment section"],[12],[1,"\\n  "],[10,0],[14,0,"period-section"],[12],[1,"\\n    "],[10,0],[14,0,"section-title"],[12],[1,"\\n      "],[10,"h2"],[14,1,"sentiment-heading"],[12],[1,"\\n        "],[1,[28,[35,2],["discourse_ai.sentiments.dashboard.title"],null]],[1,"\\n      "],[13],[1,"\\n\\n      "],[8,[39,3],null,[["@period","@setPeriod","@startDate","@endDate","@setCustomDateRange"],[[30,0,["period"]],[30,0,["setPeriod"]],[30,0,["startDate"]],[30,0,["endDate"]],[30,0,["setCustomDateRange"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n\\n  "],[10,0],[14,0,"section-body"],[12],[1,"\\n    "],[10,0],[14,0,"charts"],[12],[1,"\\n      "],[8,[39,4],null,[["@dataSourceName","@filters","@showHeader"],["overall_sentiment",[30,0,["filters"]],true]],null],[1,"\\n      "],[10,0],[14,0,"admin-report activity-metrics"],[12],[1,"\\n        "],[10,0],[14,0,"header"],[12],[1,"\\n          "],[10,"ul"],[14,0,"breadcrumb"],[12],[1,"\\n            "],[10,"li"],[14,0,"item report"],[12],[1,"\\n              "],[8,[39,7],[[24,0,"report-url"]],[["@route"],["adminReports"]],[["default"],[[[[1,"\\n                "],[1,[28,[35,2],["admin.dashboard.emotion.title"],null]],[1,"\\n              "]],[]]]]],[1,"\\n              "],[8,[39,8],null,[["@interactive"],["true"]],[["trigger","content"],[[[[1,"\\n                  "],[1,[28,[35,10],["circle-question"],null]],[1,"\\n                "]],[]],[[[1,"\\n                  "],[10,1],[12],[1,[28,[35,2],["admin.dashboard.emotion.description"],null]],[13],[1,"\\n                "]],[]]]]],[1,"\\n            "],[13],[1,"\\n          "],[13],[1,"\\n        "],[13],[1,"\\n        "],[10,0],[14,0,"report-body"],[12],[1,"\\n          "],[10,0],[14,0,"counters-list"],[12],[1,"\\n            "],[10,0],[14,0,"counters-header"],[12],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[35,2],["admin.dashboard.reports.today"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[35,2],["admin.dashboard.reports.yesterday"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[35,2],["admin.dashboard.reports.last_7_days"],null]],[13],[1,"\\n              "],[10,0],[14,0,"counters-cell"],[12],[1,[28,[35,2],["admin.dashboard.reports.last_30_days"],null]],[13],[1,"\\n            "],[13],[1,"\\n"],[42,[28,[37,14],[[28,[37,14],[[30,0,["emotions"]]],null]],null],null,[[[1,"              "],[8,[39,4],null,[["@showHeader","@filters","@forcedModes","@dataSourceName"],[false,[30,0,["emotionFilters"]],"emotion",[29,["emotion_",[30,1]]]]],null],[1,"\\n"]],[1]],null],[1,"          "],[13],[1,"\\n        "],[13],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"],[13]],["metric"],false,["div","h2","i18n","dashboard-period-selector","admin-report","ul","li","link-to","d-tooltip",":trigger","d-icon",":content","span","each","-track-array"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/admin-dashboard-sentiment.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/composer-open",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"t7q115/2",block:'[[[41,[30,0,["isAiBotChat"]],[[[1,"  "],[1,[28,[35,1],[[30,0,["aiBotClasses"]]],null]],[1,"\\n"],[41,[30,0,["renderChatWarning"]],[[[1,"    "],[10,0],[14,0,"ai-bot-chat-warning"],[12],[1,[28,[35,3],["discourse_ai.ai_bot.pm_warning"],null]],[13],[1,"\\n"]],[]],null]],[]],null]],[],false,["if","body-class","div","i18n"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/connectors/after-d-editor/composer-open.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/discourse/templates/discourse-ai-bot-conversations",["exports","ember-route-template","discourse/plugins/discourse-ai/discourse/components/ai-bot-conversations","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.default)((0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"pAtvA/d4",block:"[[[8,[32,0],null,null,null]],[],false,[]]",moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/discourse/templates/discourse-ai-bot-conversations.js",scope:()=>[s.default],isStrictMode:!0}),(0,n.default)(void 0,void 0)))})),define("discourse/plugins/discourse-ai/discourse/templates/preferences/ai",["exports","@ember/template-factory"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.createTemplateFactory)({id:"SNnAvZM0",block:'[[[10,0],[14,0,"ai-user-preferences"],[12],[1,"\\n  "],[10,"legend"],[14,0,"control-label"],[12],[1,[28,[35,2],["discourse_ai.title"],null]],[13],[1,"\\n\\n"],[42,[28,[37,4],[[28,[37,4],[[30,0,["booleanSettings"]]],null]],null],null,[[[41,[30,1,["isIncluded"]],[[[1,"      "],[10,0],[14,0,"control-group ai-setting"],[12],[1,"\\n        "],[8,[39,6],[[16,"data-setting-name",[30,1,["settingName"]]],[16,0,[29,["pref-",[30,1,["settingName"]]]]]],[["@labelKey","@checked"],[[30,1,["label"]],[28,[37,7],[[30,0,["model","user_option"]],[30,1,["key"]]],null]]],null],[1,"\\n      "],[13],[1,"\\n"]],[]],null]],[1]],null],[1,"\\n"],[41,[28,[37,8],[[30,0,["userSettingAttributes","length"]],0],null],[[[1,"    "],[1,[28,[35,2],["discourse_ai.user_preferences.empty"],null]],[1,"\\n"]],[]],null],[1,"\\n"],[41,[51,[28,[37,8],[[30,0,["userSettingAttributes","length"]],0],null]],[[[1,"    "],[8,[39,10],null,[["@id","@model","@action","@saved"],["user_ai_preference_save",[30,0,["model"]],[30,0,["save"]],[30,0,["saved"]]]],null],[1,"\\n"]],[]],null],[13]],["setting"],false,["div","legend","i18n","each","-track-array","if","preference-checkbox","get","eq","unless","save-controls"]]',moduleName:"discourse/plugins/discourse-ai/discourse/templates/preferences/ai.hbs",isStrictMode:!1})})),define("discourse/plugins/discourse-ai/initializers/admin-plugin-configuration-nav",["exports","discourse/lib/plugin-api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-admin-plugin-configuration-nav",initialize(e){const s=e.lookup("service:current-user")
s&&s.admin&&(0,t.withPluginApi)("1.1.0",(e=>{e.addAdminPluginConfigurationNav("discourse-ai",[{label:"discourse_ai.features.short_title",route:"adminPlugins.show.discourse-ai-features",description:"discourse_ai.features.description"},{label:"discourse_ai.usage.short_title",route:"adminPlugins.show.discourse-ai-usage",description:"discourse_ai.usage.subheader_description"},{label:"discourse_ai.llms.short_title",route:"adminPlugins.show.discourse-ai-llms",description:"discourse_ai.llms.preconfigured.description"},{label:"discourse_ai.ai_persona.short_title",route:"adminPlugins.show.discourse-ai-personas",description:"discourse_ai.ai_persona.persona_description"},{label:"discourse_ai.embeddings.short_title",route:"adminPlugins.show.discourse-ai-embeddings",description:"discourse_ai.embeddings.description"},{label:"discourse_ai.tools.short_title",route:"adminPlugins.show.discourse-ai-tools",description:"discourse_ai.tools.subheader_description"},{label:"discourse_ai.spam.short_title",route:"adminPlugins.show.discourse-ai-spam",description:"discourse_ai.spam.spam_description"}])}))}}})),define("discourse/plugins/discourse-ai/initializers/admin-reports",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/admin-report-emotion"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-admin-reports",initialize(e){const i=e.lookup("service:current-user")
if(!i||!i.admin)return
const o=require("discourse/plugins/discourse-ai/discourse/components/admin-report-sentiment-analysis").default;(0,t.withPluginApi)((e=>{e.registerReportModeComponent("emotion",s.default),e.registerReportModeComponent("sentiment_analysis",o),e.registerValueTransformer("admin-reports-show-query-params",(e=>{let{value:t}=e
return[...t,"selectedChart"]}))}))}}})),define("discourse/plugins/discourse-ai/initializers/ai-artifacts",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/ai-artifact","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n){"use strict"
function a(e){e.decorateCookedElement(((e,t)=>{t.renderGlimmer&&[...e.querySelectorAll("div.ai-artifact")].forEach((e=>{const a=e.getAttribute("data-ai-artifact-id"),r=e.getAttribute("data-ai-artifact-version"),l={}
for(const t of e.attributes)t.name.startsWith("data-")&&"data-ai-artifact-id"!==t.name&&"data-ai-artifact-version"!==t.name&&(l[t.name]=t.value)
t.renderGlimmer(e,(0,i.setComponentTemplate)((0,o.createTemplateFactory)({id:"dKSFA3cb",block:'[[[1,"\\n              "],[8,[32,0],null,[["@artifactId","@artifactVersion","@dataAttributes"],[[32,1],[32,2],[32,3]]],null],[1,"\\n            "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/initializers/ai-artifacts.js",scope:()=>[s.default,a,r,l],isStrictMode:!0}),(0,n.default)(void 0,void 0)))}))}),{id:"ai-artifact",onlyStream:!0})}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"ai-artifact",initialize(){(0,t.withPluginApi)("0.8.7",a)}}})),define("discourse/plugins/discourse-ai/initializers/ai-bot-replies",["exports","discourse/lib/deprecated","discourse/lib/plugin-api","discourse/widgets/render-glimmer","discourse/plugins/discourse-ai/discourse/components/ai-bot-header-icon","discourse/plugins/discourse-ai/discourse/components/post/ai-persona-flair","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-cancel-streaming-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-debug-button","discourse/plugins/discourse-ai/discourse/components/post-menu/ai-share-button","discourse/plugins/discourse-ai/discourse/lib/ai-bot-helper","discourse/plugins/discourse-ai/discourse/lib/ai-streamer/progress-handlers","@ember/template-factory"],(function(e,t,s,i,o,n,a,r,l,d,u,c){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
let p=!1
function m(e){(function(e){e.registerValueTransformer("post-menu-buttons",(e=>{let{value:t,context:{post:s,firstButtonKey:i}}=e;(0,d.isGPTBot)(s.user)&&t.add("ai-cancel-gpt",a.default,{before:i,after:["ai-share","ai-debug"]})}))})(e),e.modifyClass("controller:topic",{pluginId:"discourse-ai",onAIBotStreamedReply:function(e){(0,u.streamPostText)(this.model.postStream,e)},subscribe:function(){this._super(),this.model.isPrivateMessage&&this.model.details.allowed_users&&this.model.details.allowed_users.filter(d.isGPTBot).length>=1&&this.messageBus.subscribe(`discourse-ai/ai-bot/topic/${this.model.id}`,this.onAIBotStreamedReply.bind(this),-2)},unsubscribe:function(){this.messageBus.unsubscribe("discourse-ai/ai-bot/topic/*"),this._super()}})}function h(e){e.renderAfterWrapperOutlet("post-meta-data-poster-name",n.default),(0,t.withSilencedDeprecations)("discourse.post-stream-widget-overrides",(()=>function(e){e.decorateWidget("poster-name:after",(e=>{const t=(0,d.getBotType)(e.attrs.user)
return"llm"===t?e.widget.attach("persona-flair",{personaName:e.model?.topic?.ai_persona_name}):"persona"===t?e.widget.attach("persona-flair",{personaName:e.model?.llm_name}):void 0})),(0,i.registerWidgetShim)("persona-flair","span.persona-flair",(0,c.createTemplateFactory)({id:"u1Hv6Pkx",block:'[[[1,[30,1,["personaName"]]]],["@data"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/initializers/ai-bot-replies.js",isStrictMode:!1}))}(e)))}e.default={name:"discourse-ai-bot-replies",initialize(e){const t=e.lookup("service:current-user")
t?.ai_enabled_chat_bots&&(p=t.can_debug_ai_bot_conversations,(0,s.withPluginApi)((e=>{(function(e){e.headerIcons.add("ai",o.default)})(e),m(e),h(e),function(e){const t=e.getCurrentUser()
t&&t.ai_enabled_chat_bots&&p&&e.registerValueTransformer("post-menu-buttons",(e=>{let{value:t,context:{post:s,firstButtonKey:i}}=e
"private_message"===s.topic?.archetype&&t.add("ai-debug",r.default,{before:i,after:"ai-share"})}))}(e),function(e){const t=e.getCurrentUser()
t&&t.ai_enabled_chat_bots&&e.registerValueTransformer("post-menu-buttons",(e=>{let{value:t,context:{post:s,firstButtonKey:i}}=e
"private_message"===s.topic?.archetype&&t.add("ai-share",l.default,{before:i})}))}(e),function(e){const t=e.container.lookup("service:modal"),s=e.container.lookup("service:current-user")
e.registerTopicFooterButton({id:"share-ai-conversation",icon:"share-nodes",label:"discourse_ai.ai_bot.share_ai_conversation.name",title:"discourse_ai.ai_bot.share_ai_conversation.title",action(){(0,d.showShareConversationModal)(t,this.topic.id)},classNames:["share-ai-conversation-button"],dependentKeys:["topic.ai_persona_name"],displayed(){return s?.can_share_ai_bot_conversations&&this.topic.ai_persona_name}})}(e)})))}}})),define("discourse/plugins/discourse-ai/initializers/ai-chat-summarization",["exports","discourse/lib/api","discourse/plugins/discourse-ai/discourse/components/modal/chat-modal-channel-summary"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)("1.34.0",(e=>{const t=e.container.lookup("service:site-settings"),i=e.getCurrentUser(),o=e.container.lookup("service:chat"),n=e.container.lookup("service:modal"),a=i&&i.can_summarize
t.chat_enabled&&o?.userCanChat&&a&&e.registerChatComposerButton({translatedLabel:"discourse_ai.summarization.chat.title",id:"channel-summary",icon:"discourse-sparkles",position:"dropdown",action:()=>{n.show(s.default,{model:{channelId:o.activeChannel?.id}})}})}))})),define("discourse/plugins/discourse-ai/initializers/ai-conversations-sidebar",["exports","discourse/lib/plugin-api","discourse/plugins/discourse-ai/discourse/components/ai-bot-sidebar-new-conversation","discourse/plugins/discourse-ai/discourse/services/ai-conversations-sidebar-manager"],(function(e,t,s,i){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"ai-conversations-sidebar",initialize(){(0,t.withPluginApi)((e=>{if(!e.container.lookup("service:site-settings").ai_bot_enable_dedicated_ux)return
const t=e.container.lookup("service:current-user")
if(!t)return
const o=e.container.lookup("service:ai-conversations-sidebar-manager")
o.api=e,e.addSidebarPanel((e=>class extends e{key=(()=>i.AI_CONVERSATIONS_PANEL)()
hidden=!0
displayHeader=!1
expandActiveSection=!0})),e.renderInOutlet("before-sidebar-sections",s.default)
e.container.lookup("service:router").on("routeDidChange",(s=>{if("discourse-ai-bot-conversations"===s?.to?.name)return o.forceCustomSidebar()
const i=e.container.lookup("controller:topic").model
if("private_message"===i?.archetype&&i.user_id===t.id&&i.is_bot_pm)return o.forceCustomSidebar()
o.stopForcingCustomSidebar()}))}))}}})),define("discourse/plugins/discourse-ai/initializers/ai-gist-topic-list-class",["exports","discourse/lib/api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)("1.15.0",(e=>{const t=e.container.lookup("service:gists")
e.registerValueTransformer("topic-list-item-class",(e=>{let{value:s,context:i}=e
const o="table-ai"===t.preference&&t.shouldShow
return i.topic.get("ai_topic_gist")&&o&&s.push("excerpt-expanded"),s}))}))})),define("discourse/plugins/discourse-ai/initializers/ai-helper",["exports","discourse/lib/plugin-api","discourse-i18n","discourse/plugins/discourse-ai/discourse/components/ai-composer-helper-menu","discourse/plugins/discourse-ai/discourse/components/modal/diff-modal","discourse/plugins/discourse-ai/discourse/lib/show-ai-helper"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default={name:"discourse-ai-helper",initialize(){(0,t.withPluginApi)("1.1.0",(e=>{(function(e){e.onToolbarCreate((t=>{const a=e.getCurrentUser(),r=e.container.lookup("service:modal"),l=e=>{const t=e.getText(),s=e.selected.value
return s&&s.length>0?s:t&&t.length>0?t:void 0}
t.addButton({id:"ai-helper-trigger",group:"extras",icon:"discourse-sparkles",title:"discourse_ai.ai_helper.context_menu.trigger",preventFocus:!0,hideShortcutInTitle:!0,shortcut:"ALT+P",shortcutAction:t=>{if(0===t.getText().length)return e.container.lookup("service:toasts").error({class:"ai-proofread-error-toast",duration:3e3,data:{message:(0,s.i18n)("discourse_ai.ai_helper.no_content_error")}})
const i=a?.ai_helper_prompts.find((e=>"proofread"===e.name)).name
r.show(o.default,{model:{mode:i,selectedText:l(t),toolbarEvent:t,showResultAsDiff:!0}})},condition:()=>(0,n.showComposerAiHelper)(e.container.lookup("service:composer").model,e.container.lookup("service:site-settings"),a,"context_menu"),sendAction:t=>{e.container.lookup("service:menu").show(document.querySelector(".ai-helper-trigger"),{identifier:"ai-composer-helper-menu",component:i.default,modalForMobile:!0,interactive:!0,data:{toolbarEvent:t,selectedText:l(t)}})}})}))})(e)}))}}})),define("discourse/plugins/discourse-ai/initializers/ai-image-caption",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/api","discourse/lib/uploads","discourse-i18n"],(function(e,t,s,i,o,n){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,i.apiInitializer)("1.25.0",(e=>{const i={label:(0,n.i18n)("discourse_ai.ai_helper.image_caption.button_label"),icon:"discourse-sparkles",class:"generate-caption"},a=e.container.lookup("service:site-settings"),r=e.getCurrentUser()
if(!a.ai_helper_enabled_features.includes("image_caption")||!r?.can_use_assistant)return
function l(e){return e.length<20||1===e.split(" ").length}async function d(e,i){try{return(await(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:e,image_url_type:i}})).caption}catch(o){c.error({class:"ai-image-caption-error-toast",duration:3e3,data:{message:(0,s.extractError)(o)}})}}e.addSaveableUserOptionField("auto_image_caption"),e.addComposerImageWrapperButton(i.label,i.class,i.icon,(i=>{const o=e.container.lookup("service:imageCaptionPopup")
if(o.popupTrigger=i.target,o.popupTrigger.classList.contains("generate-caption")){const n=i.target.closest(".button-wrapper"),a=parseInt(n.getAttribute("data-image-index"),10),r=i.target.closest(".image-wrapper").querySelector("img").getAttribute("src")
o.toggleLoadingState(!0)
const l=e.container.lookup("service:site")
l.mobileView||(o.showPopup=!o.showPopup),o._request=(0,t.ajax)("/discourse-ai/ai-helper/caption_image",{method:"POST",data:{image_url:r,image_url_type:"long_url"}}),o._request.then((e=>{let{caption:t}=e
o.imageSrc=r,o.imageIndex=a,o.newCaption=t,l.mobileView&&o.updateCaption()})).catch(s.popupAjaxError).finally((()=>{o.toggleLoadingState(!1)}))}}))
const u=a?.ai_auto_image_caption_allowed_groups.split("|").map((e=>parseInt(e,10)))
if(!r.groups.map((e=>e.id)).some((e=>u.includes(e))))return
const c=e.container.lookup("service:toasts")
e.addComposerUploadMarkdownResolver((async e=>{if(!r.get("user_option.auto_image_caption")||!(0,o.isImage)(e.url)||!l(e.original_filename)||(t=e.width,s=e.height,t*s/1e6<=.1))return(0,o.getUploadMarkdown)(e)
var t,s
const i=await d(e.url,"long_url")
return i?`![${i}|${e.thumbnail_width}x${e.thumbnail_height}](${e.short_url})`:(0,o.getUploadMarkdown)(e)})),e.composerBeforeSave((()=>new Promise(((t,s)=>{const i=e.container.lookup("service:dialog"),a=e.container.lookup("service:composer"),u="discourse_ai.ai_helper.image_caption.automatic_caption_dialog",c=r.get("user_option.auto_image_caption"),p=a.model.reply.match(o.IMAGE_MARKDOWN_REGEX)
p?.length>0||t()
const m=p.filter((e=>l(e.substring(e.indexOf("[")+1,e.indexOf("]")).split("|")[0]))),h=m?.length>0,g=e.container.lookup("service:key-value-store"),_=e.container.lookup("service:imageCaptionPopup"),f="ai-auto-caption-seen",b=g.getItem(f)
if(c||!h||b)return t()
g.setItem(f,!0),i.confirm({message:(0,n.i18n)(`${u}.prompt`),confirmButtonLabel:`${u}.confirm`,cancelButtonLabel:`${u}.cancel`,class:"ai-image-caption-prompt-dialog",didConfirm:async()=>{try{r.set("user_option.auto_image_caption",!0),await r.save(["auto_image_caption"]),m.forEach((async e=>{const s=function(e){const t=e.match(/\(upload:\/\/([^)]+)\)/)
return t?`upload://${t[1]}`:null}(e)
_.showAutoCaptionLoader=!0
const i=await d(s,"short_url"),o=new RegExp(`(!\\[)[^|]+(\\|[^\\]]+\\]\\(${s}\\))`),n=a.model.reply.replace(o,`$1${i}$2`)
a.model.set("reply",n),_.showAutoCaptionLoader=!1,t()}))}catch(e){s(e)}},didCancel:()=>{t()}})}))))}))})),define("discourse/plugins/discourse-ai/initializers/ai-search-discoveries",["exports","discourse/lib/api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)((e=>{const t=e.getCurrentUser()
e.container.lookup("service:site-settings").ai_bot_enabled&&t?.can_use_ai_bot_discover_persona&&e.addSaveableUserOptionField("ai_search_discoveries")}))})),define("discourse/plugins/discourse-ai/initializers/ai-semantic-search",["exports","discourse/lib/api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)("1.15.0",(e=>{e.modifyClass("component:search-result-entry",{pluginId:"discourse-ai",classNameBindings:["bulkSelectEnabled","post.generatedByAi:ai-result"]})}))})),define("discourse/plugins/discourse-ai/initializers/ai-sentiment-admin-nav",["exports","discourse/lib/api"],(function(e,t){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)("1.15.0",(e=>{const t=e.getCurrentUser()
t&&t.admin&&t.can_see_sentiment_reports&&(e.addAdminSidebarSectionLink("reports",{name:"sentiment_overview",route:"admin.dashboardSentiment",label:"discourse_ai.sentiments.sidebar.overview",icon:"chart-column"}),e.addAdminSidebarSectionLink("reports",{name:"sentiment_analysis",route:"adminReports.show",routeModels:["sentiment_analysis"],label:"discourse_ai.sentiments.sidebar.analysis",icon:"chart-pie"}))}))})),define("discourse/plugins/discourse-ai/initializers/related-topics",["exports","@glimmer/tracking","discourse/components/basic-topic-list","discourse/helpers/d-icon","discourse/lib/plugin-api","discourse-i18n","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(e,t,s,i,o,n,a,r,l){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
const d=(0,a.setComponentTemplate)((0,r.createTemplateFactory)({id:"ub/16OCY",block:'[[[1,"\\n  "],[10,0],[14,"role","complementary"],[14,"aria-labelledby","related-topics-title"],[14,1,"related-topics"],[14,0,"more-topics__list"],[12],[1,"\\n    "],[10,"h3"],[14,1,"related-topics-title"],[14,0,"more-topics__list-title"],[12],[1,"\\n      "],[1,[28,[32,0],["discourse-sparkles"],null]],[1,[28,[32,1],["discourse_ai.related_topics.title"],null]],[1,"\\n    "],[13],[1,"\\n    "],[10,0],[14,0,"topics"],[12],[1,"\\n      "],[8,[32,2],null,[["@topics"],[[30,1,["relatedTopics"]]]],null],[1,"\\n    "],[13],[1,"\\n  "],[13],[1,"\\n"]],["@topic"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-ai/initializers/related-topics.js",scope:()=>[i.default,n.i18n,s.default],isStrictMode:!0}),(0,l.default)(void 0,"related-topics:RelatedTopics"))
e.default={name:"discourse-ai-related-topics",initialize(e){const s=e.lookup("service:site-settings")
s.ai_embeddings_enabled&&s.ai_embeddings_semantic_related_topics_enabled&&(0,o.withPluginApi)("1.37.2",(e=>{e.registerMoreTopicsTab({id:"related-topics",name:(0,n.i18n)("discourse_ai.related_topics.pill"),icon:"discourse-sparkles",component:d,condition:e=>{let{topic:t}=e
return t.relatedTopics?.length}}),e.modifyClass("model:topic",(e=>class extends e{static#e=(()=>dt7948.g(this.prototype,"related_topics",[t.tracked]))()
#si=(()=>{dt7948.i(this,"related_topics")})()
relatedTopicsCache=[]
get relatedTopics(){return this.related_topics&&(this.relatedTopicsCache=this.related_topics),this.relatedTopicsCache?.map((e=>this.store.createRecord("topic",e)))}static#s=(()=>dt7948.n(this.prototype,"relatedTopics",[t.cached]))()})),e.modifyClass("model:post-stream",(e=>class extends e{_setSuggestedTopics(e){super._setSuggestedTopics(...arguments),this.topic.related_topics=e.related_topics}}))}))}}}))
define("discourse/plugins/discourse-ai/initializers/translation",["exports","discourse/lib/api","discourse/lib/cookie"],(function(e,t,s){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0
e.default=(0,t.apiInitializer)((e=>{const t=e.container.lookup("service:site-settings")
t.discourse_ai_enabled&&t.ai_translation_enabled&&e.registerCustomPostMessageCallback("localized",((e,t)=>{if(!(0,s.default)("content-localization-show-original")){e.get("model.postStream").triggerChangedPost(t.id,t.updated_at).then((()=>{e.appEvents.trigger("post-stream:refresh",{id:t.id})}))}}))}))})),define("discourse/plugins/discourse-ai/lib/discourse-markdown/ai-tags",["exports"],(function(e){"use strict"
Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.allowList(["details[class=ai-quote]"]),e.allowList(["div[class=ai-artifact]","div[data-ai-artifact-id]","div[data-ai-artifact-version]"])}}))

//# sourceMappingURL=discourse-ai-d5cfbf60.map