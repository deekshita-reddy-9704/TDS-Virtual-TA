define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-answer-button",["exports","@glimmer/component","@ember/service","discourse/components/d-button","discourse/helpers/concat-class","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class c extends e.default{static shouldRender(t){return t.state.canCreatePost&&1===t.post.post_number}static#t=(()=>dt7948.g(this.prototype,"site",[o.service]))()
#e=(()=>{dt7948.i(this,"site")})()
get showLabel(){return this.site.desktopView}static#o=(()=>(0,n.setComponentTemplate)((0,r.createTemplateFactory)({id:"vkSoIcWn",block:'[[[1,"\\n    "],[8,[32,0],[[16,0,[28,[32,1],["post-action-menu__post-voting-answer","reply",[52,[30,0,["showLabel"]],"create fade-out"]],null]],[17,1]],[["@action","@icon","@label","@title"],[[30,2,["replyToPost"]],"reply",[52,[30,0,["showLabel"]],"post_voting.topic.answer.label"],"post_voting.topic.answer.help"]],null],[1,"\\n  "]],["&attrs","@buttonActions"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-answer-button.js",scope:()=>[s.default,i.default],isStrictMode:!0}),this))()}t.default=c})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-answer-header",["exports","@glimmer/component","@ember/object","truth-helpers","discourse/components/d-button","discourse/helpers/concat-class","discourse-i18n","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.ORDER_BY_ACTIVITY_FILTER=void 0
const d=t.ORDER_BY_ACTIVITY_FILTER="activity"
class p extends e.default{static shouldRender(t){const e=t.post
if(!e?.topic?.is_post_voting)return!1
const o=t.topicPageQueryParams.replies_to_post_number,s=o&&1!==parseInt(o,10)?2:1
return e.topic.posts_count-1>0&&e.id===e.topic.postStream.stream[s]}get post(){return this.args.outletArgs.post}get answersCount(){return this.post.topic.posts_count-1}get sortedByActivity(){return this.args.outletArgs.topicPageQueryParams.filter===d}async orderByVotes(){await this.post.topic.postStream.orderStreamByVotes(),this.args.outletArgs.actions.updateTopicPageQueryParams()}static#t=(()=>dt7948.n(this.prototype,"orderByVotes",[o.action]))()
async orderByActivity(){await this.post.topic.postStream.orderStreamByActivity(),this.args.outletArgs.actions.updateTopicPageQueryParams()}static#o=(()=>dt7948.n(this.prototype,"orderByActivity",[o.action]))()
static#s=(()=>(0,c.setComponentTemplate)((0,a.createTemplateFactory)({id:"p2chrz4y",block:'[[[1,"\\n    "],[10,0],[14,0,"post-voting-answers-header small-action"],[12],[1,"\\n      "],[10,1],[14,0,"post-voting-answers-headers-count"],[12],[1,"\\n        "],[1,[28,[32,0],["post_voting.topic.answer_count"],[["count"],[[30,0,["answersCount"]]]]]],[1,"\\n      "],[13],[1,"\\n      "],[10,1],[14,0,"post-voting-answers-headers-sort"],[12],[1,"\\n        "],[10,1],[12],[1,"\\n          "],[1,[28,[32,0],["post_voting.topic.activity"],null]],[1,"\\n        "],[13],[1,"\\n        "],[8,[32,1],[[16,0,[28,[32,2],["post-voting-answers-headers-sort-votes",[52,[51,[30,0,["sortedByActivity"]]],"active"]],null]]],[["@disabled","@label","@action"],[[28,[32,3],[[30,0,["sortedByActivity"]]],null],"post_voting.topic.votes",[30,0,["orderByVotes"]]]],null],[1,"\\n        "],[8,[32,1],[[16,0,[28,[32,2],["post-voting-answers-headers-sort-activity",[52,[30,0,["sortedByActivity"]],"active"]],null]]],[["@disabled","@label","@action"],[[30,0,["sortedByActivity"]],"post_voting.topic.activity",[30,0,["orderByActivity"]]]],null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],[],false,["unless","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-answer-header.js",scope:()=>[r.i18n,i.default,n.default,s.not],isStrictMode:!0}),this))()}t.default=p})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-button",["exports","@glimmer/component","@ember/modifier","@ember/object","discourse/components/d-button","discourse/helpers/concat-class","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class a extends e.default{get buttonClasses(){let t="up"===this.args.direction?"post-voting-button-upvote":"post-voting-button-downvote"
return this.args.voted&&(t+=" post-voting-button-voted"),t}get disabled(){return this.args.disabled||this.args.loading}get iconName(){return"up"===this.args.direction?"caret-up":"caret-down"}onClick(){if(this.args.loading)return!1
this.args.voted?this.args.removeVote(this.args.direction):this.args.vote(this.args.direction)}static#t=(()=>dt7948.n(this.prototype,"onClick",[s.action]))()
static#o=(()=>(0,r.setComponentTemplate)((0,c.createTemplateFactory)({id:"MSTEXRv2",block:'[[[1,"\\n    "],[8,[32,0],[[16,0,[28,[32,1],["btn-flat post-voting-button",[30,0,["buttonClasses"]]],null]],[4,[32,2],["click",[30,0,["onClick"]]],null]],[["@disabled","@icon"],[[30,0,["disabled"]],[30,0,["iconName"]]]],null],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-button.js",scope:()=>[i.default,n.default,o.on],isStrictMode:!0}),this))()}t.default=a})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-actions",["exports","@glimmer/component","@ember/object","@ember/service","discourse/components/d-button","discourse/components/modal/flag","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-post-voting/discourse/lib/post-voting-flag","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a,d,p,l){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class u extends e.default{static#t=(()=>dt7948.g(this.prototype,"dialog",[s.service]))()
#i=(()=>{dt7948.i(this,"dialog")})()
static#o=(()=>dt7948.g(this.prototype,"modal",[s.service]))()
#n=(()=>{dt7948.i(this,"modal")})()
static#s=(()=>dt7948.g(this.prototype,"currentUser",[s.service]))()
#r=(()=>{dt7948.i(this,"currentUser")})()
static#c=(()=>dt7948.g(this.prototype,"siteSettings",[s.service]))()
#a=(()=>{dt7948.i(this,"siteSettings")})()
static#d=(()=>dt7948.g(this.prototype,"site",[s.service]))()
#e=(()=>{dt7948.i(this,"site")})()
comment=this.args.comment
hasPermission(){return this.comment.user_id===this.currentUser.id||this.currentUser.admin||this.currentUser.moderator}get canEdit(){return this.currentUser&&this.hasPermission&&!this.args.disabled}get canFlag(){return this.currentUser&&(this.hasPermission||this.currentUser.can_flag_post_voting_comments)&&!this.args.disabled}deleteConfirm(){this.dialog.deleteConfirm({message:(0,a.i18n)("post_voting.post.post_voting_comment.delete.confirm"),didConfirm:()=>{const t={comment_id:this.args.id};(0,r.ajax)("/post_voting/comments",{type:"DELETE",data:t}).then((()=>{this.args.removeComment(this.args.id)})).catch(c.popupAjaxError)}})}static#p=(()=>dt7948.n(this.prototype,"deleteConfirm",[o.action]))()
showFlag(){this.comment.availableFlags=this.comment.available_flags,this.modal.show(n.default,{model:{flagTarget:new d.default,flagModel:this.comment,setHidden:()=>this.comment.hidden=!0,site:this.site}})}static#l=(()=>dt7948.n(this.prototype,"showFlag",[o.action]))()
static#u=(()=>(0,p.setComponentTemplate)((0,l.createTemplateFactory)({id:"TFVGWV6x",block:'[[[1,"\\n"],[41,[30,0,["canEdit"]],[[[1,"      "],[10,1],[14,0,"post-voting-comment-actions"],[12],[1,"\\n        "],[8,[32,0],[[24,0,"post-voting-comment-actions-edit-link"]],[["@display","@action","@icon"],["link",[30,1],"pencil"]],null],[1,"\\n        "],[8,[32,0],[[24,0,"post-voting-comment-actions-delete-link"]],[["@display","@action","@icon"],["link",[30,0,["deleteConfirm"]],"far-trash-can"]],null],[1,"\\n\\n"],[41,[30,0,["canFlag"]],[[[1,"          "],[8,[32,0],[[24,0,"post-voting-comment-actions-flag-link"]],[["@display","@action","@icon"],["link",[30,0,["showFlag"]],"flag"]],null],[1,"\\n"]],[]],null],[1,"      "],[13],[1,"\\n"]],[]],null],[1,"  "]],["@updateComment"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-actions.js",scope:()=>[i.default],isStrictMode:!0}),this))()}t.default=u})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-composer",["exports","@glimmer/component","@glimmer/tracking","@ember/modifier","@ember/object","@ember/service","discourse-i18n","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class d extends e.default{static#t=(()=>dt7948.g(this.prototype,"siteSettings",[n.service]))()
#a=(()=>{dt7948.i(this,"siteSettings")})()
static#o=(()=>dt7948.g(this.prototype,"value",[o.tracked],(function(){return this.args.raw??""})))()
#m=(()=>{dt7948.i(this,"value")})()
onInput(t){this.value=t.target.value,this.args.onInput?.(t.target.value)}static#s=(()=>dt7948.n(this.prototype,"onInput",[i.action]))()
get errorMessage(){return this.value.length<this.siteSettings.min_post_length?(0,r.i18n)("post_voting.post.post_voting_comment.composer.too_short",{count:this.siteSettings.min_post_length}):this.value.length>this.siteSettings.post_voting_comment_max_raw_length?(0,r.i18n)("post_voting.post.post_voting_comment.composer.too_long",{count:this.siteSettings.post_voting_comment_max_raw_length}):void 0}get remainingCharacters(){return this.siteSettings.post_voting_comment_max_raw_length-this.value.length}static#c=(()=>(0,c.setComponentTemplate)((0,a.createTemplateFactory)({id:"e/BERB7l",block:'[[[1,"\\n    "],[10,0],[14,0,"post-voting-comment-composer"],[12],[1,"\\n      "],[11,"textarea"],[24,0,"post-voting-comment-composer-textarea"],[16,2,[30,0,["value"]]],[4,[32,0],["input",[30,0,["onInput"]]],null],[4,[32,0],["keydown",[30,1]],null],[12],[13],[1,"\\n\\n"],[41,[30,0,["value","length"]],[[[41,[30,0,["errorMessage"]],[[[1,"          "],[10,0],[14,0,"post-voting-comment-composer-flash error"],[12],[1,"\\n            "],[1,[30,0,["errorMessage"]]],[1,"\\n          "],[13],[1,"\\n"]],[]],[[[1,"          "],[10,0],[14,0,"post-voting-comment-composer-flash"],[12],[1,"\\n            "],[1,[28,[32,1],["post_voting.post.post_voting_comment.composer.length_ok"],[["count"],[[30,0,["remainingCharacters"]]]]]],[1,"\\n          "],[13],[1,"\\n"]],[]]]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@onKeyDown"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-composer.js",scope:()=>[s.on,r.i18n],isStrictMode:!0}),this))()}t.default=d})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-editor",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-composer","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a,d,p){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class l extends e.default{static#t=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#a=(()=>{dt7948.i(this,"siteSettings")})()
static#o=(()=>dt7948.g(this.prototype,"value",[o.tracked],(function(){return this.args.raw})))()
#m=(()=>{dt7948.i(this,"value")})()
static#s=(()=>dt7948.g(this.prototype,"submitDisabled",[o.tracked],(function(){return!0})))()
#g=(()=>{dt7948.i(this,"submitDisabled")})()
updateValue(t){this.value=t,this.submitDisabled=t.length<this.siteSettings.min_post_length||t.length>this.siteSettings.post_voting_comment_max_raw_length}static#c=(()=>dt7948.n(this.prototype,"updateValue",[s.action]))()
onKeyDown(t){"Enter"===t.key&&(t.ctrlKey||t.metaKey)&&this.saveComment()}static#d=(()=>dt7948.n(this.prototype,"onKeyDown",[s.action]))()
saveComment(){this.submitDisabled=!0
const t={comment_id:this.args.id,raw:this.value}
return(0,r.ajax)("/post_voting/comments",{type:"PUT",data:t}).then(this.args.onSave).catch(c.popupAjaxError).finally((()=>{this.submitDisabled=!1}))}static#p=(()=>dt7948.n(this.prototype,"saveComment",[s.action]))()
static#l=(()=>(0,d.setComponentTemplate)((0,p.createTemplateFactory)({id:"kVR3ayWV",block:'[[[1,"\\n    "],[10,0],[15,0,[29,["post-voting-comment-editor post-voting-comment-editor-",[30,1]]]],[12],[1,"\\n      "],[8,[32,0],null,[["@onInput","@raw","@onKeyDown"],[[30,0,["updateValue"]],[30,2],[30,0,["onKeyDown"]]]],null],[1,"\\n\\n      "],[8,[32,1],[[24,0,"btn-primary post-voting-comment-editor-submit"]],[["@action","@disabled","@label","@icon"],[[30,0,["saveComment"]],[30,0,["submitDisabled"]],"post_voting.post.post_voting_comment.edit","pencil"]],null],[1,"\\n\\n      "],[8,[32,1],[[24,0,"post-voting-comment-editor-cancel"]],[["@display","@action","@label"],["link",[30,3],"post_voting.post.post_voting_comment.cancel"]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@id","@raw","@onCancel"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-editor.js",scope:()=>[a.default,n.default],isStrictMode:!0}),this))()}t.default=l})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/helpers/format-date","discourse/helpers/format-username","discourse/helpers/html-safe","discourse/helpers/route-action","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-post-voting/discourse/components/post-voting-button","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-actions","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-editor","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a,d,p,l,u,m,g,v,_){"use strict"
function h(t){return`post-voting-comment-${t}`}Object.defineProperty(t,"__esModule",{value:!0}),t.buildAnchorId=h,t.default=void 0
class f extends e.default{static#t=(()=>dt7948.g(this.prototype,"currentUser",[i.service]))()
#r=(()=>{dt7948.i(this,"currentUser")})()
static#o=(()=>dt7948.g(this.prototype,"isEditing",[o.tracked],(function(){return!1})))()
#v=(()=>{dt7948.i(this,"isEditing")})()
static#s=(()=>dt7948.g(this.prototype,"isVoting",[o.tracked],(function(){return!1})))()
#_=(()=>{dt7948.i(this,"isVoting")})()
static#c=(()=>dt7948.g(this.prototype,"hidden",[o.tracked],(function(){return!1})))()
#h=(()=>{dt7948.i(this,"hidden")})()
get anchorId(){return h(this.args.comment.id)}onSave(t){this.args.updateComment(t),this.collapseEditor()}static#d=(()=>dt7948.n(this.prototype,"onSave",[s.action]))()
onCancel(){this.collapseEditor()}static#p=(()=>dt7948.n(this.prototype,"onCancel",[s.action]))()
removeVote(){return this.isVoting=!0,this.args.removeVote(this.args.comment.id),(0,d.ajax)("/post_voting/vote/comment",{type:"DELETE",data:{comment_id:this.args.comment.id}}).catch((t=>{this.args.vote(this.args.comment.id),(0,p.popupAjaxError)(t)})).finally((()=>{this.isVoting=!1}))}static#l=(()=>dt7948.n(this.prototype,"removeVote",[s.action]))()
vote(t){if("up"===t)return this.isVoting=!0,this.args.vote(this.args.comment.id),(0,d.ajax)("/post_voting/vote/comment",{type:"POST",data:{comment_id:this.args.comment.id}}).catch((t=>{this.args.removeVote(this.args.comment.id),(0,p.popupAjaxError)(t)})).finally((()=>{this.isVoting=!1}))}static#u=(()=>dt7948.n(this.prototype,"vote",[s.action]))()
expandEditor(){this.isEditing=!0}static#f=(()=>dt7948.n(this.prototype,"expandEditor",[s.action]))()
collapseEditor(){this.isEditing=!1}static#b=(()=>dt7948.n(this.prototype,"collapseEditor",[s.action]))()
static#y=(()=>(0,v.setComponentTemplate)((0,_.createTemplateFactory)({id:"FrEWfjx3",block:'[[[1,"\\n    "],[10,0],[15,1,[30,0,["anchorId"]]],[15,0,[29,["post-voting-comment\\n        ",[52,[30,1,["deleted"]],"post-voting-comment-deleted"]]]],[12],[1,"\\n"],[41,[30,0,["isEditing"]],[[[1,"        "],[8,[32,0],null,[["@id","@raw","@onSave","@onCancel"],[[30,1,["id"]],[30,1,["raw"]],[30,0,["onSave"]],[30,0,["onCancel"]]]],null],[1,"\\n"]],[]],[[[1,"        "],[10,0],[14,0,"post-voting-comment-actions-vote"],[12],[1,"\\n"],[41,[30,1,["post_voting_vote_count"]],[[[1,"            "],[10,1],[14,0,"post-voting-comment-actions-vote-count"],[12],[1,[30,1,["post_voting_vote_count"]]],[13],[1,"\\n"]],[]],null],[1,"\\n          "],[8,[32,1],null,[["@direction","@loading","@voted","@removeVote","@vote","@disabled"],["up",[30,2],[30,1,["user_voted"]],[30,0,["removeVote"]],[52,[30,0,["currentUser"]],[30,0,["vote"]],[28,[32,2],["showLogin"],null]],[30,3]]],null],[1,"\\n        "],[13],[1,"\\n\\n        "],[10,0],[14,0,"post-voting-comment-post"],[12],[1,"\\n          "],[10,1],[14,0,"post-voting-comment-cooked"],[12],[1,[28,[32,3],[[30,1,["cooked"]]],null]],[13],[1,"\\n\\n          "],[10,1],[14,0,"post-voting-comment-info-separator"],[12],[1,"â€“"],[13],[1,"\\n\\n"],[41,[30,1,["username"]],[[[1,"            "],[10,3],[14,0,"post-voting-comment-info-username"],[15,"data-user-card",[30,1,["username"]]],[12],[1,"\\n              "],[1,[28,[32,4],[[30,1,["username"]]],null]],[1,"\\n            "],[13],[1,"\\n"]],[]],[[[1,"            "],[10,1],[14,0,"post-voting-comment-info-username post-voting-comment-info-username-deleted"],[12],[1,"\\n              "],[1,[28,[32,5],["post_voting.post.post_voting_comment.user.deleted"],null]],[1,"\\n            "],[13],[1,"\\n"]],[]]],[1,"\\n          "],[10,1],[14,0,"post-voting-comment-info-created"],[12],[1,"\\n            "],[1,[28,[32,6],[[30,1,["created_at"]]],null]],[1,"\\n          "],[13],[1,"\\n\\n          "],[8,[32,7],null,[["@id","@updateComment","@removeComment","@comment","@disabled"],[[30,1,["id"]],[30,0,["expandEditor"]],[30,4],[30,1],[30,3]]],null],[1,"\\n\\n        "],[13],[1,"\\n"]],[]]],[1,"    "],[13],[1,"\\n  "]],["@comment","@isVoting","@disabled","@removeComment"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment.js",scope:()=>[g.default,u.default,a.default,c.default,r.default,l.i18n,n.default,m.default],isStrictMode:!0}),this))()}t.default=f})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments-menu-composer",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax","discourse/lib/ajax-error","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment-composer","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a,d,p){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class l extends e.default{static#t=(()=>dt7948.g(this.prototype,"siteSettings",[i.service]))()
#a=(()=>{dt7948.i(this,"siteSettings")})()
static#o=(()=>dt7948.g(this.prototype,"value",[o.tracked],(function(){return""})))()
#m=(()=>{dt7948.i(this,"value")})()
static#s=(()=>dt7948.g(this.prototype,"submitDisabled",[o.tracked],(function(){return!0})))()
#g=(()=>{dt7948.i(this,"submitDisabled")})()
onKeyDown(t){"Enter"===t.key&&(t.ctrlKey||t.metaKey)&&this.saveComment()}static#c=(()=>dt7948.n(this.prototype,"onKeyDown",[s.action]))()
updateValue(t){this.submitDisabled=t.length<this.siteSettings.min_post_length||t.length>this.siteSettings.post_voting_comment_max_raw_length,this.value=t}static#d=(()=>dt7948.n(this.prototype,"updateValue",[s.action]))()
saveComment(){return this.submitDisabled=!0,(0,r.ajax)("/post_voting/comments",{type:"POST",data:{raw:this.value,post_id:this.args.id}}).then((t=>{this.args.onSave(t),this.value=""})).catch(c.popupAjaxError).finally((()=>{this.submitDisabled=!1}))}static#p=(()=>dt7948.n(this.prototype,"saveComment",[s.action]))()
static#l=(()=>(0,d.setComponentTemplate)((0,p.createTemplateFactory)({id:"E91EyHtD",block:'[[[1,"\\n    "],[10,0],[14,0,"post-voting-comments-menu-composer"],[12],[1,"\\n      "],[8,[32,0],null,[["@onInput","@onKeyDown"],[[30,0,["updateValue"]],[30,0,["onKeyDown"]]]],null],[1,"\\n\\n      "],[8,[32,1],[[24,0,"btn-primary post-voting-comments-menu-composer-submit"]],[["@action","@disabled","@icon","@label"],[[30,0,["saveComment"]],[30,0,["submitDisabled"]],"reply","post_voting.post.post_voting_comment.submit"]],null],[1,"\\n\\n      "],[8,[32,1],[[24,0,"post-voting-comments-menu-composer-cancel"]],[["@display","@action","@label"],["link",[30,1],"post_voting.post.post_voting_comment.cancel"]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@onCancel"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments-menu-composer.js",scope:()=>[a.default,n.default],isStrictMode:!0}),this))()}t.default=l})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments-menu",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/runloop","@ember/service","rsvp","discourse/components/d-button","discourse/helpers/route-action","discourse/lib/ajax","discourse/lib/ajax-error","discourse-i18n","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments-menu-composer","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a,d,p,l,u,m,g){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class v extends e.default{static#t=(()=>dt7948.g(this.prototype,"currentUser",[n.service]))()
#r=(()=>{dt7948.i(this,"currentUser")})()
static#o=(()=>dt7948.g(this.prototype,"expanded",[o.tracked],(function(){return!1})))()
#w=(()=>{dt7948.i(this,"expanded")})()
get hasMoreComments(){return this.args.moreCommentCount>0}handleSave(t){this.closeComposer(),this.args.appendComments([t])}static#s=(()=>dt7948.n(this.prototype,"handleSave",[s.action]))()
expandComposer(){this.expanded=!0,this.fetchComments().then((()=>{(0,i.schedule)("afterRender",(()=>{const t=document.querySelector(`#post_${this.args.postNumber} .post-voting-comment-composer .post-voting-comment-composer-textarea`)
t.focus(),t.select()}))}))}static#c=(()=>dt7948.n(this.prototype,"expandComposer",[s.action]))()
closeComposer(){this.expanded=!1}static#d=(()=>dt7948.n(this.prototype,"closeComposer",[s.action]))()
fetchComments(){if(!this.args.id)return r.Promise.resolve()
const t={post_id:this.args.id,last_comment_id:this.args.lastCommentId}
return(0,d.ajax)("/post_voting/comments",{type:"GET",data:t}).then((t=>{t.comments.length>0&&this.args.appendComments(t.comments)})).catch(p.popupAjaxError)}static#p=(()=>dt7948.n(this.prototype,"fetchComments",[s.action]))()
static#l=(()=>(0,m.setComponentTemplate)((0,g.createTemplateFactory)({id:"du9f0Hrv",block:'[[[1,"\\n    "],[10,0],[14,0,"post-voting-comments-menu"],[12],[1,"\\n"],[41,[30,0,["expanded"]],[[[1,"        "],[8,[32,0],null,[["@id","@onSave","@onCancel"],[[30,1],[30,0,["handleSave"]],[30,0,["closeComposer"]]]],null],[1,"\\n"]],[]],[[[1,"        "],[8,[32,1],[[24,0,"post-voting-comment-add-link"]],[["@display","@action","@label"],["link",[52,[30,0,["currentUser"]],[30,0,["expandComposer"]],[28,[32,2],["showLogin"],null]],"post_voting.post.post_voting_comment.add"]],null],[1,"\\n"]],[]]],[1,"\\n"],[41,[30,0,["hasMoreComments"]],[[[41,[51,[30,0,["expanded"]]],[[[1,"          "],[10,1],[14,0,"post-voting-comments-menu-separator"],[12],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[10,0],[14,0,"post-voting-comments-menu-show-more"],[12],[1,"\\n          "],[8,[32,1],[[24,0,"post-voting-comments-menu-show-more-link"]],[["@display","@action","@translatedLabel"],["link",[30,0,["fetchComments"]],[28,[32,3],["post_voting.post.post_voting_comment.show"],[["count"],[[30,2]]]]]],null],[1,"\\n        "],[13],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["@id","@moreCommentCount"],false,["if","unless"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments-menu.js",scope:()=>[u.default,c.default,a.default,l.i18n],isStrictMode:!0}),this))()}t.default=v})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments",["exports","@glimmer/component","@glimmer/tracking","@ember/object","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments-menu","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class a extends e.default{static#t=(()=>dt7948.g(this.prototype,"comments",[o.tracked],(function(){return this.args.post.comments})))()
#C=(()=>{dt7948.i(this,"comments")})()
get moreCommentCount(){return this.args.post.comments_count-this.comments.length}get lastCommentId(){return this.comments?.[this.comments.length-1]?.id??0}get disabled(){return this.args.post.topic.closed||this.args.post.topic.archived}appendComments(t){this.comments.pushObjects(t)}static#o=(()=>dt7948.n(this.prototype,"appendComments",[s.action]))()
removeComment(t){const e=this.comments.findIndex((e=>e.id===t))
if(-1!==e){const t={...this.comments[e],deleted:!0}
this.comments.replace(e,1,[t]),this.args.post.comments_count--}}static#s=(()=>dt7948.n(this.prototype,"removeComment",[s.action]))()
updateComment(t){const e=this.comments.findIndex((e=>e.id===t.id))
this.comments.replace(e,1,[t])}static#c=(()=>dt7948.n(this.prototype,"updateComment",[s.action]))()
vote(t){const e=this.comments.findIndex((e=>e.id===t)),o=this.comments[e],s={...o,post_voting_vote_count:o.post_voting_vote_count+1,user_voted:!0}
this.comments.replace(e,1,[s])}static#d=(()=>dt7948.n(this.prototype,"vote",[s.action]))()
removeVote(t){const e=this.comments.findIndex((e=>e.id===t)),o=this.comments[e],s={...o,post_voting_vote_count:o.post_voting_vote_count-1,user_voted:!1}
this.comments.replace(e,1,[s])}static#p=(()=>dt7948.n(this.prototype,"removeVote",[s.action]))()
static#l=(()=>(0,r.setComponentTemplate)((0,c.createTemplateFactory)({id:"FipjH4Tg",block:'[[[1,"\\n    "],[10,0],[14,0,"post-voting-comments"],[12],[1,"\\n"],[42,[28,[31,1],[[28,[31,1],[[30,0,["comments"]]],null]],null],null,[[[1,"        "],[8,[32,0],null,[["@comment","@removeComment","@updateComment","@vote","@removeVote","@disabled"],[[30,1],[30,0,["removeComment"]],[30,0,["updateComment"]],[30,0,["vote"]],[30,0,["removeVote"]],[30,0,["disabled"]]]],null],[1,"\\n"]],[1]],null],[1,"\\n"],[41,[30,2],[[[1,"        "],[8,[32,1],null,[["@id","@postNumber","@moreCommentCount","@lastCommentId","@appendComments"],[[30,3,["id"]],[30,3,["post_number"]],[30,0,["moreCommentCount"]],[30,0,["lastCommentId"]],[30,0,["appendComments"]]]],null],[1,"\\n"]],[]],null],[1,"    "],[13],[1,"\\n  "]],["comment","@canCreatePost","@post"],false,["each","-track-array","if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments.js",scope:()=>[i.default,n.default],isStrictMode:!0}),this))()}t.default=a})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-vote-controls",["exports","@glimmer/component","@glimmer/tracking","@ember/object","@ember/service","discourse/components/d-button","discourse/lib/ajax-error","discourse/plugins/discourse-post-voting/discourse/lib/post-voting-utilities","discourse/plugins/discourse-post-voting/discourse/components/post-voting-button","discourse/plugins/discourse-post-voting/discourse/components/post-voting-who-voted-list","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a,d,p,l){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class u extends e.default{static#t=(()=>dt7948.g(this.prototype,"currentUser",[i.service]))()
#r=(()=>{dt7948.i(this,"currentUser")})()
static#o=(()=>dt7948.g(this.prototype,"loading",[o.tracked]))()
#j=(()=>{dt7948.i(this,"loading")})()
static#s=(()=>dt7948.g(this.prototype,"showWhoVoted",[o.tracked],(function(){return!1})))()
#x=(()=>{dt7948.i(this,"showWhoVoted")})()
get count(){return this.args.post_voting_vote_count||0}get disabled(){return this.args.post.topic.archived||this.args.post.topic.closed}get hasVotes(){return this.args.post.post_voting_has_votes}get votedUp(){return"up"===this.args.post.post_voting_user_voted_direction}get votedDown(){return"down"===this.args.post.post_voting_user_voted_direction}async removeVote(t){const e=this.args.post,o="up"===t?-1:1
e.post_voting_user_voted_direction=null,e.post_voting_vote_count=e.post_voting_vote_count+o
const s=e.post_voting_vote_count
this.loading=!0
try{return await(0,c.removeVote)({post_id:e.id})}catch(i){e.post_voting_user_voted_direction=t,e.post_voting_vote_count=s-o,(0,r.popupAjaxError)(i)}finally{this.loading=!1}}static#c=(()=>dt7948.n(this.prototype,"removeVote",[s.action]))()
async vote(t){if(!this.currentUser)return this.args.showLogin()
const e=this.args.post
let o={post_id:e.id,direction:t}
const s="up"===t
let i
i=e.post_voting_user_voted_direction?s?2:-2:s?1:-1,e.post_voting_user_voted_direction=t,e.post_voting_vote_count=e.post_voting_vote_count+i
const n=e.post_voting_vote_count
this.loading=!0
try{return await(0,c.castVote)(o)}catch(a){e.setProperties({post_voting_user_voted_direction:null,post_voting_vote_count:n-i}),(0,r.popupAjaxError)(a)}finally{this.loading=!1}}static#d=(()=>dt7948.n(this.prototype,"vote",[s.action]))()
toggleWhoVoted(){this.showWhoVoted=!this.showWhoVoted}static#p=(()=>dt7948.n(this.prototype,"toggleWhoVoted",[s.action]))()
static#l=(()=>(0,p.setComponentTemplate)((0,l.createTemplateFactory)({id:"xin6uLDH",block:'[[[1,"\\n    "],[10,0],[14,0,"post-voting-post"],[12],[1,"\\n      "],[8,[32,0],null,[["@direction","@disabled","@loading","@removeVote","@vote","@voted"],["up",[30,0,["disabled"]],[30,0,["loading"]],[30,0,["removeVote"]],[30,0,["vote"]],[30,0,["votedUp"]]]],null],[1,"\\n\\n"],[41,[30,0,["hasVotes"]],[[[1,"        "],[8,[32,1],[[24,0,"post-voting-post-toggle-voters btn-flat"]],[["@action","@translatedLabel"],[[30,0,["toggleWhoVoted"]],[30,1,["post_voting_vote_count"]]]],null],[1,"\\n"],[41,[30,0,["showWhoVoted"]],[[[1,"          "],[8,[32,2],null,[["@post","@onClickOutside"],[[30,1],[30,0,["toggleWhoVoted"]]]],null],[1,"\\n"]],[]],null]],[]],[[[1,"        "],[10,1],[14,0,"post-voting-post-toggle-voters"],[12],[1,"\\n          "],[1,[30,0,["count"]]],[1,"\\n        "],[13],[1,"\\n"]],[]]],[1,"\\n      "],[8,[32,0],null,[["@direction","@disabled","@loading","@removeVote","@vote","@voted"],["down",[30,0,["disabled"]],[30,0,["loading"]],[30,0,["removeVote"]],[30,0,["vote"]],[30,0,["votedDown"]]]],null],[1,"\\n    "],[13],[1,"\\n  "]],["@post"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-vote-controls.js",scope:()=>[a.default,n.default,d.default],isStrictMode:!0}),this))()}t.default=u})),define("discourse/plugins/discourse-post-voting/discourse/components/post-voting-who-voted-list",["exports","@glimmer/component","@ember/helper","@ember/object","truth-helpers","discourse/components/async-content","discourse/components/small-user-list","discourse/helpers/d-icon","discourse/lib/decorators","discourse/modifiers/close-on-click-outside","discourse-i18n","discourse/plugins/discourse-post-voting/discourse/lib/post-voting-utilities","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(t,e,o,s,i,n,r,c,a,d,p,l,u,m,g){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class v extends e.default{calcRemainingCount(t){return this.args.post.post_voting_vote_count-t.length}static#t=(()=>dt7948.n(this.prototype,"calcRemainingCount",[a.bind]))()
splitUpAndDownLists(t){const e=[],o=[]
return t.forEach((t=>{"up"===t.direction?e.push(t):"down"===t.direction&&o.push(t)})),{up:e,down:o}}static#o=(()=>dt7948.n(this.prototype,"splitUpAndDownLists",[a.bind]))()
async loadWhoVoted(){const t=await(0,l.whoVoted)({post_id:this.args.post.id})
return t.voters?.map((t=>{const e=(0,r.smallUserAttrs)(t)
return e.direction=t.direction,e}))}static#s=(()=>dt7948.n(this.prototype,"loadWhoVoted",[s.action]))()
static#c=(()=>(0,u.setComponentTemplate)((0,m.createTemplateFactory)({id:"AbW4321p",block:'[[[1,"\\n    "],[11,0],[24,0,"post-voting-post-list"],[4,[32,0],[[30,1],[28,[32,1],null,[["targetSelector","secondaryTargetSelector"],[".post-voting-post-list",".post-voting-post-toggle-voters"]]]],null],[12],[1,"\\n      "],[8,[32,2],null,[["@asyncData"],[[30,0,["loadWhoVoted"]]]],[["loading","content"],[[[[1,"\\n          "],[1,[28,[32,3],["loading"],null]],[1,"\\n        "]],[]],[[[1,"\\n"],[41,[32,4],[[[44,[[28,[30,0,["splitUpAndDownLists"]],[[30,2]],null]],[[[1,"              "],[8,[32,5],null,[["@list","@direction"],[[28,[32,6],[[30,3],"up"],null],"up"]],null],[1,"\\n              "],[8,[32,5],null,[["@list","@direction"],[[28,[32,6],[[30,3],"down"],null],"down"]],null],[1,"\\n"]],[3]]],[44,[[28,[30,0,["calcRemainingCount"]],[[30,2]],null]],[[[41,[30,4],[[[1,"                "],[10,1],[12],[1,"\\n                  "],[1,[28,[32,3],["post_voting.topic.voters_count_diff"],[["count"],[[30,4]]]]],[1,"\\n                "],[13],[1,"\\n"]],[]],null]],[4]]]],[]],null],[1,"        "]],[2]]]]],[1,"\\n    "],[13],[1,"\\n  "]],["@onClickOutside","voters","splitVoters","remainingCount"],false,["if","let"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-who-voted-list.js",scope:()=>[d.default,o.hash,n.default,p.i18n,l.whoVoted,_,s.get],isStrictMode:!0}),this))()}t.default=v
const _=(0,u.setComponentTemplate)((0,m.createTemplateFactory)({id:"ohxXjYn8",block:'[[[1,"\\n"],[41,[30,1],[[[1,"    "],[10,0],[14,0,"post-voting-post-list-voters-wrapper"],[12],[1,"\\n      "],[10,1],[14,0,"post-voting-post-list-icon"],[12],[1,"\\n        "],[1,[28,[32,0],[[52,[28,[32,1],[[30,2],"up"],null],"caret-up","caret-down"]],null]],[1,"\\n      "],[13],[1,"\\n      "],[10,1],[14,0,"post-voting-post-list-count"],[12],[1,[30,1,["length"]]],[13],[1,"\\n      "],[8,[32,2],[[24,0,"post-voting-post-list-voters"]],[["@users"],[[30,1]]],null],[1,"\\n    "],[13],[1,"\\n"]],[]],null]],["@list","@direction"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/post-voting-who-voted-list.js",scope:()=>[c.default,i.eq,r.default],isStrictMode:!0}),(0,g.default)(void 0,"post-voting-who-voted-list:PostVotingSmallUserList"))})),define("discourse/plugins/discourse-post-voting/discourse/components/reviewable-post-voting-comment",["exports","@glimmer/component","@glimmer/tracking","@ember/helper","@ember/routing","@ember/service","truth-helpers","discourse/components/reviewable-created-by","discourse/components/reviewable-post-header","discourse/helpers/category-badge","discourse/helpers/html-safe","discourse-i18n","@ember/component","@ember/template-factory"],(function(t,e,o,s,i,n,r,c,a,d,p,l,u,m){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class g extends e.default{static#t=(()=>dt7948.g(this.prototype,"store",[n.service]))()
#V=(()=>{dt7948.i(this,"store")})()
static#o=(()=>dt7948.g(this.prototype,"post",[o.tracked]))()
#T=(()=>{dt7948.i(this,"post")})()
constructor(){super(...arguments),this.fetchPost()}async fetchPost(){const t=await this.store.find("post",this.args.reviewable.post_id)
this.post=t}static#s=(()=>(0,u.setComponentTemplate)((0,m.createTemplateFactory)({id:"xYwPu5fN",block:'[[[1,"\\n    "],[10,0],[14,0,"post-topic"],[12],[1,"\\n      "],[10,3],[14,0,"title-text"],[15,6,[30,0,["post","url"]]],[12],[1,"\\n        "],[1,[28,[32,0],[[30,1,["topic","fancyTitle"]]],null]],[13],[1,"\\n      "],[1,[28,[32,1],[[30,1,["category"]]],null]],[1,"\\n    "],[13],[1,"\\n\\n    "],[10,0],[14,0,"post-contents-wrapper"],[12],[1,"\\n      "],[8,[32,2],null,[["@user","@tagName"],[[30,1,["target_created_by"]],""]],null],[1,"\\n      "],[10,0],[14,0,"post-contents"],[12],[1,"\\n        "],[8,[32,3],null,[["@reviewable","@createdBy","@tagName"],[[30,1],[30,1,["target_created_by"]],""]],null],[1,"\\n\\n        "],[10,0],[14,0,"post-body"],[12],[1,"\\n          "],[1,[28,[32,0],[[28,[32,4],[[30,1,["payload","comment_cooked"]],[30,1,["cooked"]]],null]],null]],[1,"\\n        "],[13],[1,"\\n\\n"],[41,[30,1,["payload","transcript_topic_id"]],[[[1,"          "],[10,0],[14,0,"transcript"],[12],[1,"\\n            "],[8,[32,5],[[24,0,"btn btn-small"]],[["@route","@models"],["topic",[28,[32,6],["-",[30,1,["payload","transcript_topic_id"]]],null]]],[["default"],[[[[1,"\\n              "],[1,[28,[32,7],["review.transcript.view"],null]],[1,"\\n            "]],[]]]]],[1,"\\n          "],[13],[1,"\\n"]],[]],null],[1,"\\n        "],[18,2,null],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],["@reviewable","&default"],false,["if","yield"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/components/reviewable-post-voting-comment.js",scope:()=>[p.default,d.default,c.default,a.default,r.or,i.LinkTo,s.array,l.i18n],isStrictMode:!0}),this))()}t.default=g})),define("discourse/plugins/discourse-post-voting/discourse/connectors/category-custom-settings/post-voting-category-settings",["exports","@ember/component","@ember-decorators/component","discourse-i18n","@ember/template-factory"],(function(t,e,o,s,i){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
const n=dt7948.c(class extends e.default{static#t=(()=>(0,e.setComponentTemplate)((0,i.createTemplateFactory)({id:"9mu9n5AH",block:'[[[1,"\\n    "],[10,"h3"],[12],[1,[28,[32,0],["category.post_voting_settings_heading"],null]],[13],[1,"\\n    "],[10,"section"],[14,0,"field"],[12],[1,"\\n      "],[10,"label"],[12],[1,"\\n        "],[8,[32,1],[[24,1,"create-as-post-voting-default"]],[["@type","@checked"],["checkbox",[30,0,["category","custom_fields","create_as_post_voting_default"]]]],null],[1,"\\n        "],[1,[28,[32,0],["category.create_as_post_voting_default"],null]],[1,"\\n      "],[13],[1,"\\n      "],[10,"label"],[12],[1,"\\n        "],[8,[32,1],[[24,1,"only-post-voting-in-this-category"]],[["@type","@checked"],["checkbox",[30,0,["category","custom_fields","only_post_voting_in_this_category"]]]],null],[1,"\\n        "],[1,[28,[32,0],["category.only_post_voting_in_this_category"],null]],[1,"\\n      "],[13],[1,"\\n    "],[13],[1,"\\n  "]],[],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/connectors/category-custom-settings/post-voting-category-settings.js",scope:()=>[s.i18n,e.Input],isStrictMode:!0}),this))()},[(0,o.classNames)("category-custom-settings-outlet","post-voting-category-settings"),(0,o.tagName)("")])
t.default=n})),define("discourse/plugins/discourse-post-voting/discourse/connectors/topic-above-post-stream/add-post-voting-topic-page-class",["exports","truth-helpers","discourse/helpers/body-class","discourse/plugins/discourse-post-voting/discourse/components/post-voting-answer-header","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(t,e,o,s,i,n,r){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
const c=(0,i.setComponentTemplate)((0,n.createTemplateFactory)({id:"HN4LAjCz",block:'[[[1,"\\n"],[41,[30,1,["model","is_post_voting"]],[[[1,"    "],[1,[28,[32,0],[[52,[28,[32,1],[[30,1,["model","postStream","filter"]],[32,2]],null],"post-voting-topic-sort-by-activity","post-voting-topic"]],null]],[1,"\\n"]],[]],null]],["@outletArgs"],false,["if"]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/connectors/topic-above-post-stream/add-post-voting-topic-page-class.js",scope:()=>[o.default,e.eq,s.ORDER_BY_ACTIVITY_FILTER],isStrictMode:!0}),(0,r.default)(void 0,"add-post-voting-topic-page-class:AddPostVotingTopicPageClass"))
t.default=c})),define("discourse/plugins/discourse-post-voting/discourse/initializers/custom-post-message-callbacks",["exports","discourse/lib/plugin-api"],(function(t,e){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
t.default={name:"custom-post-message-callbacks",initialize(t){t.lookup("service:site-settings").post_voting_enabled&&(0,e.withPluginApi)("1.2.0",(t=>{t.registerCustomPostMessageCallback("post_voting_post_comment_edited",((t,e)=>{const o=t.get("model.postStream").findLoadedPost(e.id)
if(o){const s=o.comments.findIndex((t=>t.id===e.comment_id&&t.raw!==e.comment_raw))
if(-1!==s){const i={...o.comments[s],raw:e.comment_raw,cooked:e.comment_cooked}
o.comments.replace(s,1,[i]),t.appEvents.trigger("post-stream:refresh",{id:o.id})}}})),t.registerCustomPostMessageCallback("post_voting_post_comment_trashed",((t,e)=>{const o=t.get("model.postStream").findLoadedPost(e.id)
if(o){const s=o.comments.findIndex((t=>t.id===e.comment_id&&!t.deleted))
if(-1!==s){const t={...o.comments[s],deleted:!0}
o.comments.replace(s,1,[t])}o.set("comments_count",e.comments_count),t.appEvents.trigger("post-stream:refresh",{id:o.id})}})),t.registerCustomPostMessageCallback("post_voting_post_commented",((t,e)=>{const o=t.get("model.postStream").findLoadedPost(e.id)
o&&!o.comments.some((t=>t.id===e.comment.id))&&(o.setProperties({comments_count:e.comments_count}),o.comments_count-o.comments.length<=1&&t.currentUser.id!==e.comment.user_id&&o.comments.pushObject(e.comment),t.appEvents.trigger("post-stream:refresh",{id:o.id}))})),t.registerCustomPostMessageCallback("post_voting_post_voted",((t,e)=>{const o=t.get("model.postStream").findLoadedPost(e.id)
if(o){const s={post_voting_vote_count:e.post_voting_vote_count,post_voting_has_votes:e.post_voting_has_votes}
t.currentUser.id===e.post_voting_user_voted_id&&(s.post_voting_user_voted_direction=e.post_voting_user_voted_direction),o.setProperties(s),t.appEvents.trigger("post-stream:refresh",{id:o.id})}}))}))}}})),define("discourse/plugins/discourse-post-voting/discourse/initializers/extend-composer-actions",["exports","@ember/object","discourse/lib/plugin-api","discourse/models/composer","discourse-i18n"],(function(t,e,o,s,i){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
t.default={name:"extend-composer-actions",after:"inject-objects",initialize(t){t.lookup("service:site-settings").post_voting_enabled&&(0,o.withPluginApi)("0.13.0",(t=>{t.serializeOnCreate("create_as_post_voting","createAsPostVoting"),t.serializeOnCreate("only_post_voting_in_this_category","onlyPostVotingInThisCategory"),t.customizeComposerText({actionTitle:t=>t.createAsPostVoting||t.onlyPostVotingInThisCategory?(0,i.i18n)("composer.create_post_voting.label"):t.topic?.is_post_voting?(0,i.i18n)("post_voting.topic.answer.label"):null,saveLabel:t=>t.createAsPostVoting||t.onlyPostVotingInThisCategory?"composer.create_post_voting.label":t.topic?.is_post_voting?"post_voting.topic.answer.label":null}),t.modifyClass("component:composer-actions",{pluginId:"discourse-post-voting",togglePostVotingSelected(t,e){e.toggleProperty("createAsPostVoting"),e.notifyPropertyChange("replyOptions"),e.notifyPropertyChange("action")}}),t.modifySelectKit("composer-actions").appendContent((t=>t.action===s.CREATE_TOPIC?t.composerModel.createAsPostVoting&&!t.composerModel.onlyPostVotingInThisCategory?[{name:(0,i.i18n)("composer.composer_actions.remove_as_post_voting.label"),description:(0,i.i18n)("composer.composer_actions.remove_as_post_voting.desc"),icon:"plus",id:"togglePostVoting"}]:t.composerModel.onlyPostVotingInThisCategory?[]:[{name:(0,i.i18n)("composer.composer_actions.create_as_post_voting.label"),description:(0,i.i18n)("composer.composer_actions.create_as_post_voting.desc"),icon:"plus",id:"togglePostVoting"}]:[])),t.modifyClass("model:composer",{pluginId:"discourse-post-voting",categoryCreateAsPostVotingDefault:(0,e.observer)("categoryId",(function(){const t=this.category?.create_as_post_voting_default,e=this.category?.only_post_voting_in_this_category
this.creatingTopic&&e?(this.set("createAsPostVoting",!0),this.set("onlyPostVotingInThisCategory",e),this.notifyPropertyChange("replyOptions"),this.notifyPropertyChange("action")):this.creatingTopic&&t!==this.createAsPostVoting&&(this.set("createAsPostVoting",t),this.notifyPropertyChange("replyOptions"),this.notifyPropertyChange("action"))}))})}))}}})),define("discourse/plugins/discourse-post-voting/discourse/initializers/post-voting-edits",["exports","@glimmer/component","discourse/helpers/route-action","discourse/lib/deprecated","discourse/lib/plugin-api","discourse/widgets/render-glimmer","discourse-i18n","discourse/plugins/discourse-post-voting/discourse/components/post-voting-answer-button","discourse/plugins/discourse-post-voting/discourse/components/post-voting-answer-header","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comments","discourse/plugins/discourse-post-voting/discourse/components/post-voting-vote-controls","@ember/component","@ember/template-factory","@ember/component/template-only"],(function(t,e,o,s,i,n,r,c,a,d,p,l,u,m){"use strict"
function g(t,i){(function(t){t.addTrackedPostProperties("comments","comments_count","post_voting_user_voted_direction","post_voting_has_votes"),t.modifyClass("model:post-stream",(t=>class extends t{orderStreamByActivity(){return this.cancelFilter(),this.set("filter",a.ORDER_BY_ACTIVITY_FILTER),this.refreshAndJumpToSecondVisible()}orderStreamByVotes(){return this.cancelFilter(),this.refreshAndJumpToSecondVisible()}})),t.renderAfterWrapperOutlet("post-avatar",class extends e.default{static shouldRender(t){return t.post.topic?.is_post_voting}static#t=(()=>(0,l.setComponentTemplate)((0,u.createTemplateFactory)({id:"j9H3dULI",block:'[[[1,"\\n        "],[8,[32,0],null,[["@post","@showLogin"],[[30,1,["post"]],[28,[32,1],["showLogin"],null]]],null],[1,"\\n      "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/initializers/post-voting-edits.js",scope:()=>[p.default,o.default],isStrictMode:!0}),this))()}),t.renderBeforeWrapperOutlet("post-article",a.default),(0,s.withSilencedDeprecations)("discourse.post-stream-widget-overrides",(()=>function(t){t.reopenWidget("post",{orderByVotes(){this._topicController().model.postStream.orderStreamByVotes().then((()=>{this._refreshController()}))},orderByActivity(){this._topicController().model.postStream.orderStreamByActivity().then((()=>{this._refreshController()}))},_refreshController(){this._topicController().updateQueryParams()},_topicController(){return this.register.lookup("controller:topic")}}),t.decorateWidget("post-article:before",(t=>{const e=[],o=t.getModel()
if(!o.topic.is_post_voting)return e
const s=t.widget.register.lookup("controller:topic")
let i
i=s.replies_to_post_number&&1!==parseInt(s.replies_to_post_number,10)?2:1
const n=o.topic.posts_count-1
return n<=0||o.id!==o.topic.postStream.stream[i]||e.push(t.h("div.post-voting-answers-header.small-action",[t.h("span.post-voting-answers-headers-count",(0,r.i18n)("post_voting.topic.answer_count",{count:n})),t.h("span.post-voting-answers-headers-sort",[t.h("span",(0,r.i18n)("post_voting.topic.sort_by")),t.attach("button",{action:"orderByVotes",contents:(0,r.i18n)("post_voting.topic.votes"),disabled:s.filter!==a.ORDER_BY_ACTIVITY_FILTER,className:"post-voting-answers-headers-sort-votes "+(s.filter===a.ORDER_BY_ACTIVITY_FILTER?"":"active")}),t.attach("button",{action:"orderByActivity",contents:(0,r.i18n)("post_voting.topic.activity"),disabled:s.filter===a.ORDER_BY_ACTIVITY_FILTER,className:"post-voting-answers-headers-sort-activity "+(s.filter===a.ORDER_BY_ACTIVITY_FILTER?"active":"")})])])),e})),(0,n.registerWidgetShim)("post-voting-vote-controls","div.post-voting-post-shim",(0,l.setComponentTemplate)((0,u.createTemplateFactory)({id:"WJVPtAJ5",block:'[[[1,"\\n      "],[8,[32,0],null,[["@post","@showLogin"],[[30,1,["post"]],[28,[32,1],["showLogin"],null]]],null],[1,"\\n    "]],["@data"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/initializers/post-voting-edits.js",scope:()=>[p.default,o.default],isStrictMode:!0}),(0,m.default)(void 0,void 0))),t.decorateWidget("post-avatar:after",(function(t){const e=[],o=t.getModel()
if(o.topic?.is_post_voting){const s=t.attach("post-voting-vote-controls",{post:o})
e.push(s)}return e}))}(t)))})(t),function(t,o){const s=o.lookup("service:site-settings")
t.registerValueTransformer("post-menu-buttons",(t=>{let{value:e,context:{post:o,buttonKeys:i}}=t
void 0!==o.post_voting_has_votes&&(e.add("post-voting-answer",c.default,{after:[i.SHOW_MORE,i.REPLY]}),e.delete(i.REPLY),1===o.post_number||s.post_voting_enable_likes_on_answers||e.delete(i.LIKE))})),t.renderInOutlet("post-menu__after",class extends e.default{static shouldRender(t){return!(void 0===t.post.post_voting_has_votes||t.post.reply_to_post_number||t.state.filteredRepliesView&&t.state.repliesShown)}static#t=(()=>(0,l.setComponentTemplate)((0,u.createTemplateFactory)({id:"kUceQ+FN",block:'[[[1,"\\n        "],[8,[32,0],null,[["@post","@canCreatePost"],[[30,1,["post"]],[30,1,["state","canCreatePost"]]]],null],[1,"\\n      "]],["@outletArgs"],false,[]]',moduleName:"/var/www/discourse/app/assets/javascripts/discourse/discourse/plugins/discourse-post-voting/discourse/initializers/post-voting-edits.js",scope:()=>[d.default],isStrictMode:!0}),this))()})}(t,i),t.registerCustomLastUnreadUrlCallback((function(t){if(t.is_post_voting&&t.last_read_post_number)return t.highest_post_number<=t.last_read_post_number?t.urlForPostNumber(1):t.last_read_post_number===t.highest_post_number-1?t.urlForPostNumber(t.last_read_post_number+1):`${t.urlForPostNumber(t.last_read_post_number+1)}?filter=activity`}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
t.default={name:"post-voting-edits",initialize(t){t.lookup("service:site-settings").post_voting_enabled&&(0,i.withPluginApi)("1.13.0",(e=>{g(e,t)}))}}})),define("discourse/plugins/discourse-post-voting/discourse/initializers/post-voting-icon",["exports","discourse/lib/plugin-api","discourse/lib/utilities","discourse-i18n","discourse/plugins/discourse-post-voting/discourse/components/post-voting-comment"],(function(t,e,o,s,i){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
t.default={name:"post-voting-icon",initialize(t){t.lookup("service:site-settings").post_voting_enabled&&(0,e.withPluginApi)("1.18.0",(t=>{t.registerNotificationTypeRenderer("question_answer_user_commented",(t=>class extends t{get linkTitle(){return(0,s.i18n)("notifications.titles.question_answer_user_commented")}get linkHref(){return`${(0,o.postUrl)(this.notification.slug,this.topicId,this.notification.post_number)}#${(0,i.buildAnchorId)(this.notification.data.post_voting_comment_id)}`}get icon(){return"comment"}}))}))}}})),define("discourse/plugins/discourse-post-voting/discourse/lib/post-voting-flag",["exports","discourse/lib/ajax","discourse/lib/ajax-error","discourse/lib/flag-targets/flag"],(function(t,e,o,s){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0
class i extends s.default{title(){return"flagging.title"}customSubmitLabel(){return"flagging.notify_action"}submitLabel(){return"flagging.action"}flagCreatedEvent(){return"post:flag-created"}flagsAvailable(t){let e=t.site.flagTypes
e=e.filter((e=>t.args.model.flagModel.availableFlags.includes(e.name_key)))
const o=e.indexOf(e.filterBy("name_key","notify_user")[0])
if(-1!==o){const t=e[o]
e.splice(o,1),e.splice(0,0,t)}return e}async create(t,s){return t.args.closeModal(),(0,e.ajax)("/post_voting/comments/flag",{method:"PUT",data:{comment_id:t.args.model.flagModel.id,flag_type_id:t.selected.id,message:s.message,is_warning:s.isWarning,take_action:s.takeAction,queue_for_review:s.queue_for_review}}).catch((t=>(0,o.popupAjaxError)(t)))}}t.default=i})),define("discourse/plugins/discourse-post-voting/discourse/lib/post-voting-utilities",["exports","discourse/lib/ajax","discourse/lib/ajax-error"],(function(t,e,o){"use strict"
Object.defineProperty(t,"__esModule",{value:!0}),t.whoVoted=t.removeVote=t.castVote=void 0
const s=function(t,o){return(0,e.ajax)("/post_voting/vote",{type:t,data:o})}
t.removeVote=function(t){return s("DELETE",t)}
t.castVote=function(t){return s("POST",t)}
t.whoVoted=function(t){return(0,e.ajax)("/post_voting/voters",{type:"GET",data:t}).catch(o.popupAjaxError)}}))

//# sourceMappingURL=discourse-post-voting-6c02d7c7.map